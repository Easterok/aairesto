import{_ as Te}from"./index-127a01d9.js";import{d as Ie,Q as Be,l as ze,u as Me,r as S,b as I,an as Re,o,c,a as i,n as _,t as y,i as e,h as d,ak as We,k as h,bh as Ge,F as N,g as te,q as F,a1 as qe,j as k,S as fe,a6 as _e,s as g,x as w,R as l,ag as he,_ as Ee,b1 as je,w as re,ac as Ce,aa as ee,a9 as R,ab as le,ad as Le,br as Ue,aG as $e,A as Oe,ap as Ne,aC as Je,p as Fe,aj as Ke,a4 as Qe,aM as Ze,bl as He,Z as Xe,m as Ye,am as et,e as tt,f as at,D as st,bs as ot,B as De,av as ue,b9 as xe,a0 as Ae,ao as nt}from"./index-6367d8ff.js";import{E as lt}from"./index-55204b2b.js";import{F as it}from"./index-953ce25b.js";import{U as ye}from"./index-65b51942.js";import{c as we,b as ut}from"./index-1f2a23d2.js";import{u as Ve}from"./index-f484f4d0.js";/* empty css              */import"./index-cc030883.js";const rt=["data-id","data-high"],ct={style:{"text-align":"right"}},dt=["href"],_t=i("p",{class:"ark-text_body-xs ark-text_64"},"Комментарий",-1),mt={class:"ark-text_body-s-2 ark-text_medium"},vt=i("span",{class:"ark-space_left-1 ark-space_right-1"},"‐",-1),kt=Ie({__name:"BookingItem",props:{item:{},loading:{type:Boolean},highlight:{type:Boolean}},emits:["refresh"],setup(pe,{emit:me}){const b=pe,z=me,{item:f}=Be(b),L=ze(),P=Me(),O=S(!1),ae=S(!1),ve=S(!1),T=S(!1),C=S(!1),W=S(!1),ce=S(!1),G={"Не пересаживать":"lock","День рождения":"cake",Предзаказ:"order",Корпоратив:"party","Может опоздать":"slow","Пробковый сбор":"beer",Сертификат:"ticket","У окна":"window",Свидание:"heart","Деловая встреча":"business","Хочу напиться":"wine","Хочу поесть":"food"},M=I(()=>{const r=f.value;return r.phone_number?Re(r.phone_number):""}),K=I(()=>[...f.value.tags??[]].sort()),q=()=>{W.value=!0;const r=b.item.status,E={id:b.item.id,status:r};P.updateBooking.execute({id:b.item.id,status:l.APPLICATION}).then(A=>{A&&(L.show(he(ye),{autoClose:!1,type:"undo",data:{title:"Подтвердили бронь",callback:()=>P.updateBooking.execute(E).then(x=>{x&&z("refresh",x)})}}),z("refresh",A))}).catch(()=>{L.show("Попробуй еще раз",{label:"Не удалось подтвердить",type:"error"})}).finally(()=>{W.value=!1})},se=()=>{ce.value=!0;const r=b.item.status,E={id:b.item.id,status:r};P.updateBooking.execute({id:b.item.id,status:l.APPLICATION}).then(A=>{A&&(L.show(he(ye),{autoClose:!1,type:"undo",data:{title:"Вернули бронь",callback:()=>P.updateBooking.execute(E).then(x=>{x&&z("refresh",x)})}}),z("refresh",A))}).catch(()=>{L.show("Попробуй еще раз",{label:"Не удалось вернуть бронь",type:"error"})}).finally(()=>{ce.value=!1})},Z=()=>{T.value=!0;const r=b.item.status,E={id:b.item.id,status:r};P.updateBooking.execute({id:b.item.id,status:l.OPEN}).then(A=>{A&&(L.show(he(ye),{autoClose:!1,type:"undo",data:{title:"За столом",callback:()=>P.updateBooking.execute(E).then(x=>{x&&z("refresh",x)})}}),z("refresh",A))}).catch(()=>{L.show("Попробуй еще раз",{label:"Не удалось обновить",type:"error"})}).finally(()=>{T.value=!1})},X=()=>{C.value=!0;const r=b.item.status,E={id:b.item.id,status:r};P.updateBooking.execute({id:b.item.id,status:l.CLOSED}).then(A=>{A&&(L.show(he(ye),{autoClose:!1,type:"undo",data:{title:"Завершили бронь",callback:()=>P.updateBooking.execute(E).then(x=>{x&&z("refresh",x)})}}),z("refresh",A))}).catch(()=>{L.show("Попробуй еще раз",{label:"Не удалось обновить",type:"error"})}).finally(()=>{C.value=!1})},ke=()=>{ae.value=!0;const r=b.item.status,$=b.item.id,E=b.item.comment,A={id:$,status:r,comment:E};P.updateBooking.execute({id:b.item.id,status:l.CANCELLED}).then(x=>{x&&(L.show(he(ye),{autoClose:!1,type:"undo",data:{title:"Отменили бронь",callback:()=>P.updateBooking.execute(A).then(ie=>{ie&&z("refresh",ie)})}}),z("refresh",x))}).catch(()=>{L.show("Попробуй еще раз",{label:"Не удалось отменить бронирование",type:"error"})}).finally(()=>{ae.value=!1})},de=()=>{ve.value=!0,P.updateBooking.execute({id:b.item.id,clients_are_late:!0}).then(r=>{r&&(L.show("Перенесли на 15 минут"),z("refresh",r))}).catch(()=>{L.show("Попробуй еще раз",{label:"Не удалось перенести бронь",type:"error"})}).finally(()=>{ve.value=!1})},oe=r=>{r.animationName==="arkVibe"&&r.target&&r.target.classList.remove("ark-vibe")};return(r,$)=>(o(),c("div",{"data-id":e(f).id,class:_(r.$style.item),"data-high":r.highlight,onAnimationend:oe},[i("div",{class:_(["ark-text_h6 ark-space_bottom-1",[r.$style.item__header,r.loading&&"ark-skeleton"]])},[i("span",{class:_([r.$style.name,O.value&&r.$style.name_full]),onClick:$[0]||($[0]=E=>O.value=!O.value)},y(e(f).name_for_reservation),3),i("div",ct,[d(e(We),{tables:e(f).tables},null,8,["tables"])])],2),i("div",{class:_([r.$style.content,r.loading&&"ark-skeleton"])},[e(f).phone_number?(o(),c("a",{key:0,href:`tel:${e(f).phone_number}`,class:_(r.$style.phone)},y(M.value),11,dt)):h("",!0),d(e(Ge),{seating_time:e(f).seating_time,end_time:e(f).end_time,status:e(f).status},null,8,["seating_time","end_time","status"])],2),e(f).tags&&e(f).tags.length>0?(o(),c("div",{key:0,class:_(["ark-space_top-1",r.$style.tags])},[(o(!0),c(N,null,te(K.value,E=>(o(),c("div",{key:E,class:_(r.$style.tags__item)},[G[E]?(o(),F(e(qe),{key:0,name:G[E],size:"0.75rem"},null,8,["name"])):h("",!0),k(" "+y(E),1)],2))),128))],2)):h("",!0),e(f).comment?(o(),c("div",{key:1,class:_([r.$style.comment,r.loading&&"ark-skeleton"])},[_t,i("p",mt,y(e(f).comment),1)],2)):h("",!0),i("hr",{class:_(r.$style.hr)},null,2),i("div",{class:_(["ark-text_body-l-2 ark-text_semibold",[r.$style.inline,r.loading&&"ark-skeleton"]])},[d(e(fe),{class:"ark-text_48 ark-space_right-1",name:"clock",size:16}),d(e(_e),{mask:"[hour:numeric]:[minute:numeric]",date:e(f).seating_time},null,8,["date"]),vt,d(e(_e),{mask:"[hour:numeric]:[minute:numeric]",date:e(f).end_time},null,8,["date"]),d(e(fe),{class:"ark-text_48 ark-space_left-3 ark-space_right-1",name:"users",size:16}),i("span",null,y(e(f).num_people),1)],2),i("hr",{class:_(r.$style.hr)},null,2),i("div",{class:_([r.$style.buttons,r.loading&&"ark-skeleton"])},[d(e(w),{appearance:"neutral-b",size:"xs",to:{query:{...r.$route.query,bookingid:e(f).id}}},{default:g(()=>[k(" Изменить ")]),_:1},8,["to"]),e(f).status===e(l).CLOSED||e(f).status===e(l).CANCELLED||e(f).status===e(l).CANCELLED_NO_DEPOSIT?(o(),F(e(w),{key:0,size:"xs",appearance:"s-danger",loading:ce.value,onClick:se},{default:g(()=>[k(' Вернуть в "ожидаем" ')]),_:1},8,["loading"])):h("",!0),e(f).status===e(l).NEW?(o(),F(e(w),{key:1,size:"xs",loading:W.value,onClick:q},{default:g(()=>[k(" Подтвердить ")]),_:1},8,["loading"])):h("",!0),e(f).status===e(l).APPLICATION||e(f).status===e(l).WAITING?(o(),F(e(w),{key:2,appearance:"success",size:"xs",loading:T.value,onClick:Z},{default:g(()=>[k(" За столом ")]),_:1},8,["loading"])):h("",!0),e(f).status===e(l).APPLICATION?(o(),F(e(w),{key:3,appearance:"attention",size:"xs",loading:ve.value,onClick:de},{default:g(()=>[k(" Опаздывают ")]),_:1},8,["loading"])):h("",!0),e(f).status===e(l).OPEN?(o(),F(e(w),{key:4,appearance:"success",size:"xs",loading:C.value,onClick:X},{default:g(()=>[k(" Завершен ")]),_:1},8,["loading"])):h("",!0),e(f).status===e(l).APPLICATION||e(f).status===e(l).NEW?(o(),F(e(w),{key:5,appearance:"s-danger",size:"xs",loading:ae.value,onClick:ke},{default:g(()=>[k(" Отменить ")]),_:1},8,["loading"])):h("",!0)],2)],42,rt))}}),ft="_item_1shsm_1",pt="_item__header_1shsm_14",gt="_name_1shsm_21",ht="_name_full_1shsm_36",yt="_phone_1shsm_40",bt="_inline_1shsm_45",Ct="_content_1shsm_50",$t="_comment_1shsm_56",Nt="_tags_1shsm_66",wt="_tags__item_1shsm_71",Lt="_bottom_1shsm_82",Ot="_actions_1shsm_90",St="_buttons_1shsm_99",It="_hr_1shsm_117",Et={item:ft,item__header:pt,name:gt,name_full:ht,phone:yt,inline:bt,content:Ct,comment:$t,tags:Nt,tags__item:wt,bottom:Lt,actions:Ot,buttons:St,hr:It},Dt={$style:Et},xt=Ee(kt,[["__cssModules",Dt]]),At={class:"ark-space_bottom-1"},Pt={class:"ark-text_semibold"},Tt={class:"ark-text_body-s"},Bt={key:0,class:"ark-text_body-xs"},zt=i("h6",{class:"ark-text_h6 ark-space_bottom-6"},"Легенда для таблицы",-1),Mt={class:"ark-text_h6"},jt={class:"ark-text_body-s"},Ht=["data-status"],Vt=i("span",null,"Константин",-1),Rt={class:"ark-text_semibold"},Wt=i("p",{class:"ark-text_semibold"}," Отмененные и завершенные бронирования не показываются ",-1),Pe="2024-02-14T13:00:00",Gt=Ie({__name:"BookingLine",props:{bookings:{}},setup(pe){Je(s=>({d55b10ce:Se.value,"6840e5bc":E.value,"264de496":ge.value}));const me=pe,{bookings:b}=Be(me),z=Ve(),{reservationToShow:f}=je(z),L=Oe(Ze),P=Oe(He),O=[{title:"1. На подтверждение",subtitle:"Бронирование необходимо подтвердить",status:l.NEW},{title:"2. Ожидаем",subtitle:"Бронь подтверждена, ожидаем гостей",status:l.APPLICATION},{title:"3. В ресторане",subtitle:"Гости в ресторане, но еще не за столом",status:l.WAITING},{title:"4. За столом",subtitle:"Гости сидят за столом",status:l.OPEN}],ae=localStorage.getItem("__ark-supra-booking-line-mode"),T=S(ae==="all"||ae==="now"?ae:"all");re(T,s=>{localStorage.setItem("__ark-supra-booking-line-mode",s)});const C=s=>{const[a,p]=s.split("T");return new ee(le.jsonParse(a),R.fromString(p))},W=localStorage.getItem("__ark-supra-booking-line-left"),ce=Number.isNaN(W)?1:Ne(Number(W),1,10),G=localStorage.getItem("__ark-supra-booking-line-right"),M=Number.isNaN(G)?2:Ne(Number(G),1,10),K=S(ce),q=S(M),se=S(!1),Z=S(localStorage.getItem("__ark-supra-booking-line-full")==="1");re(Z,s=>{s?localStorage.setItem("__ark-supra-booking-line-full","1"):localStorage.removeItem("__ark-supra-booking-line-full")}),re(K,s=>{localStorage.setItem("__ark-supra-booking-line-left",`${s}`)}),re(q,s=>{localStorage.setItem("__ark-supra-booking-line-right",`${s}`)});const X=(s,a)=>{a==="left"?K.value=Ne(K.value+s,1,10):q.value=Ne(q.value+s,1,10)},ke=I(()=>b.value.filter(a=>a.status!==l.CANCELLED&&a.status!==l.CANCELLED_NO_DEPOSIT&&a.status!==l.CLOSED).sort((a,p)=>C(a.seating_time).valueOf()-C(p.seating_time).valueOf())),de=I(()=>{const s=ke.value;if(T.value==="all")return s;const a=P.value.daytime.valueOf(),p=K.value,U=q.value;return s.filter(B=>{const m=C(B.seating_time);return C(B.end_time).valueOf()<a-Ce*p||a+Ce*U>m.valueOf()})}),oe=I(()=>{if(T.value==="now"){const m=K.value,D=q.value,{day:j,time:H}=P.value.daytime,n=new ee(j,new R(H.hours,0,0)).valueOf(),u=new Date(n-Ce*m),t=new Date(n+Ce*D);return{min:new ee(le.fromLocalNativeDate(u),R.fromLocalNativeDate(u)),max:new ee(le.fromLocalNativeDate(t),R.fromLocalNativeDate(t))}}const s=de.value;if(s.length===0)return{min:new ee(le.currentLocal(),R.currentLocal()),max:new ee(le.currentLocal(),R.currentLocal())};let a=C(s[0].seating_time),p=C(s[0].end_time);s.forEach(m=>{const D=C(m.seating_time),j=C(m.end_time);a=D.valueOf()<a.valueOf()?D:a,p=j.valueOf()<p.valueOf()?p:j});const U=new Date(a.valueOf()-Le*15);a=new ee(le.fromLocalNativeDate(U),R.fromLocalNativeDate(U));const B=new Date(p.valueOf()+Le*15);return p=new ee(le.fromLocalNativeDate(B),R.fromLocalNativeDate(B)),{min:a,max:p}}),r=I(()=>{const{min:s,max:a}=oe.value;return Ue(s,a,{minutes:15}).map(p=>({style:{left:`${we(p.valueOf(),s.valueOf(),a.valueOf())}%`},nice:p.time.minutes===0,item:p}))}),$=I(()=>{const s=oe.value,a=Math.ceil((s.max.valueOf()-s.min.valueOf())/Le);return{a:{"min-width":`${a+48}px`},b:{"min-width":`${a}px`}}}),E=I(()=>{const s=L.value.daytime.valueOf(),{min:a,max:p}=oe.value;return`${we(s,a.valueOf(),p.valueOf())}%`});function A(s,a,p){const U=C(s.seating_time),B=C(s.end_time),m=we(U.valueOf(),a.valueOf(),p.valueOf()),D=we(B.valueOf(),a.valueOf(),p.valueOf());return{left:`${m}%`,width:`${D-m}%`}}const x=I(()=>{const s=de.value,{min:a,max:p}=oe.value;return s.reduce((B,m)=>{if(m.status!==l.CANCELLED&&m.status!==l.CANCELLED_NO_DEPOSIT&&m.status!==l.CLOSED){const D=A(m,a,p);m.tables.forEach(j=>{B[j]=(B[j]||[]).concat({...m,style:D})})}return B},{})}),ie={a:[],b:[],c:[]},Y=I(()=>{const s=x.value,p=Object.keys(s).length===0;return{empty:p,items:p?ie:s}}),ge=I(()=>`${Object.keys(Y.value.items).length*1.5}rem`),Se=I(()=>{const s=Z.value,a=Object.keys(Y.value.items);return`${Math.min(s?1/0:6,a.length)*1.5}rem`});return(s,a)=>{var U,B;const p=Fe("RouterLink");return o(),c("div",At,[i("div",{class:_(s.$style.buttons)},[T.value==="now"?(o(),c(N,{key:0},[d(e(w),{"icon-button":"",appearance:"neutral",size:"xs",icon:"minus",onClick:a[0]||(a[0]=m=>X(-1,"left"))}),d(e(w),{"icon-button":"",appearance:"neutral",size:"xs",icon:"plus",onClick:a[1]||(a[1]=m=>X(1,"left"))})],64)):h("",!0),d(e(w),{size:"xs",class:"ark-space_left-auto",appearance:T.value==="all"?"primary":"neutral",onClick:a[2]||(a[2]=m=>T.value="all")},{default:g(()=>[k(" Весь день ")]),_:1},8,["appearance"]),d(e(w),{class:"ark-space_right-auto",size:"xs",appearance:T.value==="all"?"neutral":"primary",onClick:a[3]||(a[3]=m=>T.value="now")},{default:g(()=>[k(" Сейчас ")]),_:1},8,["appearance"]),T.value==="now"?(o(),c(N,{key:1},[d(e(w),{"icon-button":"",appearance:"neutral",size:"xs",icon:"minus",onClick:a[4]||(a[4]=m=>X(-1,"right"))}),d(e(w),{"icon-button":"",appearance:"neutral",size:"xs",icon:"plus",onClick:a[5]||(a[5]=m=>X(1,"right"))})],64)):h("",!0)],2),i("div",{class:_(s.$style.root)},[i("div",{class:_(s.$style.carousel),style:$e($.value.a)},[(o(!0),c(N,null,te(Y.value.items,(m,D,j)=>(o(),c("div",{key:D,class:_([s.$style.table,j%2===0&&s.$style.table_even])},[i("div",{class:_(s.$style.table__name)},[Y.value.empty?h("",!0):(o(),F(e(Ke),{key:0,id:D},null,8,["id"]))],2),i("div",{class:_(s.$style.line)},[(o(!0),c(N,null,te(m,H=>{var n;return o(),F(p,{key:H.id,class:_(s.$style.bubble),style:$e(H.style),"data-selected":((n=e(f))==null?void 0:n.id)===`${H.id}`,"data-status":H.status,to:{query:{...s.$route.query,bookingid:H.id}}},{default:g(()=>[i("span",null,y(H.name_for_reservation),1),i("span",Pt,[d(e(fe),{name:"users",size:8}),k(y(H.num_people),1)]),i("div",{class:_(s.$style.inline)},[d(_e,{mask:"[hour:numeric]:[minute:numeric]",date:H.seating_time},null,8,["date"]),k(" ‐ "),d(_e,{mask:"[hour:numeric]:[minute:numeric]",date:H.end_time},null,8,["date"])],2)]),_:2},1032,["class","style","data-selected","data-status","to"])}),128))],2)],2))),128))],6),Y.value.empty?(o(),c("div",{key:0,class:_(s.$style.empty)},[i("p",Tt,[k(" Нету броней "),T.value==="now"?(o(),c(N,{key:0},[k(" с "+y((U=oe.value.min.time)==null?void 0:U.toString("HH:MM:SS"))+" до "+y((B=oe.value.max.time)==null?void 0:B.toString("HH:MM:SS")),1)],64)):h("",!0)]),T.value==="now"?(o(),c("p",Bt," Попробуй увеличить промежуток ")):h("",!0)],2)):h("",!0),i("div",{class:_(s.$style.times),style:$e($.value.b)},[(o(!0),c(N,null,te(r.value,m=>(o(),c("div",{key:m.item.toJSON(),class:_([s.$style.times__item,m.nice&&s.$style.times__item_nice]),style:$e(m.style)},y(m.item.time),7))),128))],6)],2),i("div",{class:_(s.$style.between)},[i("a",{class:"ark-text_body-xs ark-text_semibold",onClick:a[6]||(a[6]=m=>se.value=!se.value)}," Легенда (что означает каждый цвет) "),i("a",{class:"ark-text_body-xs ark-text_semibold",onClick:a[7]||(a[7]=m=>Z.value=!Z.value)},y(Z.value?"Свернуть":"На всю высоту"),1)],2),d(e(Qe),{modelValue:se.value,"onUpdate:modelValue":a[8]||(a[8]=m=>se.value=m)},{default:g(({close:m})=>[zt,(o(),c(N,null,te(O,(D,j)=>(o(),c(N,{key:j},[i("h6",Mt,y(D.title),1),i("p",jt,y(D.subtitle),1),i("div",{class:_(["ark-space_bottom-4",[s.$style.bubble,s.$style.bubble_static]]),"data-status":D.status},[Vt,i("span",Rt,[d(e(fe),{name:"users",size:8}),k("2 ")]),i("div",{class:_(s.$style.inline)},[d(_e,{mask:"[hour:numeric]:[minute:numeric]",date:Pe}),k(" ‐ "),d(_e,{mask:"[hour:numeric]:[minute:numeric]",date:Pe})],2)],10,Ht)],64))),64)),Wt,d(e(w),{appearance:"neutral",class:"ark-space_top-4",style:{width:"100%"},onClick:m},{default:g(()=>[k(" Все понятно ")]),_:2},1032,["onClick"])]),_:1},8,["modelValue"])])}}}),qt="_root_e7r2a_2",Ut="_carousel_e7r2a_15",Jt="_table_e7r2a_24",Ft="_table__name_e7r2a_29",Kt="_table_even_e7r2a_42",Qt="_line_e7r2a_51",Zt="_bubble_e7r2a_58",Xt="_bubble_static_e7r2a_87",Yt="_inline_e7r2a_117",ea="_between_e7r2a_124",ta="_times_e7r2a_130",aa="_times__item_e7r2a_155",sa="_times__item_nice_e7r2a_168",oa="_empty_e7r2a_175",na="_buttons_e7r2a_188",la="_showMobile_e7r2a_195",ia={root:qt,carousel:Ut,table:Jt,table__name:Ft,table_even:Kt,line:Qt,bubble:Zt,bubble_static:Xt,inline:Yt,between:ea,times:ta,times__item:aa,times__item_nice:sa,empty:oa,buttons:na,showMobile:la},ua={$style:ia},ra=Ee(Gt,[["__cssModules",ua]]),ca=["data-list"],da={class:"ark-text_h6 ark-text_semibold ark-space_bottom-1"},_a={class:"ark-space_bottom-2",style:{display:"flex",gap:"0.5rem"}},ma=["data-active","onClick"],va=["data-active"],ka=i("p",{class:"ark-text_body-xs ark-text_semibold ark-text_64"}," Shift + колесико мышки для скролла по горизонтали ",-1),fa=["data-active","onClick"],pa=["data-active"],ga={class:"ark-text_body-xs"},ha={key:2},ya={class:"ark-text_body-s",style:{display:"flex","flex-wrap":"wrap","flex-direction":"column"}},ba=i("span",{class:"ark-text_body-xs"},"С",-1),Ca={class:"ark-text_semibold"},$a={key:2,class:"ark-space_top-1"},Na=["data-list"],wa={key:4,style:{"text-align":"center",width:"100%"}},La=i("img",{src:Te,width:"128",height:"128",alt:"No users",class:"ark-space_bottom-4"},null,-1),Oa=i("h3",{class:"ark-space_bottom-6 ark-text_h5"}," Нет бронирований на сегодня ",-1),Sa=[La,Oa],Ia={key:5,style:{"text-align":"center",width:"100%"}},Ea=i("img",{src:Te,width:"128",height:"128",alt:"No users",class:"ark-space_bottom-4"},null,-1),Da=i("h3",{class:"ark-space_bottom-6 ark-text_h5"}," Нет бронирований с таким фильтром ",-1),xa=Ie({__name:"BookingList",props:{id:{}},setup(pe){const me=pe,b=Ve(),{navItems:z,todaysLoading:f,todaysBookings:L,reservationToShow:P,tableDate:O}=je(b),ae=Me(),ve=ze(),C=Xe().computedSmallerThen("mobile"),W=S(!1),ce=Oe(nt),G=Oe(He),M=S(localStorage.getItem("__ark-supra-booking-list-design")==="1");re(M,n=>{n?localStorage.setItem("__ark-supra-booking-list-design","1"):localStorage.removeItem("__ark-supra-booking-list-design")});const K=S(Date.now()),q=S(""),se=S(!1),Z=S(Date.now()),X=S(!1),ke=S(NaN),de=S(null),r=(()=>{let n={};try{const u=localStorage.getItem("__ark-supra-booking-list-filter");u&&(n=JSON.parse(u))}catch{}return n})(),$=Ye({Все:r.Все??!1,Пересиживают:r.Пересиживают??!1,[l.APPLICATION]:r[l.APPLICATION]??!0,[l.NEW]:r[l.NEW]??!1,[l.OPEN]:r[l.OPEN]??!1,[l.CANCELLED]:r[l.CANCELLED]??!1,[l.CANCELLED_NO_DEPOSIT]:r[l.CANCELLED_NO_DEPOSIT]??!1,[l.CLOSED]:r[l.CLOSED]??!1,[l.WAITING]:r[l.WAITING]??!1});re($,n=>{localStorage.setItem("__ark-supra-booking-list-filter",JSON.stringify(n))});const E={[l.NEW]:"Подтвердить",[l.APPLICATION]:"Ожидаем",[l.WAITING]:"Ожидает",[l.OPEN]:"В зале",[l.CANCELLED]:"Отменен",[l.CANCELLED_NO_DEPOSIT]:"Отменен, не внес депозит",[l.CLOSED]:"Завершен"},A=["Все",l.NEW,l.APPLICATION,l.OPEN,"Пересиживают",l.CLOSED,l.CANCELLED],x=I(()=>{const u=G.value.day;return new Array(5).fill("").map((t,v)=>u.append({day:v}))}),ie=I(()=>{const n=x.value;return C?n.slice(0,4):n}),Y=I(()=>{const n=O.value;return!ie.value.find(u=>u.daySame(n))}),ge=I(()=>{if(f.value)return L.value.length>0?L.value:ut;const n=ce.value,t=L.value.sort((J,V)=>new Date(J.seating_time).valueOf()-new Date(V.seating_time).valueOf()),v=(q.value||"").trim().toLowerCase();if(v)return t.filter(J=>J.phone_number.includes(v)||J.name_for_reservation.toLowerCase().includes(v)||J.tables.some(V=>{const Q=n[V];return Q?Q.number.includes(v)||Q.zone.toLowerCase().includes(v):!1}));if($.Все)return t;const ne=G.value.native.valueOf();return t.filter(J=>{if($.Пересиживают&&J.status===l.OPEN){const[V,Q]=J.end_time.split("T");return new ee(le.jsonParse(V),R.fromString(Q)).valueOf()<ne}return $[J.status]})});function Se(n,u){const t=u,v=u+1,ne=Object.keys(n).map(Number).sort((V,Q)=>V-Q);function be(V){for(const Q of ne)if(Q>=V)return{hour:Q,count:n[Q]};return null}function J(V){return{hour:V,count:n[V]!==void 0?n[V]:null,closest:be(V)}}return{in1Hour:J(t),in2Hours:J(v)}}const s=I(()=>{const n=G.value.daytime.time,u=de.value||{};return Object.keys(u).reduce((t,v)=>{const ne=Number(v);return n.hours<=ne&&(t[v]=u[v]),t},{})}),a=I(()=>{const n=R.fromLocalNativeDate(G.value.native);return Se(s.value||{},n.hours)}),p=I(()=>{const n=G.value.native.valueOf();return L.value.reduce((t,v)=>{if(v.status===l.APPLICATION||v.status===l.NEW||v.status===l.OPEN||v.status===l.WAITING){t[v.status]=(t[v.status]||0)+v.num_people;const[ne,be]=v.end_time.split("T");new ee(le.jsonParse(ne),R.fromString(be)).valueOf()<n&&v.status===l.OPEN&&(t.Пересиживают=(t.Пересиживают||0)+v.num_people),t.Все=(t.Все||0)+v.num_people}return t},{})}),U=["минуту","минуты","минут"],B=I(()=>{Z.value;const n=K.value,u=R.currentLocal().valueOf()-R.fromLocalNativeDate(new Date(n)).valueOf(),t=R.fromAbsoluteMilliseconds(u);return t.hours?"больше часа":t.minutes?`${t.minutes} ${et(U,t.minutes)}`:"меньше минуты"}),m=n=>{ke.value=Date.now(),L.value=L.value.map(u=>u.id===n.id?n:u)},D=n=>{n==="Все"?(Object.keys($).forEach(u=>{$[u]=!1}),$.Все=!0):($.Все=!1,$[n]=!$[n])};let j=null;tt(()=>{j=setInterval(()=>{Z.value=Date.now()},Le)}),at(()=>{j&&clearInterval(j)});const H=()=>{K.value=Date.now()};return re([()=>me.id,O,ke],([n,u])=>{se.value=!0,ae.bookingGuestCount.execute({id:n,date:u.toJSON()}).then(t=>{de.value=t}).catch(()=>{ve.show("Попробуй перезагрузить страницу",{type:"error",label:"Не удалось загрузить кол-во гостей"})}).finally(()=>{se.value=!1})},{immediate:!0}),re([()=>me.id,O,K],([n,u])=>{b.onSafeLoadBookings(n,u)},{immediate:!0}),(n,u)=>(o(),c("div",{class:_(n.$style.container),"data-list":!e(C)&&M.value},[i("div",da,[k(" Бронирования по дням "),d(_e,{class:"ark-text_body-s ark-text_64",mask:", [day:numeric] [month:long]",style:{display:"inline"},date:e(O).toJSON()},null,8,["date"])]),i("div",_a,[d(e(ot),{size:"s",border:!1,class:_(n.$style.tabs),items:e(z)},{default:g(({item:t})=>[k(y(t.text),1)]),_:1},8,["class","items"]),e(C)?h("",!0):(o(),F(e(w),{key:0,appearance:"accent",size:"xs",icon:"plus",class:"ark-space_top-2 ark-space_left-1",onClick:e(b).toggleNewBooking},{default:g(()=>[k(" Добавить ")]),_:1},8,["onClick"])),d(e(w),{appearance:"flat",size:"xs",icon:"refresh",class:"ark-space_top-2",onClick:H},{default:g(()=>[e(C)?h("",!0):(o(),c(N,{key:0},[k("Обновлено")],64)),k(" "+y(B.value)+" назад ",1)]),_:1})]),e(C)?h("",!0):(o(),c(N,{key:0},[i("div",{class:_(n.$style.inline)},[d(e(De),{modelValue:q.value,"onUpdate:modelValue":u[0]||(u[0]=t=>q.value=t),class:"ark-space_bottom-1",placeholder:"Телефон, имя, стол",style:{"max-width":"288px",width:"100%"}},{left:g(()=>[d(e(fe),{name:"search"})]),_:1},8,["modelValue"]),(o(!0),c(N,null,te(ie.value,(t,v)=>(o(),c("button",{key:t.toJSON(),class:_(n.$style.date),"data-active":t.daySame(e(O)),onClick:ne=>O.value=t},[d(e(ue),{class:"ark-text_semibold",mask:"[day:numeric] [month:long]",date:t.toLocalNativeDate()},null,8,["date"]),i("p",null,[v<2?(o(),c(N,{key:0},[k(y(e(G).day.daySame(t)?"сегодня":"завтра"),1)],64)):(o(),F(e(ue),{key:1,mask:"[weekday:long]",date:t.toLocalNativeDate()},null,8,["date"]))])],10,ma))),128)),d(e(Ae),{modelValue:W.value,"onUpdate:modelValue":u[2]||(u[2]=t=>W.value=t),align:"right","max-width":243,"min-width":243,"min-height":290},{dropdown:g(()=>[d(e(xe),{value:e(O),onDayClick:u[1]||(u[1]=t=>{O.value=t,W.value=!1})},null,8,["value"])]),default:g(()=>[i("button",{style:{height:"2.5rem"},class:_(n.$style.date),"data-active":Y.value},[Y.value?(o(),c(N,{key:0},[d(e(ue),{class:"ark-text_semibold",mask:"[day:numeric] [month:long]",date:e(O).toLocalNativeDate()},null,8,["date"]),i("p",null,[d(e(ue),{mask:"[weekday:long]",date:e(O).toLocalNativeDate()},null,8,["date"])])],64)):(o(),c(N,{key:1},[k(" Выбрать ")],64))],10,va)]),_:1},8,["modelValue"])],2),ka],64)),d(ra,{bookings:e(L)},null,8,["bookings"]),e(C)?(o(),c(N,{key:1},[d(e(De),{modelValue:q.value,"onUpdate:modelValue":u[3]||(u[3]=t=>q.value=t),placeholder:"Телефон, имя, стол",size:"s",class:_(n.$style.search)},{left:g(()=>[d(e(fe),{name:"search"})]),_:1},8,["modelValue","class"]),i("div",{class:_(["ark-space_top-1",n.$style.inline])},[(o(!0),c(N,null,te(ie.value,(t,v)=>(o(),c("button",{key:t.toJSON(),class:_(n.$style.date),"data-active":t.daySame(e(O)),onClick:ne=>O.value=t},[d(e(ue),{class:"ark-text_semibold",mask:"[day:numeric] [month:long]",date:t.toLocalNativeDate()},null,8,["date"]),i("p",null,[v<2?(o(),c(N,{key:0},[k(y(e(G).day.daySame(t)?"сегодня":"завтра"),1)],64)):(o(),F(e(ue),{key:1,mask:"[weekday:long]",date:t.toLocalNativeDate()},null,8,["date"]))])],10,fa))),128)),d(e(Ae),{modelValue:W.value,"onUpdate:modelValue":u[5]||(u[5]=t=>W.value=t),align:"right","max-width":243,"min-width":243,"min-height":290},{dropdown:g(()=>[d(e(xe),{value:e(O),onDayClick:u[4]||(u[4]=t=>{O.value=t,W.value=!1})},null,8,["value"])]),default:g(()=>[i("button",{style:{height:"2.5rem"},class:_(n.$style.date),"data-active":Y.value},[Y.value?(o(),c(N,{key:0},[d(e(ue),{class:"ark-text_semibold",mask:"[day:numeric] [month:long]",date:e(O).toLocalNativeDate()},null,8,["date"]),i("p",null,[d(e(ue),{mask:"[weekday:long]",date:e(O).toLocalNativeDate()},null,8,["date"])])],64)):(o(),c(N,{key:1},[k(" Выбрать ")],64))],10,pa)]),_:1},8,["modelValue"])],2)],64)):h("",!0),st((o(),c("div",{class:_(["ark-space_bottom-1 ark-space_top-1",n.$style.statuses])},[(o(),c(N,null,te(A,t=>d(e(w),{key:t,size:"xs",appearance:$.Все?t==="Все"?"primary":"neutral":$[t]?"primary":"neutral",onClick:v=>D(t)},{default:g(()=>[k(y(E[t]??t)+" ",1),p.value[t]?(o(),c("span",{key:0,class:_(n.$style.count)},y(p.value[t])+"чел ",3)):h("",!0)]),_:2},1032,["appearance","onClick"])),64)),e(C)?h("",!0):(o(),c(N,{key:0},[d(e(w),{size:"xs",icon:"list",class:"ark-space_left-auto",appearance:M.value?"neutral":"flat",onClick:u[6]||(u[6]=t=>M.value=!0)},{default:g(()=>[k(" Списком ")]),_:1},8,["appearance"]),d(e(w),{size:"xs",icon:"grid",appearance:M.value?"flat":"neutral",onClick:u[7]||(u[7]=t=>M.value=!1)},{default:g(()=>[k(" Сеткой ")]),_:1},8,["appearance"])],64))],2)),[[e(it)]]),i("p",ga,[a.value.in1Hour.count!==null?(o(),c("span",{key:0,class:_(n.$style.wait)},[k(" с "+y(a.value.in1Hour.hour)+":00 ‐ ",1),i("b",null,y(a.value.in1Hour.count)+" чел",1)],2)):h("",!0),a.value.in2Hours.count!==null?(o(),c("span",{key:1,class:_(n.$style.wait)},[k(" с "+y(a.value.in2Hours.hour)+":00 ‐ ",1),i("b",null,y(a.value.in2Hours.count)+" чел",1)],2)):h("",!0),a.value.in1Hour.count===null&&a.value.in2Hours.count===null&&a.value.in1Hour.closest?(o(),c("span",ha,[k(" Ближайщее в "+y(a.value.in1Hour.closest.hour)+":00 ожидаем ",1),i("b",null,y(a.value.in1Hour.closest.count)+" чел",1)])):h("",!0),i("a",{class:"ark-space_left-1 ark-text_semibold",onClick:u[8]||(u[8]=t=>X.value=!X.value)}," Вся разбивка по часам ")]),d(e(lt),{opened:X.value},{default:g(()=>[i("div",ya,[(o(!0),c(N,null,te(s.value,(t,v)=>(o(),c("p",{key:v},[ba,k(" "+y(v)+":00 ‐ ",1),i("span",Ca,y(t)+"чел",1)]))),128))])]),_:1},8,["opened"]),e(C)?(o(),c("div",$a,[d(e(w),{size:"xs",icon:"list",appearance:M.value?"neutral":"flat",onClick:u[9]||(u[9]=t=>M.value=!0)},{default:g(()=>[k(" Списком ")]),_:1},8,["appearance"]),d(e(w),{size:"xs",icon:"grid",appearance:M.value?"flat":"neutral",onClick:u[10]||(u[10]=t=>M.value=!1)},{default:g(()=>[k(" Сеткой ")]),_:1},8,["appearance"])])):h("",!0),ge.value.length>0?(o(),c("div",{key:3,class:_(["ark-space_top-1",n.$style.bookings]),"data-list":M.value},[(o(!0),c(N,null,te(ge.value,t=>{var v;return o(),F(xt,{key:t.id,item:t,loading:e(f),highlight:((v=e(P))==null?void 0:v.id)===`${t.id}`,onRefresh:m},null,8,["item","loading","highlight"])}),128))],10,Na)):e(L).length===0?(o(),c("div",wa,Sa)):ge.value.length===0?(o(),c("div",Ia,[Ea,Da,d(e(w),{onClick:u[11]||(u[11]=t=>D("Все"))},{default:g(()=>[k("Показать все брони")]),_:1})])):h("",!0),e(C)?(o(),c("div",{key:6,class:_(n.$style.safe__content)},[d(e(w),{"icon-button":"",icon:"refresh",appearance:"elevation",size:"l",shape:"square",class:"ark-space_left-auto",onClick:H}),d(e(w),{"icon-button":"",shape:"square",icon:"plus",size:"l",appearance:"accent",onClick:e(b).toggleNewBooking},null,8,["onClick"])],2)):h("",!0)],10,ca))}}),Aa="_container_stgoj_2",Pa="_bookings_stgoj_11",Ta="_statuses_stgoj_23",Ba="_count_stgoj_39",za="_wait_stgoj_47",Ma="_safe_stgoj_54",ja="_safe__content_stgoj_57",Ha="_search_stgoj_73",Va="_search_focused_stgoj_76",Ra="_tabs_stgoj_80",Wa="_inline_stgoj_85",Ga="_date_stgoj_100",qa={container:Aa,bookings:Pa,statuses:Ta,count:Ba,wait:za,safe:Ma,safe__content:ja,search:Ha,search_focused:Va,tabs:Ra,inline:Wa,date:Ga},Ua={$style:qa},ss=Ee(xa,[["__cssModules",Ua]]);export{ss as default};
