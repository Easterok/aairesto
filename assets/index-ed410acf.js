import{_ as Ee}from"./index-127a01d9.js";import{T as ot,D as He}from"./index-12987946.js";import{T as nt,R as Me,O as Fe}from"./index-32471362.js";import{d as le,B as it,a3 as de,a4 as rt,a5 as ut,r as C,b as te,C as _e,k as e,a6 as dt,o as a,c as _,a as l,q as L,E as ct,l as v,n as c,a7 as Be,j as p,t as N,a8 as _t,_ as re,F as D,u as me,m as pe,y as ie,a9 as o,w as ee,h as s,i,z as oe,g as Y,A as y,s as ae,aa as $e,ab as Ve,ac as Oe,ad as ve,ae as Ze,S as X,W as be,af as ye,M as Xe,R as mt,ag as pt,P as vt,e as ft,a2 as ht,f as kt,ah as We,U as gt,Y as bt,X as yt,ai as $t,Z as Te,aj as Vt,ak as zt}from"./index-2ac84a6d.js";import{F as Ye}from"./index-d9c5e50f.js";import{U as Ke}from"./index-c04c7736.js";import{c as ze,r as se,a as Ce,s as Le,_ as A}from"./index-b51ad6a4.js";import{I as we,_ as Se}from"./index-502044f9.js";import{R as Ct}from"./index-93bac8a8.js";import{_ as Lt}from"./index-ffcc03e1.js";/* empty css              */import{L as Ge}from"./index-4611c847.js";import{D as Qe}from"./index-e51b499c.js";import{s as wt}from"./index-7a2f8ecb.js";import"./index-03765aec.js";import"./index-f75dc1b0.js";import"./index-cc80e411.js";import"./index-c24d0159.js";const St={modelValue:!1,disabled:!1,label:"",size:"md",isError:!1},xt=["for"],qt=["id","checked"],Ut=le({name:"CheckboxLabeled",__name:"CheckboxLabeled",props:it({modelValue:{type:[Boolean,null]},disabled:{type:Boolean},label:{},size:{},isError:{type:Boolean},pseudoHovered:{type:Boolean},id:{}},St),emits:["update:modelValue"],setup(K,{emit:Z}){const V=K,z=Z,t=_t(),{modelValue:x,isError:T,pseudoHovered:j,label:q,id:M}=de(V);rt();const h=ut(T),w=C(!1),f=te(()=>M.value||t),W=te(()=>"check"),k=te(()=>j.value||w.value),U=n=>{const r=n.target.checked;z("update:modelValue",r)},Q={onEvent:n=>{w.value=n}};return(n,I)=>_e((a(),_("label",{class:c([n.$style.label,n.$style["label_"+n.size]]),for:f.value},[l("div",{class:c([n.$style.checkbox,n.$style["checkbox_"+n.size],e(x)===!0&&n.$style.checkbox_checked,e(h)&&n.$style.checkbox_invalid,k.value&&n.$style.checkbox_hovered])},[e(x)===!0?(a(),L(e(ct),{key:0,size:n.size,name:W.value},null,8,["size","name"])):v("",!0),l("input",{id:f.value,ref:"native",type:"checkbox",class:c(n.$style.native),checked:!!e(x),onChange:U},null,42,qt)],2),Be(n.$slots,"default",{},()=>[p(N(e(q)),1)])],10,xt)),[[e(dt),Q]])}}),Nt="_label_1ihfz_1",Rt="_label_sm_1ihfz_8",It="_label_md_1ihfz_11",Dt="_label_lg_1ihfz_16",Tt="_checkbox_1ihfz_20",Ot="_checkbox_sm_1ihfz_30",Et="_checkbox_md_1ihfz_39",Mt="_checkbox_lg_1ihfz_48",Bt="_checkbox_hovered_1ihfz_57",jt="_checkbox_disabled_1ihfz_57",Pt="_checkbox_invalid_1ihfz_57",Jt="_checkbox_checked_1ihfz_63",At="_native_1ihfz_78",Ht={label:Nt,label_sm:Rt,label_md:It,label_lg:Dt,checkbox:Tt,checkbox_sm:Ot,checkbox_md:Et,checkbox_lg:Mt,checkbox_hovered:Bt,checkbox_disabled:jt,checkbox_invalid:Pt,checkbox_checked:Jt,native:At},Ft={$style:Ht},xe=re(Ut,[["__cssModules",Ft]]),Zt={style:{font:"var(--ark-font-l)"}},Wt=l("span",{style:{font:"var(--ark-font-s)",color:"var(--ark-text-color-64)"}},"№ ",-1),Kt={style:{"font-weight":"600"}},Qt=l("p",{style:{font:"var(--ark-font-s)"}},"Добавлен в очередь",-1),Xt=le({__name:"ReservationAlert",props:{context:{}},setup(K){return(Z,V)=>(a(),_(D,null,[l("p",Zt,[Wt,l("span",Kt,N(Z.context.data.queue_number),1)]),Qt],64))}}),Yt=l("h6",{class:"ark-text_h6 ark-space_bottom-4"},"Добавление в очередь",-1),Gt=l("p",{class:"ark-text_body-s ark-space_bottom-1 ark-text_64"}," Предпочитаемая зона ",-1),ea={style:{display:"flex","flex-wrap":"wrap",gap:"0.25rem"}},ta=l("div",null,[l("p",null,"Иностранец"),l("p",{class:"ark-text_body-xs ark-text_64"},"заполнит поле телефона")],-1),aa=le({__name:"AddQueue",props:{id:{},computedZones:{}},emits:["refresh","close"],setup(K,{emit:Z}){const V=K,z=Z,t=me(),x=pe(),T=C(!1),j=ie($e),q={required:"Обязательно",phone:"Некорректный номер мобильного телефона"};function M(f,W){return W.phone_required.value?f.trim().length>0:!0}const h=ze({num_people:[2,{required:se}],phone_number:["",{required:Ce.withMessage("validator.required",M),phone:Le(!1)}],seating_time:[null],name_for_reservation:["",{required:se}],required_zone:[null],status:[o.Live,{required:se}],foreigner:[!1],comment:[""],phone_required:[!0]});ee(j,f=>{f?h.phone_required.setValue(f.phone_required):h.phone_required.setValue(!0)},{immediate:!0}),ee(h.foreigner.value,f=>{f?h.phone_number.setValue("+7 (999) 999-99-99"):h.phone_number.setValue("")});const w=()=>{if(h.validate(),h.invalid.value)return;T.value=!0;const f=h.getCurrentValue(),W={num_people:f.num_people,phone_number:f.phone_number?`+${Ve(f.phone_number)}`:"",name_for_reservation:f.name_for_reservation,status:o.Live,foreigner:f.foreigner,restaurant:Number(V.id),required_zone:f.required_zone??void 0,comment:f.comment};t.createReservation.execute(W).then(k=>{k&&(x.show(Oe(Xt),{data:k,autoClose:1e4}),z("refresh"),z("close"))}).catch(([k,U])=>{U!==403&&x.show("Ошибка добавления в очередь",{type:"error"})}).finally(()=>{T.value=!1})};return(f,W)=>(a(),_(D,null,[Yt,l("form",{class:c(f.$style.form),onSubmit:ae(w,["prevent"])},[s(e(A),{control:e(h).name_for_reservation,"validation-errors":q},{default:i(({model:k})=>[s(e(oe),{modelValue:k.value,"onUpdate:modelValue":U=>k.value=U,size:"l",required:"",label:"На чье имя бронь"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(h).num_people,"validation-errors":q},{default:i(({model:k})=>[s(e(we),{modelValue:k.value,"onUpdate:modelValue":U=>k.value=U,size:"l",required:"",label:"Количество человек"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(h).required_zone,"validation-errors":q},{default:i(({model:k})=>[Gt,l("div",ea,[(a(!0),_(D,null,Y(f.computedZones,(U,R)=>(a(),L(e(Ct),{modelValue:k.value,"onUpdate:modelValue":Q=>k.value=Q,key:R,"hide-radio":"",size:"xs",style:{"--ark-background-color":"var(--ark-text-color-08)"},name:"PreferZoneItem",item:U},{default:i(()=>[p(N(U??"Не важно"),1)]),_:2},1032,["modelValue","onUpdate:modelValue","item"]))),128))])]),_:1},8,["control"]),s(e(A),{control:e(h).phone_number,"validation-errors":q},{default:i(({model:k})=>{var U;return[s(e(Se),{modelValue:k.value,"onUpdate:modelValue":R=>k.value=R,label:"Номер телефона",size:"l",required:!!((U=e(j))!=null&&U.phone_required)},null,8,["modelValue","onUpdate:modelValue","required"])]}),_:1},8,["control"]),s(e(A),{control:e(h).comment},{default:i(({model:k})=>[s(e(oe),{modelValue:k.value,"onUpdate:modelValue":U=>k.value=U,size:"l",label:"Комментарий"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{class:"ark-space_bottom-4",control:e(h).foreigner},{default:i(({model:k})=>[s(e(xe),{modelValue:k.value,"onUpdate:modelValue":U=>k.value=U},{default:i(()=>[ta]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(y),{type:"submit",size:"l",loading:T.value},{default:i(()=>[p(" Добавить ")]),_:1},8,["loading"])],34)],64))}}),sa="_form_q3ljx_1",la={form:sa},oa={$style:la},na=re(aa,[["__cssModules",oa]]),ia=l("h6",{class:"ark-text_h6 ark-text_semibold ark-space_bottom-1"}," Выбор стола ",-1),ra=l("p",{class:"ark-text_body-s ark-space_bottom-3"}," Укажите стол/ы за который сели гости ",-1),je=le({__name:"PopupTableSelect",props:{item:{},loading:{type:Boolean},order:{}},emits:["tableSelect"],setup(K,{emit:Z}){const V=K,z=Z,{item:t}=de(V),x=C(!1),T=()=>{x.value=!0};return(j,q)=>(a(),_(D,null,[Be(j.$slots,"default",{open:T}),s(e(ve),{modelValue:x.value,"onUpdate:modelValue":q[1]||(q[1]=M=>x.value=M),order:j.order},{default:i(({close:M})=>[ia,ra,s(nt,{item:e(t),loading:j.loading,onClose:M,onTableSelect:q[0]||(q[0]=h=>z("tableSelect",h))},null,8,["item","loading","onClose"])]),_:1},8,["modelValue","order"])],64))}}),ua=["data-status","data-full"],da={key:0,class:"ark-text_body-s-2"},ca=["href"],_a=l("p",{class:"ark-text_body-xs ark-text_64"},"Комментарий",-1),ma={class:"ark-text_body-s-2 ark-text_medium"},pa={key:4,class:"ark-text_body-xs ark-text_64",style:{"white-space":"nowrap"}},va=l("h5",{class:"ark-text_h5 ark-space_bottom-4"},"Изменение",-1),fa=le({__name:"QueueItem",props:{item:{},loading:{type:Boolean},satLoading:{type:Boolean},leaveLoading:{type:Boolean},inviteLoading:{type:Boolean},joinedLoading:{type:Boolean},liveLoading:{type:Boolean},computedTable:{}},emits:["changeStatus","invite","updateDto"],setup(K,{emit:Z}){const V=K,z=Z,{item:t,loading:x}=de(V),T=me(),j=pe(),q=C(!1),M=C(!1),h=C(!1),w=C(!1),f=C(!1),W=C(!1);function k(u,O){return O.phone_required.value?u.trim().length>0:!0}const U={required:"Обязательно",phone:"Некорректный номер мобильного телефона"},R=ze({num_people:[2,{required:se}],phone_number:["",{required:Ce.withMessage("validator.required",k),phone:Le(!1)}],name_for_reservation:["",{required:se}],foreigner:[!1],comment:[""],phone_required:[!0]}),Q=te(()=>{const u=t.value.status;return u===o.Live||u===o.Called||u===o.Joined||(u===o.Cancelled?f.value:!1)}),n=u=>{M.value=!1,z("changeStatus",V.item,o.Sat,u)},I=()=>{w.value=!0,T.loadReservationItem.execute({id:V.item.id}).then(u=>{u&&z("updateDto",u)}).catch(()=>null).finally(()=>{w.value=!1})},r=()=>{R.num_people.setValue(V.item.num_people),R.phone_number.setValue(V.item.phone_number||""),R.name_for_reservation.setValue(V.item.name_for_reservation),R.foreigner.setValue(V.item.foreigner),R.comment.setValue(V.item.comment||""),q.value=!q.value},$=()=>{if(R.validate(),R.invalid.value)return;const{num_people:u,phone_number:O,name_for_reservation:B,foreigner:P,comment:H}=R.getCurrentValue();W.value=!0,T.updateReservation.execute({id:V.item.id,num_people:u,phone_number:O?`+${Ve(O)}`:"",name_for_reservation:B,foreigner:P,comment:H}).then(ce=>{ce&&(z("updateDto",ce),q.value=!1,j.show("Очередь обновлена"))}).catch(()=>{j.show("Не удалось обновить",{label:"Ошибка",type:"error"})}).finally(()=>{W.value=!1})};let g=null;return ee(t,(u,O,B)=>{B(()=>{g&&clearTimeout(g)}),u.tables.length===0&&(u.status===o.Joined||u.status===o.Called||u.status===o.Live)&&(g=setTimeout(()=>{I()},Xe*15))},{immediate:!0}),ee(t,u=>{(u.status===o.Sat||u.status===o.Cancelled)&&(f.value=!1)}),(u,O)=>(a(),_("div",{class:c(u.$style.item),"data-status":e(t).status,"data-full":f.value,onClick:O[6]||(O[6]=B=>f.value=!f.value)},[l("div",{class:c(["ark-text_h6",[u.$style.item__header,e(x)&&"ark-skeleton"]])},[l("p",{class:c([u.$style.name,h.value&&u.$style.name_full]),onClick:O[0]||(O[0]=B=>h.value=!h.value)},[e(t).queue_number?(a(),_("span",da," №"+N(e(t).queue_number),1)):v("",!0),p(" "+N(e(t).name_for_reservation),1)],2),l("div",{class:c(u.$style.inline)},[e(t).status===e(o).Cancelled?(a(),L(e(Ze),{key:0,class:"ark-text_body-xs ark-space_right-1",phone:e(t).phone_number},null,8,["phone"])):v("",!0),e(t).foreigner?(a(),L(e(X),{key:1,name:"language",class:"ark-space_right-1",size:16})):v("",!0),s(e(X),{class:"ark-text_48 ark-space_right-1",name:"users",size:16}),l("span",{class:c(u.$style.chel)},N(e(t).num_people),3),e(t).status!==e(o).Cancelled?(a(),L(e(y),{key:2,"icon-button":"",appearance:"neutral",class:"ark-space_left-2",size:"xs",style:{"--ark-height-xs":"1.25rem"},icon:"edit",shape:"square","icon-size":12,onClick:ae(r,["stop","prevent"])})):v("",!0),e(t).status===e(o).Cancelled||e(t).status===e(o).Sat?(a(),L(e(X),{key:3,name:"arrow-down",class:"ark-space_left-1 ark-text_64",size:20,rotate:f.value},null,8,["rotate"])):v("",!0)],2)],2),!(e(t).status===e(o).Cancelled||e(t).status===e(o).Sat)||f.value?(a(),_("div",{key:0,class:c(["ark-space_top-1",[u.$style.content,e(x)&&"ark-skeleton"]])},[e(t).phone_number?(a(),_("a",{key:0,class:c(["ark-space_right-auto",u.$style.phone]),href:`tel:${e(t).phone_number}`},[s(e(Ze),{phone:e(t).phone_number},null,8,["phone"])],10,ca)):v("",!0),e(t).foreigner?(a(),_("div",{key:1,class:c(u.$style.foreigner)},"Иностранец",2)):v("",!0),s(e(Me),{size:"s",status:e(t).status,"invite-time":e(t).invite_time,created:e(t).created},null,8,["status","invite-time","created"])],2)):v("",!0),e(t).comment&&(!(e(t).status===e(o).Cancelled||e(t).status===e(o).Sat)||f.value)?(a(),_("div",{key:1,class:c([u.$style.comment,e(x)&&"ark-skeleton"])},[_a,l("p",ma,N(e(t).comment),1)],2)):v("",!0),!(e(t).status===e(o).Cancelled||e(t).status===e(o).Sat)||f.value?(a(),_(D,{key:2},[l("hr",{class:c(u.$style.hr)},null,2),l("div",{class:c(["ark-text_body-l-2 ark-text_semibold",[u.$style.inline,e(x)&&"ark-skeleton"]])},[s(e(X),{class:"ark-text_48 ark-space_right-1",name:"user-plus",size:16}),e(x)?v("",!0):(a(),L(e(be),{key:0,mask:"[hour:numeric]:[minute:numeric]",date:e(t).created},null,8,["date"])),s(e(X),{class:"ark-text_48 ark-space_left-2 ark-space_right-1",name:"food",size:16}),!e(x)&&e(t).seating_time?(a(),L(e(be),{key:1,mask:"~[hour:numeric]:[minute:numeric]",date:e(t).seating_time},null,8,["date"])):(a(),L(e(X),{key:2,name:"spinner",size:16})),s(e(X),{class:"ark-text_48 ark-space_left-2 ark-space_right-1",name:"table",size:20}),e(t).tables.length>0?_e((a(),_("div",{key:3,class:c(u.$style.tables)},[(a(!0),_(D,null,Y(e(t).tables,(B,P)=>(a(),_("div",{key:P,class:c(u.$style.tables__item)},[typeof B=="string"?(a(),L(e(ye),{key:0,id:B,plus:""},null,8,["id"])):(a(!0),_(D,{key:1},Y(B,H=>(a(),L(e(ye),{id:H,key:H,plus:""},null,8,["id"]))),128))],2))),128))],2)),[[e(Ye)]]):(a(),_("div",pa,[p(" Через 1 мин"),s(e(Ge)),s(e(y),{icon:"refresh",size:"xs",appearance:"neutral",style:{width:"calc(var(--ark-height-xs) - 0.25rem)",height:"calc(var(--ark-height-xs) - 0.25rem)","min-height":"calc(var(--ark-height-xs) - 0.25rem)"},"icon-size":12,loading:w.value,onClick:I},null,8,["loading"])])),e(t).required_zone?(a(),_(D,{key:5},[s(e(X),{class:"ark-text_48 ark-space_left-2 ark-space_right-1",name:"zone",size:16}),l("p",{class:c(e(t).required_zone?"ark-text_semibold":"ark-text_body-xs ark-text_48")},N(e(t).required_zone),3)],64)):v("",!0)],2)],64)):v("",!0),Q.value?(a(),_(D,{key:3},[l("hr",{class:c(u.$style.hr)},null,2),l("div",{class:c([u.$style.buttons,e(x)&&"ark-skeleton"])},[e(t).status===e(o).Live||e(t).status===e(o).Called||e(t).status===e(o).Joined?(a(),L(e(y),{key:0,appearance:"s-danger",size:"xs",class:c(u.$style.button),loading:u.leaveLoading,onClick:O[1]||(O[1]=B=>z("changeStatus",e(t),e(o).Cancelled))},{default:i(()=>[p(" Ушел ")]),_:1},8,["class","loading"])):v("",!0),e(t).status===e(o).Live&&e(t).phone_number?(a(),L(e(y),{key:1,appearance:"primary-reverse",size:"xs",class:c(u.$style.button),loading:u.inviteLoading,onClick:O[2]||(O[2]=B=>z("invite",e(t)))},{default:i(()=>[p(" Вызвать ")]),_:1},8,["class","loading"])):v("",!0),e(t).status===e(o).Live||e(t).status===e(o).Called?(a(),L(e(y),{key:2,appearance:"attention",size:"xs",class:c(u.$style.button),loading:u.joinedLoading,onClick:O[3]||(O[3]=B=>z("changeStatus",e(t),e(o).Joined))},{default:i(()=>[p(" Пришел ")]),_:1},8,["class","loading"])):v("",!0),e(t).status===e(o).Cancelled?(a(),L(e(y),{key:3,appearance:"neutral-b",size:"xs",class:c(u.$style.button),loading:u.liveLoading,onClick:O[4]||(O[4]=ae(B=>z("changeStatus",e(t),e(o).Live),["stop","prevent"]))},{default:i(()=>[p(" Вернуть в начало очереди ")]),_:1},8,["class","loading"])):v("",!0),e(t).status===e(o).Live||e(t).status===e(o).Called||e(t).status===e(o).Joined?(a(),L(je,{key:4,item:e(t),loading:u.satLoading,onTableSelect:n},{default:i(({open:B})=>[s(e(y),{appearance:"success","icon-right":"arrow-down",size:"xs",class:c(u.$style.button),loading:u.satLoading,onClick:B},{default:i(()=>[p(" Занял ")]),_:2},1032,["class","loading","onClick"])]),_:1},8,["item","loading"])):v("",!0)],2)],64)):v("",!0),s(e(ve),{modelValue:q.value,"onUpdate:modelValue":O[5]||(O[5]=B=>q.value=B)},{default:i(({close:B})=>[va,l("form",{class:c(u.$style.form),onSubmit:ae($,["prevent"])},[s(e(A),{control:e(R).name_for_reservation,"validation-errors":U},{default:i(({model:P})=>[s(e(oe),{modelValue:P.value,"onUpdate:modelValue":H=>P.value=H,label:"На чье имя бронь*",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(R).num_people,"validation-errors":U},{default:i(({model:P})=>[s(e(we),{modelValue:P.value,"onUpdate:modelValue":H=>P.value=H,label:"Количество человек*",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(R).phone_number,"validation-errors":U},{default:i(({model:P})=>[s(e(Se),{modelValue:P.value,"onUpdate:modelValue":H=>P.value=H,label:"Номер телефона",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(R).comment,"validation-errors":U},{default:i(({model:P})=>[s(e(oe),{modelValue:P.value,"onUpdate:modelValue":H=>P.value=H,label:"Комментарий",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{class:"ark-space_bottom-4",control:e(R).foreigner},{default:i(({model:P})=>[s(e(xe),{modelValue:P.value,"onUpdate:modelValue":H=>P.value=H},{default:i(()=>[p("Иностранец")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),l("div",{class:c(u.$style.actions)},[s(e(y),{type:"submit",size:"l",loading:W.value},{default:i(()=>[p(" Сохранить ")]),_:1},8,["loading"]),s(e(y),{appearance:"neutral",type:"button",size:"l",onClick:B},{default:i(()=>[p(" Отменить ")]),_:2},1032,["onClick"])],2)],34)]),_:1},8,["modelValue"])],10,ua))}}),ha="_item_dces5_2",ka="_item__header_dces5_26",ga="_name_dces5_32",ba="_name_full_dces5_47",ya="_phone_dces5_51",$a="_inline_dces5_56",Va="_content_dces5_61",za="_comment_dces5_67",Ca="_bottom_dces5_77",La="_actions_dces5_85",wa="_form_dces5_94",Sa="_buttons_dces5_100",xa="_hr_dces5_118",qa="_tables_dces5_123",Ua="_tables__item_dces5_138",Na="_foreigner_dces5_145",Ra="_chel_dces5_156",Ia={item:ha,item__header:ka,name:ga,name_full:ba,phone:ya,inline:$a,content:Va,comment:za,bottom:Ca,actions:La,form:wa,buttons:Sa,hr:xa,tables:qa,tables__item:Ua,foreigner:Na,chel:Ra},Da={$style:Ia},Ta=re(fa,[["__cssModules",Da]]),Oa=["data-status"],Ea=["href"],Ma={class:"ark-space_top-2"},Ba={key:0,class:"ark-space_right-2 ark-text_48"},ja={key:0,class:"ark-space_top-2"},Pa=l("p",{class:"ark-text_body-xs ark-text_64"},"Комментарий",-1),Ja=["data-full"],Aa={style:{display:"flex",gap:"0.25rem","flex-wrap":"wrap"}},Ha=l("h5",{class:"ark-text_h5 ark-space_bottom-4"},"Изменение",-1),Fa=le({__name:"ReservationDesktopItem",props:{item:{},satLoading:{type:Boolean},leaveLoading:{type:Boolean},inviteLoading:{type:Boolean},joinedLoading:{type:Boolean},computedTable:{}},emits:["changeStatus","invite","updateDto"],setup(K,{emit:Z}){const V=K,z=Z,t={required:"Обязательно",phone:"Некорректный номер мобильного телефона"},x=me(),T=pe(),j=C(!1),q=C(!1),M=C(!1),h=C(!1);function w(n,I){return I.phone_required.value?n.trim().length>0:!0}const f=ze({num_people:[2,{required:se}],phone_number:["",{required:Ce.withMessage("validator.required",w),phone:Le(!1)}],name_for_reservation:["",{required:se}],foreigner:[!1],comment:[""],phone_required:[!0]}),W=ie($e);ee(W,n=>{n?f.phone_required.setValue(n.phone_required):f.phone_required.setValue(!0)},{immediate:!0});const k=()=>{f.num_people.setValue(V.item.num_people),f.phone_number.setValue(V.item.phone_number||""),f.name_for_reservation.setValue(V.item.name_for_reservation),f.foreigner.setValue(V.item.foreigner),f.comment.setValue(V.item.comment||""),q.value=!0},U=n=>{h.value=!1,z("changeStatus",V.item,o.Sat,n)},R=()=>{if(f.validate(),f.invalid.value)return;const{num_people:n,phone_number:I,name_for_reservation:r,foreigner:$,comment:g}=f.getCurrentValue();M.value=!0,x.updateReservation.execute({id:V.item.id,num_people:n,phone_number:I?`+${Ve(I)}`:"",name_for_reservation:r,foreigner:$,comment:g}).then(u=>{u&&(z("updateDto",u),q.value=!1,T.show("Бронирование обновлено"))}).catch(()=>{T.show("Не удалось изменить бронирование",{label:"Ошибка",type:"error"})}).finally(()=>{M.value=!1})},Q=()=>{q.value=!1};return(n,I)=>(a(),_("tr",{class:c(n.$style.row),"data-status":n.item.status},[l("td",null,N(n.item.queue_number),1),l("td",null,[l("p",null,[l("b",null,N(n.item.name_for_reservation),1),s(e(X),{name:"users",class:"ark-space_left-2 ark-space_right-1",size:16}),l("b",null,N(n.item.num_people),1)]),l("p",null,[n.item.phone_number?(a(),_("a",{key:0,class:"ark-text_64",href:`tel:${n.item.phone_number}`},N(n.item.phone_number),9,Ea)):v("",!0)]),l("p",Ma,[s(e(Me),{"invite-time":n.item.invite_time,created:n.item.created,status:n.item.status},null,8,["invite-time","created","status"])])]),l("td",null,[l("div",{class:c(n.$style.inline)},[l("div",null,[l("p",{class:c(n.$style.xs)},"встали",2),n.item.created?(a(),L(be,{key:0,mask:"[hour:numeric]:[minute:numeric]",date:n.item.created},null,8,["date"])):v("",!0)]),s(e(X),{name:"arrow-right-stroke",size:12,class:c(n.$style.xs)},null,8,["class"]),l("div",null,[l("p",{class:c(n.$style.xs)},"сядут ~",2),n.item.seating_time?(a(),L(be,{key:0,mask:"[hour:numeric]:[minute:numeric]",date:n.item.seating_time},null,8,["date"])):v("",!0)])],2),l("div",{class:c(["ark-space_top-2",n.$style.inline])},[s(e(X),{name:"table",class:"ark-space_right-1",size:20}),(a(!0),_(D,null,Y(n.item.tables,(r,$)=>(a(),_("div",{key:$},[$>0?(a(),_("span",Ba,"/")):v("",!0),typeof r=="string"?(a(),L(e(ye),{key:1,id:r},null,8,["id"])):(a(!0),_(D,{key:2},Y(r,g=>(a(),L(e(ye),{id:g,key:g,plus:""},null,8,["id"]))),128))]))),128))],2),n.item.required_zone?(a(),_("div",ja," Хотят "+N(n.item.required_zone),1)):v("",!0)]),l("td",null,[n.item.comment?(a(),_("div",{key:0,class:c(["ark-space_bottom-3",n.$style.comment])},[Pa,l("p",{class:c(n.$style.comment__text),"data-full":j.value,onClick:I[0]||(I[0]=r=>j.value=!j.value)},N(n.item.comment),11,Ja)],2)):v("",!0),l("div",Aa,[s(e(y),{appearance:"neutral",size:"xs",class:"ark-space_right-3",onClick:k},{default:i(()=>[p(" Изменить ")]),_:1}),n.item.status===e(o).Live?(a(),L(e(y),{key:0,appearance:"primary-reverse",size:"xs",class:"ark-space_right-3",loading:n.inviteLoading,onClick:I[1]||(I[1]=r=>z("invite",n.item))},{default:i(()=>[p(" Вызвать ")]),_:1},8,["loading"])):v("",!0),n.item.status===e(o).Live||n.item.status===e(o).Called?(a(),L(e(y),{key:1,appearance:"attention",size:"xs",class:"ark-space_right-3",loading:n.joinedLoading,onClick:I[2]||(I[2]=r=>z("changeStatus",n.item,e(o).Joined))},{default:i(()=>[p(" Пришел ")]),_:1},8,["loading"])):v("",!0),n.item.status===e(o).Live||n.item.status===e(o).Called||n.item.status===e(o).Joined?(a(),L(je,{key:2,item:n.item,loading:n.satLoading,onTableSelect:U},{default:i(({open:r})=>[s(e(y),{appearance:"success",class:"ark-space_right-3",size:"xs",icon:"arrow-down","icon-size":12,loading:n.satLoading,onClick:r},{default:i(()=>[p(" Занял ")]),_:2},1032,["loading","onClick"])]),_:1},8,["item","loading"])):v("",!0),n.item.status===e(o).Live||n.item.status===e(o).Called||n.item.status===e(o).Joined?(a(),L(e(y),{key:3,appearance:"s-danger",size:"xs",loading:n.leaveLoading,onClick:I[3]||(I[3]=r=>z("changeStatus",n.item,e(o).Cancelled))},{default:i(()=>[p(" Ушел ")]),_:1},8,["loading"])):v("",!0)])]),s(e(ve),{modelValue:q.value,"onUpdate:modelValue":I[4]||(I[4]=r=>q.value=r)},{default:i(()=>[Ha,l("form",{class:c(n.$style.form),onSubmit:ae(R,["prevent"])},[s(e(A),{control:e(f).name_for_reservation,"validation-errors":t},{default:i(({model:r})=>[s(e(oe),{modelValue:r.value,"onUpdate:modelValue":$=>r.value=$,label:"На чье имя бронь*",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(f).num_people,"validation-errors":t},{default:i(({model:r})=>[s(e(we),{modelValue:r.value,"onUpdate:modelValue":$=>r.value=$,label:"Количество человек*",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(f).phone_number,"validation-errors":t},{default:i(({model:r})=>[s(e(Se),{modelValue:r.value,"onUpdate:modelValue":$=>r.value=$,label:"Номер телефона",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(f).comment,"validation-errors":t},{default:i(({model:r})=>[s(e(oe),{modelValue:r.value,"onUpdate:modelValue":$=>r.value=$,label:"Комментарий",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{class:"ark-space_bottom-4",control:e(f).foreigner},{default:i(({model:r})=>[s(e(xe),{modelValue:r.value,"onUpdate:modelValue":$=>r.value=$},{default:i(()=>[p("Иностранец")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),l("div",{class:c(n.$style.buttons)},[s(e(y),{type:"submit",size:"l",loading:M.value},{default:i(()=>[p(" Сохранить ")]),_:1},8,["loading"]),s(e(y),{appearance:"neutral",type:"button",size:"l",onClick:Q},{default:i(()=>[p(" Отменить ")]),_:1})],2)],34)]),_:1},8,["modelValue"])],10,Oa))}}),Za="_form_1j2tr_2",Wa="_button_1j2tr_8",Ka="_row_1j2tr_12",Qa="_inline_1j2tr_22",Xa="_xs_1j2tr_28",Ya="_comment_1j2tr_32",Ga="_comment__text_1j2tr_38",es="_buttons_1j2tr_54",ts={form:Za,button:Wa,row:Ka,inline:Qa,xs:Xa,comment:Ya,comment__text:Ga,buttons:es},as={$style:ts},ss=re(Fa,[["__cssModules",as]]),ls={key:0,class:"ark-text_body-s"},os=l("span",{class:"ark-text_body-xs"}," на ",-1),ns=l("span",{class:"ark-text_body-xs"},"чел",-1),is=["href"],rs=le({__name:"ReservationHeader",props:{item:{}},emits:["onEdit"],setup(K,{emit:Z}){const V=K,z=Z,{item:t}=de(V),x=C(!1),T=te(()=>t.value.status===o.Cancelled||t.value.status===o.Sat),j=te(()=>{const h=t.value.phone_number||"";return h.slice(h.length-5).replace("-","")}),q=()=>{T.value&&(x.value=!x.value)};return(M,h)=>(a(),_("div",null,[l("button",{type:"button",class:c(M.$style.header),onClick:q},[l("p",null,[e(t).queue_number?(a(),_("span",ls,"№"+N(e(t).queue_number)+" ",1)):v("",!0),p(N(e(t).name_for_reservation),1),os,p(N(e(t).num_people),1),ns,e(t).phone_number?(a(),_("a",{key:1,class:c(["ark-space_left-1",M.$style.link]),href:`tel:${e(t).phone_number}`},[s(e(X),{name:"phone",style:{"margin-right":"2px"},size:12}),p(N(j.value),1)],10,is)):v("",!0)]),s(e(Me),{class:"ark-space_left-auto",size:"s",status:e(t).status,"invite-time":e(t).invite_time,created:e(t).created},null,8,["status","invite-time","created"]),s(e(y),{appearance:"neutral",size:"xs",icon:"edit",shape:"square","icon-size":12,style:{"--ark-height-xs":"1.25rem","margin-left":"2px"},onClick:h[0]||(h[0]=ae(w=>z("onEdit"),["stop"]))})],2),!T.value||x.value?Be(M.$slots,"default",{key:0,shortInfo:T.value}):v("",!0)]))}}),us="_header_1t0zn_1",ds="_inline_1t0zn_23",cs="_link_1t0zn_29",_s={header:us,inline:ds,link:cs},ms={$style:_s},ps=re(rs,[["__cssModules",ms]]),vs=["data-status"],fs={class:"ark-space_top-1 ark-text_body-s",style:{display:"flex",gap:"0.5rem"}},hs={class:"ark-space_left-1"},ks=l("p",{class:"ark-text_body-xs ark-text_64"},"Комментарий",-1),gs={class:"ark-text_body-s-2 ark-text_medium"},bs=l("h5",{class:"ark-text_h5 ark-space_bottom-4"},"Изменение",-1),ys=le({__name:"ReservationMobileItem",props:{item:{},satLoading:{type:Boolean},leaveLoading:{type:Boolean},inviteLoading:{type:Boolean},joinedLoading:{type:Boolean},computedTable:{}},emits:["changeStatus","invite","updateDto"],setup(K,{emit:Z}){const V=K,z=Z,{item:t}=de(V),x={required:"Обязательно",phone:"Некорректный номер мобильного телефона"},T=me(),j=pe(),q=C(!1),M=C(null),h=C(!1),w=C(!1),f=te(()=>{const r=t.value.status;return r===o.Live||r===o.Called||r===o.Joined});mt(pt,M);function W(r,$){return $.phone_required.value?r.trim().length>0:!0}const k=ze({num_people:[2,{required:se}],phone_number:["",{required:Ce.withMessage("validator.required",W),phone:Le(!1)}],name_for_reservation:["",{required:se}],foreigner:[!1],comment:[""],phone_required:[!0]}),U=ie($e);ee(U,r=>{r?k.phone_required.setValue(r.phone_required):k.phone_required.setValue(!0)},{immediate:!0});const R=()=>{k.num_people.setValue(V.item.num_people),k.phone_number.setValue(V.item.phone_number||""),k.name_for_reservation.setValue(V.item.name_for_reservation),k.foreigner.setValue(V.item.foreigner),k.comment.setValue(V.item.comment||""),h.value=!0},Q=()=>{if(k.validate(),k.invalid.value)return;const{num_people:r,phone_number:$,name_for_reservation:g,foreigner:u,comment:O}=k.getCurrentValue();w.value=!0,T.updateReservation.execute({id:V.item.id,num_people:r,phone_number:$?`+${Ve($)}`:"",name_for_reservation:g,foreigner:u,comment:O}).then(B=>{B&&(z("updateDto",B),h.value=!1,j.show("Бронирование обновлено"))}).catch(()=>{j.show("Не удалось изменить бронирование",{label:"Ошибка",type:"error"})}).finally(()=>{w.value=!1})},n=()=>{h.value=!1},I=r=>{q.value=!1,z("changeStatus",V.item,o.Sat,r)};return(r,$)=>(a(),_("div",{class:c(r.$style.item),"data-status":e(t).status},[s(ps,{item:e(t),onOnEdit:R},{default:i(()=>[l("div",fs,[l("div",{class:c(r.$style.inline),style:{gap:"0.25rem"}},[l("div",null,[l("p",{class:c(r.$style.xs)},"встали",2),e(t).created?(a(),L(Qe,{key:0,inline:"",hidetoday:"",class:c(r.$style.time),date:e(t).created},null,8,["class","date"])):v("",!0)]),s(e(X),{name:"arrow-right-stroke",size:12,class:c(r.$style.xs)},null,8,["class"]),l("div",null,[l("p",{class:c(r.$style.xs)},"сядут ~",2),e(t).seating_time?(a(),L(Qe,{key:0,inline:"",hidetoday:"",class:c(r.$style.time),date:e(t).seating_time},null,8,["class","date"])):(a(),_("p",{key:1,class:c(["ark-text_body-xs ark-text_64",r.$style.time])},[p(" Вычисляем"),s(e(Ge))],2))]),l("div",hs,[l("p",{class:c(r.$style.xs)},"Зона",2),l("p",{class:c([r.$style.time,r.$style.break])},N(e(t).required_zone??"Не важно"),3)])],2)]),e(t).comment?(a(),_("div",{key:0,class:c(r.$style.comment)},[ks,l("p",gs,N(e(t).comment),1)],2)):v("",!0),l("div",{class:c(r.$style.preview)},[s(e(ot),{"res-id":e(t).id,ids:e(t).tables,onUpdateDto:$[0]||($[0]=g=>z("updateDto",g))},null,8,["res-id","ids"])],2),f.value?(a(),_("div",{key:1,ref_key:"dropdownHostRef",ref:M,class:c(["ark-space_top-1",r.$style.buttons])},[e(t).status===e(o).Live||e(t).status===e(o).Called||e(t).status===e(o).Joined?(a(),L(e(y),{key:0,appearance:"s-danger",size:"xs",icon:"trash",class:c(r.$style.button),loading:r.leaveLoading,onClick:$[1]||($[1]=ae(g=>z("changeStatus",e(t),e(o).Cancelled),["stop"]))},{default:i(()=>[p(" Ушел ")]),_:1},8,["class","loading"])):v("",!0),e(t).status===e(o).Live&&e(t).phone_number?(a(),L(e(y),{key:1,appearance:"primary-reverse",size:"xs",icon:"bell",class:c(r.$style.button),loading:r.inviteLoading,onClick:$[2]||($[2]=g=>z("invite",e(t)))},{default:i(()=>[p(" Вызвать ")]),_:1},8,["class","loading"])):v("",!0),e(t).status===e(o).Live||e(t).status===e(o).Called?(a(),L(e(y),{key:2,appearance:"attention",size:"xs",icon:"handshake",class:c(r.$style.button),loading:r.joinedLoading,onClick:$[3]||($[3]=ae(g=>z("changeStatus",e(t),e(o).Joined),["stop"]))},{default:i(()=>[p(" Пришел ")]),_:1},8,["class","loading"])):v("",!0),e(t).status===e(o).Live||e(t).status===e(o).Called||e(t).status===e(o).Joined?(a(),L(je,{key:3,item:e(t),loading:r.satLoading,onTableSelect:I},{default:i(({open:g})=>[s(e(y),{appearance:"success",size:"xs",icon:"arrow-down",class:c(r.$style.button),loading:r.satLoading,onClick:g},{default:i(()=>[p(" Занял ")]),_:2},1032,["class","loading","onClick"])]),_:1},8,["item","loading"])):v("",!0)],2)):v("",!0)]),_:1},8,["item"]),s(e(ve),{modelValue:h.value,"onUpdate:modelValue":$[4]||($[4]=g=>h.value=g)},{default:i(()=>[bs,l("form",{class:c(r.$style.form),onSubmit:ae(Q,["prevent"])},[s(e(A),{control:e(k).name_for_reservation,"validation-errors":x},{default:i(({model:g})=>[s(e(oe),{modelValue:g.value,"onUpdate:modelValue":u=>g.value=u,label:"На чье имя бронь*",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(k).num_people,"validation-errors":x},{default:i(({model:g})=>[s(e(we),{modelValue:g.value,"onUpdate:modelValue":u=>g.value=u,label:"Количество человек*",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(k).phone_number,"validation-errors":x},{default:i(({model:g})=>[s(e(Se),{modelValue:g.value,"onUpdate:modelValue":u=>g.value=u,label:"Номер телефона",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(k).comment,"validation-errors":x},{default:i(({model:g})=>[s(e(oe),{modelValue:g.value,"onUpdate:modelValue":u=>g.value=u,label:"Комментарий",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{class:"ark-space_bottom-4",control:e(k).foreigner},{default:i(({model:g})=>[s(e(xe),{modelValue:g.value,"onUpdate:modelValue":u=>g.value=u},{default:i(()=>[p("Иностранец")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),l("div",{class:c(r.$style.actions)},[s(e(y),{type:"submit",size:"l",loading:w.value},{default:i(()=>[p(" Сохранить ")]),_:1},8,["loading"]),s(e(y),{appearance:"neutral",type:"button",size:"l",onClick:n},{default:i(()=>[p(" Отменить ")]),_:1})],2)],34)]),_:1},8,["modelValue"])],10,vs))}}),$s="_item_1glbs_2",Vs="_form_1glbs_20",zs="_inline_1glbs_26",Cs="_button_1glbs_34",Ls="_button_deep_1glbs_37",ws="_tableList_1glbs_41",Ss="_tableList__item_1glbs_46",xs="_buttons_1glbs_66",qs="_preview_1glbs_75",Us="_xs_1glbs_87",Ns="_time_1glbs_92",Rs="_edit_1glbs_101",Is="_comment_1glbs_107",Ds="_actions_1glbs_125",Ts={item:$s,form:Vs,inline:zs,button:Cs,button_deep:Ls,tableList:ws,tableList__item:Ss,buttons:xs,preview:qs,xs:Us,time:Ns,break:"_break_1glbs_97",edit:Rs,comment:Is,actions:Ds},Os={$style:Ts},Es=re(ys,[["__cssModules",Os]]),Ms=["data-list"],Bs={class:"ark-text_h6 ark-space_bottom-2",style:{display:"flex","align-items":"center",gap:"0.75rem"}},js=l("p",{class:"ark-text_body-xs ark-text_64"},"Ожидание",-1),Ps={key:0,class:"ark-table"},Js={style:{"--header-padding":"0.5rem 0.75rem"},class:"ark-table__header"},As={class:"ark-text_body-l ark-text_medium"},Hs=l("p",null,"Список",-1),Fs={key:0,class:"ark-text_body-xs ark-text_semibold ark-text_64"},Zs=l("th",null,"Номер",-1),Ws=l("th",null,"Имя",-1),Ks=l("th",null,"Время и столы",-1),Qs={key:0},Xs={colspan:"4"},Ys={key:0,class:"ark-text_body-s ark-text_semibold ark-text_64",style:{"text-align":"center"}},Gs={key:1,class:"ark-space_top-2",style:{"text-align":"center"}},el={key:1,style:{"text-align":"center",width:"100%"}},tl=l("img",{src:Ee,width:"128",height:"128",alt:"No zones",class:"ark-space_bottom-4"},null,-1),al={class:"ark-text_h6 ark-space_bottom-3"},sl={key:0,class:"ark-text_body-s ark-text_semibold ark-text_64",style:{"text-align":"center"}},ll={key:1,class:"ark-space_top-2",style:{"text-align":"center"}},ol={key:1,style:{"text-align":"center",width:"100%"}},nl=l("img",{src:Ee,width:"128",height:"128",alt:"No zones",class:"ark-space_bottom-4"},null,-1),il={class:"ark-text_h6 ark-space_bottom-3"},rl=["data-list"],ul={key:1,class:"ark-space_top-2",style:{"text-align":"center"}},dl={key:2,style:{"text-align":"center",width:"100%"}},cl=l("img",{src:Ee,width:"128",height:"128",alt:"No zones",class:"ark-space_bottom-4"},null,-1),_l={class:"ark-text_h6 ark-space_bottom-3"},ml=le({__name:"Reservations",props:{id:{}},setup(K){const Z=K,{id:V}=de(Z),z=me(),t=pe(),T=vt().computedSmallerThen("mobile"),j=ie(bt),q=ie($e),M=C(NaN),h=C(!1),w=C(null),f=C(!1),W=C(!1),k=C(null),U=C(!1),R=C(NaN),Q=C(NaN),n=C(NaN),I=C(NaN),r=C(NaN),$=C(!1),g=C(localStorage.getItem("__ark-supra-queue-new-design")!=="1"),u=C(localStorage.getItem("__ark-supra-queue-new-design-list")==="1");ee(u,m=>{m?localStorage.setItem("__ark-supra-queue-new-design-list","1"):localStorage.removeItem("__ark-supra-queue-new-design-list")});const O=ie(yt),B=[o.Live,o.Called,o.Joined,void 0],P=C(!1),H={[o.Live]:"Ожидает",[o.Called]:"Вызван",[o.Joined]:"Пришел",undefined:"Все"},ce=C(1),E=C({status:o.Live,prefer_zone:null,size:50});ee(g,m=>{m?localStorage.removeItem("__ark-supra-queue-new-design"):localStorage.setItem("__ark-supra-queue-new-design","1")});const fe=ie($t),Pe=C(null),et=["минуту","минуты","минут"];let he=null;const Je=C(Date.now()),tt=te(()=>{Je.value;const m=O.value,b=Te.currentLocal().valueOf()-Te.fromLocalNativeDate(new Date(m)).valueOf(),d=Te.fromAbsoluteMilliseconds(b);return d.hours?"больше часа":d.minutes?`${d.minutes} ${Vt(et,d.minutes)}`:"меньше минуты"}),Ae=te(()=>(Pe.value||[]).filter(b=>b.num_people===2||b.num_people===4||b.num_people===6)),ue=te(()=>{const m=w.value;if(h.value)return m&&m.results.length>0?m.results:wt;const b=fe.value,d=((m==null?void 0:m.results)||[]).reduce((J,F)=>(J.push({...F,tables:F.tables||F.table,original_phone:F.phone_number,phone_number:F.phone_number?zt(F.phone_number):""}),J),[]),S=(k.value||"").trim().toLowerCase();return S?d.filter(J=>(J.original_phone?J.original_phone.includes(S):!1)||J.name_for_reservation.toLowerCase().includes(S)||J.tables.some(F=>{if(typeof F=="string"){const G=b[F];return G?G.number.includes(S)||G.zone.toLowerCase().includes(S):!1}return F.some(G=>{const De=b[G];return De?De.number.includes(S)||De.zone.toLowerCase().includes(S):!1})})):d}),qe=()=>{M.value=Date.now(),O.value=Date.now()},ne=(m,b=!1)=>{var d;if(w.value){const S=((d=w.value)==null?void 0:d.results)||[];let J;if(b){const F=S.filter(G=>G.id!==m.id);J=[m].concat(F)}else J=S.map(F=>F.id===m.id?m:F);w.value={...w.value,results:J}}},Ue=m=>{n.value=m.id;const b={id:m.id,status:m.status};z.inviteReservation.execute({id:m.id}).then(d=>{d&&(t.show(Oe(Ke),{autoClose:!1,type:"undo",data:{title:d.info,icon:d.info==="SMS было отправлено"?"check":"info",iconColor:d.info==="SMS было отправлено"?void 0:"var(--ark-info-fill)",callback:()=>z.updateReservation.execute(b).then(S=>{S&&ne(S)})}}),z.loadReservationItem.execute({id:m.id}).then(S=>{S&&ne(S)}).catch(()=>null))}).catch(()=>{t.show("Не удалось пригласить",{label:"Ошибка",type:"error"})}).finally(()=>{n.value=NaN})},at={[o.Called]:"Вызвали",[o.Cancelled]:"Убрали из очереди",[o.Joined]:"Теперь с нами",[o.Live]:"Добавили в очередь",[o.Sat]:"Посадили за стол"},Ne=(m,b,d)=>{b===o.Cancelled?Q.value=m.id:b===o.Joined?I.value=m.id:b===o.Live?r.value=m.id:R.value=m.id;const S={id:m.id,status:m.status},J={id:m.id,status:b};d&&(J.table=d),z.updateReservation.execute(J).then(F=>{F&&(ne(F,b===o.Joined),t.show(Oe(Ke),{autoClose:!1,type:"undo",data:{title:at[b]||"Обновили статус",callback:()=>z.updateReservation.execute(S).then(G=>{G&&ne(G)})}}))}).catch(()=>{t.show("Не удалось изменить статус",{label:"Ошибка",type:"error"})}).finally(()=>{Q.value=NaN,R.value=NaN,I.value=NaN,r.value=NaN})},Re=()=>{P.value=!P.value},Ie=()=>{$.value=!0;const{status:m,size:b,prefer_zone:d}=E.value;z.loadReservations.execute({restaurant_id:Number(Z.id),status:m,page:ce.value+1,page_size:b,zone:d??void 0}).then(S=>{S&&($.value=!1,ce.value+=1,w.value?w.value={...S,results:w.value.results.concat(S.results)}:w.value=S)}).catch(([S,J])=>{J!==403&&(t.show("Попробуй еще раз",{type:"error",label:"Ошибка загрузки след страницы"}),$.value=!1)})},ke=m=>{E.value={...E.value,status:m},f.value=!1},st=m=>{E.value={...E.value,prefer_zone:m},W.value=!1},lt=([m,{status:b,size:d,prefer_zone:S}])=>{h.value=!0,z.loadReservations.execute({restaurant_id:Number(m),status:b,page:1,page_size:d,zone:S??void 0}).then(J=>{J&&(h.value=!1),w.value=J}).catch(([J,F])=>{F!==403&&(t.show("Не удалось загрузить очередь",{type:"error",label:"Ошибка"}),h.value=!1)})};let ge=null;return ft(()=>{he=setInterval(()=>{Je.value=Date.now()},ht),ge=setInterval(()=>{M.value=Date.now()},Xe*30)}),kt(()=>{ge&&clearInterval(ge),he&&clearInterval(he),ge=null,he=null}),ee([V,E,O],lt,{immediate:!0}),ee([()=>Z.id,M],([m])=>{m&&z.loadEta.execute({id:m}).then(b=>{Pe.value=b}).catch(()=>null)},{immediate:!0}),(m,b)=>(a(),_(D,null,[l("div",{class:c(["ark-space_bottom-2",m.$style.container]),"data-list":e(T)?!1:!g.value&&u.value},[l("h6",Bs,[p(" Очередь "),s(e(y),{appearance:"flat",size:"xs",icon:"refresh",style:{gap:"0.5rem"},onClick:qe},{default:i(()=>[p(" Обновлено "+N(tt.value)+" назад ",1)]),_:1})]),l("div",{class:c(["ark-space_bottom-2",m.$style.header])},[l("div",null,[js,Ae.value?(a(),_("div",{key:0,class:c(m.$style.eta)},[(a(!0),_(D,null,Y(Ae.value,(d,S)=>(a(),_("div",{key:d.num_people,class:c(m.$style.eta__item)},[S===0?(a(),_(D,{key:0},[s(e(X),{name:"users",size:12}),p("  ")],64)):v("",!0),p(N(d.num_people)+" ~ ",1),s(e(Lt),{date:d.time_difference_minutes},null,8,["date"])],2))),128))],2)):v("",!0)])],2),_e((a(),_("div",{class:c(m.$style.statuses)},[s(e(We),{modelValue:f.value,"onUpdate:modelValue":b[0]||(b[0]=d=>f.value=d),align:"left","min-width":200},{dropdown:i(()=>[s(e(He),null,{default:i(()=>[(a(),_(D,null,Y(B,d=>_e(s(e(y),{key:d,size:"s",appearance:"flat",style:{width:"100%"},"icon-right":E.value.status===d?"check":void 0,onClick:S=>ke(d)},{default:i(()=>[p(N(H[d]),1)]),_:2},1032,["icon-right","onClick"]),[[e(Fe)]])),64))]),_:1})]),default:i(()=>[s(e(y),{appearance:"flat","icon-right":"arrow-down",size:"xs","right-rotate":f.value},{default:i(()=>[p(" Статус: "),l("b",null,N(H[E.value.status]),1)]),_:1},8,["right-rotate"])]),_:1},8,["modelValue"]),s(e(We),{modelValue:W.value,"onUpdate:modelValue":b[1]||(b[1]=d=>W.value=d),align:"left",class:"ark-space_right-auto","min-width":200},{dropdown:i(()=>[s(e(He),null,{default:i(()=>[(a(!0),_(D,null,Y(e(j),(d,S)=>_e((a(),L(e(y),{key:S,size:"s",appearance:"flat","icon-right":E.value.prefer_zone===d?"check":void 0,onClick:J=>st(d)},{default:i(()=>[p(N(d??"Все"),1)]),_:2},1032,["icon-right","onClick"])),[[e(Fe)]])),128))]),_:1})]),default:i(()=>[s(e(y),{appearance:"flat","icon-right":"arrow-down",size:"xs","right-rotate":W.value},{default:i(()=>[p(" Зона: "),l("b",null,N(E.value.prefer_zone??"Все"),1)]),_:1},8,["right-rotate"])]),_:1},8,["modelValue"]),e(T)?v("",!0):(a(),_(D,{key:0},[s(e(y),{size:"xs",icon:"list",appearance:u.value&&!g.value?"neutral":"flat",onClick:b[2]||(b[2]=d=>{g.value=!1,u.value=!0})},{default:i(()=>[p(" Списком ")]),_:1},8,["appearance"]),s(e(y),{size:"xs",icon:"grid",appearance:u.value||g.value?"flat":"neutral",onClick:b[3]||(b[3]=d=>{g.value=!1,u.value=!1})},{default:i(()=>[p(" Сеткой ")]),_:1},8,["appearance"])],64)),s(e(y),{size:"xs",appearance:g.value?"flat":"neutral",onClick:b[4]||(b[4]=d=>g.value=!1)},{default:i(()=>[p(" Новый дизайн ")]),_:1},8,["appearance"]),s(e(y),{size:"xs",appearance:g.value?"neutral":"flat",onClick:b[5]||(b[5]=d=>g.value=!0)},{default:i(()=>[p(" Старый дизайн ")]),_:1},8,["appearance"])],2)),[[e(Ye)]])],10,Ms),g.value?(a(),_(D,{key:0},[e(T)?(a(),_("div",{key:1,class:c(m.$style.items)},[ue.value.length>0?(a(),_(D,{key:0},[(a(!0),_(D,null,Y(ue.value,d=>(a(),L(e(Es),{key:d.id,item:d,class:c(h.value&&"ark-skeleton"),"computed-table":e(fe),"leave-loading":d.id===Q.value,"sat-loading":d.id===R.value,"invite-loading":d.id===n.value,"joined-loading":d.id===I.value,onChangeStatus:Ne,onUpdateDto:ne,onInvite:Ue},null,8,["item","class","computed-table","leave-loading","sat-loading","invite-loading","joined-loading"]))),128)),w.value&&!w.value.next&&!h.value?(a(),_("div",sl," Больше нет никого ")):w.value&&!h.value?(a(),_("div",ll,[s(e(y),{appearance:"neutral",size:"s",loading:$.value,onClick:Ie},{default:i(()=>[p(" Загрузить 50 следующих ")]),_:1},8,["loading"])])):v("",!0)],64)):(a(),_("div",ol,[nl,l("h6",il,[p(" Нет никого "),E.value.status&&E.value.status!==e(o).Live?(a(),_(D,{key:0},[p(' из тех кто "'+N(H[E.value.status])+'" ',1)],64)):v("",!0)]),E.value.status!==e(o).Live?(a(),L(e(y),{key:0,appearance:"neutral",size:"s",onClick:b[7]||(b[7]=d=>ke(e(o).Live))},{default:i(()=>[p(" Показать тех кто в очереди? ")]),_:1})):v("",!0)]))],2)):(a(),_("div",Ps,[l("div",Js,[l("div",As,[Hs,e(T)?v("",!0):(a(),_("p",Fs," Shift + колесико мышки для скролла по горизонтали "))]),l("button",{type:"button",class:c([m.$style.grid__add,m.$style.grid__add_s]),onClick:Re}," Добавить в очередь ",2)]),s(e(gt),null,{default:i(()=>[l("table",null,[l("thead",null,[Zs,Ws,Ks,E.value.status===e(o).Live||E.value.status===e(o).Called||E.value.status===e(o).Joined||E.value.status===void 0?(a(),_("th",Qs," Изменение статуса ")):v("",!0)]),l("tbody",null,[ue.value.length>0?(a(),_(D,{key:0},[(a(!0),_(D,null,Y(ue.value,d=>(a(),L(e(ss),{key:d.id,class:c(h.value&&"ark-skeleton"),item:d,"computed-table":e(fe),"leave-loading":d.id===Q.value,"sat-loading":d.id===R.value,"invite-loading":d.id===n.value,"joined-loading":d.id===I.value,onChangeStatus:Ne,onUpdateDto:ne,onInvite:Ue},null,8,["class","item","computed-table","leave-loading","sat-loading","invite-loading","joined-loading"]))),128)),l("tr",null,[l("td",Xs,[w.value&&!w.value.next&&!h.value?(a(),_("div",Ys," Больше нет никого ")):w.value&&!h.value?(a(),_("div",Gs,[s(e(y),{appearance:"neutral",size:"s",loading:$.value,onClick:Ie},{default:i(()=>[p(" Загрузить 50 следующих ")]),_:1},8,["loading"])])):v("",!0)])])],64)):(a(),_("div",el,[tl,l("h6",al,[p(" Нет никого "),E.value.status&&E.value.status!==e(o).Live?(a(),_(D,{key:0},[p(' из тех кто "'+N(H[E.value.status])+'" ',1)],64)):v("",!0)]),E.value.status!==e(o).Live?(a(),L(e(y),{key:0,appearance:"neutral",size:"s",onClick:b[6]||(b[6]=d=>ke(e(o).Live))},{default:i(()=>[p(" Показать тех кто в очереди? ")]),_:1})):v("",!0)]))])])]),_:1})]))],64)):(a(),_("div",{key:1,class:c(m.$style.grid),"data-list":e(T)?!1:u.value},[e(T)?v("",!0):(a(),_("button",{key:0,type:"button",class:c(m.$style.grid__add),onClick:Re}," Добавить в очередь ",2)),ue.value.length>0?(a(),_(D,{key:1},[(a(!0),_(D,null,Y(ue.value,d=>{var S;return a(),L(e(Ta),{key:d.id,item:d,loading:h.value,"computed-table":e(fe),"leave-loading":d.id===Q.value,"sat-loading":d.id===R.value,"invite-loading":d.id===n.value,"joined-loading":d.id===I.value,"live-loading":d.id===r.value,timezone:(S=e(q))==null?void 0:S.timezone,onChangeStatus:Ne,onUpdateDto:ne,onInvite:Ue},null,8,["item","loading","computed-table","leave-loading","sat-loading","invite-loading","joined-loading","live-loading","timezone"])}),128)),w.value&&!w.value.next&&!h.value?(a(),_("div",{key:0,class:c(["ark-text_body-s ark-text_semibold ark-text_64",m.$style.empty])}," Больше нет никого ",2)):w.value&&!h.value?(a(),_("div",ul,[s(e(y),{appearance:"neutral",size:"s",loading:$.value,onClick:Ie},{default:i(()=>[p(" Загрузить 50 следующих ")]),_:1},8,["loading"])])):v("",!0)],64)):(a(),_("div",dl,[cl,l("h6",_l,[p(" Нет никого "),E.value.status&&E.value.status!==e(o).Live?(a(),_(D,{key:0},[p(' из тех кто "'+N(H[E.value.status])+'" ',1)],64)):v("",!0)]),E.value.status!==e(o).Live?(a(),L(e(y),{key:0,appearance:"neutral",size:"s",onClick:b[8]||(b[8]=d=>ke(e(o).Live))},{default:i(()=>[p(" Показать тех кто в очереди? ")]),_:1})):v("",!0)]))],10,rl)),e(T)?(a(),_("div",{key:2,class:c([m.$style.safe__content,(U.value||k.value)&&m.$style.safe__content_top])},[U.value||k.value?v("",!0):(a(),_(D,{key:0},[s(e(y),{"icon-button":"",icon:"refresh",appearance:"elevation",size:"l",shape:"square",class:"ark-space_left-auto",onClick:qe}),s(e(y),{"icon-button":"",shape:"square",icon:"plus",appearance:"elevation",size:"l",onClick:Re})],64))],2)):v("",!0),s(e(ve),{modelValue:P.value,"onUpdate:modelValue":b[9]||(b[9]=d=>P.value=d)},{default:i(({close:d})=>[s(e(na),{id:e(V),"computed-zones":e(j),onRefresh:qe,onClose:d},null,8,["id","computed-zones","onClose"])]),_:1},8,["modelValue"])],64))}}),pl="_container_17tdl_1",vl="_header_17tdl_7",fl="_eta_17tdl_13",hl="_eta__item_17tdl_19",kl="_statuses_17tdl_28",gl="_grid_17tdl_43",bl="_grid__add_17tdl_55",yl="_grid__add_s_17tdl_81",$l="_items_17tdl_92",Vl="_safe_17tdl_97",zl="_safe__content_17tdl_100",Cl="_search_17tdl_116",Ll="_search_focused_17tdl_122",wl="_empty_17tdl_126",Sl="_status_17tdl_28",xl={container:pl,header:vl,eta:fl,eta__item:hl,statuses:kl,grid:gl,grid__add:bl,grid__add_s:yl,items:$l,safe:Vl,safe__content:zl,search:Cl,search_focused:Ll,empty:wl,status:Sl},ql={$style:xl},Kl=re(ml,[["__cssModules",ql]]);export{Kl as default};
