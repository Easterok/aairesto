import{d as V,Q as U,A as j,u as F,r as h,a9 as d,e as P,f as Z,b as C,w as q,o as s,c as t,g as k,a as _,F as l,n as b,t as m,k as w,i as y,j as A,h as K,s as O,x as Q,q as G,S as H,ao as J,_ as W}from"./index-6367d8ff.js";const X={class:"ark-text_body-s-2"},Y=_("span",{class:"ark-text_64 ark-text_body-xs"}," • ",-1),ee={key:1},se=_("p",null,"Информация о столах будет в течение минуты",-1),te=V({__name:"TablesPreview",props:{resId:{},ids:{},showCapacity:{type:Boolean,default:!0},showZone:{type:Boolean,default:!0}},emits:["updateDto"],setup(M,{emit:N}){const u=M,D=N,{ids:L,resId:z}=U(u),S=j(J),$=F(),I=h(d.currentLocal()),x=h(Date.now()),i=h(!1);let f=null;P(()=>{f=setInterval(()=>{x.value=Date.now()},500)}),Z(()=>{f&&clearInterval(f)});const v=C(()=>{const e=L.value,n=S.value;return e?(Array.isArray(e)?e:[e]).map(r=>{var g;const a=(Array.isArray(r)?r:[r]).map(c=>n[c]).filter(Boolean),E=a.map(c=>c.number),R=a.map(c=>c.capacity);return{numbers:E,capacity:R,zone:(g=a[0])==null?void 0:g.zone}}):[]}),T=C(()=>{if(v.value.length>0||!u.resId||u.resId<0)return 1/0;x.value;const e=I.value,n=d.currentLocal();return d.fromAbsoluteMilliseconds(e.shift({seconds:30}).toAbsoluteMilliseconds()-n.toAbsoluteMilliseconds()).seconds}),B=()=>{i.value=!0,$.loadReservationItem.execute({id:u.resId}).then(e=>{e&&D("updateDto",e)}).catch(()=>null).finally(()=>{I.value=d.currentLocal(),i.value=!1})};return q([i,T],([e,n])=>{!e&&n<0&&B()},{immediate:!0}),(e,n)=>v.value.length>0?(s(!0),t(l,{key:0},k(v.value,(o,r)=>(s(),t("div",{key:r},[_("p",X,[(s(!0),t(l,null,k(o.numbers,(p,a)=>(s(),t("span",{key:a,class:b(e.$style.number)},m(p),3))),128)),e.showCapacity?(s(),t(l,{key:0},[Y,(s(!0),t(l,null,k(o.capacity,(p,a)=>(s(),t("span",{key:a,class:b(e.$style.capacity)},m(p),3))),128))],64)):w("",!0)]),e.showZone?(s(),t("p",{key:0,class:b(["ark-text_64 ark-text_body-xs",e.$style.zone])},m(o.zone),3)):w("",!0)]))),128)):y(z)&&y(z)>0?(s(),t("div",ee,[se,_("p",null,[A(" Автообновление "),i.value?(s(),G(y(H),{key:1,name:"spinner",size:12})):(s(),t(l,{key:0},[A("через "+m(T.value)+" сек ",1),K(y(Q),{appearance:"flat",size:"xs",icon:"refresh",class:"ark-space_left-1","icon-size":12,onClick:B},{default:O(()=>[A("Обновить")]),_:1})],64))])])):w("",!0)}}),ae="_number_1hp70_2",ne="_capacity_1hp70_14",oe="_zone_1hp70_26",re={number:ae,capacity:ne,zone:oe},ce={$style:re},ue=W(te,[["__cssModules",ce]]);export{ue as T};
