import{d as Ue,Q as We,A as je,b as d,aa as F,ab as ze,a9 as he,bn as ta,ad as Ne,am as Ut,aJ as qt,o as s,c as i,q as pe,i as e,a6 as at,k as U,a,t as M,j as S,F as L,g as ue,n as o,h as v,S as Rt,W as ft,b4 as Xt,_ as Xe,aC as bt,r as P,w as $e,ah as st,aG as Re,v as ht,x as R,s as w,aM as $t,ap as pt,e as aa,f as sa,u as xt,l as wt,m as lt,G as Ye,bo as Mt,D as yt,a5 as na,B as la,ac as et,ao as Ht,af as oa,ag as ra,R as Pe,bh as ia,a1 as ua,ae as Qe,b3 as ca,aj as mt,bl as St,bp as da,aK as jt,aL as tt,Z as ma,b1 as _a,bq as va,br as pa,y as fa,z as ba,bs as ga,av as ut,b9 as It,a0 as Vt,a4 as ct,a8 as ya}from"./index-f01f95e2.js";import{O as ka,I as At,M as ha}from"./index-a55c206f.js";import{T as dt}from"./index-1163e117.js";import{T as kt}from"./index-9b992aff.js";import{c as zt,p as Ot,s as Bt}from"./index-8c2b22c0.js";import{_ as Je,a as $a}from"./index-644bde6f.js";import{_ as xa}from"./index-b1bee2fe.js";import{c as wa,v as Sa,b as za,S as Oa,B as Ca,a as Ta}from"./index-f1fc2c40.js";import{F as La}from"./index-953ce25b.js";import{c as Ft,r as _t,s as Na}from"./index-e0d70f45.js";import{I as Da}from"./index-4a0e6e29.js";import{v as Ea,a as Ma}from"./index-aa15846a.js";import{u as ja}from"./index-1a7b15b1.js";import"./index-78d06d09.js";/* empty css              */import"./index-1eae7b5e.js";import"./index-9b5bd4ab.js";/* empty css              */import"./index-edaad5b3.js";const Ia=["data-conf"],Va=a("p",{class:"ark-text_body-xs ark-text_semibold ark-space_bottom-1"}," Новое бронирование ",-1),Aa={class:"ark-text_semibold"},Ba={class:"ark-text_body-xs ark-space_bottom-2"},Pa={class:"ark-text_body-xs ark-text_64"},Ua={class:"ark-text_body-xs"},qa=Ue({__name:"SelectedPreview",props:{vertical:{},horizontal:{},tables:{},time:{},conf:{type:Boolean}},setup(ge){const fe=ge,{vertical:O,horizontal:D,tables:K,time:ne}=We(fe),W=je(ft),V=d(()=>{const f=O.value;return f?f.start.time.toJSON():null}),le=d(()=>{const f=O.value;if(!f)return null;const $=f.end.time.valueOf(),z=new Date($+Ne*15),te=new F(ze.fromLocalNativeDate(z),he.fromLocalNativeDate(z));return`${f.start.time.time.toString("HH:MM")} ${ta} ${te.time.toString("HH:MM")}`}),oe=d(()=>{const f=D.value,$=K.value,z=Object.keys($);if(!f)return[];const{start:te,end:me}=f,ce=[];let Y=!1;for(let ae=0;ae<z.length;ae++){const ve=$[z[ae]];if(!Y&&ve.id===te.column&&(Y=!0),Y&&(ce.push({id:ve.id,num:ve.number,zone:ve.zone,cap:ve.capacity}),ve.id===me.column))break}return ce}),X=d(()=>oe.value.reduce((f,$)=>f+$.cap,0)),ee=d(()=>{const f=O.value;if(!f)return null;const{start:$,end:z}=f,te=$.time.valueOf();let me=z.time.valueOf()+Ne*15;return me<te&&(me+=Xt),he.fromAbsoluteMilliseconds(me-te)}),E=["час","часа","часов"],Z=d(()=>{const f=ee.value;if(!f)return"";const $=[];return f.hours!==0&&$.push(`${f.hours} ${Ut(E,f.hours)}`),f.minutes!==0&&$.push(`${f.minutes} мин`),$.join(qt)}),J=d(()=>{const f=oe.value;if(!f[0])return[];const $=f[0].zone,z=[];f.every(Y=>Y.zone===$)||z.push("Столы из разных зон");const te=O.value,me=ne.value;te&&te.start.time.valueOf()<me.valueOf()&&z.push("Время начала в прошлом");const ce=W.value;return te&&ce&&te.start.time.valueOf()<new F(te.start.time.day,he.fromString(ce.opening_time)).valueOf()&&z.push("Время начала до открытия"),z});return(f,$)=>(s(),i("div",{class:o(f.$style.root),"data-conf":f.conf},[Va,V.value?(s(),pe(e(at),{key:0,today:"",mask:"[day:numeric] [month:long] [year:numeric]",class:"ark-text_body-xs",date:V.value},null,8,["date"])):U("",!0),a("p",Aa,M(le.value),1),a("p",Ba,M(Z.value),1),a("p",Pa,[S(" Столы "),(s(!0),i(L,null,ue(oe.value,z=>(s(),i("span",{key:z.id,class:o(f.$style.table)},M(z.num),3))),128))]),a("p",Ua,[S(" На "),a("b",null,M(X.value)+" чел",1)]),J.value.length>0?(s(),i("div",{key:1,class:o(["ark-space_top-2",f.$style.notification])},[(s(!0),i(L,null,ue(J.value,z=>(s(),i("p",{key:z,class:o(f.$style.notification__text)},[v(e(Rt),{name:"warning",style:{color:"var(--supra-attention-color)"},size:12}),S(" "+M(z),1)],2))),128))],2)):U("",!0)],10,Ia))}}),Ra="_root_a4i85_1",Xa="_table_a4i85_13",Ha="_notification_a4i85_27",Fa="_notification__text_a4i85_38",Ja={root:Ra,table:Xa,notification:Ha,notification__text:Fa},Wa={$style:Ja},Ct=Xe(qa,[["__cssModules",Wa]]),Za=["data-show-hidden"],Ga=["data-col","data-time"],Ka=["data-col","data-time"],Ya=["data-id","data-high","data-type","data-selection","data-airesto","onClick"],Qa=a("p",null,"Жду следующую",-1),Pt=32,es=Ue({__name:"MobileTimesheet",props:{timeSegments:{},tables:{},data:{},highlight:{},count:{},addEnabled:{type:Boolean},freezLoading:{type:Boolean}},emits:["add","show","freez"],setup(ge,{emit:fe}){bt(l=>({"062ca894":Q.value}));const O=ge,D=fe,{timeSegments:K,data:ne,tables:W,count:V,addEnabled:le}=We(O),oe=je($t),X=P(128),ee=P(null),E=P(null),Z=P(!1),J=P(!1),f=P(null),$=d(()=>oe.value.native);let z=null;$e([ee,V],([l],p,t)=>{if(t(()=>{z&&clearTimeout(z),z=null}),l){const r=Array.isArray(l)?l[0]:l;z=setTimeout(()=>{X.value=r.clientWidth})}},{immediate:!0});const te=d(()=>K.value.reduce((p,t)=>{const r=new Date(t.valueOf()+Ne*15),u=new F(ze.fromLocalNativeDate(r),he.fromLocalNativeDate(r)),h={a:t,b:u};return p.push(h),p},[])),me=d(()=>W.value.reduce((p,t,r)=>(p[t.id]=r,p),{})),ce=d(()=>W.value.reduce((p,t)=>(p[t.id]=t,p),{})),Y=d(()=>{const l=f.value;if(!l)return null;const{start:p,end:t}=l,r=p.time.valueOf(),u=t.time.valueOf(),h=Math.abs(r-u)/(Ne*15);return p.time.valueOf()>t.time.valueOf()?{start:t,end:p,diff:h}:{start:p,end:t,diff:h}}),ae=d(()=>{const l=f.value;if(!l)return null;const{start:p,end:t}=l,r=me.value,u=r[p.column],h=r[t.column],T=Math.abs(u-h);return u<h?{start:p,end:t,diff:T}:{start:t,end:p,diff:T}}),ve=d(()=>{const l=ae.value;return l?`${(l.diff+1)*X.value}px`:"0px"}),Oe=d(()=>{const l=Y.value;return l?`${(l.diff+1)*(Pt/2)}px`:"0px"}),Ce=d(()=>{const l=ae.value,p=me.value;return l?`${p[l.start.column]*X.value}px`:"0px"}),Ie=d(()=>{const l=te.value[0],p=Y.value;return!l||!p?"0px":`${(p.start.time.valueOf()-l.a.valueOf())/(Ne*15)*(Pt/2)+42}px`}),x=d(()=>{const l=ve.value,p=Oe.value,t=Ce.value,r=Ie.value;return{left:t,width:l,height:p,top:r}}),q=d(()=>le.value&&!!f.value),C=d(()=>{const l=K.value;if(l.length===0)return[-1/0,1/0];const p=l[0].toLocalNativeDate().valueOf(),t=l[l.length-1];let r=t.day;t.time.valueOf()>t.time.shift({minutes:30}).valueOf()&&(r=r.append({day:1}));const u=new F(r,t.time.shift({minutes:30})).toLocalNativeDate().valueOf();return[p,u]}),Q=d(()=>{const l=$.value.valueOf(),[p,t]=C.value;return`${zt(l,p,t).toFixed(2)}%`}),c=d(()=>{const l=ne.value,[p,t]=C.value;return Ot(l,p,t)}),y=()=>{J.value=!1,f.value=null,Z.value=!1},N=()=>{const l=ae.value,p=Y.value,t=ce.value;if(!l||!p)return;const r=new Date(p.end.time.valueOf()+Ne*15),u=new F(ze.fromLocalNativeDate(r),he.fromLocalNativeDate(r)),h={...p,end:{...p.end,time:u}};D("add",{horizontal:l,vertical:h,tables:t}),f.value=null,J.value=!1};let se=null;const G=()=>{se&&clearTimeout(se),se=null},_e=l=>{if(G(),!le.value)return;const p=l.target,t=p.getAttribute("data-col"),r=p.getAttribute("data-time");!t||!r||Z.value||(se=setTimeout(()=>{const u={column:t,time:F.fromString(r)};f.value={start:u,end:u},J.value=!1,Z.value=!0},500))},j=()=>{const l=f.value,p={};if(l){const t=ce.value,r=Object.keys(t),{start:u,end:h}=l;let T=!1;for(let re=0;re<r.length;re++){const ie=t[r[re]];if(!T&&ie.id===u.column&&(T=!0),T&&(p[ie.id]=!0,ie.id===h.column))break}D("freez",{time:l.start.time,tables:Object.keys(p)})}};$e(()=>O.freezLoading,(l,p)=>{!l&&p&&y()});const B=l=>{if(Z.value){G();const p=l.target,t=p.getAttribute("data-col"),r=p.getAttribute("data-time");if(!t||!r)return;l.preventDefault(),l.stopPropagation();const u={column:t,time:F.fromString(r)};f.value={...f.value,end:u},Z.value=!1,J.value=!0}};return $e(le,(l,p,t)=>{t(()=>{document.removeEventListener("pointerup",G),document.removeEventListener("pointercancel",G)}),l&&(document.addEventListener("pointerup",G),document.addEventListener("pointercancel",G))},{immediate:!0}),(l,p)=>(s(),i("div",{ref_key:"timesheetRef",ref:E,class:o(l.$style.timesheet),"data-show-hidden":Z.value},[a("div",{class:o(l.$style.times)},[(s(!0),i(L,null,ue(te.value,(t,r)=>(s(),i("p",{key:r,class:o(l.$style.time)},M(t.a.time),3))),128))],2),(s(!0),i(L,null,ue(e(W),(t,r)=>(s(),i("div",{key:t.id},[a("div",{class:o(l.$style.label)},[a("div",{class:o(l.$style.label__content)},[r===0?(s(),i("div",{key:0,ref_for:!0,ref_key:"columnRef",ref:ee},null,512)):U("",!0),st(l.$slots,"xlabel",{item:t})],2)],2),a("div",{class:o(l.$style.content),onContextmenu:p[0]||(p[0]=ht(()=>{},["prevent"])),onPointerdown:_e,onClick:B},[(s(!0),i(L,null,ue(te.value,(u,h)=>(s(),i("div",{key:h,class:o(l.$style.cell)},[a("p",{"data-col":t.id,"data-time":u.a,class:o(l.$style.cell__book)},M(u.a.time),11,Ga),a("p",{"data-col":t.id,"data-time":u.b,class:o(l.$style.cell__book)},M(u.b.time),11,Ka)],2))),128)),(s(!0),i(L,null,ue(c.value[r],(u,h)=>(s(),i("div",{key:`${r}_${h}`,class:o(l.$style.bubble),style:Re(u.style),"data-id":u.original.full.id,"data-high":`${u.original.full.id}`===l.highlight,"data-type":u.original.type,"data-selection":q.value,"data-airesto":u.original.airesto,onClick:T=>D("show",u.original)},[a("div",{class:o(l.$style.bubble__content)},[st(l.$slots,"default",{item:u.original})],2)],14,Ya))),128))],34)]))),128)),q.value?(s(),i("div",{key:0,class:o(l.$style.selection),style:Re(x.value)},[Z.value?(s(),i("div",{key:1,class:o(["ark-text_body-xs",l.$style.dblclick])},[Qa,a("div",{class:o(l.$style.dblclick__btn)},[v(e(R),{"icon-button":"",size:"xs",appearance:"flat",icon:"close",onClick:y})],2),v(e(R),{size:"xs",class:"ark-space_top-1",style:{"pointer-events":"auto"},loading:l.freezLoading,onClick:j},{default:w(()=>[S(" Резерв 15мин ")]),_:1},8,["loading"])],2)):(s(),pe(Ct,{key:0,vertical:Y.value,horizontal:ae.value,tables:ce.value,time:$.value,conf:!!J.value},null,8,["vertical","horizontal","tables","time","conf"])),J.value?(s(),i("div",{key:2,class:o(l.$style.selection__btn)},[v(e(R),{size:"xs",loading:l.freezLoading,onClick:j},{default:w(()=>[S(" Резерв 15мин ")]),_:1},8,["loading"]),v(e(R),{size:"xs",style:{background:"var(--supra-accent)"},onClick:N},{default:w(()=>[S(" Создать ")]),_:1}),v(e(R),{size:"xs",appearance:"neutral",onClick:y},{default:w(()=>[S(" Отменить ")]),_:1})],2)):U("",!0)],6)):U("",!0)],10,Za))}}),ts="_timesheet_1o06s_1",as="_time_1o06s_1",ss="_label_1o06s_22",ns="_label__content_1o06s_36",ls="_times_1o06s_1",os="_cell_1o06s_51",rs="_cell__book_1o06s_68",is="_content_1o06s_83",us="_bubble_1o06s_89",cs="_bubble__content_1o06s_147",ds="_slide_1o06s_159",ms="_selection_1o06s_177",_s="_selection__btn_1o06s_190",vs="_dblclick_1o06s_204",ps="_dblclick__btn_1o06s_212",fs={timesheet:ts,time:as,label:ss,label__content:ns,times:ls,cell:os,cell__book:rs,content:is,bubble:us,bubble__content:cs,slide:ds,selection:ms,selection__btn:_s,dblclick:vs,dblclick__btn:ps},bs={$style:fs},Jt=Xe(es,[["__cssModules",bs]]),gs={style:{isolation:"isolate"}},ys={style:{display:"flex","flex-direction":"column",flex:"1"}},ks=["data-col","data-time","onPointerdown"],hs=["data-col","data-time","onPointerdown"],$s=["data-id","data-high","data-type","data-selection","data-airesto","onClick"],xs=a("p",null,"Жду следующую",-1),ws=a("p",null,"Масштаб",-1),Ss=Ue({__name:"ReverseTimesheet",props:{timeSegments:{},tables:{},data:{},highlight:{},mode:{},addEnabled:{type:Boolean},size:{},freezLoading:{type:Boolean},reverse:{type:Boolean},showReverse:{type:Boolean}},emits:["add","show","update:size","freez"],setup(ge,{emit:fe}){bt(t=>({"400c2d46":J.value}));const O=ge,D=fe,{timeSegments:K,data:ne,tables:W,mode:V,addEnabled:le,size:oe}=We(O),X=je($t),ee=d(()=>oe.value*32),E=d(()=>ee.value),Z=d(()=>E.value/2),J=d(()=>`${ee.value}px`),f=P(null),$=P(!1),z=d(()=>K.value.reduce((r,u)=>{const h=new Date(u.valueOf()+Ne*15),T=new F(ze.fromLocalNativeDate(h),he.fromLocalNativeDate(h)),re={a:u,b:T};return r.push(re),r},[])),te=d(()=>W.value.reduce((r,u,h)=>(r[u.id]=h,r),{})),me=d(()=>W.value.reduce((r,u)=>(r[u.id]=u,r),{})),ce=d(()=>{const t=f.value;if(!t)return null;const{start:r,end:u}=t,h=r.time.valueOf(),T=u.time.valueOf(),re=Math.abs(h-T)/(Ne*15);return r.time.valueOf()>u.time.valueOf()?{start:u,end:r,diff:re}:{start:r,end:u,diff:re}}),Y=d(()=>{const t=f.value;if(!t)return null;const{start:r,end:u}=t,h=te.value,T=h[r.column],re=h[u.column],ie=Math.abs(T-re);return T<re?{start:r,end:u,diff:ie}:{start:u,end:r,diff:ie}}),ae=d(()=>{const t=Y.value;return t?`${(t.diff+1)*E.value}px`:"0px"}),ve=d(()=>{const t=ce.value;return t?`${(t.diff+1)*(Z.value/2)}px`:"0px"}),Oe=d(()=>{const t=Y.value,r=te.value;return t?`${r[t.start.column]*E.value}px`:"0px"}),Ce=d(()=>{const t=z.value[0],r=ce.value;return!t||!r?"0px":`${(r.start.time.valueOf()-t.a.valueOf())/(Ne*15)*(Z.value/2)}px`}),Ie=d(()=>{const t=ae.value,r=ve.value,u=Oe.value,h=Ce.value;return{top:u,height:t,width:r,left:h}}),x=d(()=>le.value&&!!f.value),q=d(()=>V.value==="selection"&&!!f.value&&!$.value),C=d(()=>{const t=K.value;if(t.length===0)return[-1/0,1/0];const r=t[0].toLocalNativeDate().valueOf(),u=t[t.length-1];let h=u.day;u.time.valueOf()>u.time.shift({minutes:30}).valueOf()&&(h=h.append({day:1}));const T=new F(h,u.time.shift({minutes:30})).toLocalNativeDate().valueOf();return[r,T]}),Q=d(()=>X.value.native);d(()=>{const t=Q.value.valueOf(),[r,u]=C.value;return`${zt(t,r,u).toFixed(2)}%`}),d(()=>`${ne.value.length*100}%`);const c=d(()=>{const t=ne.value,[r,u]=C.value;return Ot(t,r,u,!0)}),y=t=>{D("update:size",pt(O.size+t,1,6))},N=()=>{const t=Y.value,r=ce.value,u=me.value;if(!t||!r)return;const h=new Date(r.end.time.valueOf()+Ne*15),T=new F(ze.fromLocalNativeDate(h),he.fromLocalNativeDate(h)),re={...r,end:{...r.end,time:T}};D("add",{horizontal:t,vertical:re,tables:u}),f.value=null,$.value=!1},se=t=>{t.animationName==="arkVibe"&&t.target&&t.target.classList.remove("ark-vibe")},G=P(!1),_e=()=>{const t=f.value,r={};if(t){const u=me.value,h=Object.keys(u),{start:T,end:re}=t;let ie=!1;for(let _=0;_<h.length;_++){const g=u[h[_]];if(!ie&&g.id===T.column&&(ie=!0),ie&&(r[g.id]=!0,g.id===re.column))break}D("freez",{time:t.start.time,tables:Object.keys(r)})}},j=()=>{$.value=!1,f.value=null,G.value=!1};$e(()=>O.freezLoading,(t,r)=>{!t&&r&&j()});const B=(t,{id:r},u)=>{if(V.value!=="selection"||!le.value)return;const h={column:r,time:u};$.value=!1,f.value={start:h,end:h}},l=t=>{const r=t.target,u=r.getAttribute("data-col"),h=r.getAttribute("data-time"),T=f.value;if(!u||!h||!T||T.end.time.toString()===h&&T.end.column===u)return;const re={column:u,time:F.fromString(h)};f.value={...T,end:re}},p=()=>{$.value=!0};return $e(q,(t,r,u)=>{u(()=>{document.removeEventListener("pointermove",l),document.removeEventListener("pointerup",p),document.removeEventListener("pointercancel",p)}),t&&(document.addEventListener("pointermove",l),document.addEventListener("pointerup",p),document.addEventListener("pointercancel",p))},{immediate:!0}),(t,r)=>(s(),i("div",gs,[a("div",{class:o([t.$style.root,t.$style.top])},[a("div",{class:o([t.$style.labelCell,t.$style.labelCell_hidden])},null,2),(s(!0),i(L,null,ue(e(K),(u,h)=>(s(),i("p",{key:h,class:o(["ark-text_body-xs",t.$style.timecell])},M(u.time),3))),128))],2),a("div",{class:o(t.$style.root)},[a("div",{class:o(t.$style.sticky)},[(s(!0),i(L,null,ue(e(W),(u,h)=>(s(),i("div",{key:h,class:o([t.$style.col,t.$style.col_tobottom])},[a("div",{class:o(t.$style.colLabel)},[st(t.$slots,"xlabel",{item:u},()=>[S(M(u),1)])],2)],2))),128))],2),a("div",ys,[(s(!0),i(L,null,ue(e(W),(u,h)=>(s(),i("div",{key:h,class:o(t.$style.row)},[(s(!0),i(L,null,ue(z.value,(T,re)=>(s(),i("div",{key:re,class:o(t.$style.cell)},[a("p",{"data-col":u.id,"data-time":T.a,class:o(t.$style.cell__book),onPointerdown:ie=>B(ie,u,T.a)},[a("span",{class:o(t.$style.cell__book__text)},M(T.a.time),3)],42,ks),a("p",{"data-col":u.id,"data-time":T.b,class:o(t.$style.cell__book),onPointerdown:ie=>B(ie,u,T.b)},[a("span",{class:o(t.$style.cell__book__text)},M(T.b.time),3)],42,hs)],2))),128)),(s(!0),i(L,null,ue(c.value[h],(T,re)=>(s(),i("div",{key:`${h}_${re}`,class:o(t.$style.bubble),style:Re(T.style),"data-id":T.original.full.id,"data-high":`${T.original.full.id}`===t.highlight,"data-type":T.original.type,"data-selection":x.value,"data-airesto":T.original.airesto,onClick:ie=>D("show",T.original),onAnimationend:se},[a("div",{class:o(t.$style.bubble__content)},[st(t.$slots,"default",{item:T.original})],2)],46,$s))),128))],2))),128))]),x.value?(s(),i("div",{key:0,class:o(t.$style.selection),style:Re(Ie.value)},[G.value?(s(),i("div",{key:1,class:o(["ark-text_body-xs",t.$style.dblclick])},[xs,a("div",{class:o(t.$style.dblclick__btn)},[v(e(R),{"icon-button":"",size:"xs",appearance:"flat",icon:"close",onClick:j})],2)],2)):(s(),pe(Ct,{key:0,vertical:ce.value,horizontal:Y.value,tables:me.value,time:Q.value,conf:$.value},null,8,["vertical","horizontal","tables","time","conf"])),$.value?(s(),i("div",{key:2,class:o(t.$style.selection__btn)},[v(e(R),{size:"xs",loading:t.freezLoading,onClick:_e},{default:w(()=>[S(" Резерв 15мин ")]),_:1},8,["loading"]),v(e(R),{size:"xs",style:{background:"var(--supra-accent)"},onClick:N},{default:w(()=>[S(" Создать ")]),_:1}),v(e(R),{size:"xs",appearance:"neutral",onClick:j},{default:w(()=>[S(" Отменить ")]),_:1})],2)):U("",!0)],6)):U("",!0)],2),a("div",{class:o(t.$style.fixed),onClick:j},[x.value?(s(),pe(e(R),{key:0,appearance:"accent",size:"s"},{default:w(()=>[S(" Отменить создание ")]),_:1})):U("",!0),a("div",{class:o(["ark-space_left-auto",t.$style.size])},[ws,v(e(R),{"icon-button":"",appearance:"flat",size:"xs",icon:"minus",onClick:r[0]||(r[0]=u=>y(-.5))}),v(e(R),{"icon-button":"",appearance:"flat",size:"xs",icon:"plus",onClick:r[1]||(r[1]=u=>y(.5))})],2)],2)]))}}),zs="_root_jvbrr_1",Os="_col_jvbrr_14",Cs="_col_tobottom_jvbrr_26",Ts="_timecell_jvbrr_33",Ls="_row_jvbrr_40",Ns="_labelCell_jvbrr_47",Ds="_labelCell_hidden_jvbrr_55",Es="_cell_jvbrr_64",Ms="_cell__book_jvbrr_73",js="_cell__book__text_jvbrr_81",Is="_selection_jvbrr_90",Vs="_selection__btn_jvbrr_103",As="_colLabel_jvbrr_117",Bs="_bubble_jvbrr_123",Ps="_bubble__content_jvbrr_184",Us="_top_jvbrr_202",qs="_sticky_jvbrr_210",Rs="_size_jvbrr_217",Xs="_dblclick_jvbrr_227",Hs="_dblclick__btn_jvbrr_232",Fs="_fixed_jvbrr_239",Js={root:zs,col:Os,col_tobottom:Cs,timecell:Ts,row:Ls,labelCell:Ns,labelCell_hidden:Ds,cell:Es,cell__book:Ms,cell__book__text:js,selection:Is,selection__btn:Vs,colLabel:As,bubble:Bs,bubble__content:Ps,top:Us,sticky:qs,size:Rs,dblclick:Xs,dblclick__btn:Hs,fixed:Fs},Ws={$style:Js},Zs=Xe(Ss,[["__cssModules",Ws]]),Gs={style:{isolation:"isolate"}},Ks=["data-show-hidden"],Ys=["data-col","data-time","onPointerdown"],Qs=["data-col","data-time","onPointerdown"],en=["data-id","data-high","data-type","data-selection","data-airesto","data-popover","onClick","onMouseenter"],tn=a("p",null,"Жду следующую",-1),an=a("p",null,"Масштаб",-1),sn=Ue({__name:"Timesheet",props:{timeSegments:{},tables:{},data:{},highlight:{},mode:{},addEnabled:{type:Boolean},size:{},freezLoading:{type:Boolean}},emits:["add","show","update:size","freez"],setup(ge,{emit:fe}){bt(_=>({bc1da524:J.value,"7d070eb2":N.value,"98f9d542":se.value}));const O=ge,D=fe,{timeSegments:K,data:ne,tables:W,mode:V,addEnabled:le,size:oe}=We(O),X=je($t),ee=d(()=>oe.value*32),E=d(()=>ee.value),Z=d(()=>E.value/2),J=d(()=>`${ee.value}px`),f=P(null),$=P(!1),z=P(!1),te=P(null),me=d(()=>K.value.reduce((g,k)=>{const I=new Date(k.valueOf()+Ne*15),A=new F(ze.fromLocalNativeDate(I),he.fromLocalNativeDate(I)),be={a:k,b:A};return g.push(be),g},[])),ce=d(()=>W.value.reduce((g,k,I)=>(g[k.id]=I,g),{})),Y=d(()=>W.value.reduce((g,k)=>(g[k.id]=k,g),{})),ae=d(()=>{const _=f.value;if(!_)return null;const{start:g,end:k}=_,I=g.time.valueOf(),A=k.time.valueOf(),be=Math.abs(I-A)/(Ne*15);return g.time.valueOf()>k.time.valueOf()?{start:k,end:g,diff:be}:{start:g,end:k,diff:be}}),ve=d(()=>{const _=f.value;if(!_)return null;const{start:g,end:k}=_,I=ce.value,A=I[g.column],be=I[k.column],we=Math.abs(A-be);return A<be?{start:g,end:k,diff:we}:{start:k,end:g,diff:we}}),Oe=d(()=>{const _=ve.value;return _?`${(_.diff+1)*E.value}px`:"0px"}),Ce=d(()=>{const _=ae.value;return _?`${(_.diff+1)*(Z.value/2)}px`:"0px"}),Ie=d(()=>{const _=ve.value,g=ce.value;return _?`${g[_.start.column]*E.value}px`:"0px"}),x=d(()=>{const _=me.value[0],g=ae.value;return!_||!g?"0px":`${(g.start.time.valueOf()-_.a.valueOf())/(Ne*15)*(Z.value/2)}px`}),q=d(()=>{const _=Oe.value,g=Ce.value,k=Ie.value,I=x.value;return{left:k,width:_,height:g,top:I}}),C=d(()=>le.value&&!!f.value),Q=d(()=>V.value==="selection"&&!!f.value&&!z.value),c=d(()=>{const _=K.value;if(_.length===0)return[-1/0,1/0];const g=_[0].toLocalNativeDate().valueOf(),k=_[_.length-1];let I=k.day;k.time.valueOf()>k.time.shift({minutes:30}).valueOf()&&(I=I.append({day:1}));const A=new F(I,k.time.shift({minutes:30})).toLocalNativeDate().valueOf();return[g,A]}),y=d(()=>X.value.native),N=d(()=>{const _=y.value.valueOf(),[g,k]=c.value;return`${zt(_,g,k).toFixed(2)}%`}),se=d(()=>`${ne.value.length*100}%`),G=d(()=>{const _=ne.value,[g,k]=c.value;return Ot(_,g,k)}),_e=_=>{D("update:size",pt(O.size+_,1,6))},j=()=>{const _=ve.value,g=ae.value,k=Y.value;if(!_||!g)return;const I=new Date(g.end.time.valueOf()+Ne*15),A=new F(ze.fromLocalNativeDate(I),he.fromLocalNativeDate(I)),be={...g,end:{...g.end,time:A}};D("add",{horizontal:_,vertical:be,tables:k}),f.value=null,z.value=!1},B=_=>{_.animationName==="arkVibe"&&_.target&&_.target.classList.remove("ark-vibe")},l=P(!1),p=()=>{const _=f.value,g={};if(_){const k=Y.value,I=Object.keys(k),{start:A,end:be}=_;let we=!1;for(let Ze=0;Ze<I.length;Ze++){const Ge=k[I[Ze]];if(!we&&Ge.id===A.column&&(we=!0),we&&(g[Ge.id]=!0,Ge.id===be.column))break}D("freez",{time:_.start.time,tables:Object.keys(g)})}},t=_=>{te.value=_},r=()=>{z.value=!1,f.value=null,l.value=!1};$e(()=>O.freezLoading,(_,g)=>{!_&&g&&r()});const u=(_,{id:g},k)=>{if(V.value!=="selection"||!le.value)return;const I={column:g,time:k};z.value=!1,f.value={start:I,end:I}},h=_=>{const g=_.target,k=g.getAttribute("data-col"),I=g.getAttribute("data-time"),A=f.value;if(!k||!I||!A||A.end.time.toString()===I&&A.end.column===k)return;const be={column:k,time:F.fromString(I)};f.value={...A,end:be}},T=()=>{z.value=!0};function re(_){_.key==="Alt"&&($.value=!0)}function ie(_){_.key==="Alt"&&($.value=!1)}return aa(()=>{document.addEventListener("keydown",re),document.addEventListener("keyup",ie)}),sa(()=>{document.removeEventListener("keydown",re),document.removeEventListener("keyup",ie)}),$e(Q,(_,g,k)=>{k(()=>{document.removeEventListener("pointermove",h),document.removeEventListener("pointerup",T),document.removeEventListener("pointercancel",T)}),_&&(document.addEventListener("pointermove",h),document.addEventListener("pointerup",T),document.addEventListener("pointercancel",T))},{immediate:!0}),(_,g)=>(s(),i("div",Gs,[a("div",{class:o([_.$style.root,_.$style.top])},[a("div",{class:o([_.$style.labelCell,_.$style.labelCell_hidden])},[(s(!0),i(L,null,ue(e(K),(k,I)=>(s(),i("p",{key:I},M(k.time),1))),128))],2),(s(!0),i(L,null,ue(e(W),(k,I)=>(s(),i("div",{key:I,class:o([_.$style.col,_.$style.col_tobottom])},[a("div",{class:o(_.$style.colLabel)},[st(_.$slots,"xlabel",{item:k},()=>[S(M(k),1)])],2)],2))),128))],2),a("div",{class:o(_.$style.root),"data-show-hidden":l.value},[a("div",{class:o(_.$style.sticky)},[(s(!0),i(L,null,ue(e(K),(k,I)=>(s(),i("div",{key:I,class:o(_.$style.labelCell)},M(k.time),3))),128))],2),(s(!0),i(L,null,ue(e(W),(k,I)=>(s(),i("div",{key:I,class:o([_.$style.col,I===0&&_.$style.col_first])},[(s(!0),i(L,null,ue(me.value,(A,be)=>(s(),i("div",{key:be,class:o(_.$style.cell)},[a("p",{"data-col":k.id,"data-time":A.a,class:o(_.$style.cell__book),onPointerdown:we=>u(we,k,A.a)},[a("span",{class:o(_.$style.cell__book__text)},M(A.a.time),3)],42,Ys),a("p",{"data-col":k.id,"data-time":A.b,class:o(_.$style.cell__book),onPointerdown:we=>u(we,k,A.b)},[a("span",{class:o(_.$style.cell__book__text)},M(A.b.time),3)],42,Qs)],2))),128)),(s(!0),i(L,null,ue(G.value[I],(A,be)=>(s(),i("div",{key:`${I}_${be}`,class:o(_.$style.bubble),style:Re(A.style),"data-id":A.original.full.id,"data-high":`${A.original.full.id}`===_.highlight,"data-type":A.original.type,"data-selection":C.value,"data-airesto":A.original.airesto,"data-popover":te.value&&!$.value?A.original.full.id===te.value:void 0,onClick:we=>D("show",A.original),onAnimationend:B,onMouseenter:we=>t(A.original.full.id),onMouseleave:g[0]||(g[0]=we=>t(null))},[a("div",{class:o(_.$style.bubble__content)},[st(_.$slots,"default",{item:A.original})],2)],46,en))),128))],2))),128)),C.value?(s(),i("div",{key:0,class:o(_.$style.selection),style:Re(q.value)},[l.value?(s(),i("div",{key:1,class:o(["ark-text_body-xs",_.$style.dblclick])},[tn,a("div",{class:o(_.$style.dblclick__btn)},[v(e(R),{"icon-button":"",size:"xs",appearance:"flat",icon:"close",onClick:r})],2)],2)):(s(),pe(Ct,{key:0,vertical:ae.value,horizontal:ve.value,tables:Y.value,time:y.value,conf:z.value},null,8,["vertical","horizontal","tables","time","conf"])),z.value?(s(),i("div",{key:2,class:o(_.$style.selection__btn)},[v(e(R),{size:"xs",loading:_.freezLoading,onClick:p},{default:w(()=>[S(" Резерв 15мин ")]),_:1},8,["loading"]),v(e(R),{size:"xs",style:{background:"var(--supra-accent)"},onClick:j},{default:w(()=>[S(" Создать ")]),_:1}),v(e(R),{size:"xs",appearance:"neutral",onClick:r},{default:w(()=>[S(" Отменить ")]),_:1})],2)):U("",!0)],6)):U("",!0)],10,Ks),a("div",{class:o(_.$style.fixed)},[C.value?(s(),pe(e(R),{key:0,appearance:"accent",size:"s",onClick:r},{default:w(()=>[S(" Отменить создание ")]),_:1})):U("",!0),a("div",{class:o(["ark-space_left-auto",_.$style.size])},[an,v(e(R),{"icon-button":"",appearance:"flat",size:"xs",icon:"minus",onClick:g[1]||(g[1]=k=>_e(-.5))}),v(e(R),{"icon-button":"",appearance:"flat",size:"xs",icon:"plus",onClick:g[2]||(g[2]=k=>_e(.5))})],2)],2)]))}}),nn="_root_9g4up_1",ln="_col_9g4up_14",on="_col_first_9g4up_22",rn="_col_tobottom_9g4up_34",un="_labelCell_9g4up_40",cn="_labelCell_hidden_9g4up_48",dn="_cell_9g4up_57",mn="_cell__book_9g4up_67",_n="_cell__book__text_9g4up_75",vn="_selection_9g4up_84",pn="_selection__btn_9g4up_97",fn="_colLabel_9g4up_111",bn="_bubble_9g4up_117",gn="_bubble__content_9g4up_190",yn="_top_9g4up_211",kn="_sticky_9g4up_219",hn="_size_9g4up_226",$n="_dblclick_9g4up_236",xn="_dblclick__btn_9g4up_241",wn="_fixed_9g4up_248",Sn={root:nn,col:ln,col_first:on,col_tobottom:rn,labelCell:un,labelCell_hidden:cn,cell:dn,cell__book:mn,cell__book__text:_n,selection:vn,selection__btn:pn,colLabel:fn,bubble:bn,bubble__content:gn,top:yn,sticky:kn,size:hn,dblclick:$n,dblclick__btn:xn,fixed:wn},zn={$style:Sn},On=Xe(sn,[["__cssModules",zn]]),Cn=a("h6",{class:"ark-text_h6 ark-space_bottom-3"},"Новое бронирование",-1),Tn=a("p",{class:"ark-text_body-s ark-text_64"},"Дата",-1),Ln={class:"ark-space_bottom-4"},Nn=a("p",{class:"ark-text_body-s ark-text_64"},"Время начала",-1),Dn=["data-warning"],En=a("span",{class:"ark-space_top-4"},"—",-1),Mn=a("p",{class:"ark-text_body-s ark-text_64"},"Время конца брони",-1),jn=["data-warning"],In={class:"ark-text_body-xs ark-space_top-1 ark-space_bottom-1 ark-text_64"},Vn={class:"ark-text_semibold"},An=a("p",{class:"ark-space_top-2"},[S(" Столы "),a("span",{class:"ark-text_body-xs ark-text_64"}," (можешь добавить нужный или убрать все) ")],-1),Bn=["data-active","onClick"],Pn={class:"ark-text_body-xs ark-space_top-1 ark-space_bottom-4 ark-text_64"},Un={class:"ark-text_semibold"},qn=a("p",{class:"ark-text_body-l ark-text_semibold ark-space_bottom-2"}," Контактные данные ",-1),Rn=Ue({__name:"BookingWithTables",props:{item:{},restaurant:{}},emits:["close","add"],setup(ge,{emit:fe}){const O=ge,D=fe,{item:K,restaurant:ne}=We(O),W=xt(),V=wt();class le{constructor(y,N){this.label=y,this.time_ms=N}toString(){return this.label}}const oe=[new le("До след брони",-1),new le("на 2ч",et*2),new le("на 2ч 30м",et*2+Ne*30),new le("на 3ч",et*3),new le("на 4ч",et*4)],X=Ft({count:[2,{required:_t}],name:["",{required:_t}],phone:["",{required:_t,phone:Na(!0)}],comment:[""],tags:[[]]}),ee=je(ft),E=je(Ht),Z=X.count.value,J=lt({}),f=P(!1),$=P(O.item),z=d(()=>{var N;const c=(N=ee.value)==null?void 0:N.timezone,y=new Date(new Date().toLocaleString("en",{timeZone:c})).toISOString();return F.jsonParse(y)}),te=d(()=>{const c=$.value.horizontal;return c?c.start.column:null}),me=d(()=>Object.keys(J).filter(c=>J[c]).length>0),ce=d(()=>{const c=$.value.tables;return Object.keys(J).reduce((y,N)=>y+(J[N]?c[N].capacity:0),0)}),Y=d(()=>ce.value<Z.value&&me.value?{capacity:"Столы не вмещают всех"}:null),ae=d(()=>{const c=$.value.vertical;if(!c)return null;const{start:y,end:N}=c,se=y.time.valueOf();let G=N.time.valueOf();return G<se&&(G+=Xt),he.fromAbsoluteMilliseconds(G-se)}),ve=d(()=>{const c=ae.value;return c&&c.hours===0&&c.minutes===15}),Oe=["час","часа","часов"],Ce=d(()=>{const c=ae.value;if(!c)return"";const y=[];return c.hours!==0&&y.push(`${c.hours} ${Ut(Oe,c.hours)}`),c.minutes!==0&&y.push(`${c.minutes} мин`),y.join(qt)}),Ie=c=>{const y=$.value;if(c.time_ms===-1){const N=y.vertical.start.time.valueOf(),se=Object.keys(J).reduce((B,l)=>(J[l]&&y.tables[l]&&y.tables[l].reservations.forEach(t=>{const[r,u]=t.seating_time.split("T"),h=new F(ze.jsonParse(r),he.fromString(u)).valueOf();h>N&&B.push(h)}),B),[]);if(se.length===0)return;const G=Math.min(...se),_e=new Date(G),j=new F(ze.fromLocalNativeDate(_e),he.fromLocalNativeDate(_e));$.value={...y,vertical:{...y.vertical,end:{...y.vertical.end,time:j}}}}else{const N=new Date(y.vertical.start.time.valueOf()+c.time_ms),se=new F(ze.fromLocalNativeDate(N),he.fromLocalNativeDate(N));$.value={...y,vertical:{...y.vertical,end:{...y.vertical.end,time:se}}}}},x=c=>{const y=$.value;$.value={...y,vertical:{...y.vertical,start:{...y.vertical.start,time:c}}}},q=c=>{const y=$.value;$.value={...y,vertical:{...y.vertical,end:{...y.vertical.end,time:c}}}},C=({day:c,time:y})=>`${c.toJSON()} ${y.toString("HH:MM")}`,Q=()=>{if(X.validate(),X.invalid.value)return;const{start:c,end:y}=$.value.vertical,{phone:N,name:se,count:G,comment:_e,tags:j}=X.getCurrentValue(),B=Object.keys(J).filter(l=>J[l]);f.value=!0,W.createBooking.execute({restaurant:Number(ne.value),tables:B.length===0?void 0:B,num_people:G,name_for_reservation:se,phone_number:`+${oa(N)}`,comment:_e,seating_time:C(c.time),end_time:C(y.time),tags:j}).then(l=>{l&&(V.show(ra(Ta),{autoClose:15e3,data:{...l,allTables:E.value,__newbooking:!0}}),D("add",l),D("close"))}).catch(([l])=>{V.show(l.error??"Не удалось создать бронь",{type:"error",label:"Ошибка"})}).finally(()=>{f.value=!1})};return $e(K,c=>{const y=c.horizontal,N=c.tables,se=Object.keys(N);if($.value=c,y){const{start:G,end:_e}=y;let j=!1;for(let B=0;B<se.length;B++){const l=N[se[B]];if(!j&&l.id===G.column&&(j=!0),j&&(J[l.id]=!0,l.id===_e.column))break}}X.count.setValue(ce.value)},{immediate:!0}),(c,y)=>{var N,se,G,_e;return s(),i(L,null,[Cn,Tn,a("div",{class:o(["ark-space_bottom-2",c.$style.inline])},[v(e(Ye),{name:"calendar",size:16}),v(e(at),{today:"",mask:"[day:numeric] [month:long] [year:numeric], [weekday:long]",date:$.value.vertical.start.time.toJSON()},null,8,["date"])],2),a("div",Ln,[a("div",{class:o(c.$style.time)},[a("div",{class:o(c.$style.time__item)},[Nn,a("button",{type:"button",class:o(c.$style.time__content),"data-warning":ve.value},[a("div",{class:o(c.$style.inline)},[v(e(Ye),{name:"clock",size:16}),v(e(at),{mask:"с [hour:numeric]:[minute:numeric]",date:$.value.vertical.start.time.toJSON()},null,8,["date"]),a("span",null," ‐ "+M($.value.vertical.start.time.time.shift({minutes:15})),1)],2),v(e(Ye),{name:"arrow-right",size:16}),v(e(Mt),{"model-value":$.value.vertical.start.time,class:o(c.$style.selectTime),start:(N=e(ee))==null?void 0:N.opening_time,end:(se=e(ee))==null?void 0:se.closing_time,day:$.value.horizontal.start.time.day,min:z.value,"onUpdate:modelValue":x},null,8,["model-value","class","start","end","day","min"])],10,Dn)],2),En,a("div",{class:o(c.$style.time__item)},[Mn,a("button",{type:"button",class:o(c.$style.time__content),"data-warning":ve.value},[a("div",{class:o(c.$style.inline)},[v(e(Ye),{name:"clock",size:16}),v(e(at),{mask:"до [hour:numeric]:[minute:numeric]",date:$.value.vertical.end.time.toJSON()},null,8,["date"])],2),v(e(Ye),{name:"arrow-right",size:16}),v(e(Mt),{"model-value":$.value.vertical.end.time,class:o(c.$style.selectTime),start:(G=e(ee))==null?void 0:G.opening_time,day:$.value.horizontal.start.time.day,end:(_e=e(ee))==null?void 0:_e.closing_time,min:$.value.horizontal.start.time,"onUpdate:modelValue":q},null,8,["model-value","class","start","day","end","min"])],10,jn)],2)],2),ve.value?(s(),i("span",{key:0,class:o(["ark-text_body-xs ark-text_semibold",c.$style.error])},[v(e(Ye),{name:"warning",size:16}),S(" Слишком мальнькая длительность ")],2)):U("",!0),a("p",In,[S(" Длительность "),a("span",Vn,M(Ce.value),1)]),a("div",{class:o(c.$style.buttons)},[(s(),i(L,null,ue(oe,j=>v(e(R),{key:j.label,appearance:"neutral",size:"xs",onClick:B=>Ie(j)},{default:w(()=>[S(M(j),1)]),_:2},1032,["onClick"])),64))],2)]),An,v(e(na),null,{default:w(()=>[yt((s(),i("div",{class:o(["ark-space_bottom-1",c.$style.tables])},[(s(!0),i(L,null,ue(e(K).tables,(j,B)=>yt((s(),i("button",{key:B,type:"button",class:o(c.$style.tables__item),"data-active":J[B],onClick:l=>J[B]=!J[B]},[v(e(kt),{item:j},null,8,["item"])],10,Bn)),[[e(za),te.value===B]])),128))],2)),[[e(La)],[e(wa)],[e(Sa)]])]),_:1}),a("p",Pn,[me.value?(s(),i(L,{key:0},[S(" Вместимость "),a("span",Un,M(ce.value)+" чел",1)],64)):(s(),i(L,{key:1},[S(" Столы определим сами ")],64))]),qn,a("form",{onSubmit:ht(Q,["prevent"])},[v(e(Je),{class:"ark-space_bottom-3",control:e(X).name},{default:w(({model:j})=>[v(e(la),{modelValue:j.value,"onUpdate:modelValue":B=>j.value=B,modelModifiers:{capitalize:!0},required:"",label:"На чье имя","has-cleaner":!1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),v(e(Je),{class:"ark-space_bottom-3",control:e(X).count},{default:w(({model:j})=>[v(e(Da),{modelValue:j.value,"onUpdate:modelValue":B=>j.value=B,required:"",label:"Кол-во человек",min:1,"has-cleaner":!1},null,8,["modelValue","onUpdate:modelValue"]),v(e($a),{error:Y.value},null,8,["error"])]),_:1},8,["control"]),v(e(Je),{class:"ark-space_bottom-3",control:e(X).phone},{default:w(({model:j})=>[v(e(xa),{modelValue:j.value,"onUpdate:modelValue":B=>j.value=B,required:"",label:"Номер телефона","has-cleaner":!1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),v(e(Je),{control:e(X).comment},{default:w(({model:j})=>[v(e(Oa),{modelValue:j.value,"onUpdate:modelValue":B=>j.value=B,placeholder:"Комментарий",rows:4},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),v(e(Je),{class:"ark-space_bottom-6",control:e(X).tags},{default:w(({model:j})=>[v(e(Ca),{tags:j.value,"onUpdate:tags":B=>j.value=B},null,8,["tags","onUpdate:tags"])]),_:1},8,["control"]),a("div",{class:o(c.$style.actions)},[v(e(R),{type:"submit",loading:f.value},{default:w(()=>[S("Создать")]),_:1},8,["loading"]),v(e(R),{appearance:"neutral",type:"button",onClick:y[0]||(y[0]=j=>D("close"))},{default:w(()=>[S(" Отменить ")]),_:1})],2)],32)],64)}}}),Xn="_actions_1yu47_1",Hn="_time_1yu47_10",Fn="_time__item_1yu47_15",Jn="_time__content_1yu47_18",Wn="_inline_1yu47_55",Zn="_buttons_1yu47_63",Gn="_tables_1yu47_69",Kn="_tables__item_1yu47_83",Yn="_selectTime_1yu47_115",Qn="_error_1yu47_124",el={actions:Xn,time:Hn,time__item:Fn,time__content:Jn,inline:Wn,buttons:Zn,tables:Gn,tables__item:Kn,selectTime:Yn,error:Qn},tl={$style:el},al=Xe(Rn,[["__cssModules",tl]]),sl=["data-cancelled"],nl={style:{"white-space":"nowrap"}},ll={class:"ark-text_semibold"},ol=Ue({__name:"BubblePreview",props:{item:{}},setup(ge){const fe=ge,{item:O}=We(fe),D=d(()=>{const V=O.value;return`${V.start.time.toString("HH:MM")}-${V.end.time.toString("HH:MM")}`}),K=d(()=>{const le=O.value.full.phone_number;return le?le.slice(le.length-4):""}),ne=d(()=>{const V=O.value.full;switch(V.status){case Pe.APPLICATION:case Pe.CANCELLED:case Pe.CANCELLED_NO_DEPOSIT:case Pe.CLOSED:case Pe.NEW:case Pe.OPEN:case Pe.WAITING:return""}return V.status}),W=d(()=>{const V=O.value.full;return V.status===Pe.CANCELLED||V.status===Pe.CANCELLED_NO_DEPOSIT});return(V,le)=>(s(),i("div",{class:o(V.$style.preview),"data-cancelled":W.value},[e(O).type==="reservation"?(s(),i(L,{key:0},[a("div",null,[a("p",{class:o(["ark-space_right-1",V.$style.id])},"№"+M(e(O).full.id),3),a("span",{class:o(V.$style.bold)},M(e(O).full.name_for_reservation),3),a("span",{class:o(V.$style.bold)},M(e(O).full.num_people),3),a("p",nl,M(ne.value),1)]),e(O).airesto?(s(),pe(e(ia),{key:0,size:"xs",end_time:e(O).full.end_time,seating_time:e(O).full.seating_time,status:e(O).full.status},null,8,["end_time","seating_time","status"])):U("",!0),e(O).full.phone_number?(s(),i("p",{key:1,class:o(V.$style.phone)},[v(e(ua),{name:"phone",class:o(V.$style.phone)},null,8,["class"]),S(" "+M(K.value),1)],2)):U("",!0),a("p",null,M(D.value),1)],64)):(s(),i(L,{key:1},[a("p",ll,[e(O).full.status!=="Banquet"?(s(),i(L,{key:0},[S(" Заказ ")],64)):U("",!0),v(e(ka),{class:o(V.$style.status),status:e(O).full.status},null,8,["class","status"])]),a("p",null,M(D.value),1)],64))],10,sl))}}),rl="_id_f0ecp_2",il="_preview_f0ecp_7",ul="_phone_f0ecp_15",cl="_bold_f0ecp_19",dl="_status_f0ecp_32",ml={id:rl,preview:il,phone:ul,bold:cl,status:dl},_l={$style:ml},vt=Xe(ol,[["__cssModules",_l]]),vl={style:{position:"relative",overflow:"hidden"}},pl=["data-selected","data-reserved","onClick"],fl={key:0,style:{"white-space":"nowrap"}},bl=["src"],gl={style:{"white-space":"nowrap"}},yl=Ue({__name:"BookingMap",props:{slots:{},prep:{},segments:{},freezLoading:{type:Boolean}},emits:["show","freez"],setup(ge,{emit:fe}){const O=ge,D=fe,{slots:K,segments:ne}=We(O),W=je(Ht),V=je(St),le=je(ft),oe=P(null),X=d(()=>{const x=V.value.daytime,q=x.valueOf()-et;return ne.value.filter(C=>C.day.daySame(x.day)?C.valueOf()>=q:!0)}),ee=d(()=>{const x=W.value;return Array.from(Object.values(x).reduce((q,C)=>(q.add(C.zone),q),new Set)).sort()}),E=d(()=>{const x=K.value,q=V.value.daytime,C=q.valueOf();return x.reduce((Q,c)=>{const{orders:y,reservations:N}=c,se=N.sort((l,p)=>new Date(l.seating_time).valueOf()-new Date(p.seating_time).valueOf());let G=null;for(let l=y.length-1;l>=0;l--){const p=y[l];if(p.status==="New"||p.status==="Bill"){G=p.end_time??p.prediction_time;break}}const _e=[];let j=null;for(let l=0;l<se.length;l++){const p=se[l];if(p.status===Qe.Reserve)continue;const t=ze.jsonParse(p.seating_time),r=new F(ze.jsonParse(p.seating_time),he.fromString(p.seating_time.split("T")[1])).valueOf(),u=new F(ze.jsonParse(p.end_time),he.fromString(p.end_time.split("T")[1])).valueOf();if(q.day.daySame(t)&&(r<=C&&C<u&&_e.push(p),C<r)){j=p;break}}const B=_e.reduce((l,p)=>(p.end_time&&l.push({nat:p.end_time,val:new F(ze.jsonParse(p.end_time),he.fromString(p.end_time.split("T")[1])).valueOf()}),l),[]).sort((l,p)=>p.val.valueOf()-l.val.valueOf())[0];return Q[c.id]={reserved:!!G||_e.length>0,seating:G??(B==null?void 0:B.nat),nextBooking:j??null},Q},{})}),Z=d(()=>ee.value.filter(Boolean));$e(Z,x=>{x.length>0&&(oe.value=x[0])},{immediate:!0});const J=d(()=>{const x=W.value;return Object.keys(x).reduce((q,C)=>(q[x[C].number]=C,q),{})}),f={"1 Этаж":[[{img:"/romani/sofa_2.png",text:"17",id:"17"},{img:"/romani/sofa_2.png",text:"18",id:"18",style:{transform:"translateX(16px)"}}],[{img:"/romani/round_2.png",text:"19",id:"19",sub:"неброн",style:{transform:"translateX(128px)"}},{img:"/romani/round_2.png",text:"191",id:"191",sub:"неброн",style:{transform:"translateX(144px)"}},{img:"/romani/4.png",text:"14",id:"14",style:{transform:"translate(288px, 8px)"},rotate:{transform:"rotate(90deg)"}}],[],[{img:"/romani/round_5.png",text:"16",id:"16",style:{transform:"translate(32px, -16px)"}},{img:"/romani/4.png",text:"154",id:"154",style:{transform:"translateX(64px)"}},{img:"/romani/4.png",text:"153",id:"153",style:{transform:"translateX(76px)"}},{img:"/romani/4.png",text:"152",id:"152",style:{transform:"translateX(88px)"}},{img:"/romani/6.png",text:"151",id:"151",style:{transform:"translateX(100px)"}},{img:"/romani/round_4.png",text:"15",id:"15",style:{transform:"translateX(128px)"}},{img:"/romani/2.png",text:"12",id:"12",style:{transform:"translate(160px, 8px)"}}],[{img:"/romani/arrow.svg",sub:"Вход",id:"lol?",custom:!0,style:{"margin-left":"-48px",color:"var(--ark-text-color)"},rotate:{width:"48px",height:"12px"}}],[{img:"/romani/round_5.png",text:"1",id:"1"},{img:"/romani/sofa_1.png",text:"2",id:"2",style:{transform:"translateX(24px)"},rotate:{transform:"rotate(-90deg)"}},{img:"/romani/sofa_2.png",text:"4",id:"4",style:{transform:"translateX(36px)"},rotate:{transform:"rotate(-180deg)"}},{img:"/romani/sofa_1.png",text:"5",id:"5",style:{transform:"translateX(64px)"},rotate:{transform:"rotate(-90deg)"}},{img:"/romani/sofa_2.png",text:"6",id:"6",style:{transform:"translateX(76px)"},rotate:{transform:"rotate(-180deg)"}},{img:"/romani/sofa_2.png",text:"8",id:"8",style:{transform:"translateX(104px)"},rotate:{transform:"rotate(-180deg)"}},{img:"/romani/sofa_1.png",text:"10",id:"10",style:{transform:"translateX(116px)"},rotate:{transform:"rotate(-90deg)"}},{img:"/romani/round_6.png",text:"11",id:"11",style:{transform:"translateX(150px)"},rotate:{transform:"rotate(-90deg)"}}]],"2 Этаж":[[{img:"/romani/2.png",text:"47",id:"47",rotate:{transform:"rotate(90deg)"}},{img:"/romani/2.png",text:"48",id:"48",style:{transform:"translateX(16px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/sofa_5.png",text:"40",id:"40",style:{transform:"translateX(44px)"},rotate:{width:"90px",height:"44px"}},{img:"/romani/2.png",text:"41",id:"41",style:{transform:"translateX(76px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/2.png",text:"42",id:"42",style:{transform:"translateX(88px)"},rotate:{transform:"rotate(90deg)"}}],[],[{img:"/romani/2.png",text:"46",id:"46",rotate:{transform:"rotate(90deg)"}},{img:"/romani/2.png",text:"45",id:"45",style:{transform:"translateX(16px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/2.png",text:"44",id:"44",style:{transform:"translateX(166px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/2.png",text:"43",id:"43",style:{transform:"translateX(178px)"},rotate:{transform:"rotate(90deg)"}}],[],[{img:"/romani/4.png",text:"37",id:"37",style:{transform:"translateX(52px)"}},{img:"/romani/2.png",text:"36",id:"36",style:{transform:"translateX(68px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/4.png",text:"34",id:"34",style:{transform:"translateX(84px)"}},{img:"/romani/2.png",text:"33",id:"33",style:{transform:"translateX(100px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/4.png",text:"31",id:"31",style:{transform:"translateX(116px)"}},{img:"/romani/2.png",text:"21",id:"21",style:{transform:"translateX(132px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/2.png",text:"30",id:"30",style:{transform:"translateX(148px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/round_6.png",text:"20",id:"20",style:{transform:"translateX(196px)"}}],[],[{img:"/romani/round_4.png",text:"29",id:"29",style:{transform:"translateX(36px)"}},{img:"/romani/round_4.png",text:"28",id:"28",style:{transform:"translateX(52px)"}},{img:"/romani/round_2.png",text:"27",id:"27",style:{transform:"translateX(68px)"},rotate:{transform:"rotate(-45deg)"}},{img:"/romani/round_2.png",text:"39",id:"39",style:{transform:"translateX(84px)"},rotate:{transform:"rotate(-45deg)"}},{img:"/romani/round_4.png",text:"26",id:"26",style:{transform:"translateX(100px)"}},{img:"/romani/round_4.png",text:"25",id:"25",style:{transform:"translateX(116px)"}},{img:"/romani/round_2.png",text:"24",id:"24",style:{transform:"translateX(132px)"},rotate:{transform:"rotate(-45deg)"}},{img:"/romani/round_4.png",text:"23",id:"23",style:{transform:"translateX(148px)"}},{img:"/romani/3.png",text:"22",id:"22",style:{transform:"translateX(164px)"}}]],"Банкетный зал":[[{img:"/romani/3.png",text:"61",id:"61",style:{},rotate:{transform:"rotate(90deg)"}},{img:"/romani/4.png",text:"62",id:"62",style:{transform:"translate(16px, 16px)"}},{img:"/romani/2.png",text:"64",id:"64",style:{transform:"translate(32px, 16px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/4.png",text:"65",id:"65",style:{transform:"translate(48px, 16px)"}},{img:"/romani/4.png",text:"67",id:"67",style:{transform:"translate(64px, 16px)"}},{img:"/romani/4.png",text:"69",id:"69",sub:"Не сдвигать",style:{transform:"translate(80px, 16px)"}}],[],[{img:"/romani/arrow.svg",sub:"Вход",id:"lol?",custom:!0,style:{"margin-right":"-48px",transform:"translateY(32px)"},rotate:{width:"48px",height:"12px",transform:"rotate(-90deg)"}},{img:"/romani/4.png",text:"57",id:"57",sub:"Не сдвигать",style:{transform:"translate(48px, 16px)"}},{img:"/romani/4.png",text:"55",id:"55",sub:"Не сдвигать",style:{transform:"translate(64px, 16px)"}},{img:"/romani/4.png",text:"53",id:"53",style:{transform:"translate(80px, 16px)"}},{img:"/romani/2.png",text:"52",id:"52",style:{transform:"translate(96px, 16px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/4.png",text:"50",id:"50",sub:"Не сдвигать",style:{transform:"translate(112px, 16px)"}}]]},$=d(()=>{const x=J.value;return Object.keys(f).reduce((q,C)=>(q[C]=f[C].map(Q=>Q.map(c=>({...c,id:x[c.text]}))),q),{})}),z=lt({}),te=()=>{var Q;const x=Object.keys(z).filter(c=>z[c]);if(x.length===0)return;const q=(Q=le.value)==null?void 0:Q.timezone,C=new Date(new Date().toLocaleString("en",{timeZone:q}));D("freez",{tables:x,time:new F(ze.fromLocalNativeDate(C),he.fromLocalNativeDate(C))})},me=d(()=>Object.keys(z).filter(x=>z[x]).length>0),ce=d(()=>{if(!Object.keys(z).filter(Q=>z[Q]))return{tables:[],data:[]};const q=O.prep;return K.value.reduce((Q,c,y)=>(z[c.id]&&(Q.tables.push(c),Q.data.push(q[y]??[])),Q),{tables:[],data:[]})}),Y=x=>{z[x]=!z[x]},ae=P({scale:1,translate:{x:0,y:0},deg:0}),ve=d(()=>{const x=ae.value;return{position:"relative",display:"inline-flex",transition:"",transformOrigin:"0 0",transform:`translate(${x.translate.x}px, ${x.translate.y}px) scale(${x.scale})`}}),Oe=([x,q])=>{const C=ae.value.translate;ae.value={...ae.value,translate:{x:C.x+x,y:C.y+q}}},Ce={matrix:ae,onEvent:(x,q,C)=>{const Q=ae.value;ae.value={...Q,scale:x,translate:{x:q,y:C}}},onRelease:()=>{}},Ie={onEvent:Oe,onPanning:()=>{}};return(x,q)=>(s(),i(L,null,[a("div",{class:o(["ark-space_bottom-2",x.$style.zones])},[(s(!0),i(L,null,ue(Z.value,(C,Q)=>(s(),pe(e(R),{key:Q,size:"xs",type:"button",appearance:oe.value===C?"primary":"neutral",onClick:c=>oe.value=C},{default:w(()=>[S(M(C),1)]),_:2},1032,["appearance","onClick"]))),128))],2),a("div",vl,[yt((s(),i("div",{class:o(x.$style.floor)},[a("div",{class:o(x.$style.content),style:Re(ve.value)},[(s(!0),i(L,null,ue($.value[oe.value??"1 Этаж"],(C,Q)=>(s(),i("div",{key:Q,class:o(x.$style.line)},[(s(!0),i(L,null,ue(C,c=>{var y;return s(),i("button",{key:c.id,type:"button",class:o(x.$style.table),style:Re(c.style),"data-selected":z[c.id],"data-reserved":(y=E.value[c.id])==null?void 0:y.reserved,onClick:N=>Y(c.custom?"":c.id)},[E.value[c.id]?(s(),i("div",{key:0,class:o([x.$style.sub,x.$style.sub_top])},[E.value[c.id].seating?(s(),i("p",fl,[S(" До "),v(e(at),{mask:"[hour:numeric]:[minute:numeric]",date:E.value[c.id].seating},null,8,["date"])])):U("",!0)],2)):U("",!0),a("span",{class:o(x.$style.table__text)},M(c.text),3),a("img",{src:c.img,width:"32",height:"32",style:Re(c.rotate)},null,12,bl),c.sub?(s(),i("p",{key:1,class:o(x.$style.sub),style:{opacity:"0.32"}},M(c.sub),3)):U("",!0),E.value[c.id]&&E.value[c.id].nextBooking?(s(),i("div",{key:2,class:o(x.$style.sub)},[a("p",gl,[S(" Бронь в "),v(e(at),{mask:"[hour:numeric]:[minute:numeric]",date:E.value[c.id].nextBooking.seating_time},null,8,["date"])])],2)):U("",!0)],14,pl)}),128))],2))),128))],6)],2)),[[e(ca)],[e(Ea),Ie],[e(Ma),Ce]]),a("div",{class:o(x.$style.sheet)},[v(e(Jt),{style:{width:"50%"},data:ce.value.data,count:1,"time-segments":X.value,tables:ce.value.tables,onShow:q[0]||(q[0]=C=>D("show",C))},{default:w(({item:C})=>[v(vt,{item:C},null,8,["item"])]),xlabel:w(({item:C})=>[v(e(mt),{id:C.id},null,8,["id"])]),_:1},8,["data","time-segments","tables"])],2),a("div",{class:o(x.$style.buttons)},[v(e(R),{size:"xs",disabled:!me.value,onClick:te},{default:w(()=>[S(" Резерв 15мин "),me.value?U("",!0):(s(),i(L,{key:0},[S("(выбери столы)")],64))]),_:1},8,["disabled"])],2)])],64))}}),kl="_floor_1ossq_1",hl="_content_1ossq_10",$l="_line_1ossq_18",xl="_table_1ossq_24",wl="_table__text_1ossq_47",Sl="_sheet_1ossq_61",zl="_sub_1ossq_79",Ol="_sub_top_1ossq_88",Cl="_zones_1ossq_93",Tl="_buttons_1ossq_99",Ll={floor:kl,content:hl,line:$l,table:xl,table__text:wl,sheet:Sl,sub:zl,sub_top:Ol,zones:Cl,buttons:Tl},Nl={$style:Ll},Dl=Xe(yl,[["__cssModules",Nl]]);function El(ge,fe){const O=document.createElement("a");O.download=ge,O.href=fe,O.click()}const Ml=a("h6",{class:"ark-text_h6 ark-space_bottom-6"},"Выгрузка бронирований",-1),jl={key:0,class:"ark-text_body-xs ark-text_64"},Il={key:0,class:"ark-text_body-s ark-space_bottom-4"},Vl=["download","href"],Al=Ue({__name:"DownloadContacts",props:{id:{},defaultDay:{}},setup(ge){const fe=ge,O=Ft({start:[fe.defaultDay,{required:_t}],end:[null]}),D=xt(),K=wt(),ne=je(St),W=P(!1),V=P(null),le=()=>{if(O.validate(),O.invalid.value)return;const{start:oe,end:X}=O.getCurrentValue();W.value=!0,D.guestsContactsExport({restaurant_id:fe.id,start_date:oe.toJSON(),end_start:X==null?void 0:X.toJSON()}).then(ee=>{var f;const E=window.URL.createObjectURL(ee),J=oe.daySame(X||ne.value.day)?`Брони_гостей_за_${oe.toString()}.xlsx`:`Брони_гостей_с_${oe.toString()}_до_${(f=X||ne.value.day)==null?void 0:f.toString()}.xlsx`;V.value={name:J,url:E},El(J,E)}).catch(()=>{K.show("Не удалось скачать выгрузку",{type:"error"})}).finally(()=>{W.value=!1})};return(oe,X)=>(s(),i(L,null,[Ml,a("form",{onSubmit:ht(le,["prevent"])},[v(e(Je),{class:"ark-space_bottom-3",control:e(O).start},{default:w(({model:ee})=>[v(e(At),{modelValue:ee.value,"onUpdate:modelValue":E=>ee.value=E,required:"",size:"l",label:"Дата начала","has-cleaner":!1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),v(e(Je),{class:"ark-space_bottom-4",control:e(O).end},{default:w(({model:ee})=>{var E;return[v(e(At),{modelValue:ee.value,"onUpdate:modelValue":Z=>ee.value=Z,size:"l",label:"Дата окончания",class:"ark-space_bottom-1","has-cleaner":!1},null,8,["modelValue","onUpdate:modelValue"]),ee.value?U("",!0):(s(),i("p",jl," По умолчанию текущая дата - "+M((E=e(ne))==null?void 0:E.day),1))]}),_:1},8,["control"]),V.value?(s(),i("div",Il,[S(" Если загрузка не началась автоматически, нажмите сюда "),a("a",{download:V.value.name,href:V.value.url},M(V.value.name),9,Vl)])):U("",!0),v(e(R),{type:"submit",size:"l",style:{width:"100%"},loading:W.value},{default:w(()=>[S(" Выгрузить ")]),_:1},8,["loading"])],32)],64))}}),Bl="/aairesto/img/selection.gif",Pl="/aairesto/img/2clicks.gif",Ul=a("h6",{class:"ark-text_h6 ark-space_bottom-3"}," Как выбирать столы для бронирования ",-1),ql=a("div",null,[a("p",{class:"ark-text_semibold"},"Выделение"),a("p",{class:"ark-text_body-s"},"Только для компьютеров")],-1),Rl=a("div",null,[a("p",{class:"ark-text_semibold"},"Удержание"),a("p",{class:"ark-text_body-s"},"Для телефонов и планшетов")],-1),Xl=Ue({__name:"SelectionModeExplan",props:{mode:{}},emits:["update:mode"],setup(ge,{emit:fe}){const O=fe,D=da();return(K,ne)=>(s(),i(L,null,[Ul,e(D)?U("",!0):(s(),i(L,{key:0},[v(e(tt),{style:{display:"inline-flex"}},{default:w(()=>[v(e(jt),{class:"ark-space_right-2",style:{"align-self":"flex-start"},"model-value":K.mode==="selection","onUpdate:modelValue":ne[0]||(ne[0]=W=>O("update:mode","selection"))},null,8,["model-value"]),ql]),_:1}),a("img",{src:Bl,width:"200px",height:"177",class:o(["ark-space_bottom-4",K.$style.gif])},null,2)],64)),v(e(tt),{style:{display:"inline-flex"}},{default:w(()=>[v(e(jt),{class:"ark-space_right-2",style:{"align-self":"flex-start"},"model-value":K.mode==="click","onUpdate:modelValue":ne[1]||(ne[1]=W=>O("update:mode","click"))},null,8,["model-value"]),Rl]),_:1}),a("img",{src:Pl,class:o(K.$style.gif)},null,2)],64))}}),Hl="_gif_ncrcy_1",Fl={gif:Hl},Jl={$style:Fl},Wl=Xe(Xl,[["__cssModules",Jl]]),Zl=a("p",{class:"ark-text_body-s ark-text_medium ark-text_64"},"Когда",-1),Gl=["data-active","onClick"],Kl=["data-active"],Yl=a("p",null,"Как выбирать столы?",-1),Ql={class:"ark-text_semibold"},eo=a("p",{class:"ark-text_body-xs ark-text_semibold ark-text_64"}," Shift + колесико мышки для скролла по горизонтали ",-1),to={key:2},ao=a("p",{class:"ark-text_body-s ark-text_medium ark-text_64"},"Отображаемые зоны",-1),so=["data-active","onClick"],no=["data-tablebar"],lo={key:1,class:"ark-text_body-xs"},oo={key:1,class:"ark-text_body-xs"},ro=a("h6",{class:"ark-text_h6"},"Настройки таблицы",-1),io=a("p",{class:"ark-text_body-xs ark-space_bottom-2 ark-text_64"}," Эти настройки только для вас ",-1),uo={class:"ark-space_bottom-4"},co={class:"ark-space_bottom-4"},mo={class:"ark-space_bottom-4"},_o=Ue({__name:"Booking",props:{id:{}},setup(ge){bt(n=>({"8556d31c":l.value}));const fe={Banquet:"Банкеты",Bill:"Пречек",Closed:"Закрытые",Deleted:"Удаленные",New:"Новые"},O=Qe,D=ge;P([]),P("");const K=ma(),ne=xt(),W=wt(),V=fa(),le=ba(),oe=ja(),{reservationToShow:X,navItems:ee,tableDate:E,tableSlots:Z,tableSlots2:J}=_a(oe),f=P(!1),$=P(!1),z=P(!1),te=P(null),me=P(!1),ce=P(!1),Y=P(!1),ae=localStorage.getItem("__ark-supra-timesheet-size"),ve=Number.isNaN(ae)?4:pt(Number(ae),1,6),Oe=P(ve);$e(Oe,n=>{localStorage.setItem("__ark-supra-timesheet-size",`${n}`)});const Ce=P(null),Ie=P(!1);$e(Ie,n=>{n?localStorage.removeItem("__ark-supra-table-booking-reverse-dev"):localStorage.setItem("__ark-supra-table-booking-reverse-dev","1")});const x=je(St),q=d(()=>{const n=E.value,m=x.value.daytime;return m.day.daySame(n)?"Сегодня":m.day.append({day:1}).daySame(n)?"Завтра":n}),C=localStorage.getItem("__ark-supra-selection-mode"),Q=va()==="web"?C==="selection"||C==="click"?C:"selection":"click",c=P(Q),y=P(!1);$e(c,n=>{localStorage.setItem("__ark-supra-selection-mode",n)});const N=je(ft),se=je(ya),G=localStorage.getItem(`__ark-supra-empty-tables-state_${D.id}`),_e=P(!G||G==="1");$e(_e,n=>{localStorage.setItem(`__ark-supra-empty-tables-state_${D.id}`,n?"1":"0")});function j(n){return typeof n!="string"||!n||Number.isNaN(Number(n))?3:Number(n)}const B=j(localStorage.getItem(`__ark-supra-mobile-tables-count-state_${D.id}`)),l=P(B),p=n=>{const m=l.value,H=pt(m+n,1,1/0);l.value=H};$e(l,n=>{localStorage.setItem(`__ark-supra-mobile-tables-count-state_${D.id}`,`${n}`)});function t(n){if(typeof n!="string")return{};let m;try{m=JSON.parse(n)}catch{}return typeof m=="object"&&m!==null?m:{}}const r=t(localStorage.getItem(`__ark-supra-orders-state_${D.id}`)),u=lt({Banquet:r.Banquet??!0,Bill:r.Bill??!0,Closed:r.Closed??!0,Deleted:r.Deleted??!0,New:r.New??!0});$e(u,n=>{localStorage.setItem(`__ark-supra-orders-state_${D.id}`,JSON.stringify(n))});const h=t(localStorage.getItem(`__ark-supra-reservation-state_v2_${D.id}`)),T=Object.values(Pe),re=T.reduce((n,m)=>(n[m]=!0,n),{}),ie=lt(Object.values(Qe).concat(...T).reduce((n,m)=>(n[m]=h[m]??!0,n),{}));$e(ie,n=>{localStorage.setItem(`__ark-supra-reservation-state_v2_${D.id}`,JSON.stringify(n))});const _=t(localStorage.getItem(`__ark-supra-zones-state_${D.id}`)),g=lt(_);$e(g,n=>{localStorage.setItem(`__ark-supra-zones-state_${D.id}`,JSON.stringify(n))});const k=K.computedSmallerThen("mobile"),I=n=>{Ce.value=n},A=(n,m)=>{const H=m[n];return H===void 0?!0:H},be=n=>{n.type==="reservation"&&(me.value?(te.value=n,ce.value=!0):V.push({query:{...le.query,type:n.airesto?void 0:"resto",bookingid:n.full.id}}))},we=d(()=>se.value.filter(Boolean)),Ze=d(()=>we.value.every(m=>A(m,g))),Ge=d(()=>Object.values(ie).every(m=>m)),Tt=d(()=>Object.values(u).every(m=>m)),Wt=()=>{const n=Ze.value,m=we.value,H=!n;m.forEach(de=>{g[de]=H})},Zt=()=>{const n=Ge.value,m=ie,H=!n;Object.keys(m).forEach(de=>{ie[de]=H})},Gt=n=>{Z.value=Z.value.map(m=>{if(n.tables.includes(m.id)){const H=m.reservations.concat(n);return{...m,reservations:H}}return m})},Kt=()=>{const n=Tt.value,m=u,H=!n;Object.keys(m).forEach(de=>{u[de]=H})},ot=d(()=>{var Se,Me;const m=E.value,H=(Se=N.value)==null?void 0:Se.opening_time,de=(Me=N.value)==null?void 0:Me.closing_time;if(!H||!de)return[];const xe=he.fromString(H),Ee=he.fromString(de);let Te=m;return xe.toAbsoluteMilliseconds()>Ee.toAbsoluteMilliseconds()&&(Te=Te.append({day:1})),pa(new F(m,xe),new F(Te,Ee),{minutes:30})}),He=P(!1),Lt=P(!1),Nt=d(()=>{const m=x.value.day;return new Array(5).fill("").map((H,de)=>m.append({day:de}))}),Yt=d(()=>He.value?Bt:Z.value.filter(n=>A(n.zone,g)));d(()=>He.value?Bt:J.value.filter(n=>A(n.zone,g)));const Dt=d(()=>{if(He.value)return[];const n=new Set;return Z.value.forEach(m=>{n.add(m.zone)}),Array.from(n).sort()}),Qt=d(()=>{const n=E.value,m=Z.value,H=new Array(m.length).fill("").map(()=>null),de=new Array(m.length).fill("").map(()=>[]);return m.forEach((xe,Ee)=>{H[Ee]=xe;const Te=xe.orders.reduce((Ve,ye)=>{var Ae,Le;if(u[ye.status]){const ke=ye.start_time.split("+")[0],Be=F.jsonParse(ke);if(Be.day.daySame(n)){const qe={start:Be,end:F.jsonParse(((Ae=ye.end_time)==null?void 0:Ae.split("+")[0])??((Le=ye.prediction_time)==null?void 0:Le.split("+")[0])??""),type:ye.status,airesto:!1,full:ye};Ve.push(qe)}}return Ve},[]),Se=xe.reservations.reduce((Ve,ye)=>{if(ie[ye.status]&&(D.id!=="111113"||ye.status!==Qe.Reserve)){const Ae=F.jsonParse(ye.seating_time.split("+")[0]);if(Ae.day.daySame(n)){const Le={start:Ae,end:F.jsonParse(ye.end_time.split("+")[0]),type:"reservation",airesto:re[ye.status],full:ye};Ve.push(Le)}}return Ve},[]),Me=[].concat(Te).concat(Se);Me.sort((Ve,ye)=>Ve.start.toLocalNativeDate().valueOf()-ye.start.toLocalNativeDate().valueOf()),de[Ee]=Me}),{data:de}}),Fe=d(()=>{const n=E.value,m=Yt.value,H=new Array(m.length).fill("").map(()=>null),de=new Array(m.length).fill("").map(()=>[]);m.forEach((Se,Me)=>{H[Me]=Se;const Ve=Se.orders.reduce((Le,ke)=>{var Be,qe;if(u[ke.status]){const it=ke.start_time.split("+")[0],b=F.jsonParse(it);if(b.day.daySame(n)){const De={start:b,end:F.jsonParse(((Be=ke.end_time)==null?void 0:Be.split("+")[0])??((qe=ke.prediction_time)==null?void 0:qe.split("+")[0])??""),type:ke.status,airesto:!1,full:ke};Le.push(De)}}return Le},[]),ye=Se.reservations.reduce((Le,ke)=>{if(ie[ke.status]&&(D.id!=="111113"||ke.status!==Qe.Reserve)){const Be=F.jsonParse(ke.seating_time.split("+")[0]);if(Be.day.daySame(n)){const qe={start:Be,end:F.jsonParse(ke.end_time.split("+")[0]),type:"reservation",airesto:re[ke.status],full:ke};Le.push(qe)}}return Le},[]),Ae=[].concat(Ve).concat(ye);Ae.sort((Le,ke)=>Le.start.toLocalNativeDate().valueOf()-ke.start.toLocalNativeDate().valueOf()),de[Me]=Ae});const xe=_e.value,Ee=xe?H:H.filter((Se,Me)=>de[Me].length>0),Te=xe?de:de.filter(Se=>Se.length>0);return{tables:Ee,data:Te}}),Et=d(()=>{const n=E.value;return!Nt.value.find(m=>m.daySame(n))}),Ke=P(null),rt=n=>{z.value=!0;const m=n.tables.length>1;ne.reservationFreez.execute({restaurant:Number(D.id),seating_time:`${n.time.day.toJSON()} ${n.time.time.toString("HH:MM")}`,tables:n.tables}).then(H=>{if(H){W.show(`Добавили резерв стол${m?"ов":"а"} на 15 минут`);const de=new Date(n.time.valueOf()+et),xe=new F(ze.fromLocalNativeDate(de),he.fromLocalNativeDate(de)),Ee={...H,comment:"",status:Qe.Sat,queue_number:null,restaurant:Number(D.id),end_time:`${xe.day.toJSON()}T${xe.time.toString("HH:MM")}+10:00`,num_people:1,name_for_reservation:"Новый гость",phone_number:"+79999999999",foreigner:!1,invite_time:null,created:""};Z.value=Z.value.map(Te=>{if(Ee.tables.includes(Te.id)){const Se=Te.reservations.concat(Ee);return{...Te,reservations:Se}}return Te})}}).catch(()=>{W.show(`Не удалось зарезервировать стол${m?"ы":""} на 15 мин`,{type:"error"})}).finally(()=>{z.value=!1})};let gt=null;const ea=(n,m)=>ne.loadAvailableTables.execute({page_size:60,restaurant_id:n,date:m}).then(H=>{H&&(oe.setTableSlots(H.results),H.next&&(Ke.value={id:n,page:2,date:m}),He.value=!1)});return $e([()=>D.id,E],([n,m],H,de)=>{if(de(()=>{gt&&clearTimeout(gt),gt=null}),!n)return;Ke.value=null;const xe=m.toJSON();He.value=!0,Lt.value=!1,ea(n,xe).catch(()=>{Ke.value=null,He.value=!1,Lt.value=!0})},{immediate:!0}),$e(Ke,n=>{n&&ne.loadAvailableTables.execute({restaurant_id:n.id,date:n.date,page:n.page,page_size:60}).then(m=>{m&&(oe.concatTableSlots(m.results),m.next&&(Ke.value={id:n.id,date:n.date,page:n.page+1}))}).catch(()=>{Ke.value=null,W.show("Не удалось загрузить следующую страницу бронирований",{type:"error"})})},{immediate:!0}),(n,m)=>{var H,de,xe,Ee,Te,Se,Me,Ve,ye,Ae,Le,ke,Be,qe,it;return s(),i(L,null,[a("div",{class:o(n.$style.headerContainer)},[a("h6",{class:o(["ark-text_h6 ark-text_semibold ark-space_top-2 ark-space_bottom-1",n.$style.header])},[S(" Бронирования "),a("div",{class:o(n.$style.statuses)},[v(e(R),{appearance:"neutral",icon:"download",size:"xs",onClick:m[0]||(m[0]=b=>f.value=!f.value)},{default:w(()=>[S(" Контакты гостей ")]),_:1}),v(e(R),{appearance:"neutral",size:"xs",icon:"settings",onClick:m[1]||(m[1]=b=>$.value=!$.value)},{default:w(()=>[S(" Настройки ")]),_:1})],2)],2),a("div",{class:o(["ark-space_bottom-2",n.$style.statuses])},[(H=e(N))!=null&&H.has_bookings?(s(),pe(e(ga),{key:0,size:"s",border:!1,class:o(n.$style.tabs),items:e(ee)},{default:w(({item:b})=>[S(M(b.text),1)]),_:1},8,["class","items"])):U("",!0),!e(k)&&((de=e(N))!=null&&de.has_reservations||(xe=e(N))!=null&&xe.has_bookings)?(s(),pe(e(R),{key:1,size:"xs",icon:"plus",class:"ark-space_top-2 ark-space_left-1",appearance:(Ee=e(N))!=null&&Ee.has_bookings?"accent":void 0,onClick:e(oe).toggleNewBooking},{default:w(()=>[S(" Добавить ")]),_:1},8,["appearance","onClick"])):U("",!0)],2),e(k)?U("",!0):(s(),i(L,{key:0},[Zl,a("div",{class:o(["ark-space_bottom-2",n.$style.statuses])},[(s(!0),i(L,null,ue(Nt.value,(b,De)=>(s(),i("button",{key:b.toJSON(),class:o(n.$style.date),"data-active":b.daySame(e(E)),onClick:nt=>E.value=b},[v(e(ut),{class:"ark-text_semibold",mask:"[day:numeric] [month:long]",date:b.toLocalNativeDate()},null,8,["date"]),a("p",null,[De<2?(s(),i(L,{key:0},[S(M(e(x).day.daySame(b)?"сегодня":"завтра"),1)],64)):(s(),pe(e(ut),{key:1,mask:"[weekday:long]",date:b.toLocalNativeDate()},null,8,["date"]))])],10,Gl))),128)),v(e(Vt),{modelValue:Y.value,"onUpdate:modelValue":m[3]||(m[3]=b=>Y.value=b),align:"left","max-width":243,"min-width":243,"min-height":290},{dropdown:w(()=>[v(e(It),{value:e(E),onDayClick:m[2]||(m[2]=b=>{E.value=b,Y.value=!1})},null,8,["value"])]),default:w(()=>[a("button",{style:{height:"2.5rem"},class:o(n.$style.date),"data-active":Et.value},[Et.value?(s(),i(L,{key:0},[v(e(ut),{class:"ark-text_semibold",mask:"[day:numeric] [month:long]",date:e(E).toLocalNativeDate()},null,8,["date"]),a("p",null,[v(e(ut),{mask:"[weekday:long]",date:e(E).toLocalNativeDate()},null,8,["date"])])],64)):(s(),i(L,{key:1},[S(" Выбрать ")],64))],10,Kl)]),_:1},8,["modelValue"]),(Te=e(N))!=null&&Te.has_bookings?(s(),i("button",{key:0,type:"button",class:o(["ark-space_left-auto",n.$style.date]),onClick:m[4]||(m[4]=b=>y.value=!y.value)},[Yl,a("p",Ql,M(c.value==="selection"?"Выделение":"Удержание"),1)],2)):U("",!0)],2),eo],64)),n.id==="111113"?(s(),pe(Dl,{key:1,slots:e(Z),prep:Qt.value.data,segments:ot.value,"freez-loading":z.value,onShow:be,onFreez:rt},null,8,["slots","prep","segments","freez-loading"])):U("",!0),e(k)&&((Se=e(N))!=null&&Se.has_bookings)?(s(),i("div",to,[a("a",{class:"ark-text_body-s",style:{"text-decoration":"underline"},onClick:m[5]||(m[5]=b=>y.value=!y.value)}," Как выбирать столы для брони? ")])):U("",!0),ao,a("div",{class:o(n.$style.statuses)},[(s(!0),i(L,null,ue(Dt.value,b=>(s(),pe(e(ha),{key:b,a:A(b,g)},{default:w(({a:De})=>[a("button",{type:"button",class:o([n.$style.date,n.$style.date_center]),"data-active":De,onClick:nt=>g[b]=!De},M(b),11,so)]),_:2},1032,["a"]))),128))],2),U("",!0)],2),a("div",{class:o(n.$style.container),"data-tablebar":e(X)!==null},[Fe.value.tables.length>0?(s(),i(L,{key:0},[He.value?(s(),i(L,{key:1},[v(e(Rt),{name:"spinner",class:"ark-space_right-2",size:16}),S(" Загружаем... ")],64)):(s(),i(L,{key:0},[e(k)?(s(),pe(e(Jt),{key:1,"time-segments":ot.value,tables:Fe.value.tables,data:Fe.value.data,highlight:(Le=e(X))==null?void 0:Le.id,count:l.value,"add-enabled":(ke=e(N))==null?void 0:ke.has_bookings,"freez-loading":z.value,onShow:be,onAdd:I,onFreez:rt},{default:w(({item:b})=>[v(vt,{item:b},null,8,["item"])]),xlabel:w(({item:b})=>[v(e(mt),{id:b.id},null,8,["id"])]),_:1},8,["time-segments","tables","data","highlight","count","add-enabled","freez-loading"])):(s(),i(L,{key:0},[Ie.value?(s(),pe(e(Zs),{key:1,size:2.5,"time-segments":ot.value,tables:Fe.value.tables,data:Fe.value.data,highlight:(ye=e(X))==null?void 0:ye.id,mode:e(k)?"click":c.value,"add-enabled":(Ae=e(N))==null?void 0:Ae.has_bookings,"freez-loading":z.value,onShow:be,onAdd:I,onFreez:rt},{default:w(({item:b})=>[v(vt,{item:b},null,8,["item"])]),xlabel:w(({item:b})=>[Oe.value>2?(s(),pe(e(kt),{key:0,item:b},null,8,["item"])):(s(),i("div",oo,[v(e(mt),{id:b.id},null,8,["id"])]))]),_:1},8,["time-segments","tables","data","highlight","mode","add-enabled","freez-loading"])):(s(),pe(e(On),{key:0,size:Oe.value,"onUpdate:size":m[7]||(m[7]=b=>Oe.value=b),"time-segments":ot.value,tables:Fe.value.tables,data:Fe.value.data,highlight:(Me=e(X))==null?void 0:Me.id,mode:e(k)?"click":c.value,"add-enabled":(Ve=e(N))==null?void 0:Ve.has_bookings,"freez-loading":z.value,onShow:be,onAdd:I,onFreez:rt},{default:w(({item:b})=>[v(vt,{item:b},null,8,["item"])]),xlabel:w(({item:b})=>[Oe.value>2?(s(),pe(e(kt),{key:0,item:b},null,8,["item"])):(s(),i("div",lo,[v(e(mt),{id:b.id},null,8,["id"])]))]),_:1},8,["size","time-segments","tables","data","highlight","mode","add-enabled","freez-loading"]))],64))],64))],64)):e(N)?(s(),i(L,{key:1},[S(' Нет данных. Возможно у вас скрытые "пустые" столы в настройках ')],64)):U("",!0)],10,no),e(k)?(s(),i("div",{key:0,class:o(n.$style.safe__content)},[v(e(Vt),{modelValue:Y.value,"onUpdate:modelValue":m[9]||(m[9]=b=>Y.value=b),align:"right",class:"ark-space_left-auto","max-width":243,"min-width":243,"min-height":290},{dropdown:w(()=>[v(e(It),{value:e(E),onDayClick:m[8]||(m[8]=b=>{E.value=b,Y.value=!1})},null,8,["value"])]),default:w(()=>[v(e(R),{icon:"calendar",appearance:"elevation",size:"l",style:{"--ark-padding":"1rem"}},{default:w(()=>[S(M(q.value),1)]),_:1})]),_:1},8,["modelValue"]),(Be=e(N))!=null&&Be.has_reservations||(qe=e(N))!=null&&qe.has_bookings?(s(),pe(e(R),{key:0,"icon-button":"",shape:"square",icon:"plus",size:"l",appearance:(it=e(N))!=null&&it.has_bookings?"accent":void 0,onClick:e(oe).toggleNewBooking},null,8,["appearance","onClick"])):U("",!0)],2)):U("",!0),v(e(ct),{modelValue:$.value,"onUpdate:modelValue":m[13]||(m[13]=b=>$.value=b),order:4},{default:w(()=>[ro,io,a("div",uo,[a("div",{class:o(["ark-text_body-xs ark-text_64",n.$style.header])}," Столы ",2),v(e(tt),{class:o(n.$style.label)},{default:w(()=>[S(" Показывать пустые столы "),v(e(dt),{modelValue:_e.value,"onUpdate:modelValue":m[10]||(m[10]=b=>_e.value=b),size:"s"},null,8,["modelValue"])]),_:1},8,["class"]),e(k)?(s(),i("div",{key:0,class:o(n.$style.label)},[S(" Отображение кол-ва столов "),a("div",{class:o(n.$style.label__counter)},[v(e(R),{"icon-button":"",shape:"square",appearance:"neutral",size:"xs",icon:"minus",onClick:m[11]||(m[11]=b=>p(-1))}),S(" "+M(l.value)+" ",1),v(e(R),{"icon-button":"",shape:"square",appearance:"neutral",size:"xs",icon:"plus",onClick:m[12]||(m[12]=b=>p(1))})],2)],2)):U("",!0)]),a("div",co,[a("div",{class:o(["ark-text_body-xs ark-text_64",n.$style.header])},[S(" Бронирования "),v(e(R),{size:"xs",appearance:"flat",onClick:Zt},{default:w(()=>[S(M(Ge.value?"Скрыть все":"Все"),1)]),_:1})],2),(s(!0),i(L,null,ue(e(O),(b,De)=>(s(),pe(e(tt),{key:De,class:o(n.$style.label)},{default:w(()=>[S(M(b)+" ",1),v(e(dt),{modelValue:ie[b],"onUpdate:modelValue":nt=>ie[b]=nt,size:"s"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["class"]))),128))]),a("div",mo,[a("div",{class:o(["ark-text_body-xs ark-text_64",n.$style.header])},[S(" Заказы "),v(e(R),{size:"xs",appearance:"flat",onClick:Kt},{default:w(()=>[S(M(Tt.value?"Скрыть все":"Все"),1)]),_:1})],2),(s(),i(L,null,ue(fe,(b,De)=>v(e(tt),{key:De,class:o(n.$style.label)},{default:w(()=>[S(M(b)+" ",1),v(e(dt),{modelValue:u[De],"onUpdate:modelValue":nt=>u[De]=nt,size:"s"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["class"])),64))]),a("div",null,[a("div",{class:o(["ark-text_body-xs ark-text_64",n.$style.header])},[S(" Зоны "),v(e(R),{size:"xs",appearance:"flat",onClick:Wt},{default:w(()=>[S(M(Ze.value?"Скрыть все":"Все"),1)]),_:1})],2),(s(!0),i(L,null,ue(Dt.value,b=>(s(),pe(e(tt),{key:b,class:o(n.$style.label)},{default:w(()=>[S(M(b)+" ",1),v(e(dt),{size:"s","model-value":A(b,g),"onUpdate:modelValue":De=>g[b]=De},null,8,["model-value","onUpdate:modelValue"])]),_:2},1032,["class"]))),128))])]),_:1},8,["modelValue"]),v(e(ct),{overscroll:"none","model-value":Ce.value!==null,"onUpdate:modelValue":m[14]||(m[14]=b=>Ce.value=null)},{default:w(({close:b})=>[Ce.value?(s(),pe(al,{key:0,item:Ce.value,restaurant:n.id,onAdd:Gt,onClose:b},null,8,["item","restaurant","onClose"])):U("",!0)]),_:1},8,["model-value"]),v(e(ct),{modelValue:y.value,"onUpdate:modelValue":m[16]||(m[16]=b=>y.value=b)},{default:w(()=>[v(Wl,{mode:c.value,"onUpdate:mode":m[15]||(m[15]=b=>c.value=b)},null,8,["mode"])]),_:1},8,["modelValue"]),v(e(ct),{modelValue:f.value,"onUpdate:modelValue":m[17]||(m[17]=b=>f.value=b),size:"sm"},{default:w(()=>[n.id?(s(),pe(Al,{key:0,id:n.id,"default-day":e(E)},null,8,["id","default-day"])):U("",!0)]),_:1},8,["modelValue"])],64)}}}),vo="_container_1amg5_1",po="_headerContainer_1amg5_8",fo="_fixed_1amg5_16",bo="_tabs_1amg5_38",go="_header_1amg5_8",yo="_statuses_1amg5_49",ko="_buttons_1amg5_63",ho="_statusesScroll_1amg5_73",$o="_date_1amg5_88",xo="_date_center_1amg5_107",wo="_cell_1amg5_116",So="_input_1amg5_121",zo="_notification_1amg5_156",Oo="_label_1amg5_162",Co="_label__counter_1amg5_181",To="_spinner_1amg5_189",Lo="_safe_1amg5_205",No="_safe__content_1amg5_208",Do="_safe__buttons_1amg5_219",Eo="_search_1amg5_227",Mo="_search_focused_1amg5_233",jo={container:vo,headerContainer:po,fixed:fo,tabs:bo,header:go,statuses:yo,buttons:ko,statusesScroll:ho,date:$o,date_center:xo,cell:wo,input:So,notification:zo,label:Oo,label__counter:Co,spinner:To,safe:Lo,safe__content:No,safe__buttons:Do,search:Eo,search_focused:Mo},Io={$style:jo},ar=Xe(_o,[["__cssModules",Io]]);export{ar as default};
