import{d as w,m as y,w as g,r as x,c as k,h as o,i as n,k as a,a as c,n as C,s as E,p as S,u as $,v as b,o as A,z as N,j as d,A as U,_ as q}from"./index-4bb58793.js";import{c as B,r as p,e as M,_}from"./index-32116540.js";import{I as j}from"./index-56e02b8d.js";import"./index-bc918f74.js";const z=w({__name:"Signup",setup(F){const m=$(),f=y(),v=b(),e=B({email:["",{required:p,email:M}],password:["",{required:p}]}),h={"A user with that email already exists.":"Пользователь с такой почтой уже существует"};g([e.email.value,e.password.value],()=>{e.email.removeErrors(["_async"]),e.password.removeErrors(["_async"])});const u=x(!1),V=()=>{if(e.validate(),e.invalid.value)return;u.value=!0;const t=e.getCurrentValue();m.signup.execute(t).catch(([s])=>{if(s.email&&s.email[0]){const r=s.email[0];e.email.setErrors({_async:h[r]||r})}else f.show(JSON.stringify(s),{type:"error",label:"Ошибка регистрации"});return Promise.reject(null)}).then(()=>m.login(t)).then(()=>v.push("/")).finally(()=>{u.value=!1})};return(t,s)=>{const r=S("router-link");return A(),k("form",{class:C(t.$style.form),onSubmit:E(V,["prevent"])},[o(a(_),{control:a(e).email},{default:n(({model:l})=>[o(a(N),{modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,placeholder:"Email",autocomplete:"email",name:"email",inputmode:"email"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),o(a(_),{control:a(e).password},{default:n(({model:l})=>[o(a(j),{modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,placeholder:"Пароль"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),c("p",null,[o(r,{to:"/login"},{default:n(()=>[d("Авторизация")]),_:1})]),c("div",null,[o(a(U),{type:"submit",loading:u.value},{default:n(()=>[d(" Зарегистрироваться ")]),_:1},8,["loading"])])],34)}}}),I="_form_as36q_1",P={form:I},R={$style:P},G=q(z,[["__cssModules",R]]);export{G as default};
