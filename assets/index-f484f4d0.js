import{R as d,b0 as A,y as D,u as E,l as O,A as p,W as _,bl as N,r as u,w as L,b as T,ab as R}from"./index-6367d8ff.js";const h=Object.values(d),v=h.reduce((l,S)=>(l[S]=!0,l),{}),W=A("useBooking",()=>{const l=D(),S=E(),k=O(),y=p(_),i=p(N),r=u([]),f=u(!1),b=u(i.value.day),n=u([]),c=u([]),g=u(!1);L(y,e=>{e&&(b.value.daySame(i.value.day)||(b.value=i.value.day))});const B=T(()=>{const e=l.currentRoute.value.query.bookingid,o=l.currentRoute.value.query.type;return typeof e!="string"?null:{id:e,type:typeof o=="string"&&(o==="resto"||"queue")?o:null}});return{navItems:T(()=>{var o;const e=(o=y.value)==null?void 0:o.code;return[{text:"Таблица",to:`/restaurant/${e}/booking`,exact:!0},{text:"Списком по дням",to:`/restaurant/${e}/booking/list`}]}),todaysLoading:f,todaysBookings:r,onSafeLoadBookings:(e,o)=>{f.value=!0,S.loadBooking.execute({restaurant_id:e,start_date:o.toJSON(),end_date:o.toJSON()}).then(a=>{r.value=a??[]}).catch(()=>{k.show("Попробуй перезагрузить страницу",{type:"error",label:"Не удалось загрузить бронирования"})}).finally(()=>{f.value=!1})},toggleNewBooking:()=>{g.value=!g.value},newBookingOpened:g,reservationToShow:B,tableDate:b,tableSlots:n,setTableSlots:e=>{n.value=e},concatTableSlots:e=>{n.value=n.value.concat(e)},onAddBooking:e=>{const[o]=e.seating_time.split("T"),a=R.jsonParse(o);n.value=n.value.map(t=>{if(e.tables.includes(t.id)){const s=t.reservations.concat(e);return{...t,reservations:s}}return t}),a.daySame(i.value.day)&&(r.value=r.value.concat(e))},onDeleteReservation:e=>{n.value=n.value.map(o=>{const a=o.reservations.filter(t=>v[t.status]?!0:`${t.id}`!=`${e}`);return{...o,reservations:a}}),r.value=r.value.filter(o=>`${o.id}`!=`${e}`)},onHandleAiresto:(e,o)=>{n.value=n.value.map(a=>{let t=a.reservations;return o.status===d.CANCELLED||o.status===d.CANCELLED_NO_DEPOSIT||o.status===d.CLOSED?t=a.reservations.filter(s=>v[s.status]?`${s.id}`!=`${e}`:s):t=a.reservations.map(s=>v[s.status]&&`${s.id}`==`${e}`?o:s),{...a,reservations:t}}),r.value=r.value.map(a=>`${a.id}`==`${e}`?o:a)},onSwapTables:e=>{const o=e.prev.reduce((t,s)=>(t[s]=!0,t),{}),a=e.new.reduce((t,s)=>(t[s]=!0,t),{});n.value=n.value.map(t=>{let s=t.reservations;return o[t.id]&&!a[t.id]?s=s.filter(({id:$,status:w})=>v[w]&&$!==e.dto.id):a[t.id]&&!o[t.id]&&(s=s.concat(e.dto)),{...t,reservations:s}}),r.value=r.value.map(t=>t.id===e.dto.id?e.dto:t)},tableSlots2:c,setTableSlots2:e=>{c.value=e},concatTableSlots2:e=>{c.value=c.value.concat(e)}}});export{W as u};
