import{_ as Oe}from"./index-127a01d9.js";import{D as Je}from"./index-9535c0f6.js";import{O as Ae}from"./index-f9111cae.js";import{d as le,o as a,c,a as o,t as q,F as O,u as ce,l as _e,r as V,A as ne,ae as l,w as Y,h as s,s as n,i as e,B as se,g as ee,q as L,j as p,x as b,n as d,v as te,W as be,af as $e,ag as De,_ as ue,Q as me,ah as Ke,a4 as pe,b as ie,k as v,ai as Fe,S as Q,a6 as ye,D as ge,aj as Qe,ak as Ge,M as Xe,$ as nt,al as it,Z as rt,a9 as Te,am as ut,an as dt,e as ct,ad as _t,f as mt,a0 as He,a5 as pt,a8 as vt,a7 as ft,ao as ht}from"./index-6367d8ff.js";import{F as Ye}from"./index-953ce25b.js";import{U as Ze}from"./index-65b51942.js";import{C as Ve}from"./index-51011b71.js";import{_ as A}from"./index-bbe23418.js";import{_ as ze}from"./index-57821b90.js";import{R as kt}from"./index-60afbd63.js";import{c as Ce,r as ae,a as Le,s as we}from"./index-9268c079.js";import{I as Se}from"./index-375c6776.js";import{E as gt}from"./index-cfb8160a.js";import{L as et}from"./index-83df3083.js";import{T as yt,R as Ee}from"./index-181093b8.js";import{D as We}from"./index-8d10ddf0.js";import{T as bt}from"./index-cbb74742.js";import{s as $t}from"./index-146507eb.js";/* empty css              */import"./index-cc030883.js";import"./index-55204b2b.js";import"./index-456889fa.js";import"./index-464983bd.js";import"./index-cebbb5bb.js";const Vt={style:{font:"var(--ark-font-l)"}},zt=o("span",{style:{font:"var(--ark-font-s)",color:"var(--ark-text-color-64)"}},"№ ",-1),Ct={style:{"font-weight":"600"}},Lt=o("p",{style:{font:"var(--ark-font-s)"}},"Добавлен в очередь",-1),wt=le({__name:"ReservationAlert",props:{context:{}},setup(K){return(H,z)=>(a(),c(O,null,[o("p",Vt,[zt,o("span",Ct,q(H.context.data.queue_number),1)]),Lt],64))}}),St=o("h6",{class:"ark-text_h6 ark-space_bottom-4"},"Добавление в очередь",-1),qt=o("p",{class:"ark-text_body-s ark-space_bottom-1 ark-text_64"}," Предпочитаемая зона ",-1),Ut={style:{display:"flex","flex-wrap":"wrap",gap:"0.25rem"}},xt=o("div",null,[o("p",null,"Иностранец"),o("p",{class:"ark-text_body-xs ark-text_64"},"заполнит поле телефона")],-1),Nt=le({__name:"AddQueue",props:{id:{},computedZones:{}},emits:["refresh","close"],setup(K,{emit:H}){const z=K,C=H,t=ce(),R=_e(),E=V(!1),P=ne(be),U={required:"Обязательно",phone:"Некорректный номер мобильного телефона"};function j(f,Z){return Z.phone_required.value?f.trim().length>0:!0}const h=Ce({num_people:[2,{required:ae}],phone_number:["",{required:Le.withMessage("validator.required",j),phone:we(!1)}],seating_time:[null],name_for_reservation:["",{required:ae}],required_zone:[null],status:[l.Live,{required:ae}],foreigner:[!1],comment:[""],phone_required:[!0]});Y(P,f=>{f?h.phone_required.setValue(f.phone_required):h.phone_required.setValue(!0)},{immediate:!0}),Y(h.foreigner.value,f=>{f?h.phone_number.setValue("+7 (999) 999-99-99"):h.phone_number.setValue("")});const S=()=>{if(h.validate(),h.invalid.value)return;E.value=!0;const f=h.getCurrentValue(),Z={num_people:f.num_people,phone_number:f.phone_number?`+${$e(f.phone_number)}`:"",name_for_reservation:f.name_for_reservation,status:l.Live,foreigner:f.foreigner,restaurant:Number(z.id),required_zone:f.required_zone??void 0,comment:f.comment};t.createReservation.execute(Z).then(g=>{g&&(R.show(De(wt),{data:g,autoClose:1e4}),C("refresh"),C("close"))}).catch(([g,x])=>{x!==403&&R.show("Ошибка добавления в очередь",{type:"error"})}).finally(()=>{E.value=!1})};return(f,Z)=>(a(),c(O,null,[St,o("form",{class:d(f.$style.form),onSubmit:te(S,["prevent"])},[s(e(A),{control:e(h).name_for_reservation,"validation-errors":U},{default:n(({model:g})=>[s(e(se),{modelValue:g.value,"onUpdate:modelValue":x=>g.value=x,size:"l",required:"",label:"На чье имя бронь"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(h).num_people,"validation-errors":U},{default:n(({model:g})=>[s(e(Se),{modelValue:g.value,"onUpdate:modelValue":x=>g.value=x,size:"l",required:"",label:"Количество человек"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(h).required_zone,"validation-errors":U},{default:n(({model:g})=>[qt,o("div",Ut,[(a(!0),c(O,null,ee(f.computedZones,(x,N)=>(a(),L(e(kt),{modelValue:g.value,"onUpdate:modelValue":G=>g.value=G,key:N,"hide-radio":"",size:"xs",style:{"--ark-background-color":"var(--ark-text-color-08)"},name:"PreferZoneItem",item:x},{default:n(()=>[p(q(x??"Не важно"),1)]),_:2},1032,["modelValue","onUpdate:modelValue","item"]))),128))])]),_:1},8,["control"]),s(e(A),{control:e(h).phone_number,"validation-errors":U},{default:n(({model:g})=>{var x;return[s(e(ze),{modelValue:g.value,"onUpdate:modelValue":N=>g.value=N,label:"Номер телефона",size:"l",required:!!((x=e(P))!=null&&x.phone_required)},null,8,["modelValue","onUpdate:modelValue","required"])]}),_:1},8,["control"]),s(e(A),{control:e(h).comment},{default:n(({model:g})=>[s(e(se),{modelValue:g.value,"onUpdate:modelValue":x=>g.value=x,size:"l",label:"Комментарий"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{class:"ark-space_bottom-4",control:e(h).foreigner},{default:n(({model:g})=>[s(e(Ve),{modelValue:g.value,"onUpdate:modelValue":x=>g.value=x},{default:n(()=>[xt]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(b),{type:"submit",size:"l",loading:E.value},{default:n(()=>[p(" Добавить ")]),_:1},8,["loading"])],34)],64))}}),Rt="_form_q3ljx_1",It={form:Rt},Tt={$style:It},Dt=ue(Nt,[["__cssModules",Tt]]),Ot=o("h6",{class:"ark-text_h6 ark-text_semibold ark-space_bottom-1"}," Выбор стола ",-1),Et=o("p",{class:"ark-text_body-s ark-space_bottom-3"}," Укажите стол/ы за который сели гости ",-1),Me=le({__name:"PopupTableSelect",props:{item:{},loading:{type:Boolean},order:{}},emits:["tableSelect"],setup(K,{emit:H}){const z=K,C=H,{item:t}=me(z),R=V(!1),E=()=>{R.value=!0};return(P,U)=>(a(),c(O,null,[Ke(P.$slots,"default",{open:E}),s(e(pe),{modelValue:R.value,"onUpdate:modelValue":U[1]||(U[1]=j=>R.value=j),order:P.order},{default:n(({close:j})=>[Ot,Et,s(yt,{item:e(t),loading:P.loading,onClose:j,onTableSelect:U[0]||(U[0]=h=>C("tableSelect",h))},null,8,["item","loading","onClose"])]),_:1},8,["modelValue","order"])],64))}}),Mt=["data-status","data-full"],jt={key:0,class:"ark-text_body-s-2"},Bt=["href"],Pt=o("p",{class:"ark-text_body-xs ark-text_64"},"Комментарий",-1),Jt={class:"ark-text_body-s-2 ark-text_medium"},At={key:4,class:"ark-text_body-xs ark-text_64",style:{"white-space":"nowrap"}},Ft=o("h5",{class:"ark-text_h5 ark-space_bottom-4"},"Изменение",-1),Ht=le({__name:"QueueItem",props:{item:{},loading:{type:Boolean},satLoading:{type:Boolean},leaveLoading:{type:Boolean},inviteLoading:{type:Boolean},joinedLoading:{type:Boolean},liveLoading:{type:Boolean},computedTable:{}},emits:["changeStatus","invite","updateDto"],setup(K,{emit:H}){const z=K,C=H,{item:t,loading:R}=me(z),E=ce(),P=_e(),U=V(!1),j=V(!1),h=V(!1),S=V(!1),f=V(!1),Z=V(!1);function g(i,T){return T.phone_required.value?i.trim().length>0:!0}const x={required:"Обязательно",phone:"Некорректный номер мобильного телефона"},N=Ce({num_people:[2,{required:ae}],phone_number:["",{required:Le.withMessage("validator.required",g),phone:we(!1)}],name_for_reservation:["",{required:ae}],foreigner:[!1],comment:[""],phone_required:[!0]}),G=ie(()=>{const i=t.value.status;return i===l.Live||i===l.Called||i===l.Joined||(i===l.Cancelled?f.value:!1)}),_=i=>{j.value=!1,C("changeStatus",z.item,l.Sat,i)},I=()=>{S.value=!0,E.loadReservationItem.execute({id:z.item.id}).then(i=>{i&&C("updateDto",i)}).catch(()=>null).finally(()=>{S.value=!1})},r=()=>{N.num_people.setValue(z.item.num_people),N.phone_number.setValue(z.item.phone_number||""),N.name_for_reservation.setValue(z.item.name_for_reservation),N.foreigner.setValue(z.item.foreigner),N.comment.setValue(z.item.comment||""),U.value=!U.value},$=()=>{if(N.validate(),N.invalid.value)return;const{num_people:i,phone_number:T,name_for_reservation:M,foreigner:B,comment:W}=N.getCurrentValue();Z.value=!0,E.updateReservation.execute({id:z.item.id,num_people:i,phone_number:T?`+${$e(T)}`:"",name_for_reservation:M,foreigner:B,comment:W}).then(de=>{de&&(C("updateDto",de),U.value=!1,P.show("Очередь обновлена"))}).catch(()=>{P.show("Не удалось обновить",{label:"Ошибка",type:"error"})}).finally(()=>{Z.value=!1})};let y=null;return Y(t,(i,T,M)=>{M(()=>{y&&clearTimeout(y)}),i.tables.length===0&&(i.status===l.Joined||i.status===l.Called||i.status===l.Live)&&(y=setTimeout(()=>{I()},Xe*15))},{immediate:!0}),Y(t,i=>{(i.status===l.Sat||i.status===l.Cancelled)&&(f.value=!1)}),(i,T)=>(a(),c("div",{class:d(i.$style.item),"data-status":e(t).status,"data-full":f.value,onClick:T[6]||(T[6]=M=>f.value=!f.value)},[o("div",{class:d(["ark-text_h6",[i.$style.item__header,e(R)&&"ark-skeleton"]])},[o("p",{class:d([i.$style.name,h.value&&i.$style.name_full]),onClick:T[0]||(T[0]=M=>h.value=!h.value)},[e(t).queue_number?(a(),c("span",jt," №"+q(e(t).queue_number),1)):v("",!0),p(" "+q(e(t).name_for_reservation),1)],2),o("div",{class:d(i.$style.inline)},[e(t).status===e(l).Cancelled?(a(),L(e(Fe),{key:0,class:"ark-text_body-xs ark-space_right-1",phone:e(t).phone_number},null,8,["phone"])):v("",!0),e(t).foreigner?(a(),L(e(Q),{key:1,name:"language",class:"ark-space_right-1",size:16})):v("",!0),s(e(Q),{class:"ark-text_48 ark-space_right-1",name:"users",size:16}),o("span",{class:d(i.$style.chel)},q(e(t).num_people),3),e(t).status!==e(l).Cancelled?(a(),L(e(b),{key:2,"icon-button":"",appearance:"neutral",class:"ark-space_left-2",size:"xs",style:{"--ark-height-xs":"1.25rem"},icon:"edit",shape:"square","icon-size":12,onClick:te(r,["stop","prevent"])})):v("",!0),e(t).status===e(l).Cancelled||e(t).status===e(l).Sat?(a(),L(e(Q),{key:3,name:"arrow-down",class:"ark-space_left-1 ark-text_64",size:20,rotate:f.value},null,8,["rotate"])):v("",!0)],2)],2),!(e(t).status===e(l).Cancelled||e(t).status===e(l).Sat)||f.value?(a(),c("div",{key:0,class:d(["ark-space_top-1",[i.$style.content,e(R)&&"ark-skeleton"]])},[e(t).phone_number?(a(),c("a",{key:0,class:d(["ark-space_right-auto",i.$style.phone]),href:`tel:${e(t).phone_number}`},[s(e(Fe),{phone:e(t).phone_number},null,8,["phone"])],10,Bt)):v("",!0),e(t).foreigner?(a(),c("div",{key:1,class:d(i.$style.foreigner)},"Иностранец",2)):v("",!0),s(e(Ee),{size:"s",status:e(t).status,"invite-time":e(t).invite_time,created:e(t).created},null,8,["status","invite-time","created"])],2)):v("",!0),e(t).comment&&(!(e(t).status===e(l).Cancelled||e(t).status===e(l).Sat)||f.value)?(a(),c("div",{key:1,class:d([i.$style.comment,e(R)&&"ark-skeleton"])},[Pt,o("p",Jt,q(e(t).comment),1)],2)):v("",!0),!(e(t).status===e(l).Cancelled||e(t).status===e(l).Sat)||f.value?(a(),c(O,{key:2},[o("hr",{class:d(i.$style.hr)},null,2),o("div",{class:d(["ark-text_body-l-2 ark-text_semibold",[i.$style.inline,e(R)&&"ark-skeleton"]])},[s(e(Q),{class:"ark-text_48 ark-space_right-1",name:"user-plus",size:16}),e(R)?v("",!0):(a(),L(e(ye),{key:0,mask:"[hour:numeric]:[minute:numeric]",date:e(t).created},null,8,["date"])),s(e(Q),{class:"ark-text_48 ark-space_left-2 ark-space_right-1",name:"food",size:16}),!e(R)&&e(t).seating_time?(a(),L(e(ye),{key:1,mask:"~[hour:numeric]:[minute:numeric]",date:e(t).seating_time},null,8,["date"])):(a(),L(e(Q),{key:2,name:"spinner",size:16})),s(e(Q),{class:"ark-text_48 ark-space_left-2 ark-space_right-1",name:"table",size:20}),e(t).tables.length>0?ge((a(),c("div",{key:3,class:d(i.$style.tables)},[(a(!0),c(O,null,ee(e(t).tables,(M,B)=>(a(),c("div",{key:B,class:d(i.$style.tables__item)},[typeof M=="string"?(a(),L(e(Qe),{key:0,id:M,plus:""},null,8,["id"])):(a(),L(e(Ge),{key:1,plus:"",tables:M},null,8,["tables"]))],2))),128))],2)),[[e(Ye)]]):(a(),c("div",At,[p(" Через 1 мин"),s(e(et)),s(e(b),{icon:"refresh",size:"xs",appearance:"neutral",style:{width:"calc(var(--ark-height-xs) - 0.25rem)",height:"calc(var(--ark-height-xs) - 0.25rem)","min-height":"calc(var(--ark-height-xs) - 0.25rem)"},"icon-size":12,loading:S.value,onClick:I},null,8,["loading"])])),e(t).required_zone?(a(),c(O,{key:5},[s(e(Q),{class:"ark-text_48 ark-space_left-2 ark-space_right-1",name:"zone",size:16}),o("p",{class:d(e(t).required_zone?"ark-text_semibold":"ark-text_body-xs ark-text_48")},q(e(t).required_zone),3)],64)):v("",!0)],2)],64)):v("",!0),G.value?(a(),c(O,{key:3},[o("hr",{class:d(i.$style.hr)},null,2),o("div",{class:d([i.$style.buttons,e(R)&&"ark-skeleton"])},[e(t).status===e(l).Live||e(t).status===e(l).Called||e(t).status===e(l).Joined?(a(),L(e(b),{key:0,appearance:"s-danger",size:"xs",class:d(i.$style.button),loading:i.leaveLoading,onClick:T[1]||(T[1]=M=>C("changeStatus",e(t),e(l).Cancelled))},{default:n(()=>[p(" Ушел ")]),_:1},8,["class","loading"])):v("",!0),e(t).status===e(l).Live&&e(t).phone_number?(a(),L(e(b),{key:1,appearance:"primary-reverse",size:"xs",class:d(i.$style.button),loading:i.inviteLoading,onClick:T[2]||(T[2]=M=>C("invite",e(t)))},{default:n(()=>[p(" Вызвать ")]),_:1},8,["class","loading"])):v("",!0),e(t).status===e(l).Live||e(t).status===e(l).Called?(a(),L(e(b),{key:2,appearance:"attention",size:"xs",class:d(i.$style.button),loading:i.joinedLoading,onClick:T[3]||(T[3]=M=>C("changeStatus",e(t),e(l).Joined))},{default:n(()=>[p(" Пришел ")]),_:1},8,["class","loading"])):v("",!0),e(t).status===e(l).Cancelled?(a(),L(e(b),{key:3,appearance:"neutral-b",size:"xs",class:d(i.$style.button),loading:i.liveLoading,onClick:T[4]||(T[4]=te(M=>C("changeStatus",e(t),e(l).Live),["stop","prevent"]))},{default:n(()=>[p(" Вернуть в начало очереди ")]),_:1},8,["class","loading"])):v("",!0),e(t).status===e(l).Live||e(t).status===e(l).Called||e(t).status===e(l).Joined?(a(),L(Me,{key:4,item:e(t),loading:i.satLoading,onTableSelect:_},{default:n(({open:M})=>[s(e(b),{appearance:"success","icon-right":"arrow-down",size:"xs",class:d(i.$style.button),loading:i.satLoading,onClick:M},{default:n(()=>[p(" Занял ")]),_:2},1032,["class","loading","onClick"])]),_:1},8,["item","loading"])):v("",!0)],2)],64)):v("",!0),s(e(pe),{modelValue:U.value,"onUpdate:modelValue":T[5]||(T[5]=M=>U.value=M)},{default:n(({close:M})=>[Ft,o("form",{class:d(i.$style.form),onSubmit:te($,["prevent"])},[s(e(A),{control:e(N).name_for_reservation,"validation-errors":x},{default:n(({model:B})=>[s(e(se),{modelValue:B.value,"onUpdate:modelValue":W=>B.value=W,label:"На чье имя бронь*",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(N).num_people,"validation-errors":x},{default:n(({model:B})=>[s(e(Se),{modelValue:B.value,"onUpdate:modelValue":W=>B.value=W,label:"Количество человек*",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(N).phone_number,"validation-errors":x},{default:n(({model:B})=>[s(e(ze),{modelValue:B.value,"onUpdate:modelValue":W=>B.value=W,label:"Номер телефона",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(N).comment,"validation-errors":x},{default:n(({model:B})=>[s(e(se),{modelValue:B.value,"onUpdate:modelValue":W=>B.value=W,label:"Комментарий",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{class:"ark-space_bottom-4",control:e(N).foreigner},{default:n(({model:B})=>[s(e(Ve),{modelValue:B.value,"onUpdate:modelValue":W=>B.value=W},{default:n(()=>[p("Иностранец")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),o("div",{class:d(i.$style.actions)},[s(e(b),{type:"submit",size:"l",loading:Z.value},{default:n(()=>[p(" Сохранить ")]),_:1},8,["loading"]),s(e(b),{appearance:"neutral",type:"button",size:"l",onClick:M},{default:n(()=>[p(" Отменить ")]),_:2},1032,["onClick"])],2)],34)]),_:1},8,["modelValue"])],10,Mt))}}),Zt="_item_dces5_2",Wt="_item__header_dces5_26",Kt="_name_dces5_32",Qt="_name_full_dces5_47",Gt="_phone_dces5_51",Xt="_inline_dces5_56",Yt="_content_dces5_61",ea="_comment_dces5_67",ta="_bottom_dces5_77",aa="_actions_dces5_85",sa="_form_dces5_94",la="_buttons_dces5_100",oa="_hr_dces5_118",na="_tables_dces5_123",ia="_tables__item_dces5_138",ra="_foreigner_dces5_145",ua="_chel_dces5_156",da={item:Zt,item__header:Wt,name:Kt,name_full:Qt,phone:Gt,inline:Xt,content:Yt,comment:ea,bottom:ta,actions:aa,form:sa,buttons:la,hr:oa,tables:na,tables__item:ia,foreigner:ra,chel:ua},ca={$style:da},_a=ue(Ht,[["__cssModules",ca]]),ma=["data-status"],pa=["href"],va={class:"ark-space_top-2"},fa={key:0,class:"ark-space_right-2 ark-text_48"},ha={key:0,class:"ark-space_top-2"},ka=o("p",{class:"ark-text_body-xs ark-text_64"},"Комментарий",-1),ga=["data-full"],ya={style:{display:"flex",gap:"0.25rem","flex-wrap":"wrap"}},ba=o("h5",{class:"ark-text_h5 ark-space_bottom-4"},"Изменение",-1),$a=le({__name:"ReservationDesktopItem",props:{item:{},satLoading:{type:Boolean},leaveLoading:{type:Boolean},inviteLoading:{type:Boolean},joinedLoading:{type:Boolean},computedTable:{}},emits:["changeStatus","invite","updateDto"],setup(K,{emit:H}){const z=K,C=H,t={required:"Обязательно",phone:"Некорректный номер мобильного телефона"},R=ce(),E=_e(),P=V(!1),U=V(!1),j=V(!1),h=V(!1);function S(_,I){return I.phone_required.value?_.trim().length>0:!0}const f=Ce({num_people:[2,{required:ae}],phone_number:["",{required:Le.withMessage("validator.required",S),phone:we(!1)}],name_for_reservation:["",{required:ae}],foreigner:[!1],comment:[""],phone_required:[!0]}),Z=ne(be);Y(Z,_=>{_?f.phone_required.setValue(_.phone_required):f.phone_required.setValue(!0)},{immediate:!0});const g=()=>{f.num_people.setValue(z.item.num_people),f.phone_number.setValue(z.item.phone_number||""),f.name_for_reservation.setValue(z.item.name_for_reservation),f.foreigner.setValue(z.item.foreigner),f.comment.setValue(z.item.comment||""),U.value=!0},x=_=>{h.value=!1,C("changeStatus",z.item,l.Sat,_)},N=()=>{if(f.validate(),f.invalid.value)return;const{num_people:_,phone_number:I,name_for_reservation:r,foreigner:$,comment:y}=f.getCurrentValue();j.value=!0,R.updateReservation.execute({id:z.item.id,num_people:_,phone_number:I?`+${$e(I)}`:"",name_for_reservation:r,foreigner:$,comment:y}).then(i=>{i&&(C("updateDto",i),U.value=!1,E.show("Бронирование обновлено"))}).catch(()=>{E.show("Не удалось изменить бронирование",{label:"Ошибка",type:"error"})}).finally(()=>{j.value=!1})},G=()=>{U.value=!1};return(_,I)=>(a(),c("tr",{class:d(_.$style.row),"data-status":_.item.status},[o("td",null,q(_.item.queue_number),1),o("td",null,[o("p",null,[o("b",null,q(_.item.name_for_reservation),1),s(e(Q),{name:"users",class:"ark-space_left-2 ark-space_right-1",size:16}),o("b",null,q(_.item.num_people),1)]),o("p",null,[_.item.phone_number?(a(),c("a",{key:0,class:"ark-text_64",href:`tel:${_.item.phone_number}`},q(_.item.phone_number),9,pa)):v("",!0)]),o("p",va,[s(e(Ee),{"invite-time":_.item.invite_time,created:_.item.created,status:_.item.status},null,8,["invite-time","created","status"])])]),o("td",null,[o("div",{class:d(_.$style.inline)},[o("div",null,[o("p",{class:d(_.$style.xs)},"встали",2),_.item.created?(a(),L(ye,{key:0,mask:"[hour:numeric]:[minute:numeric]",date:_.item.created},null,8,["date"])):v("",!0)]),s(e(Q),{name:"arrow-right-stroke",size:12,class:d(_.$style.xs)},null,8,["class"]),o("div",null,[o("p",{class:d(_.$style.xs)},"сядут ~",2),_.item.seating_time?(a(),L(ye,{key:0,mask:"[hour:numeric]:[minute:numeric]",date:_.item.seating_time},null,8,["date"])):v("",!0)])],2),o("div",{class:d(["ark-space_top-2",_.$style.inline])},[s(e(Q),{name:"table",class:"ark-space_right-1",size:20}),(a(!0),c(O,null,ee(_.item.tables,(r,$)=>(a(),c("div",{key:$},[$>0?(a(),c("span",fa,"/")):v("",!0),typeof r=="string"?(a(),L(e(Qe),{key:1,id:r},null,8,["id"])):(a(),L(e(Ge),{key:2,plus:"",tables:r},null,8,["tables"]))]))),128))],2),_.item.required_zone?(a(),c("div",ha," Хотят "+q(_.item.required_zone),1)):v("",!0)]),o("td",null,[_.item.comment?(a(),c("div",{key:0,class:d(["ark-space_bottom-3",_.$style.comment])},[ka,o("p",{class:d(_.$style.comment__text),"data-full":P.value,onClick:I[0]||(I[0]=r=>P.value=!P.value)},q(_.item.comment),11,ga)],2)):v("",!0),o("div",ya,[s(e(b),{appearance:"neutral",size:"xs",class:"ark-space_right-3",onClick:g},{default:n(()=>[p(" Изменить ")]),_:1}),_.item.status===e(l).Live?(a(),L(e(b),{key:0,appearance:"primary-reverse",size:"xs",class:"ark-space_right-3",loading:_.inviteLoading,onClick:I[1]||(I[1]=r=>C("invite",_.item))},{default:n(()=>[p(" Вызвать ")]),_:1},8,["loading"])):v("",!0),_.item.status===e(l).Live||_.item.status===e(l).Called?(a(),L(e(b),{key:1,appearance:"attention",size:"xs",class:"ark-space_right-3",loading:_.joinedLoading,onClick:I[2]||(I[2]=r=>C("changeStatus",_.item,e(l).Joined))},{default:n(()=>[p(" Пришел ")]),_:1},8,["loading"])):v("",!0),_.item.status===e(l).Live||_.item.status===e(l).Called||_.item.status===e(l).Joined?(a(),L(Me,{key:2,item:_.item,loading:_.satLoading,onTableSelect:x},{default:n(({open:r})=>[s(e(b),{appearance:"success",class:"ark-space_right-3",size:"xs",icon:"arrow-down","icon-size":12,loading:_.satLoading,onClick:r},{default:n(()=>[p(" Занял ")]),_:2},1032,["loading","onClick"])]),_:1},8,["item","loading"])):v("",!0),_.item.status===e(l).Live||_.item.status===e(l).Called||_.item.status===e(l).Joined?(a(),L(e(b),{key:3,appearance:"s-danger",size:"xs",loading:_.leaveLoading,onClick:I[3]||(I[3]=r=>C("changeStatus",_.item,e(l).Cancelled))},{default:n(()=>[p(" Ушел ")]),_:1},8,["loading"])):v("",!0)])]),s(e(pe),{modelValue:U.value,"onUpdate:modelValue":I[4]||(I[4]=r=>U.value=r)},{default:n(()=>[ba,o("form",{class:d(_.$style.form),onSubmit:te(N,["prevent"])},[s(e(A),{control:e(f).name_for_reservation,"validation-errors":t},{default:n(({model:r})=>[s(e(se),{modelValue:r.value,"onUpdate:modelValue":$=>r.value=$,label:"На чье имя бронь*",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(f).num_people,"validation-errors":t},{default:n(({model:r})=>[s(e(Se),{modelValue:r.value,"onUpdate:modelValue":$=>r.value=$,label:"Количество человек*",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(f).phone_number,"validation-errors":t},{default:n(({model:r})=>[s(e(ze),{modelValue:r.value,"onUpdate:modelValue":$=>r.value=$,label:"Номер телефона",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(f).comment,"validation-errors":t},{default:n(({model:r})=>[s(e(se),{modelValue:r.value,"onUpdate:modelValue":$=>r.value=$,label:"Комментарий",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{class:"ark-space_bottom-4",control:e(f).foreigner},{default:n(({model:r})=>[s(e(Ve),{modelValue:r.value,"onUpdate:modelValue":$=>r.value=$},{default:n(()=>[p("Иностранец")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),o("div",{class:d(_.$style.buttons)},[s(e(b),{type:"submit",size:"l",loading:j.value},{default:n(()=>[p(" Сохранить ")]),_:1},8,["loading"]),s(e(b),{appearance:"neutral",type:"button",size:"l",onClick:G},{default:n(()=>[p(" Отменить ")]),_:1})],2)],34)]),_:1},8,["modelValue"])],10,ma))}}),Va="_form_1j2tr_2",za="_button_1j2tr_8",Ca="_row_1j2tr_12",La="_inline_1j2tr_22",wa="_xs_1j2tr_28",Sa="_comment_1j2tr_32",qa="_comment__text_1j2tr_38",Ua="_buttons_1j2tr_54",xa={form:Va,button:za,row:Ca,inline:La,xs:wa,comment:Sa,comment__text:qa,buttons:Ua},Na={$style:xa},Ra=ue($a,[["__cssModules",Na]]),Ia={key:0,class:"ark-text_body-s"},Ta=o("span",{class:"ark-text_body-xs"}," на ",-1),Da=o("span",{class:"ark-text_body-xs"},"чел",-1),Oa=["href"],Ea=le({__name:"ReservationHeader",props:{item:{}},emits:["onEdit"],setup(K,{emit:H}){const z=K,C=H,{item:t}=me(z),R=V(!1),E=ie(()=>t.value.status===l.Cancelled||t.value.status===l.Sat),P=ie(()=>{const h=t.value.phone_number||"";return h.slice(h.length-5).replace("-","")}),U=()=>{E.value&&(R.value=!R.value)};return(j,h)=>(a(),c("div",null,[o("button",{type:"button",class:d(j.$style.header),onClick:U},[o("p",null,[e(t).queue_number?(a(),c("span",Ia,"№"+q(e(t).queue_number)+" ",1)):v("",!0),p(q(e(t).name_for_reservation),1),Ta,p(q(e(t).num_people),1),Da,e(t).phone_number?(a(),c("a",{key:1,class:d(["ark-space_left-1",j.$style.link]),href:`tel:${e(t).phone_number}`},[s(e(Q),{name:"phone",style:{"margin-right":"2px"},size:12}),p(q(P.value),1)],10,Oa)):v("",!0)]),s(e(Ee),{class:"ark-space_left-auto",size:"s",status:e(t).status,"invite-time":e(t).invite_time,created:e(t).created},null,8,["status","invite-time","created"]),s(e(b),{appearance:"neutral",size:"xs",icon:"edit",shape:"square","icon-size":12,style:{"--ark-height-xs":"1.25rem","margin-left":"2px"},onClick:h[0]||(h[0]=te(S=>C("onEdit"),["stop"]))})],2),!E.value||R.value?Ke(j.$slots,"default",{key:0,shortInfo:E.value}):v("",!0)]))}}),Ma="_header_1t0zn_1",ja="_inline_1t0zn_23",Ba="_link_1t0zn_29",Pa={header:Ma,inline:ja,link:Ba},Ja={$style:Pa},Aa=ue(Ea,[["__cssModules",Ja]]),Fa=["data-status"],Ha={class:"ark-space_top-1 ark-text_body-s",style:{display:"flex",gap:"0.5rem"}},Za={class:"ark-space_left-1"},Wa=o("p",{class:"ark-text_body-xs ark-text_64"},"Комментарий",-1),Ka={class:"ark-text_body-s-2 ark-text_medium"},Qa=o("h5",{class:"ark-text_h5 ark-space_bottom-4"},"Изменение",-1),Ga=le({__name:"ReservationMobileItem",props:{item:{},satLoading:{type:Boolean},leaveLoading:{type:Boolean},inviteLoading:{type:Boolean},joinedLoading:{type:Boolean},computedTable:{}},emits:["changeStatus","invite","updateDto"],setup(K,{emit:H}){const z=K,C=H,{item:t}=me(z),R={required:"Обязательно",phone:"Некорректный номер мобильного телефона"},E=ce(),P=_e(),U=V(!1),j=V(null),h=V(!1),S=V(!1),f=ie(()=>{const r=t.value.status;return r===l.Live||r===l.Called||r===l.Joined});nt(it,j);function Z(r,$){return $.phone_required.value?r.trim().length>0:!0}const g=Ce({num_people:[2,{required:ae}],phone_number:["",{required:Le.withMessage("validator.required",Z),phone:we(!1)}],name_for_reservation:["",{required:ae}],foreigner:[!1],comment:[""],phone_required:[!0]}),x=ne(be);Y(x,r=>{r?g.phone_required.setValue(r.phone_required):g.phone_required.setValue(!0)},{immediate:!0});const N=()=>{g.num_people.setValue(z.item.num_people),g.phone_number.setValue(z.item.phone_number||""),g.name_for_reservation.setValue(z.item.name_for_reservation),g.foreigner.setValue(z.item.foreigner),g.comment.setValue(z.item.comment||""),h.value=!0},G=()=>{if(g.validate(),g.invalid.value)return;const{num_people:r,phone_number:$,name_for_reservation:y,foreigner:i,comment:T}=g.getCurrentValue();S.value=!0,E.updateReservation.execute({id:z.item.id,num_people:r,phone_number:$?`+${$e($)}`:"",name_for_reservation:y,foreigner:i,comment:T}).then(M=>{M&&(C("updateDto",M),h.value=!1,P.show("Бронирование обновлено"))}).catch(()=>{P.show("Не удалось изменить бронирование",{label:"Ошибка",type:"error"})}).finally(()=>{S.value=!1})},_=()=>{h.value=!1},I=r=>{U.value=!1,C("changeStatus",z.item,l.Sat,r)};return(r,$)=>(a(),c("div",{class:d(r.$style.item),"data-status":e(t).status},[s(Aa,{item:e(t),onOnEdit:N},{default:n(()=>[o("div",Ha,[o("div",{class:d(r.$style.inline),style:{gap:"0.25rem"}},[o("div",null,[o("p",{class:d(r.$style.xs)},"встали",2),e(t).created?(a(),L(We,{key:0,inline:"",hidetoday:"",class:d(r.$style.time),date:e(t).created},null,8,["class","date"])):v("",!0)]),s(e(Q),{name:"arrow-right-stroke",size:12,class:d(r.$style.xs)},null,8,["class"]),o("div",null,[o("p",{class:d(r.$style.xs)},"сядут ~",2),e(t).seating_time?(a(),L(We,{key:0,inline:"",hidetoday:"",class:d(r.$style.time),date:e(t).seating_time},null,8,["class","date"])):(a(),c("p",{key:1,class:d(["ark-text_body-xs ark-text_64",r.$style.time])},[p(" Вычисляем"),s(e(et))],2))]),o("div",Za,[o("p",{class:d(r.$style.xs)},"Зона",2),o("p",{class:d([r.$style.time,r.$style.break])},q(e(t).required_zone??"Не важно"),3)])],2)]),e(t).comment?(a(),c("div",{key:0,class:d(r.$style.comment)},[Wa,o("p",Ka,q(e(t).comment),1)],2)):v("",!0),o("div",{class:d(r.$style.preview)},[s(e(bt),{"res-id":e(t).id,ids:e(t).tables,onUpdateDto:$[0]||($[0]=y=>C("updateDto",y))},null,8,["res-id","ids"])],2),f.value?(a(),c("div",{key:1,ref_key:"dropdownHostRef",ref:j,class:d(["ark-space_top-1",r.$style.buttons])},[e(t).status===e(l).Live||e(t).status===e(l).Called||e(t).status===e(l).Joined?(a(),L(e(b),{key:0,appearance:"s-danger",size:"xs",icon:"trash",class:d(r.$style.button),loading:r.leaveLoading,onClick:$[1]||($[1]=te(y=>C("changeStatus",e(t),e(l).Cancelled),["stop"]))},{default:n(()=>[p(" Ушел ")]),_:1},8,["class","loading"])):v("",!0),e(t).status===e(l).Live&&e(t).phone_number?(a(),L(e(b),{key:1,appearance:"primary-reverse",size:"xs",icon:"bell",class:d(r.$style.button),loading:r.inviteLoading,onClick:$[2]||($[2]=y=>C("invite",e(t)))},{default:n(()=>[p(" Вызвать ")]),_:1},8,["class","loading"])):v("",!0),e(t).status===e(l).Live||e(t).status===e(l).Called?(a(),L(e(b),{key:2,appearance:"attention",size:"xs",icon:"handshake",class:d(r.$style.button),loading:r.joinedLoading,onClick:$[3]||($[3]=te(y=>C("changeStatus",e(t),e(l).Joined),["stop"]))},{default:n(()=>[p(" Пришел ")]),_:1},8,["class","loading"])):v("",!0),e(t).status===e(l).Live||e(t).status===e(l).Called||e(t).status===e(l).Joined?(a(),L(Me,{key:3,item:e(t),loading:r.satLoading,onTableSelect:I},{default:n(({open:y})=>[s(e(b),{appearance:"success",size:"xs",icon:"arrow-down",class:d(r.$style.button),loading:r.satLoading,onClick:y},{default:n(()=>[p(" Занял ")]),_:2},1032,["class","loading","onClick"])]),_:1},8,["item","loading"])):v("",!0)],2)):v("",!0)]),_:1},8,["item"]),s(e(pe),{modelValue:h.value,"onUpdate:modelValue":$[4]||($[4]=y=>h.value=y)},{default:n(()=>[Qa,o("form",{class:d(r.$style.form),onSubmit:te(G,["prevent"])},[s(e(A),{control:e(g).name_for_reservation,"validation-errors":R},{default:n(({model:y})=>[s(e(se),{modelValue:y.value,"onUpdate:modelValue":i=>y.value=i,label:"На чье имя бронь*",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(g).num_people,"validation-errors":R},{default:n(({model:y})=>[s(e(Se),{modelValue:y.value,"onUpdate:modelValue":i=>y.value=i,label:"Количество человек*",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(g).phone_number,"validation-errors":R},{default:n(({model:y})=>[s(e(ze),{modelValue:y.value,"onUpdate:modelValue":i=>y.value=i,label:"Номер телефона",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{control:e(g).comment,"validation-errors":R},{default:n(({model:y})=>[s(e(se),{modelValue:y.value,"onUpdate:modelValue":i=>y.value=i,label:"Комментарий",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(A),{class:"ark-space_bottom-4",control:e(g).foreigner},{default:n(({model:y})=>[s(e(Ve),{modelValue:y.value,"onUpdate:modelValue":i=>y.value=i},{default:n(()=>[p("Иностранец")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),o("div",{class:d(r.$style.actions)},[s(e(b),{type:"submit",size:"l",loading:S.value},{default:n(()=>[p(" Сохранить ")]),_:1},8,["loading"]),s(e(b),{appearance:"neutral",type:"button",size:"l",onClick:_},{default:n(()=>[p(" Отменить ")]),_:1})],2)],34)]),_:1},8,["modelValue"])],10,Fa))}}),Xa="_item_1glbs_2",Ya="_form_1glbs_20",es="_inline_1glbs_26",ts="_button_1glbs_34",as="_button_deep_1glbs_37",ss="_tableList_1glbs_41",ls="_tableList__item_1glbs_46",os="_buttons_1glbs_66",ns="_preview_1glbs_75",is="_xs_1glbs_87",rs="_time_1glbs_92",us="_edit_1glbs_101",ds="_comment_1glbs_107",cs="_actions_1glbs_125",_s={item:Xa,form:Ya,inline:es,button:ts,button_deep:as,tableList:ss,tableList__item:ls,buttons:os,preview:ns,xs:is,time:rs,break:"_break_1glbs_97",edit:us,comment:ds,actions:cs},ms={$style:_s},ps=ue(Ga,[["__cssModules",ms]]),vs=["data-list"],fs={class:"ark-text_h6 ark-space_bottom-2",style:{display:"flex","align-items":"center",gap:"0.75rem"}},hs=o("p",{class:"ark-text_body-xs ark-text_64"},"Ожидание",-1),ks={key:0,class:"ark-table"},gs={style:{"--header-padding":"0.5rem 0.75rem"},class:"ark-table__header"},ys={class:"ark-text_body-l ark-text_medium"},bs=o("p",null,"Список",-1),$s={key:0,class:"ark-text_body-xs ark-text_semibold ark-text_64"},Vs=o("th",null,"Номер",-1),zs=o("th",null,"Имя",-1),Cs=o("th",null,"Время и столы",-1),Ls={key:0},ws={colspan:"4"},Ss={key:0,class:"ark-text_body-s ark-text_semibold ark-text_64",style:{"text-align":"center"}},qs={key:1,class:"ark-space_top-2",style:{"text-align":"center"}},Us={key:1,style:{"text-align":"center",width:"100%"}},xs=o("img",{src:Oe,width:"128",height:"128",alt:"No zones",class:"ark-space_bottom-4"},null,-1),Ns={class:"ark-text_h6 ark-space_bottom-3"},Rs={key:0,class:"ark-text_body-s ark-text_semibold ark-text_64",style:{"text-align":"center"}},Is={key:1,class:"ark-space_top-2",style:{"text-align":"center"}},Ts={key:1,style:{"text-align":"center",width:"100%"}},Ds=o("img",{src:Oe,width:"128",height:"128",alt:"No zones",class:"ark-space_bottom-4"},null,-1),Os={class:"ark-text_h6 ark-space_bottom-3"},Es=["data-list"],Ms={key:1,class:"ark-space_top-2",style:{"text-align":"center"}},js={key:2,style:{"text-align":"center",width:"100%"}},Bs=o("img",{src:Oe,width:"128",height:"128",alt:"No zones",class:"ark-space_bottom-4"},null,-1),Ps={class:"ark-text_h6 ark-space_bottom-3"},Js=le({__name:"Reservations",props:{id:{}},setup(K){const H=K,{id:z}=me(H),C=ce(),t=_e(),E=rt().computedSmallerThen("mobile"),P=ne(vt),U=ne(be),j=V(NaN),h=V(!1),S=V(null),f=V(!1),Z=V(!1),g=V(null),x=V(!1),N=V(NaN),G=V(NaN),_=V(NaN),I=V(NaN),r=V(NaN),$=V(!1),y=V(localStorage.getItem("__ark-supra-queue-new-design")!=="1"),i=V(localStorage.getItem("__ark-supra-queue-new-design-list")==="1");Y(i,m=>{m?localStorage.setItem("__ark-supra-queue-new-design-list","1"):localStorage.removeItem("__ark-supra-queue-new-design-list")});const T=ne(ft),M=[l.Live,l.Called,l.Joined,void 0],B=V(!1),W={[l.Live]:"Ожидает",[l.Called]:"Вызван",[l.Joined]:"Пришел",undefined:"Все"},de=V(1),D=V({status:l.Live,prefer_zone:null,size:50});Y(y,m=>{m?localStorage.removeItem("__ark-supra-queue-new-design"):localStorage.setItem("__ark-supra-queue-new-design","1")});const ve=ne(ht),je=V(null),tt=["минуту","минуты","минут"];let fe=null;const Be=V(Date.now()),at=ie(()=>{Be.value;const m=T.value,k=Te.currentLocal().valueOf()-Te.fromLocalNativeDate(new Date(m)).valueOf(),u=Te.fromAbsoluteMilliseconds(k);return u.hours?"больше часа":u.minutes?`${u.minutes} ${ut(tt,u.minutes)}`:"меньше минуты"}),Pe=ie(()=>(je.value||[]).filter(k=>k.num_people===2||k.num_people===4||k.num_people===6)),re=ie(()=>{const m=S.value;if(h.value)return m&&m.results.length>0?m.results:$t;const k=ve.value,u=((m==null?void 0:m.results)||[]).reduce((J,F)=>(J.push({...F,tables:F.tables||F.table,original_phone:F.phone_number,phone_number:F.phone_number?dt(F.phone_number):""}),J),[]),w=(g.value||"").trim().toLowerCase();return w?u.filter(J=>(J.original_phone?J.original_phone.includes(w):!1)||J.name_for_reservation.toLowerCase().includes(w)||J.tables.some(F=>{if(typeof F=="string"){const X=k[F];return X?X.number.includes(w)||X.zone.toLowerCase().includes(w):!1}return F.some(X=>{const Ie=k[X];return Ie?Ie.number.includes(w)||Ie.zone.toLowerCase().includes(w):!1})})):u}),qe=()=>{j.value=Date.now(),T.value=Date.now()},oe=(m,k=!1)=>{var u;if(S.value){const w=((u=S.value)==null?void 0:u.results)||[];let J;if(k){const F=w.filter(X=>X.id!==m.id);J=[m].concat(F)}else J=w.map(F=>F.id===m.id?m:F);S.value={...S.value,results:J}}},Ue=m=>{_.value=m.id;const k={id:m.id,status:m.status};C.inviteReservation.execute({id:m.id}).then(u=>{u&&(t.show(De(Ze),{autoClose:!1,type:"undo",data:{title:u.info,icon:u.info==="SMS было отправлено"?"check":"info",iconColor:u.info==="SMS было отправлено"?void 0:"var(--ark-info-fill)",callback:()=>C.updateReservation.execute(k).then(w=>{w&&oe(w)})}}),C.loadReservationItem.execute({id:m.id}).then(w=>{w&&oe(w)}).catch(()=>null))}).catch(()=>{t.show("Не удалось пригласить",{label:"Ошибка",type:"error"})}).finally(()=>{_.value=NaN})},st={[l.Called]:"Вызвали",[l.Cancelled]:"Убрали из очереди",[l.Joined]:"Теперь с нами",[l.Live]:"Добавили в очередь",[l.Sat]:"Посадили за стол"},xe=(m,k,u)=>{k===l.Cancelled?G.value=m.id:k===l.Joined?I.value=m.id:k===l.Live?r.value=m.id:N.value=m.id;const w={id:m.id,status:m.status},J={id:m.id,status:k};u&&(J.table=u),C.updateReservation.execute(J).then(F=>{F&&(oe(F,k===l.Joined),t.show(De(Ze),{autoClose:!1,type:"undo",data:{title:st[k]||"Обновили статус",callback:()=>C.updateReservation.execute(w).then(X=>{X&&oe(X)})}}))}).catch(()=>{t.show("Не удалось изменить статус",{label:"Ошибка",type:"error"})}).finally(()=>{G.value=NaN,N.value=NaN,I.value=NaN,r.value=NaN})},Ne=()=>{B.value=!B.value},Re=()=>{$.value=!0;const{status:m,size:k,prefer_zone:u}=D.value;C.loadReservations.execute({restaurant_id:Number(H.id),status:m,page:de.value+1,page_size:k,zone:u??void 0}).then(w=>{w&&($.value=!1,de.value+=1,S.value?S.value={...w,results:S.value.results.concat(w.results)}:S.value=w)}).catch(([w,J])=>{J!==403&&(t.show("Попробуй еще раз",{type:"error",label:"Ошибка загрузки след страницы"}),$.value=!1)})},he=m=>{D.value={...D.value,status:m},f.value=!1},lt=m=>{D.value={...D.value,prefer_zone:m},Z.value=!1},ot=([m,{status:k,size:u,prefer_zone:w}])=>{h.value=!0,C.loadReservations.execute({restaurant_id:Number(m),status:k,page:1,page_size:u,zone:w??void 0}).then(J=>{J&&(h.value=!1),S.value=J}).catch(([J,F])=>{F!==403&&(t.show("Не удалось загрузить очередь",{type:"error",label:"Ошибка"}),h.value=!1)})};let ke=null;return ct(()=>{fe=setInterval(()=>{Be.value=Date.now()},_t),ke=setInterval(()=>{j.value=Date.now()},Xe*30)}),mt(()=>{ke&&clearInterval(ke),fe&&clearInterval(fe),ke=null,fe=null}),Y([z,D,T],ot,{immediate:!0}),Y([()=>H.id,j],([m])=>{m&&C.loadEta.execute({id:m}).then(k=>{je.value=k}).catch(()=>null)},{immediate:!0}),(m,k)=>(a(),c(O,null,[o("div",{class:d(["ark-space_bottom-2",m.$style.container]),"data-list":e(E)?!1:!y.value&&i.value},[o("h6",fs,[p(" Очередь "),s(e(b),{appearance:"flat",size:"xs",icon:"refresh",style:{gap:"0.5rem"},onClick:qe},{default:n(()=>[p(" Обновлено "+q(at.value)+" назад ",1)]),_:1})]),o("div",{class:d(["ark-space_bottom-2",m.$style.header])},[o("div",null,[hs,Pe.value?(a(),c("div",{key:0,class:d(m.$style.eta)},[(a(!0),c(O,null,ee(Pe.value,(u,w)=>(a(),c("div",{key:u.num_people,class:d(m.$style.eta__item)},[w===0?(a(),c(O,{key:0},[s(e(Q),{name:"users",size:12}),p("  ")],64)):v("",!0),p(q(u.num_people)+" ~ ",1),s(e(gt),{date:u.time_difference_minutes},null,8,["date"])],2))),128))],2)):v("",!0)])],2),ge((a(),c("div",{class:d(m.$style.statuses)},[s(e(He),{modelValue:f.value,"onUpdate:modelValue":k[0]||(k[0]=u=>f.value=u),align:"left","min-width":200},{dropdown:n(()=>[s(e(Je),null,{default:n(()=>[(a(),c(O,null,ee(M,u=>ge(s(e(b),{key:u,size:"s",appearance:"flat",style:{width:"100%"},"icon-right":D.value.status===u?"check":void 0,onClick:w=>he(u)},{default:n(()=>[p(q(W[u]),1)]),_:2},1032,["icon-right","onClick"]),[[e(Ae)]])),64))]),_:1})]),default:n(()=>[s(e(b),{appearance:"flat","icon-right":"arrow-down",size:"xs","right-rotate":f.value},{default:n(()=>[p(" Статус: "),o("b",null,q(W[D.value.status]),1)]),_:1},8,["right-rotate"])]),_:1},8,["modelValue"]),s(e(He),{modelValue:Z.value,"onUpdate:modelValue":k[1]||(k[1]=u=>Z.value=u),align:"left",class:"ark-space_right-auto","min-width":200},{dropdown:n(()=>[s(e(Je),null,{default:n(()=>[(a(!0),c(O,null,ee(e(P),(u,w)=>ge((a(),L(e(b),{key:w,size:"s",appearance:"flat","icon-right":D.value.prefer_zone===u?"check":void 0,onClick:J=>lt(u)},{default:n(()=>[p(q(u??"Все"),1)]),_:2},1032,["icon-right","onClick"])),[[e(Ae)]])),128))]),_:1})]),default:n(()=>[s(e(b),{appearance:"flat","icon-right":"arrow-down",size:"xs","right-rotate":Z.value},{default:n(()=>[p(" Зона: "),o("b",null,q(D.value.prefer_zone??"Все"),1)]),_:1},8,["right-rotate"])]),_:1},8,["modelValue"]),e(E)?v("",!0):(a(),c(O,{key:0},[s(e(b),{size:"xs",icon:"list",appearance:i.value&&!y.value?"neutral":"flat",onClick:k[2]||(k[2]=u=>{y.value=!1,i.value=!0})},{default:n(()=>[p(" Списком ")]),_:1},8,["appearance"]),s(e(b),{size:"xs",icon:"grid",appearance:i.value||y.value?"flat":"neutral",onClick:k[3]||(k[3]=u=>{y.value=!1,i.value=!1})},{default:n(()=>[p(" Сеткой ")]),_:1},8,["appearance"])],64)),s(e(b),{size:"xs",appearance:y.value?"flat":"neutral",onClick:k[4]||(k[4]=u=>y.value=!1)},{default:n(()=>[p(" Новый дизайн ")]),_:1},8,["appearance"]),s(e(b),{size:"xs",appearance:y.value?"neutral":"flat",onClick:k[5]||(k[5]=u=>y.value=!0)},{default:n(()=>[p(" Старый дизайн ")]),_:1},8,["appearance"])],2)),[[e(Ye)]])],10,vs),y.value?(a(),c(O,{key:0},[e(E)?(a(),c("div",{key:1,class:d(m.$style.items)},[re.value.length>0?(a(),c(O,{key:0},[(a(!0),c(O,null,ee(re.value,u=>(a(),L(e(ps),{key:u.id,item:u,class:d(h.value&&"ark-skeleton"),"computed-table":e(ve),"leave-loading":u.id===G.value,"sat-loading":u.id===N.value,"invite-loading":u.id===_.value,"joined-loading":u.id===I.value,onChangeStatus:xe,onUpdateDto:oe,onInvite:Ue},null,8,["item","class","computed-table","leave-loading","sat-loading","invite-loading","joined-loading"]))),128)),S.value&&!S.value.next&&!h.value?(a(),c("div",Rs," Больше нет никого ")):S.value&&!h.value?(a(),c("div",Is,[s(e(b),{appearance:"neutral",size:"s",loading:$.value,onClick:Re},{default:n(()=>[p(" Загрузить 50 следующих ")]),_:1},8,["loading"])])):v("",!0)],64)):(a(),c("div",Ts,[Ds,o("h6",Os,[p(" Нет никого "),D.value.status&&D.value.status!==e(l).Live?(a(),c(O,{key:0},[p(' из тех кто "'+q(W[D.value.status])+'" ',1)],64)):v("",!0)]),D.value.status!==e(l).Live?(a(),L(e(b),{key:0,appearance:"neutral",size:"s",onClick:k[7]||(k[7]=u=>he(e(l).Live))},{default:n(()=>[p(" Показать тех кто в очереди? ")]),_:1})):v("",!0)]))],2)):(a(),c("div",ks,[o("div",gs,[o("div",ys,[bs,e(E)?v("",!0):(a(),c("p",$s," Shift + колесико мышки для скролла по горизонтали "))]),o("button",{type:"button",class:d([m.$style.grid__add,m.$style.grid__add_s]),onClick:Ne}," Добавить в очередь ",2)]),s(e(pt),null,{default:n(()=>[o("table",null,[o("thead",null,[Vs,zs,Cs,D.value.status===e(l).Live||D.value.status===e(l).Called||D.value.status===e(l).Joined||D.value.status===void 0?(a(),c("th",Ls," Изменение статуса ")):v("",!0)]),o("tbody",null,[re.value.length>0?(a(),c(O,{key:0},[(a(!0),c(O,null,ee(re.value,u=>(a(),L(e(Ra),{key:u.id,class:d(h.value&&"ark-skeleton"),item:u,"computed-table":e(ve),"leave-loading":u.id===G.value,"sat-loading":u.id===N.value,"invite-loading":u.id===_.value,"joined-loading":u.id===I.value,onChangeStatus:xe,onUpdateDto:oe,onInvite:Ue},null,8,["class","item","computed-table","leave-loading","sat-loading","invite-loading","joined-loading"]))),128)),o("tr",null,[o("td",ws,[S.value&&!S.value.next&&!h.value?(a(),c("div",Ss," Больше нет никого ")):S.value&&!h.value?(a(),c("div",qs,[s(e(b),{appearance:"neutral",size:"s",loading:$.value,onClick:Re},{default:n(()=>[p(" Загрузить 50 следующих ")]),_:1},8,["loading"])])):v("",!0)])])],64)):(a(),c("div",Us,[xs,o("h6",Ns,[p(" Нет никого "),D.value.status&&D.value.status!==e(l).Live?(a(),c(O,{key:0},[p(' из тех кто "'+q(W[D.value.status])+'" ',1)],64)):v("",!0)]),D.value.status!==e(l).Live?(a(),L(e(b),{key:0,appearance:"neutral",size:"s",onClick:k[6]||(k[6]=u=>he(e(l).Live))},{default:n(()=>[p(" Показать тех кто в очереди? ")]),_:1})):v("",!0)]))])])]),_:1})]))],64)):(a(),c("div",{key:1,class:d(m.$style.grid),"data-list":e(E)?!1:i.value},[e(E)?v("",!0):(a(),c("button",{key:0,type:"button",class:d(m.$style.grid__add),onClick:Ne}," Добавить в очередь ",2)),re.value.length>0?(a(),c(O,{key:1},[(a(!0),c(O,null,ee(re.value,u=>{var w;return a(),L(e(_a),{key:u.id,item:u,loading:h.value,"computed-table":e(ve),"leave-loading":u.id===G.value,"sat-loading":u.id===N.value,"invite-loading":u.id===_.value,"joined-loading":u.id===I.value,"live-loading":u.id===r.value,timezone:(w=e(U))==null?void 0:w.timezone,onChangeStatus:xe,onUpdateDto:oe,onInvite:Ue},null,8,["item","loading","computed-table","leave-loading","sat-loading","invite-loading","joined-loading","live-loading","timezone"])}),128)),S.value&&!S.value.next&&!h.value?(a(),c("div",{key:0,class:d(["ark-text_body-s ark-text_semibold ark-text_64",m.$style.empty])}," Больше нет никого ",2)):S.value&&!h.value?(a(),c("div",Ms,[s(e(b),{appearance:"neutral",size:"s",loading:$.value,onClick:Re},{default:n(()=>[p(" Загрузить 50 следующих ")]),_:1},8,["loading"])])):v("",!0)],64)):(a(),c("div",js,[Bs,o("h6",Ps,[p(" Нет никого "),D.value.status&&D.value.status!==e(l).Live?(a(),c(O,{key:0},[p(' из тех кто "'+q(W[D.value.status])+'" ',1)],64)):v("",!0)]),D.value.status!==e(l).Live?(a(),L(e(b),{key:0,appearance:"neutral",size:"s",onClick:k[8]||(k[8]=u=>he(e(l).Live))},{default:n(()=>[p(" Показать тех кто в очереди? ")]),_:1})):v("",!0)]))],10,Es)),e(E)?(a(),c("div",{key:2,class:d([m.$style.safe__content,(x.value||g.value)&&m.$style.safe__content_top])},[x.value||g.value?v("",!0):(a(),c(O,{key:0},[s(e(b),{"icon-button":"",icon:"refresh",appearance:"elevation",size:"l",shape:"square",class:"ark-space_left-auto",onClick:qe}),s(e(b),{"icon-button":"",shape:"square",icon:"plus",appearance:"elevation",size:"l",onClick:Ne})],64))],2)):v("",!0),s(e(pe),{modelValue:B.value,"onUpdate:modelValue":k[9]||(k[9]=u=>B.value=u)},{default:n(({close:u})=>[s(e(Dt),{id:e(z),"computed-zones":e(P),onRefresh:qe,onClose:u},null,8,["id","computed-zones","onClose"])]),_:1},8,["modelValue"])],64))}}),As="_container_146ka_1",Fs="_header_146ka_10",Hs="_eta_146ka_16",Zs="_eta__item_146ka_22",Ws="_statuses_146ka_31",Ks="_grid_146ka_46",Qs="_grid__add_146ka_59",Gs="_grid__add_s_146ka_86",Xs="_items_146ka_97",Ys="_safe_146ka_102",el="_safe__content_146ka_105",tl="_search_146ka_121",al="_search_focused_146ka_127",sl="_empty_146ka_131",ll="_status_146ka_31",ol={container:As,header:Fs,eta:Hs,eta__item:Zs,statuses:Ws,grid:Ks,grid__add:Qs,grid__add_s:Gs,items:Xs,safe:Ys,safe__content:el,search:tl,search_focused:al,empty:sl,status:ll},nl={$style:ol},xl=ue(Js,[["__cssModules",nl]]);export{xl as default};
