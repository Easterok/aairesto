import{d as b,l as g,w as k,e as x,r as E,c as z,h as s,s as l,i as o,a as d,n as q,v as C,u as N,y as R,z as U,p as $,A as B,o as M,B as A,j as v,x as I,V as S,_ as j}from"./index-6367d8ff.js";import{_ as h}from"./index-bbe23418.js";import{I as F}from"./index-89d72c36.js";import{c as L,r as y,e as O}from"./index-9268c079.js";import"./index-55204b2b.js";const T=d("h6",{class:"ark-text_h6 ark-space_bottom-4"},"Вход",-1),J={class:"ark-space_bottom-6"},K=b({__name:"Login",setup(G){const _=N(),p=g(),n=R(),V=U(),i=B(S),e=L({email:["",{required:y,email:O}],password:["",{required:y}]}),f={"Unable to log in with provided credentials.":"Неверная почта или пароль"};k([e.email.value,e.password.value],()=>{e.email.removeErrors(["_async"]),e.password.removeErrors(["_async"])}),x(()=>{V.query.t==="1"&&(_.authorized.value=!1,p.show("Токен авторизации просрочен",{type:"info",label:"Авторизуйтесь еще раз"}),n.replace({query:{...n.currentRoute.value.query,t:void 0}}))});const u=E(!1),w=()=>{if(e.validate(),e.invalid.value)return;u.value=!0;const c=e.getCurrentValue();_.login(c).then(()=>{i==null||i.verify(),n.push("/")}).catch(([t])=>{if(t.non_field_errors&&t.non_field_errors[0]){const a=t.non_field_errors[0];e.email.setErrors({_async:f[a]||a}),e.password.setErrors({_async:f[a]||a})}else p.show(JSON.stringify(t),{type:"error",label:"Ошибка авторизации"})}).finally(()=>{u.value=!1})};return(c,t)=>{const a=$("router-link");return M(),z("form",{class:q(c.$style.form),onSubmit:C(w,["prevent"])},[T,s(o(h),{class:"ark-space_bottom-3",control:o(e).email},{default:l(({model:r})=>[s(o(A),{modelValue:r.value,"onUpdate:modelValue":m=>r.value=m,placeholder:"Email",autocomplete:"email",name:"email",inputmode:"email",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(o(h),{class:"ark-space_bottom-1",control:o(e).password},{default:l(({model:r})=>[s(o(F),{modelValue:r.value,"onUpdate:modelValue":m=>r.value=m,placeholder:"Пароль",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),d("p",J,[s(a,{to:"/sign-up"},{default:l(()=>[v("Регистрация")]),_:1})]),d("div",null,[s(o(I),{type:"submit",size:"l",loading:u.value},{default:l(()=>[v(" Войти ")]),_:1},8,["loading"])])],34)}}}),P="_form_1tlxv_1",Y={form:P},D={$style:Y},ee=j(K,[["__cssModules",D]]);export{ee as default};
