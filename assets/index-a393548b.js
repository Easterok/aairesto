import{d as te,Q as se,A as J,m as le,r as re,b as _,aJ as H,am as G,w as ce,o as l,c as u,i as n,t as d,k as j,j as y,n as v,h as $,S as ie,F as M,a as r,ah as ue,g as U,q as O,s as g,aK as Q,aL as W,x as V,v as F,a8 as de,ao as _e,_ as ae,ae as i,aa as X,ab as Y,a9 as P,aM as me}from"./index-f01f95e2.js";import{T as ee}from"./index-9b992aff.js";const pe={key:0,class:"ark-space_bottom-2 ark-text_medium"},ve={key:0,class:"ark-text_body-s"},be=r("span",{class:"ark-text_body-xs"}," на ",-1),fe=r("span",{class:"ark-text_body-xs"},"чел",-1),ye=["href"],ke={class:"ark-text_body-s ark-text_semibold ark-space_bottom-1"},he={class:"ark-text_body-xs ark-space_bottom-1"},$e={style:{display:"flex","justify-content":"space-between",gap:"0.5rem","align-items":"center"}},ge={key:0},ze={key:1},Te=["data-small"],Se=te({__name:"TableSelect",props:{item:{},loading:{type:Boolean},buttonSize:{},showClient:{type:Boolean,default:!0},buttonText:{},buttonReverse:{type:Boolean}},emits:["tableSelect","close"],setup(L,{emit:K}){const z=L,w=K,{item:c}=se(z),B=J(de),T=J(_e),b=le({}),f=re(null),D=["стол","стола","столов"],I=["Выбран","Выбрано","Выбрано"],o=_(()=>{const e=b;return Object.keys(e).filter(s=>!!e[s])}),S=e=>{const s=Array.isArray(e)?e:[e],t=o.value;return s.every(a=>!!t.find(p=>p===a))},N=(e,s)=>{(typeof s=="string"?[s]:s).forEach(a=>{b[a]=e})},q=_(()=>{const e=T.value;return c.value.tables.map(a=>{var Z;const k=(Array.isArray(a)?a:[a]).map(h=>e[h]).filter(Boolean),ne=k.map(h=>h.number).join(`${H}+${H}`),oe=k.map(h=>h.capacity).join("+");return{ids:k.map(h=>h.id),number:ne,capacity:oe,zone:(Z=k[0])==null?void 0:Z.zone}})}),C=_(()=>{const e=o.value.length,s=G(D,e);return`${G(I,e)} ${e} ${s}`}),x=_(()=>{const e=o.value,s=T.value;let t=0;const a=[];return e.forEach(p=>{const k=s[p];t+=k.capacity,a.push(`#${k.number}`)}),`${a.join(", ")} (на ${t} чел)`}),R=_(()=>{const s=c.value.phone_number||"";return s.slice(s.length-5).replace("-","")}),A=_(()=>{const e=f.value,s=Object.values(T.value),t=e?s.filter(({zone:a})=>a===e):s;return t.sort((a,p)=>Number(a.number)-Number(p.number)),t}),m=()=>{const e=o.value;e.length!==0&&w("tableSelect",e)},E=()=>{Object.keys(b).forEach(e=>{delete b[e]})};return ce(B,e=>{const s=e.filter(Boolean);s.length>0&&!f.value&&(f.value=s[0])},{immediate:!0}),(e,s)=>(l(),u(M,null,[e.showClient?(l(),u("p",pe,["queue_number"in n(c)&&n(c).queue_number?(l(),u("span",ve,"№"+d(n(c).queue_number)+" ",1)):j("",!0),y(d(n(c).name_for_reservation),1),be,y(d(n(c).num_people),1),fe,n(c).phone_number?(l(),u("a",{key:1,class:v(["ark-space_left-1",e.$style.link]),href:`tel:${n(c).phone_number}`},[$(n(ie),{name:"phone",style:{"margin-right":"2px"},size:12}),y(d(R.value),1)],10,ye)):j("",!0)])):j("",!0),q.value.length>0?(l(),u(M,{key:1},[r("p",ke,[ue(e.$slots,"expectedTitle",{},()=>[y(" Предлагаемые столы ")])]),r("div",{class:v(["ark-space_bottom-3",e.$style.tables])},[(l(!0),u(M,null,U(q.value,(t,a)=>(l(),O(n(W),{key:a,class:v(["ark-text_body-s-2 ark-text_medium",e.$style.tables__item]),for:`expected_table_${a}`},{default:g(()=>[$(n(Q),{id:`expected_table_${a}`,size:"s","model-value":S(t.ids),"onUpdate:modelValue":p=>N(p,t.ids)},null,8,["id","model-value","onUpdate:modelValue"]),r("div",null,[$(n(ee),{item:t},null,8,["item"])])]),_:2},1032,["class","for"]))),128))],2)],64)):j("",!0),r("div",{class:v(["ark-space_bottom-2",e.$style.zones])},[(l(!0),u(M,null,U(n(B),(t,a)=>(l(),O(n(V),{key:a,size:"xs",type:"button",appearance:f.value===t?"primary":"neutral",onClick:p=>f.value=t},{default:g(()=>[y(d(t??"Все"),1)]),_:2},1032,["appearance","onClick"]))),128))],2),r("div",{class:v(e.$style.tables)},[(l(!0),u(M,null,U(A.value,t=>(l(),O(n(W),{key:t.id,class:v(["ark-text_body-s-2 ark-text_medium",e.$style.tables__item]),for:`table_${t.id}`},{default:g(()=>[$(n(Q),{id:`table_${t.id}`,size:"s","model-value":!!b[t.id],"onUpdate:modelValue":a=>b[t.id]=a},null,8,["id","model-value","onUpdate:modelValue"]),r("div",null,[$(n(ee),{item:t,zone:!f.value},null,8,["item","zone"])])]),_:2},1032,["class","for"]))),128))],2),r("div",{class:v(e.$style.footer)},[r("div",he,[r("div",$e,[o.value.length>0?(l(),u("p",ge,d(C.value),1)):(l(),u("p",ze,"Выберите стол")),$(n(V),{appearance:"flat",size:"xs",onClick:F(E,["stop","prevent"])},{default:g(()=>[y(" Сбросить ")]),_:1})]),r("p",null,d(o.value.length>0?x.value:"..."),1)]),r("div",{class:v(e.$style.buttons),"data-small":!!e.buttonText},[$(n(V),{size:e.buttonSize,disabled:o.value.length===0,loading:e.loading,onClick:F(m,["stop"])},{default:g(()=>[y(d(e.buttonText??"Подтвердить"),1)]),_:1},8,["size","disabled","loading"]),e.buttonReverse?(l(),O(n(V),{key:0,appearance:"neutral",size:e.buttonSize,onClick:s[0]||(s[0]=F(t=>w("close"),["stop"]))},{default:g(()=>[y(" Отменить ")]),_:1},8,["size"])):j("",!0)],10,Te)],2)],64))}}),qe="_footer_186ql_1",Ce="_buttons_186ql_11",xe="_smallzone_186ql_19",Re="_link_186ql_26",Ae="_zones_186ql_34",Ee="_tables_186ql_40",je="_tables__item_186ql_44",Me={footer:qe,buttons:Ce,smallzone:xe,link:Re,zones:Ae,tables:Ee,tables__item:je},we={$style:Me},De=ae(Se,[["__cssModules",we]]),Be=["data-type","data-size"],Ne=te({__name:"ReservationStatus",props:{status:{},size:{default:"m"},inviteTime:{},created:{}},setup(L){const K=L,{status:z,inviteTime:w,created:c}=se(K),B=J(me),T=_(()=>B.value.native),b={[i.Joined]:"Пришел",[i.Called]:"Вызван",[i.Live]:"Ожидает"},f=_(()=>{const o=z.value;return b[o]??o}),D=_(()=>{switch(z.value){case i.Cancelled:return"cancelled";case i.Called:return"called";case i.Reserve:case i.Reserve_Hostme:return"reserve";case i.Sat:return"sat";case i.Joined:return"joined";default:return"live"}}),I=_(()=>{const o=z.value,S=T.value.valueOf(),N=c.value,q=w.value;if(o===i.Live&&N){const[C,x]=N.split("T"),R=new X(Y.jsonParse(C),P.fromString(x)).valueOf(),A=S-R,m=P.fromAbsoluteMilliseconds(A),E=m.toString("HH:MM"),e=m.hours?E:`${m.minutes} мин.`;return`${H}(${e})`}if(o===i.Called&&q){const[C,x]=q.split("T"),R=new X(Y.jsonParse(C),P.fromString(x)).valueOf(),A=S-R,m=P.fromAbsoluteMilliseconds(A),E=m.toString("HH:MM"),e=m.hours?E:`${m.minutes} мин.`;return`${H}(${e})`}return""});return(o,S)=>(l(),u("span",{"data-type":D.value,"data-size":o.size,class:v(o.$style.tag)},d(f.value)+d(I.value),11,Be))}}),Oe="_tag_1ivsp_1",Ve={tag:Oe},Pe={$style:Ve},Ie=ae(Ne,[["__cssModules",Pe]]);export{Ie as R,De as T};
