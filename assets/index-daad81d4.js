import{d as De,a3 as je,y as $e,b as _,o as n,c,q as ue,k as e,W as Ge,l as U,a as l,t as C,j as $,F as x,g as oe,n as i,h as r,S as Tt,aa as st,$ as ee,a0 as Ne,Z as me,b5 as Ft,a2 as be,aj as Nt,aO as Dt,b6 as Et,_ as Ve,aN as lt,r as I,w as ve,a7 as Xe,aC as et,s as nt,A as W,i as g,aP as Lt,aL as ot,al as at,b7 as Jt,u as it,m as rt,Q as Ye,E as Ae,b8 as kt,C as ht,U as Wt,z as gt,a1 as Je,ai as Zt,ab as Kt,ac as Gt,aD as Yt,b9 as Qt,T as ge,ba as Xt,aF as $t,aG as Ue,P as ea,aM as ta,bb as aa,a9 as tt,v as sa,x as la,bc as na,aq as We,aK as St,ah as wt,af as Ot,ad as Ze,Y as oa,bd as ia}from"./index-45eddc23.js";import{O as ra,I as Ct,M as ca}from"./index-118a0edc.js";import{T as Ke}from"./index-58825fc2.js";import{T as Vt}from"./index-25adc23a.js";import{c as Mt,p as It,s as ua}from"./index-ebf0c672.js";import{c as At,r as Qe,s as da,_ as Be,b as _a}from"./index-643723b9.js";import{I as va,_ as ma}from"./index-8511ca2b.js";import{F as pa}from"./index-d9c5e50f.js";import{v as fa,a as ba,S as ya}from"./index-f213f7f7.js";import{u as ka}from"./index-db4db64e.js";import"./index-4b73aacf.js";import"./index-1ddc465b.js";import"./index-a905c6bd.js";const ha=["data-conf"],ga=l("p",{class:"ark-text_body-xs ark-text_semibold ark-space_bottom-1"}," Новое бронирование ",-1),$a={class:"ark-text_semibold"},Sa={class:"ark-text_body-xs ark-space_bottom-2"},wa={class:"ark-text_body-xs ark-text_64"},Oa={class:"ark-text_body-xs"},Ca=De({__name:"SelectedPreview",props:{vertical:{},horizontal:{},tables:{},time:{},conf:{type:Boolean}},setup(le){const ie=le,{vertical:h,horizontal:N,tables:R,time:Z}=je(ie),K=$e(st),z=_(()=>{const p=h.value;return p?p.start.time.toJSON():null}),j=_(()=>{const p=h.value;if(!p)return null;const y=p.end.time.valueOf(),V=new Date(y+be*15),q=new ee(Ne.fromLocalNativeDate(V),me.fromLocalNativeDate(V));return`${p.start.time.time.toString("HH:MM")} ${Ft} ${q.time.toString("HH:MM")}`}),Q=_(()=>{const p=N.value,y=R.value,V=Object.keys(y);if(!p)return[];const{start:q,end:H}=p,te=[];let ne=!1;for(let re=0;re<V.length;re++){const ae=y[V[re]];if(!ne&&ae.id===q.column&&(ne=!0),ne&&(te.push({id:ae.id,num:ae.number,zone:ae.zone,cap:ae.capacity}),ae.id===H.column))break}return te}),M=_(()=>Q.value.reduce((p,y)=>p+y.cap,0)),P=_(()=>{const p=h.value;if(!p)return null;const{start:y,end:V}=p,q=y.time.valueOf();let H=V.time.valueOf()+be*15;return H<q&&(H+=Et),me.fromAbsoluteMilliseconds(H-q)}),D=["час","часа","часов"],G=_(()=>{const p=P.value;if(!p)return"";const y=[];return p.hours!==0&&y.push(`${p.hours} ${Nt(D,p.hours)}`),p.minutes!==0&&y.push(`${p.minutes} мин`),y.join(Dt)}),E=_(()=>{const p=Q.value;if(!p[0])return[];const y=p[0].zone,V=[];p.every(ne=>ne.zone===y)||V.push("Столы из разных зон");const q=h.value,H=Z.value;q&&q.start.time.valueOf()<H.valueOf()&&V.push("Время начала в прошлом");const te=K.value;return q&&te&&q.start.time.valueOf()<new ee(q.start.time.day,me.fromString(te.opening_time)).valueOf()&&V.push("Время начала до открытия"),V});return(p,y)=>(n(),c("div",{class:i(p.$style.root),"data-conf":p.conf},[ga,z.value?(n(),ue(e(Ge),{key:0,today:"",mask:"[day:numeric] [month:long] [year:numeric]",class:"ark-text_body-xs",date:z.value},null,8,["date"])):U("",!0),l("p",$a,C(j.value),1),l("p",Sa,C(G.value),1),l("p",wa,[$(" Столы "),(n(!0),c(x,null,oe(Q.value,V=>(n(),c("span",{key:V.id,class:i(p.$style.table)},C(V.num),3))),128))]),l("p",Oa,[$(" На "),l("b",null,C(M.value)+" чел",1)]),E.value.length>0?(n(),c("div",{key:1,class:i(["ark-space_top-2",p.$style.notification])},[(n(!0),c(x,null,oe(E.value,V=>(n(),c("p",{key:V,class:i(p.$style.notification__text)},[r(e(Tt),{name:"warning",style:{color:"var(--supra-attention-color)"},size:12}),$(" "+C(V),1)],2))),128))],2)):U("",!0)],10,ha))}}),xa="_root_a4i85_1",za="_table_a4i85_13",Ta="_notification_a4i85_27",Na="_notification__text_a4i85_38",Da={root:xa,table:za,notification:Ta,notification__text:Na},Ea={$style:Da},Ut=Ve(Ca,[["__cssModules",Ea]]),La=["data-show-hidden"],Va={style:{position:"absolute","z-index":"-1",top:"40px",left:"-4px"}},Ma=["data-col","data-time"],Ia=["data-col","data-time"],Aa=["data-id","data-high","data-type","data-selection","data-airesto","onClick"],Ua=l("p",null,"Жду следующую",-1),xt=32,Ba=De({__name:"MobileTimesheet",props:{timeSegments:{},tables:{},data:{},highlight:{},count:{},addEnabled:{type:Boolean}},emits:["add","show"],setup(le,{emit:ie}){lt(s=>({"4c10f00f":X.value}));const h=le,N=ie,{timeSegments:R,data:Z,tables:K,count:z,addEnabled:j}=je(h),Q=$e(Lt);$e(ot);const M=I(128),P=I(null),D=I(null),G=I(!1),E=I(!1),p=I(null),y=_(()=>Q.value.native);let V=null;ve([P,z],([s],v,b)=>{if(b(()=>{V&&clearTimeout(V),V=null}),s){const S=Array.isArray(s)?s[0]:s;V=setTimeout(()=>{M.value=S.clientWidth})}},{immediate:!0});const q=_(()=>R.value.reduce((v,b)=>{const S=new Date(b.valueOf()+be*15),t=new ee(Ne.fromLocalNativeDate(S),me.fromLocalNativeDate(S)),m={a:b,b:t};return v.push(m),v},[])),H=_(()=>K.value.reduce((v,b,S)=>(v[b.id]=S,v),{})),te=_(()=>K.value.reduce((v,b)=>(v[b.id]=b,v),{})),ne=_(()=>{const s=p.value;if(!s)return null;const{start:v,end:b}=s,S=v.time.valueOf(),t=b.time.valueOf(),m=Math.abs(S-t)/(be*15);return v.time.valueOf()>b.time.valueOf()?{start:b,end:v,diff:m}:{start:v,end:b,diff:m}}),re=_(()=>{const s=p.value;if(!s)return null;const{start:v,end:b}=s,S=H.value,t=S[v.column],m=S[b.column],u=Math.abs(t-m);return t<m?{start:v,end:b,diff:u}:{start:b,end:v,diff:u}}),ae=_(()=>{const s=re.value;return s?`${(s.diff+1)*M.value}px`:"0px"}),Se=_(()=>{const s=ne.value;return s?`${(s.diff+1)*(xt/2)}px`:"0px"}),Ee=_(()=>{const s=re.value,v=H.value;return s?`${v[s.start.column]*M.value}px`:"0px"}),we=_(()=>{const s=q.value[0],v=ne.value;return!s||!v?"0px":`${(v.start.time.valueOf()-s.a.valueOf())/(be*15)*(xt/2)+42}px`}),Oe=_(()=>{const s=ae.value,v=Se.value,b=Ee.value,S=we.value;return{left:b,width:s,height:v,top:S}}),pe=_(()=>j.value&&!!p.value),de=_(()=>{const s=R.value;if(s.length===0)return[-1/0,1/0];const v=s[0].toLocalNativeDate().valueOf(),b=s[s.length-1];let S=b.day;b.time.valueOf()>b.time.shift({minutes:30}).valueOf()&&(S=S.append({day:1}));const t=new ee(S,b.time.shift({minutes:30})).toLocalNativeDate().valueOf();return[v,t]}),X=_(()=>{const s=y.value.valueOf(),[v,b]=de.value;return`${Mt(s,v,b).toFixed(2)}%`}),f=_(()=>{const s=Z.value,[v,b]=de.value;return It(s,v,b)}),k=()=>{E.value=!1,p.value=null,G.value=!1},L=()=>{const s=re.value,v=ne.value,b=te.value;if(!s||!v)return;const S=new Date(v.end.time.valueOf()+be*15),t=new ee(Ne.fromLocalNativeDate(S),me.fromLocalNativeDate(S)),m={...v,end:{...v.end,time:t}};N("add",{horizontal:s,vertical:m,tables:b}),p.value=null,E.value=!1};let B=null;const F=()=>{B&&clearTimeout(B),B=null},se=s=>{if(F(),!j.value)return;const v=s.target,b=v.getAttribute("data-col"),S=v.getAttribute("data-time");!b||!S||G.value||(B=setTimeout(()=>{const t={column:b,time:ee.fromString(S)};p.value={start:t,end:t},E.value=!1,G.value=!0},500))},T=s=>{if(G.value){F();const v=s.target,b=v.getAttribute("data-col"),S=v.getAttribute("data-time");if(!b||!S)return;s.preventDefault(),s.stopPropagation();const t={column:b,time:ee.fromString(S)};p.value={...p.value,end:t},G.value=!1,E.value=!0}};return ve(j,(s,v,b)=>{b(()=>{document.removeEventListener("pointerup",F),document.removeEventListener("pointercancel",F)}),s&&(document.addEventListener("pointerup",F),document.addEventListener("pointercancel",F))},{immediate:!0}),(s,v)=>(n(),c("div",{ref_key:"timesheetRef",ref:D,class:i(s.$style.timesheet),"data-show-hidden":G.value},[l("div",Va,[(n(!0),c(x,null,oe(q.value,(b,S)=>(n(),c("p",{key:S,class:i(s.$style.time)},C(b.a.time),3))),128))]),(n(!0),c(x,null,oe(e(K),(b,S)=>(n(),c("div",{key:b.id},[l("div",{class:i(s.$style.label)},[l("div",{class:i(s.$style.label__content)},[S===0?(n(),c("div",{key:0,ref_for:!0,ref_key:"columnRef",ref:P},null,512)):U("",!0),Xe(s.$slots,"xlabel",{item:b})],2)],2),l("div",{class:i(s.$style.content),onContextmenu:v[0]||(v[0]=nt(()=>{},["prevent"])),onPointerdown:se,onClick:T},[(n(!0),c(x,null,oe(q.value,(t,m)=>(n(),c("div",{key:m,class:i(s.$style.cell)},[l("p",{"data-col":b.id,"data-time":t.a,class:i(s.$style.cell__book)},C(t.a.time),11,Ma),l("p",{"data-col":b.id,"data-time":t.b,class:i(s.$style.cell__book)},C(t.b.time),11,Ia)],2))),128)),(n(!0),c(x,null,oe(f.value[S],(t,m)=>(n(),c("div",{key:`${S}_${m}`,class:i(s.$style.bubble),style:et(t.style),"data-id":t.original.full.id,"data-high":`${t.original.full.id}`===s.highlight,"data-type":t.original.type,"data-selection":pe.value,"data-airesto":t.original.airesto,onClick:u=>N("show",t.original)},[l("div",{class:i(s.$style.bubble__content)},[Xe(s.$slots,"default",{item:t.original})],2)],14,Aa))),128))],34)]))),128)),pe.value?(n(),c("div",{key:0,class:i(s.$style.selection),style:et(Oe.value)},[G.value?(n(),c("div",{key:1,class:i(["ark-text_body-xs",s.$style.dblclick])},[Ua,l("div",{class:i(s.$style.dblclick__btn)},[r(e(W),{"icon-button":"",size:"xs",appearance:"flat",icon:"close",onClick:k})],2)],2)):(n(),ue(Ut,{key:0,vertical:ne.value,horizontal:re.value,tables:te.value,time:y.value,conf:!!E.value},null,8,["vertical","horizontal","tables","time","conf"])),E.value?(n(),c("div",{key:2,class:i(s.$style.selection__btn)},[r(e(W),{size:"xs",style:{background:"var(--supra-accent)"},onClick:L},{default:g(()=>[$(" Создать ")]),_:1}),r(e(W),{size:"xs",appearance:"neutral",class:"ark-space_top-2",onClick:k},{default:g(()=>[$(" Отменить ")]),_:1})],2)):U("",!0)],6)):U("",!0)],10,La))}}),Pa="_timesheet_h4yv9_1",Ra="_time_h4yv9_1",ja="_label_h4yv9_23",qa="_label__content_h4yv9_36",Ha="_cell_h4yv9_43",Fa="_cell__book_h4yv9_60",Ja="_content_h4yv9_75",Wa="_bubble_h4yv9_80",Za="_bubble__content_h4yv9_138",Ka="_slide_h4yv9_150",Ga="_selection_h4yv9_168",Ya="_selection__btn_h4yv9_181",Qa="_dblclick_h4yv9_195",Xa="_dblclick__btn_h4yv9_200",es={timesheet:Pa,time:Ra,label:ja,label__content:qa,cell:Ha,cell__book:Fa,content:Ja,bubble:Wa,bubble__content:Za,slide:Ka,selection:Ga,selection__btn:Ya,dblclick:Qa,dblclick__btn:Xa},ts={$style:es},as=Ve(Ba,[["__cssModules",ts]]),ss={style:{isolation:"isolate"}},ls=["data-show-hidden"],ns=["data-col","data-time","onPointerdown"],os=["data-col","data-time","onPointerdown"],is=["data-id","data-high","data-type","data-selection","data-airesto","onClick"],rs=l("p",null,"Жду следующую",-1),cs=l("p",null,"Масштаб",-1),us=De({__name:"Timesheet",props:{timeSegments:{},tables:{},data:{},highlight:{},mode:{},addEnabled:{type:Boolean},size:{}},emits:["add","show","update:size"],setup(le,{emit:ie}){lt(t=>({"2c6603b1":E.value,"47e65b6a":f.value,"8a911708":k.value}));const h=le,N=ie,{timeSegments:R,data:Z,tables:K,mode:z,addEnabled:j,size:Q}=je(h),M=$e(Lt),P=_(()=>Q.value*32),D=_(()=>P.value),G=_(()=>D.value/2),E=_(()=>`${P.value}px`),p=I(null),y=I(!1),V=_(()=>R.value.reduce((m,u)=>{const O=new Date(u.valueOf()+be*15),w=new ee(Ne.fromLocalNativeDate(O),me.fromLocalNativeDate(O)),J={a:u,b:w};return m.push(J),m},[])),q=_(()=>K.value.reduce((m,u,O)=>(m[u.id]=O,m),{})),H=_(()=>K.value.reduce((m,u)=>(m[u.id]=u,m),{})),te=_(()=>{const t=p.value;if(!t)return null;const{start:m,end:u}=t,O=m.time.valueOf(),w=u.time.valueOf(),J=Math.abs(O-w)/(be*15);return m.time.valueOf()>u.time.valueOf()?{start:u,end:m,diff:J}:{start:m,end:u,diff:J}}),ne=_(()=>{const t=p.value;if(!t)return null;const{start:m,end:u}=t,O=q.value,w=O[m.column],J=O[u.column],ye=Math.abs(w-J);return w<J?{start:m,end:u,diff:ye}:{start:u,end:m,diff:ye}}),re=_(()=>{const t=ne.value;return t?`${(t.diff+1)*D.value}px`:"0px"}),ae=_(()=>{const t=te.value;return t?`${(t.diff+1)*(G.value/2)}px`:"0px"}),Se=_(()=>{const t=ne.value,m=q.value;return t?`${m[t.start.column]*D.value}px`:"0px"}),Ee=_(()=>{const t=V.value[0],m=te.value;return!t||!m?"0px":`${(m.start.time.valueOf()-t.a.valueOf())/(be*15)*(G.value/2)}px`}),we=_(()=>{const t=re.value,m=ae.value,u=Se.value,O=Ee.value;return{left:u,width:t,height:m,top:O}}),Oe=_(()=>j.value&&!!p.value),pe=_(()=>z.value==="selection"&&!!p.value&&!y.value),de=_(()=>{const t=R.value;if(t.length===0)return[-1/0,1/0];const m=t[0].toLocalNativeDate().valueOf(),u=t[t.length-1];let O=u.day;u.time.valueOf()>u.time.shift({minutes:30}).valueOf()&&(O=O.append({day:1}));const w=new ee(O,u.time.shift({minutes:30})).toLocalNativeDate().valueOf();return[m,w]}),X=_(()=>M.value.native),f=_(()=>{const t=X.value.valueOf(),[m,u]=de.value;return`${Mt(t,m,u).toFixed(2)}%`}),k=_(()=>`${Z.value.length*100}%`),L=_(()=>{const t=Z.value,[m,u]=de.value;return It(t,m,u)}),B=t=>{N("update:size",at(h.size+t,1,6))},F=()=>{const t=ne.value,m=te.value,u=H.value;if(!t||!m)return;const O=new Date(m.end.time.valueOf()+be*15),w=new ee(Ne.fromLocalNativeDate(O),me.fromLocalNativeDate(O)),J={...m,end:{...m.end,time:w}};N("add",{horizontal:t,vertical:J,tables:u}),p.value=null,y.value=!1},se=t=>{t.animationName==="arkVibe"&&t.target&&t.target.classList.remove("ark-vibe")},T=I(!1),s=()=>{y.value=!1,p.value=null,T.value=!1},v=(t,{id:m},u)=>{if(z.value!=="selection"||!j.value)return;const O={column:m,time:u};y.value=!1,p.value={start:O,end:O}},b=t=>{const m=t.target,u=m.getAttribute("data-col"),O=m.getAttribute("data-time"),w=p.value;if(!u||!O||!w||w.end.time.toString()===O&&w.end.column===u)return;const J={column:u,time:ee.fromString(O)};p.value={...w,end:J}},S=()=>{y.value=!0};return ve(pe,(t,m,u)=>{u(()=>{document.removeEventListener("pointermove",b),document.removeEventListener("pointerup",S),document.removeEventListener("pointercancel",S)}),t&&(document.addEventListener("pointermove",b),document.addEventListener("pointerup",S),document.addEventListener("pointercancel",S))},{immediate:!0}),(t,m)=>(n(),c("div",ss,[l("div",{class:i([t.$style.root,t.$style.top])},[l("div",{class:i([t.$style.labelCell,t.$style.labelCell_hidden])},[(n(!0),c(x,null,oe(e(R),(u,O)=>(n(),c("p",{key:O},C(u.time),1))),128))],2),(n(!0),c(x,null,oe(e(K),(u,O)=>(n(),c("div",{key:O,class:i([t.$style.col,t.$style.col_tobottom])},[l("div",{class:i(t.$style.colLabel)},[Xe(t.$slots,"xlabel",{item:u},()=>[$(C(u),1)])],2)],2))),128))],2),l("div",{class:i(t.$style.root),"data-show-hidden":T.value},[l("div",{class:i(t.$style.sticky)},[(n(!0),c(x,null,oe(e(R),(u,O)=>(n(),c("div",{key:O,class:i(t.$style.labelCell)},C(u.time),3))),128))],2),(n(!0),c(x,null,oe(e(K),(u,O)=>(n(),c("div",{key:O,class:i([t.$style.col,O===0&&t.$style.col_first])},[(n(!0),c(x,null,oe(V.value,(w,J)=>(n(),c("div",{key:J,class:i(t.$style.cell)},[l("p",{"data-col":u.id,"data-time":w.a,class:i(t.$style.cell__book),onPointerdown:ye=>v(ye,u,w.a)},[l("span",{class:i(t.$style.cell__book__text)},C(w.a.time),3)],42,ns),l("p",{"data-col":u.id,"data-time":w.b,class:i(t.$style.cell__book),onPointerdown:ye=>v(ye,u,w.b)},[l("span",{class:i(t.$style.cell__book__text)},C(w.b.time),3)],42,os)],2))),128)),(n(!0),c(x,null,oe(L.value[O],(w,J)=>(n(),c("div",{key:`${O}_${J}`,class:i(t.$style.bubble),style:et(w.style),"data-id":w.original.full.id,"data-high":`${w.original.full.id}`===t.highlight,"data-type":w.original.type,"data-selection":Oe.value,"data-airesto":w.original.airesto,onClick:ye=>N("show",w.original),onAnimationend:se},[l("div",{class:i(t.$style.bubble__content)},[Xe(t.$slots,"default",{item:w.original})],2)],46,is))),128))],2))),128)),Oe.value?(n(),c("div",{key:0,class:i(t.$style.selection),style:et(we.value)},[T.value?(n(),c("div",{key:1,class:i(["ark-text_body-xs",t.$style.dblclick])},[rs,l("div",{class:i(t.$style.dblclick__btn)},[r(e(W),{"icon-button":"",size:"xs",appearance:"flat",icon:"close",onClick:s})],2)],2)):(n(),ue(Ut,{key:0,vertical:te.value,horizontal:ne.value,tables:H.value,time:X.value,conf:y.value},null,8,["vertical","horizontal","tables","time","conf"])),y.value?(n(),c("div",{key:2,class:i(t.$style.selection__btn)},[r(e(W),{size:"xs",style:{background:"var(--supra-accent)"},onClick:F},{default:g(()=>[$(" Создать ")]),_:1}),r(e(W),{size:"xs",appearance:"neutral",class:"ark-space_top-2",onClick:s},{default:g(()=>[$(" Отменить ")]),_:1})],2)):U("",!0)],6)):U("",!0)],10,ls),l("div",{class:i(t.$style.fixed),onClick:s},[Oe.value?(n(),ue(e(W),{key:0,appearance:"accent",size:"s"},{default:g(()=>[$(" Отменить создание ")]),_:1})):U("",!0),l("div",{class:i(["ark-space_left-auto",t.$style.size])},[cs,r(e(W),{"icon-button":"",appearance:"flat",size:"xs",icon:"minus",onClick:m[0]||(m[0]=u=>B(-.5))}),r(e(W),{"icon-button":"",appearance:"flat",size:"xs",icon:"plus",onClick:m[1]||(m[1]=u=>B(.5))})],2)],2)]))}}),ds="_root_1v97l_1",_s="_col_1v97l_14",vs="_col_first_1v97l_22",ms="_col_tobottom_1v97l_34",ps="_labelCell_1v97l_40",fs="_labelCell_hidden_1v97l_48",bs="_cell_1v97l_57",ys="_cell__book_1v97l_67",ks="_cell__book__text_1v97l_75",hs="_selection_1v97l_84",gs="_selection__btn_1v97l_97",$s="_colLabel_1v97l_111",Ss="_bubble_1v97l_117",ws="_bubble__content_1v97l_178",Os="_top_1v97l_196",Cs="_sticky_1v97l_203",xs="_size_1v97l_209",zs="_dblclick_1v97l_219",Ts="_dblclick__btn_1v97l_224",Ns="_fixed_1v97l_231",Ds={root:ds,col:_s,col_first:vs,col_tobottom:ms,labelCell:ps,labelCell_hidden:fs,cell:bs,cell__book:ys,cell__book__text:ks,selection:hs,selection__btn:gs,colLabel:$s,bubble:Ss,bubble__content:ws,top:Os,sticky:Cs,size:xs,dblclick:zs,dblclick__btn:Ts,fixed:Ns},Es={$style:Ds},Ls=Ve(us,[["__cssModules",Es]]);function Vs(le){le.dispatchEvent(new CustomEvent(Jt,{detail:le,bubbles:!0}))}const Ms={mounted:Vs},Is=l("h6",{class:"ark-text_h6 ark-space_bottom-3"},"Новое бронирование",-1),As=l("p",{class:"ark-text_body-s ark-text_64"},"Дата",-1),Us={class:"ark-space_bottom-4"},Bs=l("p",{class:"ark-text_body-s ark-text_64"},"Время начала",-1),Ps=["data-warning"],Rs=l("span",{class:"ark-space_top-4"},"—",-1),js=l("p",{class:"ark-text_body-s ark-text_64"},"Время конца брони",-1),qs=["data-warning"],Hs={class:"ark-text_body-xs ark-space_top-1 ark-space_bottom-1 ark-text_64"},Fs={class:"ark-text_semibold"},Js=l("p",{class:"ark-space_top-2"},[$(" Столы "),l("span",{class:"ark-text_body-xs ark-text_64"}," (можешь добавить нужный или убрать все) ")],-1),Ws=["data-active","onClick"],Zs={class:"ark-text_body-xs ark-space_top-1 ark-space_bottom-4 ark-text_64"},Ks={class:"ark-text_semibold"},Gs=l("p",{class:"ark-text_body-l ark-text_semibold ark-space_bottom-2"}," Контактные данные ",-1),Ys=De({__name:"BookingWithTables",props:{item:{},restaurant:{}},emits:["close","add"],setup(le,{emit:ie}){const h=le,N=ie,{item:R,restaurant:Z}=je(h),K=it(),z=rt();class j{constructor(k,L){this.label=k,this.time_ms=L}toString(){return this.label}}const Q=[new j("До след брони",-1),new j("на 2ч",Je*2),new j("на 2ч 30м",Je*2+be*30),new j("на 3ч",Je*3),new j("на 4ч",Je*4)],M=At({count:[2,{required:Qe}],name:["",{required:Qe}],phone:["",{required:Qe,phone:da(!0)}],comment:[""]}),P=$e(st),D=$e(Zt),G=M.count.value,E=Ye({}),p=I(!1),y=I(h.item),V=_(()=>{var L;const f=(L=P.value)==null?void 0:L.timezone,k=new Date(new Date().toLocaleString("en",{timeZone:f})).toISOString();return ee.jsonParse(k)}),q=_(()=>{const f=y.value.horizontal;return f?f.start.column:null}),H=_(()=>Object.keys(E).filter(f=>E[f]).length>0),te=_(()=>{const f=y.value.tables;return Object.keys(E).reduce((k,L)=>k+(E[L]?f[L].capacity:0),0)}),ne=_(()=>te.value<G.value&&H.value?{capacity:"Столы не вмещают всех"}:null),re=_(()=>{const f=y.value.vertical;if(!f)return null;const{start:k,end:L}=f,B=k.time.valueOf();let F=L.time.valueOf();return F<B&&(F+=Et),me.fromAbsoluteMilliseconds(F-B)}),ae=_(()=>{const f=re.value;return f&&f.hours===0&&f.minutes===15}),Se=["час","часа","часов"],Ee=_(()=>{const f=re.value;if(!f)return"";const k=[];return f.hours!==0&&k.push(`${f.hours} ${Nt(Se,f.hours)}`),f.minutes!==0&&k.push(`${f.minutes} мин`),k.join(Dt)}),we=f=>{const k=y.value;if(f.time_ms===-1){const L=k.vertical.start.time.valueOf(),B=Object.keys(E).reduce((s,v)=>(E[v]&&k.tables[v]&&k.tables[v].reservations.forEach(S=>{const[t,m]=S.seating_time.split("T"),u=new ee(Ne.jsonParse(t),me.fromString(m)).valueOf();u>L&&s.push(u)}),s),[]);if(B.length===0)return;const F=Math.min(...B),se=new Date(F),T=new ee(Ne.fromLocalNativeDate(se),me.fromLocalNativeDate(se));y.value={...k,vertical:{...k.vertical,end:{...k.vertical.end,time:T}}}}else{const L=new Date(k.vertical.start.time.valueOf()+f.time_ms),B=new ee(Ne.fromLocalNativeDate(L),me.fromLocalNativeDate(L));y.value={...k,vertical:{...k.vertical,end:{...k.vertical.end,time:B}}}}},Oe=f=>{const k=y.value;y.value={...k,vertical:{...k.vertical,start:{...k.vertical.start,time:f}}}},pe=f=>{const k=y.value;y.value={...k,vertical:{...k.vertical,end:{...k.vertical.end,time:f}}}},de=({day:f,time:k})=>`${f.toJSON()} ${k.toString("HH:MM")}`,X=()=>{if(M.validate(),M.invalid.value)return;const{start:f,end:k}=y.value.vertical,{phone:L,name:B,count:F,comment:se}=M.getCurrentValue(),T=Object.keys(E).filter(s=>E[s]);p.value=!0,K.createBooking.execute({restaurant:Number(Z.value),tables:T.length===0?void 0:T,num_people:F,name_for_reservation:B,phone_number:`+${Kt(L)}`,comment:se,seating_time:de(f.time),end_time:de(k.time)}).then(s=>{s&&(z.show(Gt(ya),{autoClose:15e3,data:{...s,allTables:D.value,__newbooking:!0}}),N("add",s),N("close"))}).catch(([s])=>{z.show(s.error??"Не удалось создать бронь",{type:"error",label:"Ошибка"})}).finally(()=>{p.value=!1})};return ve(R,f=>{const k=f.horizontal,L=f.tables,B=Object.keys(L);if(y.value=f,k){const{start:F,end:se}=k;let T=!1;for(let s=0;s<B.length;s++){const v=L[B[s]];if(!T&&v.id===F.column&&(T=!0),T&&(E[v.id]=!0,v.id===se.column))break}}M.count.setValue(te.value)},{immediate:!0}),(f,k)=>{var L,B,F,se;return n(),c(x,null,[Is,As,l("div",{class:i(["ark-space_bottom-2",f.$style.inline])},[r(e(Ae),{name:"calendar",size:16}),r(e(Ge),{today:"",mask:"[day:numeric] [month:long] [year:numeric], [weekday:long]",date:y.value.vertical.start.time.toJSON()},null,8,["date"])],2),l("div",Us,[l("div",{class:i(f.$style.time)},[l("div",{class:i(f.$style.time__item)},[Bs,l("button",{type:"button",class:i(f.$style.time__content),"data-warning":ae.value},[l("div",{class:i(f.$style.inline)},[r(e(Ae),{name:"clock",size:16}),r(e(Ge),{mask:"с [hour:numeric]:[minute:numeric]",date:y.value.vertical.start.time.toJSON()},null,8,["date"]),l("span",null," ‐ "+C(y.value.vertical.start.time.time.shift({minutes:15})),1)],2),r(e(Ae),{name:"arrow-right",size:16}),r(e(kt),{"model-value":y.value.vertical.start.time,class:i(f.$style.selectTime),start:(L=e(P))==null?void 0:L.opening_time,end:(B=e(P))==null?void 0:B.closing_time,day:y.value.horizontal.start.time.day,min:V.value,"onUpdate:modelValue":Oe},null,8,["model-value","class","start","end","day","min"])],10,Ps)],2),Rs,l("div",{class:i(f.$style.time__item)},[js,l("button",{type:"button",class:i(f.$style.time__content),"data-warning":ae.value},[l("div",{class:i(f.$style.inline)},[r(e(Ae),{name:"clock",size:16}),r(e(Ge),{mask:"до [hour:numeric]:[minute:numeric]",date:y.value.vertical.end.time.toJSON()},null,8,["date"])],2),r(e(Ae),{name:"arrow-right",size:16}),r(e(kt),{"model-value":y.value.vertical.end.time,class:i(f.$style.selectTime),start:(F=e(P))==null?void 0:F.opening_time,day:y.value.horizontal.start.time.day,end:(se=e(P))==null?void 0:se.closing_time,min:y.value.horizontal.start.time,"onUpdate:modelValue":pe},null,8,["model-value","class","start","day","end","min"])],10,qs)],2)],2),ae.value?(n(),c("span",{key:0,class:i(["ark-text_body-xs ark-text_semibold",f.$style.error])},[r(e(Ae),{name:"warning",size:16}),$(" Слишком мальнькая длительность ")],2)):U("",!0),l("p",Hs,[$(" Длительность "),l("span",Fs,C(Ee.value),1)]),l("div",{class:i(f.$style.buttons)},[(n(),c(x,null,oe(Q,T=>r(e(W),{key:T.label,appearance:"neutral",size:"xs",onClick:s=>we(T)},{default:g(()=>[$(C(T),1)]),_:2},1032,["onClick"])),64))],2)]),Js,r(e(Wt),null,{default:g(()=>[ht((n(),c("div",{class:i(["ark-space_bottom-1",f.$style.tables])},[(n(!0),c(x,null,oe(e(R).tables,(T,s)=>ht((n(),c("button",{key:s,type:"button",class:i(f.$style.tables__item),"data-active":E[s],onClick:v=>E[s]=!E[s]},[r(e(Vt),{item:T},null,8,["item"])],10,Ws)),[[e(ba),q.value===s]])),128))],2)),[[e(pa)],[e(Ms)],[e(fa)]])]),_:1}),l("p",Zs,[H.value?(n(),c(x,{key:0},[$(" Вместимость "),l("span",Ks,C(te.value)+" чел",1)],64)):(n(),c(x,{key:1},[$(" Столы определим сами ")],64))]),Gs,l("form",{onSubmit:nt(X,["prevent"])},[r(e(Be),{class:"ark-space_bottom-3",control:e(M).name},{default:g(({model:T})=>[r(e(gt),{modelValue:T.value,"onUpdate:modelValue":s=>T.value=s,required:"",label:"На чье имя","has-cleaner":!1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),r(e(Be),{class:"ark-space_bottom-3",control:e(M).count},{default:g(({model:T})=>[r(e(va),{modelValue:T.value,"onUpdate:modelValue":s=>T.value=s,required:"",label:"Кол-во человек",min:1,"has-cleaner":!1},null,8,["modelValue","onUpdate:modelValue"]),r(e(_a),{error:ne.value},null,8,["error"])]),_:1},8,["control"]),r(e(Be),{class:"ark-space_bottom-3",control:e(M).phone},{default:g(({model:T})=>[r(e(ma),{modelValue:T.value,"onUpdate:modelValue":s=>T.value=s,required:"",label:"Номер телефона","has-cleaner":!1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),r(e(Be),{class:"ark-space_bottom-6",control:e(M).comment},{default:g(({model:T})=>[r(e(gt),{modelValue:T.value,"onUpdate:modelValue":s=>T.value=s,label:"Комментарий","has-cleaner":!1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),l("div",{class:i(f.$style.actions)},[r(e(W),{type:"submit",loading:p.value},{default:g(()=>[$("Создать")]),_:1},8,["loading"]),r(e(W),{appearance:"neutral",type:"button",onClick:k[0]||(k[0]=T=>N("close"))},{default:g(()=>[$(" Отменить ")]),_:1})],2)],32)],64)}}}),Qs="_actions_1yu47_1",Xs="_time_1yu47_10",el="_time__item_1yu47_15",tl="_time__content_1yu47_18",al="_inline_1yu47_55",sl="_buttons_1yu47_63",ll="_tables_1yu47_69",nl="_tables__item_1yu47_83",ol="_selectTime_1yu47_115",il="_error_1yu47_124",rl={actions:Qs,time:Xs,time__item:el,time__content:tl,inline:al,buttons:sl,tables:ll,tables__item:nl,selectTime:ol,error:il},cl={$style:rl},ul=Ve(Ys,[["__cssModules",cl]]),dl=["data-cancelled"],_l={class:"ark-text_semibold"},vl=De({__name:"BubblePreview",props:{item:{}},setup(le){const ie=le,{item:h}=je(ie),N=_(()=>{const z=h.value;return`${z.start.time.toString("HH:MM")}-${z.end.time.toString("HH:MM")}`}),R=_(()=>{const j=h.value.full.phone_number;return j?j.slice(j.length-4):""}),Z=_(()=>{const z=h.value.full;switch(z.status){case ge.APPLICATION:case ge.CANCELLED:case ge.CANCELLED_NO_DEPOSIT:case ge.CLOSED:case ge.NEW:case ge.OPEN:case ge.WAITING:return""}return z.status}),K=_(()=>{const z=h.value.full;return z.status===ge.CANCELLED||z.status===ge.CANCELLED_NO_DEPOSIT});return(z,j)=>(n(),c("div",{class:i(z.$style.preview),"data-cancelled":K.value},[e(h).type==="reservation"?(n(),c(x,{key:0},[l("div",null,[l("p",{class:i(["ark-space_right-1",z.$style.id])},"№"+C(e(h).full.id),3),l("span",{class:i(z.$style.bold)},C(e(h).full.name_for_reservation),3),l("span",{class:i(z.$style.bold)},C(e(h).full.num_people),3),l("span",null,C(Z.value),1)]),e(h).airesto?(n(),ue(e(Yt),{key:0,size:"xs",end_time:e(h).full.end_time,seating_time:e(h).full.seating_time,status:e(h).full.status},null,8,["end_time","seating_time","status"])):U("",!0),e(h).full.phone_number?(n(),c("p",{key:1,class:i(z.$style.phone)},[r(e(Qt),{name:"phone",class:i(z.$style.phone)},null,8,["class"]),$(" "+C(R.value),1)],2)):U("",!0),l("p",null,C(N.value),1)],64)):(n(),c(x,{key:1},[l("p",_l,[e(h).full.status!=="Banquet"?(n(),c(x,{key:0},[$(" Заказ ")],64)):U("",!0),r(e(ra),{class:i(z.$style.status),status:e(h).full.status},null,8,["class","status"])]),l("p",null,C(N.value),1)],64))],10,dl))}}),ml="_id_f0ecp_2",pl="_preview_f0ecp_7",fl="_phone_f0ecp_15",bl="_bold_f0ecp_19",yl="_status_f0ecp_32",kl={id:ml,preview:pl,phone:fl,bold:bl,status:yl},hl={$style:kl},zt=Ve(vl,[["__cssModules",hl]]);function gl(le,ie){const h=document.createElement("a");h.download=le,h.href=ie,h.click()}const $l=l("h6",{class:"ark-text_h6 ark-space_bottom-6"},"Выгрузка бронирований",-1),Sl={key:0,class:"ark-text_body-xs ark-text_64"},wl={key:0,class:"ark-text_body-s ark-space_bottom-4"},Ol=["download","href"],Cl=De({__name:"DownloadContacts",props:{id:{},defaultDay:{}},setup(le){const ie=le,h=At({start:[ie.defaultDay,{required:Qe}],end:[null]}),N=it(),R=rt(),Z=$e(ot),K=I(!1),z=I(null),j=()=>{if(h.validate(),h.invalid.value)return;const{start:Q,end:M}=h.getCurrentValue();K.value=!0,N.guestsContactsExport({restaurant_id:ie.id,start_date:Q.toJSON(),end_start:M==null?void 0:M.toJSON()}).then(P=>{var p;const D=window.URL.createObjectURL(P),E=Q.daySame(M||Z.value.day)?`Брони_гостей_за_${Q.toString()}.xlsx`:`Брони_гостей_с_${Q.toString()}_до_${(p=M||Z.value.day)==null?void 0:p.toString()}.xlsx`;z.value={name:E,url:D},gl(E,D)}).catch(()=>{R.show("Не удалось скачать выгрузку",{type:"error"})}).finally(()=>{K.value=!1})};return(Q,M)=>(n(),c(x,null,[$l,l("form",{onSubmit:nt(j,["prevent"])},[r(e(Be),{class:"ark-space_bottom-3",control:e(h).start},{default:g(({model:P})=>[r(e(Ct),{modelValue:P.value,"onUpdate:modelValue":D=>P.value=D,required:"",size:"l",label:"Дата начала","has-cleaner":!1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),r(e(Be),{class:"ark-space_bottom-4",control:e(h).end},{default:g(({model:P})=>{var D;return[r(e(Ct),{modelValue:P.value,"onUpdate:modelValue":G=>P.value=G,size:"l",label:"Дата окончания",class:"ark-space_bottom-1","has-cleaner":!1},null,8,["modelValue","onUpdate:modelValue"]),P.value?U("",!0):(n(),c("p",Sl," По умолчанию текущая дата - "+C((D=e(Z))==null?void 0:D.day),1))]}),_:1},8,["control"]),z.value?(n(),c("div",wl,[$(" Если загрузка не началась автоматически, нажмите сюда "),l("a",{download:z.value.name,href:z.value.url},C(z.value.name),9,Ol)])):U("",!0),r(e(W),{type:"submit",size:"l",style:{width:"100%"},loading:K.value},{default:g(()=>[$(" Выгрузить ")]),_:1},8,["loading"])],32)],64))}}),xl="/img/selection.gif",zl="/img/2clicks.gif",Tl=l("h6",{class:"ark-text_h6 ark-space_bottom-3"}," Как выбирать столы для бронирования ",-1),Nl=l("div",null,[l("p",{class:"ark-text_semibold"},"Выделение"),l("p",{class:"ark-text_body-s"},"Только для компьютеров")],-1),Dl=l("div",null,[l("p",{class:"ark-text_semibold"},"Удержание"),l("p",{class:"ark-text_body-s"},"Для телефонов и планшетов")],-1),El=De({__name:"SelectionModeExplan",props:{mode:{}},emits:["update:mode"],setup(le,{emit:ie}){const h=ie,N=Xt();return(R,Z)=>(n(),c(x,null,[Tl,e(N)?U("",!0):(n(),c(x,{key:0},[r(e(Ue),{style:{display:"inline-flex"}},{default:g(()=>[r(e($t),{class:"ark-space_right-2",style:{"align-self":"flex-start"},"model-value":R.mode==="selection","onUpdate:modelValue":Z[0]||(Z[0]=K=>h("update:mode","selection"))},null,8,["model-value"]),Nl]),_:1}),l("img",{src:xl,width:"200px",height:"177",class:i(["ark-space_bottom-4",R.$style.gif])},null,2)],64)),r(e(Ue),{style:{display:"inline-flex"}},{default:g(()=>[r(e($t),{class:"ark-space_right-2",style:{"align-self":"flex-start"},"model-value":R.mode==="click","onUpdate:modelValue":Z[1]||(Z[1]=K=>h("update:mode","click"))},null,8,["model-value"]),Dl]),_:1}),l("img",{src:zl,class:i(R.$style.gif)},null,2)],64))}}),Ll="_gif_ncrcy_1",Vl={gif:Ll},Ml={$style:Vl},Il=Ve(El,[["__cssModules",Ml]]),Al={key:0},Ul=l("p",{class:"ark-text_body-s ark-text_medium ark-text_64"},"Когда",-1),Bl=["data-active","onClick"],Pl=["data-active"],Rl=l("p",null,"Как выбирать столы?",-1),jl={class:"ark-text_semibold"},ql=l("p",{class:"ark-text_body-xs ark-text_semibold ark-text_64"}," Shift + колесико мышки для скролла по горизонтали ",-1),Hl=l("p",{class:"ark-text_body-s ark-text_medium ark-text_64"},"Отображаемые зоны",-1),Fl=["data-active","onClick"],Jl=["data-tablebar"],Wl={key:1,class:"ark-text_body-xs"},Zl=l("h6",{class:"ark-text_h6"},"Настройки таблицы",-1),Kl=l("p",{class:"ark-text_body-xs ark-space_bottom-2 ark-text_64"}," Эти настройки только для вас ",-1),Gl={class:"ark-space_bottom-4"},Yl={class:"ark-space_bottom-4"},Ql={class:"ark-space_bottom-4"},Xl=De({__name:"Booking",props:{id:{}},setup(le){lt(a=>({"665dc410":se.value}));const ie={Banquet:"Банкеты",Bill:"Пречек",Closed:"Закрытые",Deleted:"Удаленные",New:"Новые"},h=tt,N=le,R=ea(),Z=it(),K=rt(),z=sa(),j=la(),Q=ka(),{reservationToShow:M,navItems:P,tableDate:D,tableSlots:G}=ta(Q),E=I(!1),p=I(!1),y=I(null),V=I(!1),q=I(!1),H=I(!1),te=localStorage.getItem("__ark-supra-timesheet-size"),ne=Number.isNaN(te)?4:at(Number(te),1,6),re=I(ne);ve(re,a=>{localStorage.setItem("__ark-supra-timesheet-size",`${a}`)});const ae=I(null),Se=$e(ot),Ee=_(()=>{const a=D.value,o=Se.value.daytime;return o.day.daySame(a)?"Сегодня":o.day.append({day:1}).daySame(a)?"Завтра":a}),we=localStorage.getItem("__ark-supra-selection-mode"),Oe=aa()==="web"?we==="selection"||we==="click"?we:"selection":"click",pe=I(Oe),de=I(!1);ve(pe,a=>{localStorage.setItem("__ark-supra-selection-mode",a)});const X=$e(st),f=$e(oa),k=localStorage.getItem(`__ark-supra-empty-tables-state_${N.id}`),L=I(!k||k==="1");ve(L,a=>{localStorage.setItem(`__ark-supra-empty-tables-state_${N.id}`,a?"1":"0")});function B(a){return typeof a!="string"||!a||Number.isNaN(Number(a))?3:Number(a)}const F=B(localStorage.getItem(`__ark-supra-mobile-tables-count-state_${N.id}`)),se=I(F),T=a=>{const o=se.value,A=at(o+a,1,1/0);se.value=A};ve(se,a=>{localStorage.setItem(`__ark-supra-mobile-tables-count-state_${N.id}`,`${a}`)});function s(a){if(typeof a!="string")return{};let o;try{o=JSON.parse(a)}catch{}return typeof o=="object"&&o!==null?o:{}}const v=s(localStorage.getItem(`__ark-supra-orders-state_${N.id}`)),b=Ye({Banquet:v.Banquet??!0,Bill:v.Bill??!0,Closed:v.Closed??!0,Deleted:v.Deleted??!0,New:v.New??!0});ve(b,a=>{localStorage.setItem(`__ark-supra-orders-state_${N.id}`,JSON.stringify(a))});const S=s(localStorage.getItem(`__ark-supra-reservation-state_v2_${N.id}`)),t=Object.values(ge),m=t.reduce((a,o)=>(a[o]=!0,a),{}),u=Ye(Object.values(tt).concat(...t).reduce((a,o)=>(a[o]=S[o]??!0,a),{}));ve(u,a=>{localStorage.setItem(`__ark-supra-reservation-state_v2_${N.id}`,JSON.stringify(a))});const O=s(localStorage.getItem(`__ark-supra-zones-state_${N.id}`)),w=Ye(O);ve(w,a=>{localStorage.setItem(`__ark-supra-zones-state_${N.id}`,JSON.stringify(a))});const J=R.computedSmallerThen("mobile"),ye=a=>{ae.value=a},qe=(a,o)=>{const A=o[a];return A===void 0?!0:A},ct=a=>{a.type==="reservation"&&(V.value?(y.value=a,q.value=!0):z.push({query:{...j.query,type:a.airesto?void 0:"resto",bookingid:a.full.id}}))},ut=_(()=>f.value.filter(Boolean)),dt=_(()=>ut.value.every(o=>qe(o,w))),_t=_(()=>Object.values(u).every(o=>o)),vt=_(()=>Object.values(b).every(o=>o)),Bt=()=>{const a=dt.value,o=ut.value,A=!a;o.forEach(Y=>{w[Y]=A})},Pt=()=>{const a=_t.value,o=u,A=!a;Object.keys(o).forEach(Y=>{u[Y]=A})},Rt=a=>{G.value=G.value.map(o=>{if(a.tables.includes(o.id)){const A=o.reservations.concat(a);return{...o,reservations:A}}return o})},jt=()=>{const a=vt.value,o=b,A=!a;Object.keys(o).forEach(Y=>{b[Y]=A})},mt=_(()=>{var fe,ke;const o=D.value,A=(fe=X.value)==null?void 0:fe.opening_time,Y=(ke=X.value)==null?void 0:ke.closing_time;if(!A||!Y)return[];const Ce=me.fromString(A),Le=me.fromString(Y);let xe=o;return Ce.toAbsoluteMilliseconds()>Le.toAbsoluteMilliseconds()&&(xe=xe.append({day:1})),ia(new ee(o,Ce),new ee(xe,Le),{minutes:30})}),Me=I(!1),pt=I(!1),ft=_(()=>{const o=Se.value.day;return new Array(5).fill("").map((A,Y)=>o.append({day:Y}))}),qt=_(()=>Me.value?ua:G.value.filter(a=>qe(a.zone,w))),bt=_(()=>{if(Me.value)return[];const a=new Set;return G.value.forEach(o=>{a.add(o.zone)}),Array.from(a).sort()}),Pe=_(()=>{const a=D.value,o=qt.value,A=new Array(o.length).fill("").map(()=>null),Y=new Array(o.length).fill("").map(()=>[]);o.forEach((fe,ke)=>{A[ke]=fe;const He=fe.orders.reduce((he,ce)=>{var ze,d;if(b[ce.status]){const _e=ce.start_time.split("+")[0],Te=ee.jsonParse(_e);if(Te.day.daySame(a)){const Ht={start:Te,end:ee.jsonParse(((ze=ce.end_time)==null?void 0:ze.split("+")[0])??((d=ce.prediction_time)==null?void 0:d.split("+")[0])??""),type:ce.status,airesto:!1,full:ce};he.push(Ht)}}return he},[]),Fe=fe.reservations.reduce((he,ce)=>{if(u[ce.status]&&(N.id!=="111113"||ce.status!==tt.Reserve)){const ze=ee.jsonParse(ce.seating_time.split("+")[0]);if(ze.day.daySame(a)){const d={start:ze,end:ee.jsonParse(ce.end_time.split("+")[0]),type:"reservation",airesto:m[ce.status],full:ce};he.push(d)}}return he},[]),Re=[].concat(He).concat(Fe);Re.sort((he,ce)=>he.start.toLocalNativeDate().valueOf()-ce.start.toLocalNativeDate().valueOf()),Y[ke]=Re});const Ce=L.value,Le=Ce?A:A.filter((fe,ke)=>Y[ke].length>0),xe=Ce?Y:Y.filter(fe=>fe.length>0);return{tables:Le,data:xe}}),yt=_(()=>{const a=D.value;return!ft.value.find(o=>o.daySame(a))}),Ie=I(null);return ve([()=>N.id,D],([a,o])=>{if(!a)return;Ie.value=null;const A=o.toJSON();Me.value=!0,pt.value=!1,Z.loadAvailableTables.execute({restaurant_id:a,date:A}).then(Y=>{Y&&(Q.setTableSlots(Y.results),Y.next&&(Ie.value={id:a,page:2,date:A}),Me.value=!1)}).catch(()=>{Ie.value=null,Me.value=!1,pt.value=!0})},{immediate:!0}),ve(Ie,a=>{a&&Z.loadAvailableTables.execute({restaurant_id:a.id,date:a.date,page:a.page}).then(o=>{o&&(Q.concatTableSlots(o.results),o.next&&(Ie.value={id:a.id,date:a.date,page:a.page+1}))}).catch(()=>{Ie.value=null,K.show("Не удалось загрузить следующую страницу бронирований",{type:"error"})})},{immediate:!0}),(a,o)=>{var A,Y,Ce,Le,xe,fe,ke,He,Fe,Re,he,ce,ze;return n(),c(x,null,[l("div",{class:i(a.$style.headerContainer)},[l("h6",{class:i(["ark-text_h6 ark-text_semibold ark-space_top-2 ark-space_bottom-1",a.$style.header])},[$(" Бронирования "),l("div",{class:i(a.$style.statuses)},[r(e(W),{appearance:"neutral",icon:"download",size:"xs",onClick:o[0]||(o[0]=d=>E.value=!E.value)},{default:g(()=>[$(" Контакты гостей ")]),_:1}),r(e(W),{appearance:"neutral",size:"xs",icon:"settings",onClick:o[1]||(o[1]=d=>p.value=!p.value)},{default:g(()=>[$(" Настройки ")]),_:1})],2)],2),l("div",{class:i(["ark-space_bottom-2",a.$style.statuses])},[(A=e(X))!=null&&A.has_bookings?(n(),ue(e(na),{key:0,size:"s",border:!1,class:i(a.$style.tabs),items:e(P)},{default:g(({item:d})=>[$(C(d.text),1)]),_:1},8,["class","items"])):U("",!0),!e(J)&&((Y=e(X))!=null&&Y.has_reservations||(Ce=e(X))!=null&&Ce.has_bookings)?(n(),ue(e(W),{key:1,size:"xs",icon:"plus",class:"ark-space_top-2 ark-space_left-1",appearance:(Le=e(X))!=null&&Le.has_bookings?"accent":void 0,onClick:e(Q).toggleNewBooking},{default:g(()=>[$(" Добавить ")]),_:1},8,["appearance","onClick"])):U("",!0)],2),e(J)&&((xe=e(X))!=null&&xe.has_bookings)?(n(),c("div",Al,[l("a",{class:"ark-text_body-s",style:{"text-decoration":"underline"},onClick:o[2]||(o[2]=d=>de.value=!de.value)}," Как выбирать столы для брони? ")])):U("",!0),e(J)?U("",!0):(n(),c(x,{key:1},[Ul,l("div",{class:i(["ark-space_bottom-2",a.$style.statuses])},[(n(!0),c(x,null,oe(ft.value,(d,_e)=>(n(),c("button",{key:d.toJSON(),class:i(a.$style.date),"data-active":d.daySame(e(D)),onClick:Te=>D.value=d},[r(e(We),{class:"ark-text_semibold",mask:"[day:numeric] [month:long]",date:d.toLocalNativeDate()},null,8,["date"]),l("p",null,[_e<2?(n(),c(x,{key:0},[$(C(e(Se).day.daySame(d)?"сегодня":"завтра"),1)],64)):(n(),ue(e(We),{key:1,mask:"[weekday:long]",date:d.toLocalNativeDate()},null,8,["date"]))])],10,Bl))),128)),r(e(wt),{modelValue:H.value,"onUpdate:modelValue":o[4]||(o[4]=d=>H.value=d),align:"left","max-width":243,"min-width":243,"min-height":290},{dropdown:g(()=>[r(e(St),{value:e(D),onDayClick:o[3]||(o[3]=d=>{D.value=d,H.value=!1})},null,8,["value"])]),default:g(()=>[l("button",{style:{height:"2.5rem"},class:i(a.$style.date),"data-active":yt.value},[yt.value?(n(),c(x,{key:0},[r(e(We),{class:"ark-text_semibold",mask:"[day:numeric] [month:long]",date:e(D).toLocalNativeDate()},null,8,["date"]),l("p",null,[r(e(We),{mask:"[weekday:long]",date:e(D).toLocalNativeDate()},null,8,["date"])])],64)):(n(),c(x,{key:1},[$(" Выбрать ")],64))],10,Pl)]),_:1},8,["modelValue"]),(fe=e(X))!=null&&fe.has_bookings?(n(),c("button",{key:0,type:"button",class:i(["ark-space_left-auto",a.$style.date]),onClick:o[5]||(o[5]=d=>de.value=!de.value)},[Rl,l("p",jl,C(pe.value==="selection"?"Выделение":"Удержание"),1)],2)):U("",!0)],2),ql],64)),Hl,l("div",{class:i(a.$style.statuses)},[(n(!0),c(x,null,oe(bt.value,d=>(n(),ue(e(ca),{key:d,a:qe(d,w)},{default:g(({a:_e})=>[l("button",{type:"button",class:i([a.$style.date,a.$style.date_center]),"data-active":_e,onClick:Te=>w[d]=!_e},C(d),11,Fl)]),_:2},1032,["a"]))),128))],2)],2),l("div",{class:i(a.$style.container),"data-tablebar":e(M)!==null},[Pe.value.tables.length>0?(n(),c(x,{key:0},[Me.value?(n(),c(x,{key:1},[r(e(Tt),{name:"spinner",class:"ark-space_right-2",size:16}),$(" Загружаем... ")],64)):(n(),c(x,{key:0},[e(J)?(n(),ue(e(as),{key:1,"time-segments":mt.value,tables:Pe.value.tables,data:Pe.value.data,highlight:(Fe=e(M))==null?void 0:Fe.id,count:se.value,"add-enabled":(Re=e(X))==null?void 0:Re.has_bookings,onShow:ct,onAdd:ye},{default:g(({item:d})=>[r(zt,{item:d},null,8,["item"])]),xlabel:g(({item:d})=>[r(e(Ot),{id:d.id},null,8,["id"])]),_:1},8,["time-segments","tables","data","highlight","count","add-enabled"])):(n(),ue(e(Ls),{key:0,size:re.value,"onUpdate:size":o[6]||(o[6]=d=>re.value=d),"time-segments":mt.value,tables:Pe.value.tables,data:Pe.value.data,highlight:(ke=e(M))==null?void 0:ke.id,mode:e(J)?"click":pe.value,"add-enabled":(He=e(X))==null?void 0:He.has_bookings,onShow:ct,onAdd:ye},{default:g(({item:d})=>[r(zt,{item:d},null,8,["item"])]),xlabel:g(({item:d})=>[re.value>2?(n(),ue(e(Vt),{key:0,item:d},null,8,["item"])):(n(),c("div",Wl,[r(e(Ot),{id:d.id},null,8,["id"])]))]),_:1},8,["size","time-segments","tables","data","highlight","mode","add-enabled"]))],64))],64)):e(X)?(n(),c(x,{key:1},[$(' Нет данных. Возможно у вас скрытые "пустые" столы в настройках ')],64)):U("",!0)],10,Jl),e(J)?(n(),c("div",{key:0,class:i(a.$style.safe__content)},[r(e(wt),{modelValue:H.value,"onUpdate:modelValue":o[8]||(o[8]=d=>H.value=d),align:"right",class:"ark-space_left-auto","max-width":243,"min-width":243,"min-height":290},{dropdown:g(()=>[r(e(St),{value:e(D),onDayClick:o[7]||(o[7]=d=>{D.value=d,H.value=!1})},null,8,["value"])]),default:g(()=>[r(e(W),{icon:"calendar",appearance:"elevation",size:"l",style:{"--ark-padding":"1rem"}},{default:g(()=>[$(C(Ee.value),1)]),_:1})]),_:1},8,["modelValue"]),(he=e(X))!=null&&he.has_reservations||(ce=e(X))!=null&&ce.has_bookings?(n(),ue(e(W),{key:0,"icon-button":"",shape:"square",icon:"plus",size:"l",appearance:(ze=e(X))!=null&&ze.has_bookings?"accent":void 0,onClick:e(Q).toggleNewBooking},null,8,["appearance","onClick"])):U("",!0)],2)):U("",!0),r(e(Ze),{modelValue:p.value,"onUpdate:modelValue":o[12]||(o[12]=d=>p.value=d),order:4},{default:g(()=>[Zl,Kl,l("div",Gl,[l("div",{class:i(["ark-text_body-xs ark-text_64",a.$style.header])}," Столы ",2),r(e(Ue),{class:i(a.$style.label)},{default:g(()=>[$(" Показывать пустые столы "),r(e(Ke),{modelValue:L.value,"onUpdate:modelValue":o[9]||(o[9]=d=>L.value=d),size:"s"},null,8,["modelValue"])]),_:1},8,["class"]),e(J)?(n(),c("div",{key:0,class:i(a.$style.label)},[$(" Отображение кол-ва столов "),l("div",{class:i(a.$style.label__counter)},[r(e(W),{"icon-button":"",shape:"square",appearance:"neutral",size:"xs",icon:"minus",onClick:o[10]||(o[10]=d=>T(-1))}),$(" "+C(se.value)+" ",1),r(e(W),{"icon-button":"",shape:"square",appearance:"neutral",size:"xs",icon:"plus",onClick:o[11]||(o[11]=d=>T(1))})],2)],2)):U("",!0)]),l("div",Yl,[l("div",{class:i(["ark-text_body-xs ark-text_64",a.$style.header])},[$(" Бронирования "),r(e(W),{size:"xs",appearance:"flat",onClick:Pt},{default:g(()=>[$(C(_t.value?"Скрыть все":"Все"),1)]),_:1})],2),(n(!0),c(x,null,oe(e(h),(d,_e)=>(n(),ue(e(Ue),{key:_e,class:i(a.$style.label)},{default:g(()=>[$(C(d)+" ",1),r(e(Ke),{modelValue:u[d],"onUpdate:modelValue":Te=>u[d]=Te,size:"s"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["class"]))),128))]),l("div",Ql,[l("div",{class:i(["ark-text_body-xs ark-text_64",a.$style.header])},[$(" Заказы "),r(e(W),{size:"xs",appearance:"flat",onClick:jt},{default:g(()=>[$(C(vt.value?"Скрыть все":"Все"),1)]),_:1})],2),(n(),c(x,null,oe(ie,(d,_e)=>r(e(Ue),{key:_e,class:i(a.$style.label)},{default:g(()=>[$(C(d)+" ",1),r(e(Ke),{modelValue:b[_e],"onUpdate:modelValue":Te=>b[_e]=Te,size:"s"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["class"])),64))]),l("div",null,[l("div",{class:i(["ark-text_body-xs ark-text_64",a.$style.header])},[$(" Зоны "),r(e(W),{size:"xs",appearance:"flat",onClick:Bt},{default:g(()=>[$(C(dt.value?"Скрыть все":"Все"),1)]),_:1})],2),(n(!0),c(x,null,oe(bt.value,d=>(n(),ue(e(Ue),{key:d,class:i(a.$style.label)},{default:g(()=>[$(C(d)+" ",1),r(e(Ke),{size:"s","model-value":qe(d,w),"onUpdate:modelValue":_e=>w[d]=_e},null,8,["model-value","onUpdate:modelValue"])]),_:2},1032,["class"]))),128))])]),_:1},8,["modelValue"]),r(e(Ze),{overscroll:"none","model-value":ae.value!==null,"onUpdate:modelValue":o[13]||(o[13]=d=>ae.value=null)},{default:g(({close:d})=>[ae.value?(n(),ue(ul,{key:0,item:ae.value,restaurant:a.id,onAdd:Rt,onClose:d},null,8,["item","restaurant","onClose"])):U("",!0)]),_:1},8,["model-value"]),r(e(Ze),{modelValue:de.value,"onUpdate:modelValue":o[15]||(o[15]=d=>de.value=d)},{default:g(()=>[r(Il,{mode:pe.value,"onUpdate:mode":o[14]||(o[14]=d=>pe.value=d)},null,8,["mode"])]),_:1},8,["modelValue"]),r(e(Ze),{modelValue:E.value,"onUpdate:modelValue":o[16]||(o[16]=d=>E.value=d),size:"sm"},{default:g(()=>[a.id?(n(),ue(Cl,{key:0,id:a.id,"default-day":e(D)},null,8,["id","default-day"])):U("",!0)]),_:1},8,["modelValue"])],64)}}}),en="_container_42k44_1",tn="_headerContainer_42k44_8",an="_fixed_42k44_15",sn="_tabs_42k44_39",ln="_header_42k44_8",nn="_statuses_42k44_50",on="_buttons_42k44_55",rn="_statusesScroll_42k44_65",cn="_date_42k44_80",un="_date_center_42k44_98",dn="_cell_42k44_107",_n="_input_42k44_112",vn="_notification_42k44_147",mn="_label_42k44_153",pn="_label__counter_42k44_172",fn="_spinner_42k44_180",bn="_safe_42k44_196",yn="_safe__content_42k44_199",kn="_safe__buttons_42k44_210",hn="_search_42k44_218",gn="_search_focused_42k44_224",$n={container:en,headerContainer:tn,fixed:an,tabs:sn,header:ln,statuses:nn,buttons:on,statusesScroll:rn,date:cn,date_center:un,cell:dn,input:_n,notification:vn,label:mn,label__counter:pn,spinner:fn,safe:bn,safe__content:yn,safe__buttons:kn,search:hn,search_focused:gn},Sn={$style:$n},An=Ve(Xl,[["__cssModules",Sn]]);export{An as default};
