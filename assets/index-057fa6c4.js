import{d as se,B as bt,a3 as Oe,b as K,r as c,y as ue,at as yt,au as kt,w as J,k as e,o as a,q as H,i as v,h as s,C as de,av as gt,aw as xt,ax as je,c as l,a as i,U as ht,n as b,a7 as $t,E as Ct,ay as wt,l as L,ao as St,az as Tt,aA as Bt,_ as ne,aB as Dt,Q as Nt,F as E,g as te,j as d,t as U,A as N,aC as Se,af as Ze,ai as ze,W as xe,T as F,u as Le,m as Ae,aD as Et,ah as We,aE as $e,aF as It,aG as Vt,S as Be,G as Ot,s as oe,ar as zt,as as Lt,aH as Je,aI as At,z as De,ad as Ce,ac as Ne,a9 as le,aa as Ke,$ as Te,al as Rt,a2 as Mt,Z as Pt,aJ as qe,aK as Ee,P as Ge,aq as ye,Y as Xt,aL as Ut,ab as Ft,a0 as Ht,aM as qt,L as jt,x as Zt,v as Wt,p as Jt}from"./index-4bb58793.js";import{_ as Kt}from"./index-33213308.js";/* empty css              */import{c as Ye,r as Ie,_ as he,s as Gt}from"./index-32116540.js";import{T as we,D as Yt}from"./index-8aa53e89.js";import{O as Qt,T as ea,R as ta}from"./index-e92da206.js";import{F as Qe}from"./index-d9c5e50f.js";import{I as et,_ as aa}from"./index-3a4af7ab.js";import{T as la,Z as oa,S as Ve,v as sa,a as na}from"./index-80443b79.js";import{R as ra}from"./index-26aacdad.js";import{u as ia}from"./index-ee039805.js";import"./index-bc918f74.js";import"./index-bdf865c9.js";import"./index-fe4132e1.js";import"./index-176adada.js";const ua={direction:"bottom"},ke=12,ge=72,da=se({name:"TableBar",__name:"TableBar",props:bt({modelValue:{type:Boolean},direction:{},overlay:{type:Boolean},rootClass:{},contentClass:{},dataAutomationId:{},closeButton:{type:Boolean}},ua),emits:["update:modelValue"],setup(M,{emit:y}){const _=M,p=y,{modelValue:k,overlay:z,direction:C}=Oe(_),m=K(()=>z.value?"all":"none"),A=c(null),V=c(!1),$=ue(yt,c(null)),w=ue(kt,c(NaN)),x=K(()=>$.value&&$.value.overlayClickEvents),r=()=>{p("update:modelValue",!1)},D=()=>{z.value&&r()},S=()=>{var q;const f=(q=A.value)==null?void 0:q.getBoundingClientRect();if(!f)return!1;const Y=C.value,{left:u,right:I,top:h,bottom:X}=f,t=window.innerWidth,B=window.innerHeight;switch(Y){case"left":return t-I-ge-ke<0;case"right":return u-ge-ke<0;case"top":return B-X-ge-ke<0;default:return h-ge-ke<0}};J([k,z,$],([f,Y,u])=>{f&&Y&&u?u.showOverlay():u==null||u.hideOverlay()},{immediate:!0}),J(x,()=>{k.value&&z.value&&r()});const j=Bt(()=>{if(!k.value)return;const f=S();V.value=f},300),O={onEvent:D};return _.closeButton&&J(w,j,{immediate:!0}),(f,Y)=>e($)?(a(),H(e(Tt),{key:0,"append-to":e(z)?"#ark_table-bar-overlayable":"#ark_table-bars"},{default:v(()=>[s(St,{appear:"","enter-from-class":f.$style[`ark-table-bar_${e(C)}-enter-from`],"enter-active-class":f.$style[`ark-table-bar_${e(C)}-enter-active`],"leave-active-class":f.$style[`ark-table-bar_${e(C)}-leave-active`],"leave-to-class":f.$style[`ark-table-bar_${e(C)}-leave-to`]},{default:v(()=>[e(k)?de((a(),l("section",{key:0,ref_key:"tableBarRef",ref:A,class:b([f.$style.tableBar,f.$style["tableBar_"+e(C)],f.rootClass])},[i("div",{class:b(f.$style.content)},[s(e(ht),{class:b(f.$style.scrollbar)},{default:v(()=>[i("div",{class:b(f.contentClass)},[$t(f.$slots,"default",{close:r})],2)]),_:3},8,["class"]),f.closeButton&&e(k)?de((a(),l("button",{key:0,class:b([f.$style.close,f.$style["close_"+e(C)],V.value&&f.$style.close_inside]),onClick:r},[s(e(Ct),{name:"close",size:"xl"})],2)),[[e(wt)]]):L("",!0)],2)],2)),[[e(gt),O],[e(xt),{handle:e(z)}],[e(je),m.value]]):L("",!0)]),_:3},8,["enter-from-class","enter-active-class","leave-active-class","leave-to-class"])]),_:3},8,["append-to"])):L("",!0)}}),ca="_tableBar_1xo14_1",ma="_tableBar_bottom_1xo14_10",va="_tableBar_top_1xo14_14",pa="_tableBar_left_1xo14_18",_a="_tableBar_right_1xo14_23",fa="_content_1xo14_29",ba="_scrollbar_1xo14_35",ya="_close_1xo14_39",ka="_close_left_1xo14_88",ga="_close_right_1xo14_94",xa="_close_bottom_1xo14_100",ha="_close_top_1xo14_106",$a="_close_inside_1xo14_112",Ca={tableBar:ca,tableBar_bottom:ma,tableBar_top:va,tableBar_left:pa,tableBar_right:_a,content:fa,scrollbar:ba,close:ya,close_left:ka,close_right:ga,close_bottom:xa,close_top:ha,close_inside:$a,"ark-table-bar_bottom-enter-active":"_ark-table-bar_bottom-enter-active_1xo14_135","ark-table-bar_bottom-leave-active":"_ark-table-bar_bottom-leave-active_1xo14_135","ark-table-bar_bottom-enter-from":"_ark-table-bar_bottom-enter-from_1xo14_139","ark-table-bar_bottom-leave-to":"_ark-table-bar_bottom-leave-to_1xo14_139","ark-table-bar_left-enter-active":"_ark-table-bar_left-enter-active_1xo14_142","ark-table-bar_left-leave-active":"_ark-table-bar_left-leave-active_1xo14_142","ark-table-bar_left-enter-from":"_ark-table-bar_left-enter-from_1xo14_146","ark-table-bar_left-leave-to":"_ark-table-bar_left-leave-to_1xo14_146","ark-table-bar_right-enter-active":"_ark-table-bar_right-enter-active_1xo14_149","ark-table-bar_right-leave-active":"_ark-table-bar_right-leave-active_1xo14_149","ark-table-bar_right-enter-from":"_ark-table-bar_right-enter-from_1xo14_153","ark-table-bar_right-leave-to":"_ark-table-bar_right-leave-to_1xo14_153","ark-table-bar_top-enter-active":"_ark-table-bar_top-enter-active_1xo14_156","ark-table-bar_top-leave-active":"_ark-table-bar_top-leave-active_1xo14_156","ark-table-bar_top-enter-from":"_ark-table-bar_top-enter-from_1xo14_160","ark-table-bar_top-leave-to":"_ark-table-bar_top-leave-to_1xo14_160"},wa={$style:Ca},Sa=ne(da,[["__cssModules",wa]]),Ta=["type","inputMode","autocomplete","accept","min","max","step","pattern","size","maxlength"],Ba=(M,y)=>{Ta.forEach(_=>{const p=y.getAttribute(_);p!=null&&M.setAttribute(_,p)})},Da=M=>{const y=document.createElement("input"),_=M.getBoundingClientRect();return Ba(y,M),y.setAttribute("autofocus","autofocus"),y.style.height=`${_.height}px`,y.style.width=`${_.width/2}px`,y.style.position="fixed",y.style.zIndex="-99999999",y.style.caretColor="transparent",y.style.border="none",y.style.outline="none",y.style.color="transparent",y.style.background="transparent",y.style.cursor="none",y.style.fontSize="16px",y.style.top=`${_.top}px`,y.style.left=`${_.left}px`,y},Na=M=>M.closest("#ark_popups-host"),Ea=M=>{var m;const y=Da(M),_=100;let p=null,k=null;const z=()=>y.focus({preventScroll:!0}),C=()=>{p&&clearTimeout(p),p=setTimeout(()=>{k&&clearTimeout(k),y.removeEventListener("blur",z),y.removeEventListener("focus",C),k=setTimeout(()=>{M.focus({preventScroll:!1}),y.remove()},_)})};y.addEventListener("blur",z,{once:!0}),y.addEventListener("focus",C),Na(M)?window.document.body.appendChild(y):(m=M.parentElement)==null||m.appendChild(y),y.focus({preventScroll:!0})},Ia=M=>{Promise.resolve().then(()=>{const y=M.querySelector("input,textarea")??M;Dt()?Ea(y):setTimeout(()=>y.focus())})},tt={mounted:Ia},Va=["value"],Oa=se({__name:"SimpleTextarea",props:{modelValue:{}},emits:["update:modelValue"],setup(M,{emit:y}){const _=y,p=k=>{const z=k.target.value;_("update:modelValue",z)};return(k,z)=>(a(),l("textarea",{value:k.modelValue,class:b(k.$style.textarea),onInput:p},null,42,Va))}}),za="_textarea_18ru7_1",La={textarea:za},Aa={$style:La},at=ne(Oa,[["__cssModules",Aa]]),Ra=i("p",{class:"ark-text_body-xs ark-space_bottom-1"}," Зеленые столы не означают что они свободны!!! ",-1),Ma=["data-selected","onClick"],Pa=["src"],Xa={class:"ark-text_body-xs ark-space_top-1 ark-space_bottom-1"},Ua=se({__name:"FloorMap",props:{preselected:{},loading:{type:Boolean}},emits:["tableSelect","close"],setup(M,{emit:y}){const _=M,p=y,k=ue(ze),z=c(null),C=K(()=>{const u=k.value;return Array.from(Object.values(u).reduce((I,h)=>(I.add(h.zone),I),new Set)).sort()}),m=K(()=>C.value.filter(Boolean));J(m,u=>{u.length>0&&(z.value=u[0])},{immediate:!0});const A=K(()=>{const u=k.value;return Object.keys(u).reduce((I,h)=>(I[u[h].number]=h,I),{})}),V={"1 Этаж":[[{img:"/romani/sofa_2.png",text:"17",id:"17"},{img:"/romani/sofa_2.png",text:"18",id:"18",style:{transform:"translateX(16px)"}}],[{img:"/romani/round_2.png",text:"19",id:"19",sub:"неброн",style:{transform:"translateX(128px)"}},{img:"/romani/round_2.png",text:"191",id:"191",sub:"неброн",style:{transform:"translateX(144px)"}},{img:"/romani/4.png",text:"14",id:"14",style:{transform:"translate(288px, 8px)"},rotate:{transform:"rotate(90deg)"}}],[],[{img:"/romani/round_5.png",text:"16",id:"16",style:{transform:"translate(32px, -16px)"}},{img:"/romani/4.png",text:"154",id:"154",style:{transform:"translateX(64px)"}},{img:"/romani/4.png",text:"153",id:"153",style:{transform:"translateX(76px)"}},{img:"/romani/4.png",text:"152",id:"152",style:{transform:"translateX(88px)"}},{img:"/romani/6.png",text:"151",id:"151",style:{transform:"translateX(100px)"}},{img:"/romani/round_4.png",text:"15",id:"15",style:{transform:"translateX(128px)"}},{img:"/romani/2.png",text:"12",id:"12",style:{transform:"translate(160px, 8px)"}}],[{img:"/romani/arrow.svg",sub:"Вход",id:"lol?",custom:!0,style:{"margin-left":"-48px"},rotate:{width:"48px",height:"12px"}}],[{img:"/romani/round_5.png",text:"1",id:"1"},{img:"/romani/sofa_1.png",text:"2",id:"2",style:{transform:"translateX(24px)"},rotate:{transform:"rotate(-90deg)"}},{img:"/romani/sofa_2.png",text:"4",id:"4",style:{transform:"translateX(36px)"},rotate:{transform:"rotate(-180deg)"}},{img:"/romani/sofa_1.png",text:"5",id:"5",style:{transform:"translateX(64px)"},rotate:{transform:"rotate(-90deg)"}},{img:"/romani/sofa_2.png",text:"6",id:"6",style:{transform:"translateX(76px)"},rotate:{transform:"rotate(-180deg)"}},{img:"/romani/sofa_2.png",text:"8",id:"8",style:{transform:"translateX(104px)"},rotate:{transform:"rotate(-180deg)"}},{img:"/romani/sofa_1.png",text:"10",id:"10",style:{transform:"translateX(116px)"},rotate:{transform:"rotate(-90deg)"}},{img:"/romani/round_6.png",text:"11",id:"11",style:{transform:"translateX(150px)"},rotate:{transform:"rotate(-90deg)"}}]],"2 Этаж":[[{img:"/romani/2.png",text:"47",id:"47",rotate:{transform:"rotate(90deg)"}},{img:"/romani/2.png",text:"48",id:"48",style:{transform:"translateX(16px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/sofa_5.png",text:"40",id:"40",style:{transform:"translateX(44px)"},rotate:{width:"90px",height:"44px"}},{img:"/romani/2.png",text:"41",id:"41",style:{transform:"translateX(76px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/2.png",text:"42",id:"42",style:{transform:"translateX(88px)"},rotate:{transform:"rotate(90deg)"}}],[{img:"/romani/2.png",text:"46",id:"46",rotate:{transform:"rotate(90deg)"}},{img:"/romani/2.png",text:"45",id:"45",style:{transform:"translateX(16px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/2.png",text:"44",id:"44",style:{transform:"translateX(166px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/2.png",text:"43",id:"43",style:{transform:"translateX(178px)"},rotate:{transform:"rotate(90deg)"}}],[],[{img:"/romani/4.png",text:"37",id:"37",style:{transform:"translateX(52px)"}},{img:"/romani/2.png",text:"36",id:"36",style:{transform:"translateX(68px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/4.png",text:"34",id:"34",style:{transform:"translateX(84px)"}},{img:"/romani/2.png",text:"33",id:"33",style:{transform:"translateX(100px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/4.png",text:"31",id:"31",style:{transform:"translateX(116px)"}},{img:"/romani/2.png",text:"21",id:"21",style:{transform:"translateX(132px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/2.png",text:"30",id:"30",style:{transform:"translateX(148px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/round_6.png",text:"20",id:"20",style:{transform:"translateX(196px)"}}],[],[{img:"/romani/round_4.png",text:"29",id:"29",style:{transform:"translateX(36px)"}},{img:"/romani/round_4.png",text:"28",id:"28",style:{transform:"translateX(52px)"}},{img:"/romani/round_2.png",text:"27",id:"27",style:{transform:"translateX(68px)"},rotate:{transform:"rotate(-45deg)"}},{img:"/romani/round_2.png",text:"39",id:"39",style:{transform:"translateX(84px)"},rotate:{transform:"rotate(-45deg)"}},{img:"/romani/round_4.png",text:"26",id:"26",style:{transform:"translateX(100px)"}},{img:"/romani/round_4.png",text:"25",id:"25",style:{transform:"translateX(116px)"}},{img:"/romani/round_2.png",text:"24",id:"24",style:{transform:"translateX(132px)"},rotate:{transform:"rotate(-45deg)"}},{img:"/romani/round_4.png",text:"23",id:"23",style:{transform:"translateX(148px)"}},{img:"/romani/3.png",text:"22",id:"22",style:{transform:"translateX(164px)"}}]],"Банкетный зал":[[{img:"/romani/3.png",text:"61",id:"61",style:{},rotate:{transform:"rotate(90deg)"}},{img:"/romani/4.png",text:"62",id:"62",style:{transform:"translate(16px, 16px)"}},{img:"/romani/2.png",text:"64",id:"64",style:{transform:"translate(32px, 16px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/4.png",text:"65",id:"65",style:{transform:"translate(48px, 16px)"}},{img:"/romani/4.png",text:"67",id:"67",style:{transform:"translate(64px, 16px)"}},{img:"/romani/4.png",text:"69",id:"69",sub:"Не сдвигать",style:{transform:"translate(80px, 16px)"}}],[],[{img:"/romani/arrow.svg",sub:"Вход",id:"lol?",custom:!0,style:{"margin-right":"-48px",transform:"translateY(32px)"},rotate:{width:"48px",height:"12px",transform:"rotate(-90deg)"}},{img:"/romani/4.png",text:"57",id:"57",sub:"Не сдвигать",style:{transform:"translate(48px, 16px)"}},{img:"/romani/4.png",text:"55",id:"55",sub:"Не сдвигать",style:{transform:"translate(64px, 16px)"}},{img:"/romani/4.png",text:"53",id:"53",style:{transform:"translate(80px, 16px)"}},{img:"/romani/2.png",text:"52",id:"52",style:{transform:"translate(96px, 16px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/4.png",text:"50",id:"50",sub:"Не сдвигать",style:{transform:"translate(112px, 16px)"}}]]},$=K(()=>{const u=A.value;return Object.keys(V).reduce((I,h)=>(I[h]=V[h].map(X=>X.map(t=>({...t,id:u[t.text]}))),I),{})}),w=Nt({}),x=K(()=>Object.keys(w).filter(u=>w[u])),r=()=>{p("tableSelect",x.value)},D=u=>{u&&(w[u]=!w[u])};J(()=>_.preselected,u=>{u.forEach(I=>{w[I]=!0})},{immediate:!0}),c({left:0,top:0,width:0,height:0,ratio:1});const S=c({scale:1,translate:{x:0,y:0},deg:0}),j=K(()=>{const u=S.value;return{position:"relative",display:"inline-flex",transition:"",transformOrigin:"0 0",transform:`translate(${u.translate.x}px, ${u.translate.y}px) scale(${u.scale})`}}),O=([u,I])=>{const h=S.value.translate;S.value={...S.value,translate:{x:h.x+u,y:h.y+I}}},f={matrix:S,onEvent:(u,I,h)=>{const X=S.value;S.value={...X,scale:u,translate:{x:I,y:h}}},onRelease:()=>{}},Y={onEvent:O,onPanning:()=>{}};return(u,I)=>(a(),l(E,null,[i("div",{class:b(["ark-space_bottom-2",u.$style.zones])},[(a(!0),l(E,null,te(m.value,(h,X)=>(a(),H(e(N),{key:X,size:"xs",type:"button",appearance:z.value===h?"primary":"neutral",onClick:t=>z.value=h},{default:v(()=>[d(U(h),1)]),_:2},1032,["appearance","onClick"]))),128))],2),Ra,de((a(),l("div",{class:b(u.$style.floor)},[i("div",{class:b(u.$style.content),style:Se(j.value)},[(a(!0),l(E,null,te($.value[z.value??"1 Этаж"],(h,X)=>(a(),l("div",{key:X,class:b(u.$style.line)},[(a(!0),l(E,null,te(h,t=>(a(),l("button",{key:t.id,type:"button",class:b(u.$style.table),style:Se(t.style),"data-selected":w[t.id],onClick:B=>D(t.custom?"":t.id)},[i("span",{class:b(u.$style.table__text)},U(t.text),3),i("img",{src:t.img,width:"32",height:"32",style:Se(t.rotate)},null,12,Pa),t.sub?(a(),l("p",{key:0,class:b(["ark-text_64",u.$style.sub])},U(t.sub),3)):L("",!0)],14,Ma))),128))],2))),128))],6)],2)),[[e(je)],[e(la),Y],[e(oa),f]]),i("p",Xa,[d(" Выбраны столы: "),(a(!0),l(E,null,te(x.value,h=>(a(),H(e(Ze),{id:h,key:h},null,8,["id"]))),128))]),s(e(N),{size:"xs",loading:u.loading,onClick:r},{default:v(()=>[d(" Пересадить ")]),_:1},8,["loading"]),s(e(N),{appearance:"neutral",size:"xs",class:"ark-space_left-2",onClick:I[0]||(I[0]=h=>p("close"))},{default:v(()=>[d(" Отменить ")]),_:1})],64))}}),Fa="_floor_1bx28_1",Ha="_content_1bx28_10",qa="_line_1bx28_18",ja="_table_1bx28_24",Za="_table__text_1bx28_47",Wa="_sub_1bx28_58",Ja="_zones_1bx28_67",Ka={floor:Fa,content:Ha,line:qa,table:ja,table__text:Za,sub:Wa,zones:Ja},Ga={$style:Ka},Ya=ne(Ua,[["__cssModules",Ga]]),Qa={class:"ark-text_body-xs ark-space_bottom-1"},el={class:"ark-text_64",style:{display:"flex","align-items":"center",gap:"0.25rem"}},tl={style:{display:"flex","text-decoration":"line-through"}},al=se({__name:"HistoryPreview",props:{item:{}},setup(M){const y={comment:"Коммент",seating_time:"Начало",end_time:"Конец",tables:"Столы",status:"Статус",num_people:"Гостей"};return(_,p)=>(a(),l("div",Qa,[i("div",el,[i("span",null,U(_.item.user)+".",1),s(e(xe),{mask:"[day:numeric] [month:long] [year:numeric], [hour:numeric]:[minute:numeric]",date:_.item.date},null,8,["date"])]),(a(!0),l(E,null,te(_.item.changes,(k,z)=>(a(),l("div",{key:z,class:b(_.$style.change)},[d(U(y[k.key]||k.key)+": ",1),k.key==="seating_time"||k.key==="end_time"?(a(),l(E,{key:0},[s(e(xe),{mask:"[day:numeric] [month:long] [year:numeric], [hour:numeric]:[minute:numeric]. ",date:k.new},null,8,["date"]),s(e(xe),{mask:"[day:numeric] [month:long] [year:numeric], [hour:numeric]:[minute:numeric]",style:{"text-decoration":"line-through"},date:k.old},null,8,["date"])],64)):k.key==="tables"?(a(),l(E,{key:1},[s(e(we),{"show-capacity":!1,"show-zone":!1,ids:k.new},null,8,["ids"]),i("div",tl,[s(e(we),{"show-capacity":!1,"show-zone":!1,ids:k.old},null,8,["ids"])])],64)):(a(),l(E,{key:2},[d(U(k.new),1)],64))],2))),128))]))}}),ll="_change_retyy_1",ol={change:ll},sl={$style:ol},nl=ne(al,[["__cssModules",sl]]),rl={class:"ark-text_h6 ark-space_bottom-1 ark-text_medium",style:{display:"flex","align-items":"center","justify-content":"space-between"}},il={key:0},ul=i("a",{class:"ark-space_left-2 ark-text_body-s ark-text_semibold",style:{cursor:"pointer"}}," Изменить статус ",-1),dl={key:2},cl={class:"ark-text_body-s"},ml={key:0},vl=i("p",{class:"ark-text_semibold"},"Столы могут поменяться",-1),pl=i("p",{class:"ark-text_body-s"},' Если нужны именно эти столы, нажмите на "Оставить ..." ',-1),_l={key:0,style:{width:"100%"}},fl={key:4,style:{"padding-left":"0.5rem","--ark-elevation":"var(--ark-background-color)"}},bl={key:0,class:"ark-space_bottom-2"},yl={key:2,class:"ark-space_bottom-8"},kl={key:0,class:"ark-text_body-xs"},gl=i("div",null,[i("p",{class:"ark-text_body-s ark-text_semibold"},"Опаздывают"),i("p",{class:"ark-text_body-xs"},"(+15 мин.)")],-1),xl={key:1},hl=i("p",{class:"ark-space_bottom-2 ark-text_h6"}," Не удалось загрузить информацию ",-1),$l={style:{"text-align":"center"}},Cl=i("h4",{class:"ark-text_h4 ark-space_bottom-6",style:{"text-align":"center"}}," Точно отменяем бронирование? ",-1),wl=se({__name:"AirestoBookingRes",props:{itemId:{}},emits:["close","changeTable","refresh","editMode"],setup(M,{emit:y}){const _=M,p=y,k={[F.NEW]:"Ожидает подтверждения",[F.APPLICATION]:"Ожидаем",[F.CANCELLED]:"Отменен",[F.CLOSED]:"Завершено",[F.OPEN]:"В зале"},z=[F.NEW,F.APPLICATION,F.OPEN,F.CANCELLED,F.CLOSED],C=Le(),m=Ae(),A=c(!1),V=c(!1),$=c(!1),w=c(!1),x=c(""),r=c(""),D=Ye({name:["",{required:Ie}],count:[1]}),S=c(!1),j=c(!1),O=c(!1),f=c(!1),Y=c(!1),u=c(!1),I=c(null),h=c(NaN),X=c(!1),t=c(null),B=c(!1),q=c(!1),R=c(!1),g=c(!1),P=c(""),Q=c(!1),Z=c(!1),me=c(!1),pe=localStorage.getItem("__ark-supra-table-mode-booking-rest"),re=c(pe==="list"||pe==="scheme"?pe:"list"),ve=c(!1),be=c(!1),ie=c(!1),_e=c(null);J(re,n=>{localStorage.setItem("__ark-supra-table-mode-booking-rest",n)});const ae=c(Date.now()),Re=ue(ze),lt=n=>{const o=document.querySelector(`[data-id="${n}"]`);o&&(o.scrollIntoView({block:"center",inline:"center"}),o.classList.add("ark-vibe"))},ot=K(()=>$.value||S.value||V.value&&x.value!==P.value||A.value&&w.value),st=K(()=>{const n=t.value;return!!n&&(n.status===F.CANCELLED||n.status===F.CANCELLED_NO_DEPOSIT)}),fe=K(()=>!st.value),nt=()=>{var ce;if(D.validate(),D.invalid.value)return;j.value=!0;const n=t.value,o=ve.value?(ce=t.value)==null?void 0:ce.tables:void 0,{count:G}=D.getCurrentValue();C.updateBooking.execute({id:Number(_.itemId),num_people:G,tables:o}).then(W=>{W&&(t.value=W,W.tables.sort().toString()!==n.tables.sort().toString()?(m.show(Ne(Ve),{autoClose:15e3,data:{...W,allTables:Re.value,__frontUpdate:!0,__newbooking:!0}}),p("changeTable",{prev:n.tables,new:W.tables,dto:W})):(m.show("Изменили количество человек"),p("refresh",W)),ae.value=Date.now(),S.value=!1)}).catch(([W])=>{m.show("Попробуйте еще раз",{label:W.error?W.error:"Не удалось изменить кол-во человек",type:"error"})}).finally(()=>{j.value=!1})},rt=n=>{I.value=n,C.updateBooking.execute({id:Number(_.itemId),status:n}).then(o=>{o&&(m.show(`Изменили статус брони. "${k[n]}"`),t.value=o,p("refresh",o),p("close"),me.value=!1,ae.value=Date.now())}).catch(()=>{m.show("Попробуйте еще раз",{label:"Не удалось обновить",type:"error"})}).finally(()=>{I.value=null})},it=()=>{u.value=!0,C.updateBooking.execute({id:Number(_.itemId),status:F.APPLICATION}).then(n=>{n&&(m.show("Вернули бронь"),t.value=n,p("refresh",n),p("close"),B.value=!1,me.value=!1,ae.value=Date.now())}).catch(()=>{m.show("Попробуйте еще раз",{label:"Не удалось обновить",type:"error"})}).finally(()=>{u.value=!1})},ut=()=>{Z.value=!0,C.updateBooking.execute({id:Number(_.itemId),status:F.OPEN}).then(n=>{n&&(m.show("За столом"),t.value=n,p("refresh",n),p("close"),B.value=!1,ae.value=Date.now())}).catch(()=>{m.show("Попробуйте еще раз",{label:"Не удалось обновить",type:"error"})}).finally(()=>{Z.value=!1})},dt=()=>{q.value=!0,C.updateBooking.execute({id:Number(_.itemId),status:F.CANCELLED,comment:r.value||void 0}).then(n=>{n&&(m.show("Бронирование отменено"),t.value=n,r.value="",p("refresh",n),p("close"),B.value=!1,ae.value=Date.now())}).catch(()=>{m.show("Попробуйте еще раз",{label:"Не удалось отменить бронирование",type:"error"})}).finally(()=>{q.value=!1})},ct=()=>{const n=P.value;g.value=!0,C.updateBooking.execute({id:Number(_.itemId),comment:n}).then(o=>{o&&(m.show("Изменили комментарий"),t.value=o,V.value=!1,p("refresh",o),ae.value=Date.now())}).catch(()=>{m.show("Попробуйте еще раз",{label:"Не удалось изменить комментарий",type:"error"})}).finally(()=>{g.value=!1})},mt=()=>{O.value=!0,C.updateBooking.execute({id:Number(_.itemId),status:F.CLOSED}).then(n=>{n&&(m.show("Завершили бронирование"),t.value=n,p("refresh",n),p("close"),ae.value=Date.now())}).catch(()=>{m.show("Попробуйте еще раз",{label:"Не удалось завершить бронирование",type:"error"})}).finally(()=>{O.value=!1})},vt=()=>{Y.value=!0,C.updateBooking.execute({id:Number(_.itemId),status:F.APPLICATION}).then(n=>{n&&(m.show("Подтвердили бронь"),t.value=n,p("refresh",n),p("close"),ae.value=Date.now())}).catch(()=>{m.show("Попробуйте еще раз",{label:"Не удалось завершить бронирование",type:"error"})}).finally(()=>{Y.value=!1})},pt=()=>{R.value=!0,C.updateBooking.execute({id:Number(_.itemId),clients_are_late:!0}).then(n=>{n&&(m.show("Перенесли на 15 минут"),t.value=n,ae.value=Date.now(),p("refresh",n))}).catch(()=>{m.show("Попробуйте еще раз",{label:"Не удалось перенести бронь",type:"error"})}).finally(()=>{R.value=!1})},_t=n=>{var ce;f.value=!0;const o=be.value?(ce=t.value)==null?void 0:ce.tables:void 0,G=t.value;C.updateBooking.execute({id:Number(_.itemId),seating_time:n.start,end_time:n.end,tables:o}).then(W=>{W&&(t.value=W,be.value=!1,A.value=!1,W.tables.sort().toString()!==G.tables.sort().toString()?(m.show(Ne(Ve),{autoClose:15e3,data:{...W,allTables:Re.value,__frontUpdate:!0,__newbooking:!0}}),p("changeTable",{prev:G.tables,new:W.tables,dto:W})):(m.show("Изменили дату и время"),p("refresh",W)),ae.value=Date.now())}).catch(()=>{m.show("Попробуйте еще раз",{label:"Не удалось изменить дату и время",type:"error"})}).finally(()=>{f.value=!1})},Me=()=>{ie.value=!0,C.loadBookingHistory.execute({id:Number(_.itemId)}).then(n=>{n&&Array.isArray(n)?(_e.value=n.sort((o,G)=>new Date(G.date).valueOf()-new Date(o.date).valueOf()).map(o=>({...o,changes:o.changes.filter(G=>G.new.toString()!==G.old.toString())})).filter(o=>o.changes.length>0),ie.value=!1):ie.value=null}).catch(()=>{ie.value=null})},Pe=n=>{Q.value=!0;const o=t.value;C.updateBooking.execute({id:Number(_.itemId),tables:n}).then(G=>{G&&(m.show("Изменили столы"),t.value=G,$.value=!1,ae.value=Date.now(),p("changeTable",{prev:o.tables,new:G.tables,dto:G}))}).catch(()=>{m.show("Попробуйте еще раз",{label:"Не удалось изменить столы",type:"error"})}).finally(()=>{Q.value=!1})};return J(V,n=>{var o;n&&(P.value=((o=t.value)==null?void 0:o.comment)||"",x.value=P.value)}),J(S,n=>{n&&(ve.value=!1)}),J([S,t],([n,o])=>{n&&o&&(D.count.setValue(o.num_people),D.name.setValue(o.name_for_reservation))}),J(ot,n=>{p("editMode",n)}),J([()=>_.itemId,h],([n])=>{X.value=!0,_e.value=null,ie.value=!1,$.value=!1,V.value=!1,A.value=!1,C.loadBookingById.execute({id:n}).then(o=>{t.value=o,ae.value=Date.now()}).finally(()=>{X.value=!1})},{immediate:!0}),J(fe,(n,o)=>{o&&!n&&(V.value=!1,A.value=!1,$.value=!1)}),J(ae,()=>{Me()},{immediate:!0}),(n,o)=>{var G,ce,W,Xe,Ue;return a(),l(E,null,[X.value||t.value?(a(),l(E,{key:0},[i("h6",rl,[d(" Бронирование "),s(e(Kt),{appearance:"filled",size:"s",color:"var(--ark-white)",background:"var(--supra-accent)"},{default:v(()=>[d(" Airesto ")]),_:1})]),t.value?(a(),l("div",il,[s(e(Et),{class:b(X.value&&"ark-skeleton"),end_time:t.value.end_time,seating_time:t.value.seating_time,status:t.value.status},null,8,["class","end_time","seating_time","status"]),s(e(We),{modelValue:me.value,"onUpdate:modelValue":o[0]||(o[0]=T=>me.value=T),"min-width":240},{dropdown:v(()=>[s(e(Yt),null,{default:v(()=>[(a(),l(E,null,te(z,T=>de(s(e(N),{key:T,size:"s",appearance:"flat",disabled:I.value!==null,loading:I.value===T,onClick:ee=>rt(T)},{default:v(()=>[d(U(k[T]),1)]),_:2},1032,["disabled","loading","onClick"]),[[e(Qt)]])),64))]),_:1})]),default:v(()=>[ul]),_:1},8,["modelValue"])])):L("",!0),i("p",{class:b(n.$style.label)},[d(" Гость "),t.value&&fe.value?(a(),H(e(N),{key:0,size:"xs",appearance:"neutral",type:"button",disabled:X.value,onClick:o[1]||(o[1]=T=>S.value=!S.value)},{default:v(()=>[d(U(S.value?"Отменить":"Изменить"),1)]),_:1},8,["disabled"])):L("",!0)],2),S.value?(a(),l("div",dl,[s(e(he),{control:e(D).count},{default:v(({model:T})=>[s(e(et),{modelValue:T.value,"onUpdate:modelValue":ee=>T.value=ee,label:"Количество человек",min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),i("div",{class:b(["ark-space_bottom-2 ark-space_top-2",n.$style.buttons]),style:{"align-items":"center","flex-wrap":"nowrap"}},[s(e(Vt),null,{default:v(()=>{var T;return[s(e(It),{modelValue:ve.value,"onUpdate:modelValue":o[2]||(o[2]=ee=>ve.value=ee),size:"s",class:"ark-space_right-1"},null,8,["modelValue"]),i("div",cl,[d(" Оставить стол"),t.value&&t.value.tables.length>1?(a(),l("span",ml,"ы")):L("",!0),d("  "),(a(!0),l(E,null,te((T=t.value)==null?void 0:T.tables,ee=>(a(),H(e(Ze),{id:ee,key:ee},null,8,["id"]))),128))])]}),_:1}),s(e(Lt),null,{default:v(({on:T,attrs:ee})=>[s(e(Be),Ot(ee,{name:"question",class:"ark-text_48",size:12},zt(T),{onClick:o[3]||(o[3]=oe(()=>{},["stop"]))}),null,16)]),hint:v(()=>[vl,pl]),_:1})],2),i("div",{class:b(["ark-space_top-2",n.$style.buttons])},[s(e(N),{type:"button",size:"xs",loading:j.value,onClick:oe(nt,["stop","prevent"])},{default:v(()=>[d(" Сохранить ")]),_:1},8,["loading"]),s(e(N),{type:"button",size:"xs",appearance:"flat",onClick:o[4]||(o[4]=oe(T=>S.value=!1,["stop","prevent"]))},{default:v(()=>[d(" Отменить ")]),_:1})],2)])):(a(),H($e,{key:1,name:(G=t.value)==null?void 0:G.name_for_reservation,num:(ce=t.value)==null?void 0:ce.num_people,phone:(W=t.value)==null?void 0:W.phone_number,loading:X.value},null,8,["name","num","phone","loading"])),i("p",{class:b(n.$style.label)},[d(U(A.value?"Изменение даты и времени":"Дата и время")+" ",1),t.value&&fe.value?(a(),H(e(N),{key:0,size:"xs",appearance:"neutral",type:"button",disabled:X.value,onClick:o[5]||(o[5]=T=>A.value=!A.value)},{default:v(()=>[d(U(A.value?"Отменить":"Изменить"),1)]),_:1},8,["disabled"])):L("",!0)],2),s(Je,{edit:A.value,loading:X.value||f.value,count:((Xe=t.value)==null?void 0:Xe.num_people)??0,start:t.value?t.value.seating_time:"1970-01-01T01:01:01+10:00",end:t.value?t.value.end_time:"1970-01-01T01:01:01+10:00",tables:(Ue=t.value)==null?void 0:Ue.tables,onConfirm:_t,onClose:o[6]||(o[6]=T=>{A.value=!1,be.value=!1}),onEdited:o[7]||(o[7]=T=>w.value=T),onNewTables:o[8]||(o[8]=T=>be.value=T)},null,8,["edit","loading","count","start","end","tables"]),i("p",{class:b(n.$style.label)},[d(U(V.value?"Изменение комментария":"Комментарий")+" ",1),fe.value?(a(),H(e(N),{key:0,size:"xs",appearance:"neutral",type:"button",disabled:X.value,onClick:o[9]||(o[9]=oe(T=>V.value=!V.value,["stop","prevent"]))},{default:v(()=>[d(U(V.value?"Отменить":"Изменить"),1)]),_:1},8,["disabled"])):L("",!0)],2),i("div",{class:b(n.$style.commentContainer)},[V.value?(a(),l("div",_l,[de(s(e(at),{modelValue:P.value,"onUpdate:modelValue":o[10]||(o[10]=T=>P.value=T),placeholder:"Комментарий..."},null,8,["modelValue"]),[[e(tt)]]),i("div",{class:b(["ark-space_top-2",n.$style.buttons])},[s(e(N),{type:"button",size:"xs",loading:g.value,onClick:oe(ct,["stop","prevent"])},{default:v(()=>[d(" Сохранить ")]),_:1},8,["loading"]),s(e(N),{type:"button",size:"xs",appearance:"flat",onClick:o[11]||(o[11]=oe(T=>V.value=!1,["stop","prevent"]))},{default:v(()=>[d(" Отменить ")]),_:1})],2)])):(a(),l("p",{key:1,class:b(["ark-text_body-s-2",X.value&&"ark-skeleton"])},[t.value&&t.value.comment?(a(),l(E,{key:0},[d(U(t.value.comment),1)],64)):(a(),l(E,{key:1},[d("—")],64))],2))],2),i("p",{class:b(n.$style.label)},[d(U($.value?"Изменение столов":"Столы")+" ",1),t.value&&fe.value?(a(),H(e(N),{key:0,size:"xs",appearance:"neutral",type:"button",disabled:X.value,onClick:o[12]||(o[12]=T=>$.value=!$.value)},{default:v(()=>[d(U($.value?"Отменить":"Изменить"),1)]),_:1},8,["disabled"])):L("",!0)],2),$.value?t.value?(a(),l("div",fl,[t.value.restaurant===111113?(a(),l("div",bl,[s(e(N),{size:"xs",class:"ark-space_right-1",appearance:re.value==="scheme"?"neutral":"flat",onClick:o[13]||(o[13]=T=>re.value="scheme")},{default:v(()=>[d(" Схема ")]),_:1},8,["appearance"]),s(e(N),{size:"xs",appearance:re.value==="list"?"neutral":"flat",onClick:o[14]||(o[14]=T=>re.value="list")},{default:v(()=>[d(" Список ")]),_:1},8,["appearance"])])):L("",!0),t.value.restaurant===111113&&re.value==="scheme"?(a(),H(Ya,{key:1,preselected:t.value.tables,loading:Q.value,onClose:o[15]||(o[15]=T=>$.value=!1),onTableSelect:Pe},null,8,["preselected","loading"])):(a(),l("div",yl,[s(ea,{"button-reverse":"","button-size":"xs","button-text":"Пересадить",item:t.value,"show-client":!1,loading:Q.value,onClose:o[16]||(o[16]=T=>$.value=!1),onTableSelect:Pe},{subtitle:v(()=>[d(" За какой стол пересаживаем? ")]),expectedTitle:v(()=>[d(" Текущие столы ")]),_:1},8,["item","loading"])]))])):L("",!0):(a(),l("div",{key:3,class:b(["ark-space_bottom-4",[n.$style.tables,X.value&&"ark-skeleton"]])},[t.value?(a(),H(e(we),{key:0,"show-capacity":!1,"res-id":t.value.id,ids:t.value.tables},null,8,["res-id","ids"])):L("",!0)],2)),i("p",{class:b(n.$style.label)},"История изменений",2),de((a(),l("div",{class:b(["ark-space_bottom-4",n.$style.history])},[ie.value===null?(a(),l("p",kl,"Нет истории")):L("",!0),t.value&&!_e.value&&ie.value!==null?(a(),H(e(N),{key:1,size:"xs",appearance:"neutral",type:"button",loading:ie.value===null?!1:ie.value,onClick:Me},{default:v(()=>[d(" Загрузить ")]),_:1},8,["loading"])):L("",!0),_e.value?(a(!0),l(E,{key:2},te(_e.value,(T,ee)=>(a(),H(nl,{key:ee,item:T},null,8,["item"]))),128)):L("",!0)],2)),[[e(Qe),"vertical"]]),t.value?(a(),l("div",{key:5,class:b(["ark-space_top-auto",n.$style.actions])},[t.value.status===e(F).NEW?(a(),H(e(N),{key:0,loading:Y.value,onClick:vt},{default:v(()=>[d(" Подтвердить ")]),_:1},8,["loading"])):L("",!0),t.value.status===e(F).CANCELLED||t.value.status===e(F).CANCELLED_NO_DEPOSIT||t.value.status===e(F).CLOSED?(a(),H(e(N),{key:1,appearance:"s-danger",loading:u.value,onClick:it},{default:v(()=>[d(' Вернуть в "ожидаем" ')]),_:1},8,["loading"])):L("",!0),t.value.status===e(F).APPLICATION?(a(),l("div",{key:2,class:b([n.$style.buttons,n.$style.buttons_wide])},[s(e(N),{align:"vertical",appearance:"success",loading:Z.value,onClick:ut},{default:v(()=>[d(" За столом ")]),_:1},8,["loading"]),s(e(N),{appearance:"neutral-b",align:"vertical",loading:R.value,onClick:pt},{default:v(()=>[gl]),_:1},8,["loading"])],2)):L("",!0),t.value.status===e(F).APPLICATION||t.value.status===e(F).NEW?(a(),H(e(N),{key:3,appearance:"s-danger",onClick:o[17]||(o[17]=T=>B.value=!0)},{default:v(()=>[d(" Отменить бронь ")]),_:1})):L("",!0),t.value.status===e(F).OPEN||t.value.status===e(F).WAITING?(a(),H(e(N),{key:4,appearance:"success",loading:O.value,onClick:mt},{default:v(()=>[d(" Завершить бронь ")]),_:1},8,["loading"])):L("",!0),s(e(N),{appearance:"flat",onClick:o[18]||(o[18]=T=>lt(t.value.id))},{default:v(()=>[d(" Найти на странице ")]),_:1})],2)):L("",!0)],64)):(a(),l("div",xl,[hl,s(e(N),{appearance:"neutral",size:"s",onClick:o[19]||(o[19]=T=>h.value=Date.now())},{default:v(()=>[d(" Попробуйте еще раз ")]),_:1})])),s(e(Ce),{modelValue:B.value,"onUpdate:modelValue":o[21]||(o[21]=T=>B.value=T),size:"sm",order:3.1},{default:v(({close:T})=>{var ee,Fe,He;return[i("div",$l,[s(e(At),{class:"ark-space_bottom-6",type:"warning"}),Cl,s($e,{name:(ee=t.value)==null?void 0:ee.name_for_reservation,num:(Fe=t.value)==null?void 0:Fe.num_people,phone:(He=t.value)==null?void 0:He.phone_number,loading:X.value},null,8,["name","num","phone","loading"]),s(e(De),{modelValue:r.value,"onUpdate:modelValue":o[20]||(o[20]=ft=>r.value=ft),class:"ark-space_top-3",label:"Причина отмены (опционально)",size:"l"},null,8,["modelValue"]),i("div",{class:b(["ark-space_top-4",n.$style.actions])},[s(e(N),{size:"l",loading:q.value,onClick:dt},{default:v(()=>[d(" Да, отменяем ")]),_:1},8,["loading"]),s(e(N),{appearance:"neutral",size:"l",onClick:T},{default:v(()=>[d(" Нет, оставляем ")]),_:2},1032,["onClick"])],2)])]}),_:1},8,["modelValue"])],64)}}}),Sl="_tables_1iikv_1",Tl="_commentContainer_1iikv_18",Bl="_actions_1iikv_26",Dl="_buttons_1iikv_27",Nl="_buttons_wide_1iikv_33",El="_comment_1iikv_18",Il="_history_1iikv_51",Vl="_label_1iikv_64",Ol={tables:Sl,commentContainer:Tl,actions:Bl,buttons:Dl,buttons_wide:Nl,comment:El,history:Il,label:Vl},zl={$style:Ol},Ll=ne(wl,[["__cssModules",zl]]),Al={class:"ark-text_h6 ark-space_bottom-1 ark-text_medium"},Rl={key:1},Ml={key:0,style:{width:"100%"}},Pl={key:1},Xl=i("p",{class:"ark-space_bottom-2 ark-text_h6"}," Не удалось загрузить информацию ",-1),Ul=i("h6",{class:"ark-text_h6 ark-space_bottom-4"},"Точно отменяем бронирование?",-1),Fl=se({__name:"BookingRes",props:{itemId:{}},emits:["close","refresh","editMode"],setup(M,{emit:y}){const _=M,p=y,k=Le(),z=Ae(),C=c(!1),m=c(!1),A=c(!1),V=c(!1),$=c(""),w=c(NaN),x=c(!1),r=c(null),D=c(!1),S=c(!1),j=c(!1),O=c(""),f=ue(Ke),Y=t=>{const B=document.querySelector(`[data-id="${t}"]`);B&&(B.scrollIntoView({block:"center",inline:"center"}),B.classList.add("ark-vibe"))},u=K(()=>A.value||m.value&&$.value!==O.value||C.value&&V.value),I=K(()=>{const t=r.value;if(!t)return"";switch(t.status){case le.Sat:case le.Called:case le.Cancelled:case le.Joined:case le.Live:return t.queue_number===null?"Быстрый резерв":`Живая очередь #${t.queue_number}`;case le.Reserve:case le.Reserve_Hostme:return"Бронирование"}return""}),h=()=>{S.value=!0,k.cancelBookingReservation.execute({id:Number(_.itemId)}).then(()=>{z.show("Бронирование отменено"),p("refresh"),p("close"),D.value=!1}).catch(()=>{z.show("Попробуйте еще раз",{label:"Не удалось отменить бронирование",type:"error"})}).finally(()=>{S.value=!1})},X=()=>{const t=O.value;j.value=!0,k.updateBookingReservation.execute({id:Number(_.itemId),comment:t}).then(()=>{z.show("Комментарий изменен"),r.value&&(r.value={...r.value,comment:t}),m.value=!1}).catch(()=>{z.show("Попробуйте еще раз",{label:"Не удалось изменить комментарий",type:"error"})}).finally(()=>{j.value=!1})};return J(m,t=>{var B;t&&(O.value=((B=r.value)==null?void 0:B.comment)||"",$.value=O.value)}),J(u,t=>{p("editMode",t)}),J([()=>_.itemId,w],([t])=>{x.value=!0,A.value=!1,m.value=!1,C.value=!1,k.loadReservationItem.execute({id:Number(t)}).then(B=>{r.value=B}).finally(()=>{x.value=!1})},{immediate:!0}),(t,B)=>{var q,R,g,P,Q;return a(),l(E,null,[x.value||r.value?(a(),l(E,{key:0},[i("h6",Al,U(I.value),1),I.value==="Быстрый резерв"?(a(),l("p",{key:0,class:b(["ark-text_body-xs",t.$style.notification])}," Закроем автоматом через 15 минут, если не будет заказа за столом ",2)):L("",!0),r.value&&r.value.status!==e(le).Reserve&&r.value.status!==e(le).Reserve_Hostme?(a(),l("div",Rl,[s(e(ta),{class:"ark-text_body-m",size:"s",status:r.value.status,"invite-time":r.value.invite_time,created:r.value.created},null,8,["status","invite-time","created"])])):L("",!0),i("p",{class:b(t.$style.label)},"Гость",2),s($e,{name:(q=r.value)==null?void 0:q.name_for_reservation,num:(R=r.value)==null?void 0:R.num_people,foreigner:(g=r.value)==null?void 0:g.foreigner,phone:(P=r.value)==null?void 0:P.phone_number,loading:x.value},null,8,["name","num","foreigner","phone","loading"]),i("p",{class:b(t.$style.label)},"Дата и время",2),s(Je,{edit:C.value,loading:x.value,count:((Q=r.value)==null?void 0:Q.num_people)??0,start:r.value?r.value.status!==e(le).Reserve&&r.value.status!==e(le).Reserve_Hostme?r.value.seating_time??r.value.created:r.value.seating_time:"1970-01-01T01:01:01+10:00",end:r.value&&r.value.end_time||"1970-01-01T01:01:01+10:00",onClose:B[0]||(B[0]=Z=>C.value=!1),onEdited:B[1]||(B[1]=Z=>V.value=Z)},null,8,["edit","loading","count","start","end"]),i("p",{class:b(t.$style.label)},[d(U(m.value?"Изменение комментария":"Комментарий")+" ",1),e(f)&&e(f).code!==111113&&r.value&&r.value.status!==e(le).Reserve_Hostme?(a(),H(e(N),{key:0,size:"xs",appearance:"neutral",type:"button",disabled:x.value,onClick:B[2]||(B[2]=oe(Z=>m.value=!m.value,["stop","prevent"]))},{default:v(()=>[d(U(m.value?"Отменить":"Изменить"),1)]),_:1},8,["disabled"])):L("",!0)],2),i("div",{class:b(t.$style.commentContainer)},[m.value?(a(),l("div",Ml,[de(s(e(at),{modelValue:O.value,"onUpdate:modelValue":B[3]||(B[3]=Z=>O.value=Z),placeholder:"Комментарий..."},null,8,["modelValue"]),[[e(tt)]]),i("div",{class:b(["ark-space_top-2",t.$style.buttons])},[s(e(N),{type:"button",size:"xs",loading:j.value,onClick:oe(X,["stop","prevent"])},{default:v(()=>[d(" Сохранить ")]),_:1},8,["loading"]),s(e(N),{type:"button",size:"xs",appearance:"flat",onClick:B[4]||(B[4]=oe(Z=>m.value=!1,["stop","prevent"]))},{default:v(()=>[d(" Отменить ")]),_:1})],2)])):(a(),l("p",{key:1,class:b(["ark-text_body-s-2",x.value&&"ark-skeleton"])},[r.value&&r.value.comment?(a(),l(E,{key:0},[d(U(r.value.comment),1)],64)):(a(),l(E,{key:1},[d("—")],64))],2))],2),i("p",{class:b(t.$style.label)},"Столы",2),r.value?(a(),l("div",{key:2,class:b(["ark-space_bottom-4",[t.$style.tables,x.value&&"ark-skeleton"]])},[s(e(we),{"show-capacity":!1,"res-id":r.value.id,ids:r.value.tables},null,8,["res-id","ids"])],2)):L("",!0),r.value?(a(),l("div",{key:3,class:b(["ark-space_top-auto",t.$style.actions])},[r.value.status===e(le).Reserve?(a(),H(e(N),{key:0,appearance:"s-danger",onClick:B[5]||(B[5]=Z=>D.value=!0)},{default:v(()=>[d(" Отменить бронь ")]),_:1})):L("",!0),s(e(N),{appearance:"flat",onClick:B[6]||(B[6]=Z=>Y(r.value.id))},{default:v(()=>[d(" Найти на странице ")]),_:1})],2)):L("",!0)],64)):(a(),l("div",Pl,[Xl,s(e(N),{appearance:"neutral",size:"s",onClick:B[7]||(B[7]=Z=>w.value=Date.now())},{default:v(()=>[d(" Попробуйте еще раз ")]),_:1})])),s(e(Ce),{modelValue:D.value,"onUpdate:modelValue":B[8]||(B[8]=Z=>D.value=Z),size:"sm",order:3.1},{default:v(({close:Z})=>{var me,pe,re,ve;return[Ul,s($e,{name:(me=r.value)==null?void 0:me.name_for_reservation,num:(pe=r.value)==null?void 0:pe.num_people,foreigner:(re=r.value)==null?void 0:re.foreigner,phone:(ve=r.value)==null?void 0:ve.phone_number,loading:x.value},null,8,["name","num","foreigner","phone","loading"]),i("div",{class:b(["ark-space_top-6",t.$style.actions])},[s(e(N),{loading:S.value,onClick:h},{default:v(()=>[d(" Да, отменяем ")]),_:1},8,["loading"]),s(e(N),{appearance:"neutral",onClick:Z},{default:v(()=>[d(" Нет, оставляем ")]),_:2},1032,["onClick"])],2)]}),_:1},8,["modelValue"])],64)}}}),Hl="_tables_17vaf_1",ql="_commentContainer_17vaf_18",jl="_actions_17vaf_26",Zl="_buttons_17vaf_27",Wl="_comment_17vaf_18",Jl="_label_17vaf_43",Kl="_notification_17vaf_59",Gl={tables:Hl,commentContainer:ql,actions:jl,buttons:Zl,comment:Wl,label:Jl,notification:Kl},Yl={$style:Gl},Ql=ne(Fl,[["__cssModules",Yl]]),eo={class:"ark-space_bottom-1"},to=["disabled","data-active","onClick"],ao=se({__name:"SepSlots",props:{selectedDate:{},start_time:{},end_time:{}},emits:["update:selectedDate"],setup(M,{emit:y}){const _=M,p=y,{start_time:k,end_time:z}=Oe(_),C=Mt*15,m=K(()=>{const $=new Date(k.value),w=new Date(z.value);if(w.valueOf()-$.valueOf()<C)return[Te.jsonParse($.toJSON())];let x=$;const r=[x],D=x.getMinutes()%15;for(D!==0&&x.setMinutes(x.getMinutes()+(15-D));x.valueOf()<w.valueOf();)x=new Date(Rt(x.valueOf()+C,x.valueOf(),w.valueOf())),r.push(x);return r.map(S=>Te.jsonParse(S.toJSON()))}),A=$=>{if($.length===4)return $.map(D=>({dt:D,key:D.valueOf(),disabled:!1}));const w=$.reduce((D,S)=>(D[S.valueOf()]=!0,D),{}),{hours:x}=$[0].time;return new Array(4).fill("").map((D,S)=>{const j=new Te($[0].day,new Pt(x,S*15));return{dt:j,key:j.valueOf(),disabled:!w[j.valueOf()]}})},V=K(()=>m.value.reduce((w,x)=>{const r=x.time.hours;return w[r]=(w[r]||[]).concat(x),w},[]).filter(w=>w.length>0).map(w=>A(w)));return($,w)=>(a(),l("div",eo,[(a(!0),l(E,null,te(V.value,(x,r)=>(a(),l("div",{key:r,class:b($.$style.slots)},[(a(!0),l(E,null,te(x,D=>{var S;return a(),l("button",{key:D.key,class:b($.$style.slots__item),disabled:D.disabled,"data-active":D.key===((S=$.selectedDate)==null?void 0:S.valueOf()),onClick:j=>p("update:selectedDate",D.dt)},U(D.dt.time),11,to)}),128))],2))),128))]))}}),lo="_slots_9sxcp_1",oo="_slots__item_9sxcp_9",so={slots:lo,slots__item:oo},no={$style:so},ro=ne(ao,[["__cssModules",no]]),io=se({__name:"DoubleCalendar",props:{date:{},max:{},min:{}},emits:["update:date"],setup(M,{emit:y}){const _=y,p=c(qe.currentLocal()),k=c(qe.currentLocal().append({month:1})),z=m=>{p.value=m,k.value=m.append({month:1})},C=m=>{p.value=m.append({month:-1}),k.value=m};return(m,A)=>(a(),l("div",{class:b(m.$style.root)},[s(e(Ee),{"flex-width":"",bordered:!1,value:m.date,month:p.value,min:m.min,"max-viewed-month":p.value,"show-adjacent-days":!1,max:m.max,onDayClick:A[0]||(A[0]=V=>_("update:date",V)),"onUpdate:month":z},null,8,["value","month","min","max-viewed-month","max"]),s(e(Ee),{"flex-width":"",bordered:!1,value:m.date,month:k.value,"min-viewed-month":k.value,"show-adjacent-days":!1,max:m.max,onDayClick:A[1]||(A[1]=V=>_("update:date",V)),"onUpdate:month":C},null,8,["value","month","min-viewed-month","max"])],2))}}),uo="_root_dw5ia_1",co={root:uo},mo={$style:co},vo=ne(io,[["__cssModules",mo]]),po=i("h6",{class:"ark-text_h6 ark-space_bottom-4"},"Новое бронирование",-1),_o=i("p",{class:"ark-text_body-s ark-text_medium ark-space_top-3 ark-space_bottom-1 ark-text_64"}," Когда? ",-1),fo=["data-active","onClick"],bo={class:"ark-text_medium ark-text_body-xs",style:{"white-space":"nowrap",opacity:"0.64"}},yo=["data-active"],ko={class:"ark-text_medium ark-text_body-xs",style:{"white-space":"nowrap",opacity:"0.64"}},go=i("p",{class:"ark-text_body-s ark-text_medium ark-space_top-3 ark-space_bottom-1 ark-text_64"}," Зона (если просят определенную) ",-1),xo=i("p",{class:"ark-text_body-s ark-text_medium ark-space_top-3 ark-text_64"}," Свободные слоты ",-1),ho={key:2,style:{position:"relative"}},$o={key:1},Co=i("span",{class:"ark-text_body-xs"},"(подберем автоматически)",-1),wo={style:{position:"sticky",bottom:"0.5rem",left:"0"}},So={key:3},To=i("h6",{class:"ark-text_h6 ark-space_bottom-4"},"Подтверди бронирование",-1),Bo=i("p",{class:"ark-text_body-s ark-text_medium ark-text_64"},"Время",-1),Do={class:"ark-text_semibold ark-space_bottom-2"},No=i("p",{class:"ark-text_body-s ark-text_medium ark-text_64"},"Количество гостей",-1),Eo={class:"ark-text_semibold ark-space_bottom-2"},Io=i("p",{class:"ark-text_body-s ark-text_medium ark-text_64"},"Зона",-1),Vo={class:"ark-text_semibold ark-space_bottom-6"},Oo=i("span",{class:"ark-text_body-xs"},"(подберем автоматически)",-1),zo=i("h6",{class:"ark-text_h6 ark-space_bottom-3"},"Контактные данные",-1),Lo=se({__name:"NewBookingContent",props:{id:{},maxBookingDate:{},airestoBooking:{type:Boolean}},emits:["add","close"],setup(M,{emit:y}){const _=M,p=y,{maxBookingDate:k}=Oe(_),C=Ge().computedSmallerThen("mobile"),m=Le(),A=Ae(),V=ue(Xt),$=ue(ze),w=ue(Ut),x=Ye({name:["",{required:Ie}],phone:["+7",{required:Ie,softPhone:Gt(!0)}],comment:[""]}),r=c(0),D=c(!1),S=c(2),j=c(!1),O=c(null),f=c(null),Y=c(!1),u=c(!1),I=c(null),h=c(w.value.day),X=K(()=>{const q=w.value.day,R=k.value,g=new Array(10).fill("").map((P,Q)=>q.append({day:Q}));return R?g.filter(P=>P.daySameOrBefore(R)):g}),t=K(()=>{const q=h.value;return X.value.find(R=>R.daySame(q))?"Выбрать":null});J(h,()=>{O.value=null}),J([h,S,f,()=>_.id],([q,R,g,P])=>{P&&R&&(j.value=!0,m.loadAvailableSlots.execute({restaurant_id:P,date:q.toJSON(),group_size:R,zone:g??void 0}).then(Q=>{Q&&(I.value=Q,j.value=!1)}).catch(()=>{I.value=null,A.show("Ошибка загрузки слотов для бронирования",{type:"error"}),j.value=!1}))},{immediate:!0});const B=()=>{if(x.validate(),x.invalid.value||!S.value||!O.value)return;const{comment:q,name:R,phone:g}=x.getCurrentValue();D.value=!0;const P=f.value;(_.airestoBooking?m.createBooking:m.createBookingReservation).execute({restaurant:Number(_.id),num_people:S.value,name_for_reservation:R,phone_number:`+${Ft(g)}`,foreigner:!1,comment:q,required_zone:P??void 0,seating_time:`${O.value.day.toJSON()} ${O.value.time.toString("HH:MM")}`}).then(Z=>{Z&&(A.show(Ne(Ve),{autoClose:15e3,data:{...Z,allTables:$.value,__newbooking:_.airestoBooking}}),_.airestoBooking&&p("add",Z),x.comment.reset(),x.name.reset(),x.phone.setValue("+7"),O.value=null,f.value=null,Y.value=!1,S.value=2,p("close"))}).catch(()=>{A.show("Попробуйте еще раз",{type:"error",label:"Ошибка добавления бронирования"})}).finally(()=>{D.value=!1})};return(q,R)=>r.value?r.value===1?(a(),l(E,{key:1},[To,Bo,i("p",Do,[O.value?(a(),H(e(xe),{key:0,today:"",mask:"[day:numeric] [month:long] [year:numeric], [hour:numeric]:[minute:numeric]",date:O.value.toJSON()},null,8,["date"])):L("",!0)]),No,i("p",Eo,U(S.value),1),Io,i("p",Vo,[f.value?(a(),l(E,{key:0},[d(U(f.value),1)],64)):(a(),l(E,{key:1},[d(" Не важно "),Oo],64))]),zo,i("form",{onSubmit:oe(B,["prevent"])},[s(e(he),{class:"ark-space_bottom-2",control:e(x).name},{default:v(({model:g})=>[s(e(De),{modelValue:g.value,"onUpdate:modelValue":P=>g.value=P,required:"",label:"Имя",placeholder:"Иван",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(he),{class:"ark-space_bottom-2",control:e(x).phone},{default:v(({model:g})=>[s(e(aa),{modelValue:g.value,"onUpdate:modelValue":P=>g.value=P,required:"",label:"Телефон",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(e(he),{class:"ark-space_bottom-6",control:e(x).comment},{default:v(({model:g})=>[s(e(De),{modelValue:g.value,"onUpdate:modelValue":P=>g.value=P,label:"Комментарий",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),i("div",{class:b(q.$style.buttons)},[s(e(N),{type:"submit",size:"l",loading:D.value},{default:v(()=>[d(" Подтвердить ")]),_:1},8,["loading"]),s(e(N),{appearance:"neutral",type:"button",size:"l",onClick:R[6]||(R[6]=oe(g=>r.value=0,["stop","prevent"]))},{default:v(()=>[d(" Назад ")]),_:1})],2)],32)],64)):L("",!0):(a(),l(E,{key:0},[po,s(e(et),{modelValue:S.value,"onUpdate:modelValue":R[0]||(R[0]=g=>S.value=g),label:"Количество гостей",size:"l",min:1},null,8,["modelValue"]),_o,e(C)?(a(),l("div",{key:0,class:b(q.$style.statuses)},[de((a(),l("div",{class:b(q.$style.statusesScroll)},[(a(!0),l(E,null,te(X.value,g=>de((a(),l("button",{key:g.toJSON(),type:"button",class:b(q.$style.date),"data-active":g.daySame(h.value),onClick:P=>h.value=g},[s(e(ye),{mask:"[day:numeric] [month:short]",date:g.toLocalNativeDate()},null,8,["date"]),i("p",bo,[g.daySame(e(w).day)?(a(),l(E,{key:0},[d(" сегодня ")],64)):g.daySame(e(w).day.append({day:1}))?(a(),l(E,{key:1},[d(" завтра ")],64)):(a(),H(e(ye),{key:2,mask:"[weekday:long]",date:g.toLocalNativeDate()},null,8,["date"]))])],10,fo)),[[e(na),g.daySame(h.value),void 0,{updated:!0}]])),128))],2)),[[e(Qe)],[e(sa)]]),s(e(We),{modelValue:u.value,"onUpdate:modelValue":R[2]||(R[2]=g=>u.value=g),"max-width":243,"min-width":243,"min-height":290},{dropdown:v(()=>[s(e(Ee),{value:h.value,max:e(k),min:e(w).day,onDayClick:R[1]||(R[1]=g=>{h.value=g,u.value=!1})},null,8,["value","max","min"])]),default:v(()=>[i("button",{class:b(q.$style.date),"data-active":!t.value},[t.value?(a(),l(E,{key:0},[d(U(t.value),1)],64)):(a(),l(E,{key:1},[s(e(ye),{mask:"[day:numeric] [month:short]",date:h.value.toLocalNativeDate()},null,8,["date"]),i("p",ko,[s(e(ye),{mask:"[weekday:long]",date:h.value.toLocalNativeDate()},null,8,["date"])])],64))],10,yo)]),_:1},8,["modelValue"])],2)):(a(),H(vo,{key:1,date:h.value,"onUpdate:date":R[3]||(R[3]=g=>h.value=g),max:e(k),min:e(w).day},null,8,["date","max","min"])),go,i("div",{class:b(q.$style.statusesScroll)},[(a(!0),l(E,null,te(e(V),(g,P)=>(a(),H(e(ra),{key:P,"hide-radio":"",size:"s",style:{"--ark-background-color":"var(--ark-text-color-08)","white-space":"nowrap"},name:"PreferZone","model-value":f.value,item:g,"onUpdate:modelValue":Q=>f.value=g},{default:v(()=>[d(U(g??"Не важно"),1)]),_:2},1032,["model-value","item","onUpdate:modelValue"]))),128))],2),xo,I.value&&I.value.length>0?(a(),l("div",ho,[(a(!0),l(E,null,te(I.value,g=>(a(),l("div",{key:g.zone,class:"ark-space_bottom-2"},[g.zone!=="default"?(a(),l(E,{key:0},[d(U(g.zone),1)],64)):(a(),l("p",$o,[d(" Зона: Не важно "),Co])),(a(!0),l(E,null,te(g.slots,(P,Q)=>(a(),H(ro,{"selected-date":O.value,"onUpdate:selectedDate":R[4]||(R[4]=Z=>O.value=Z),key:Q,start_time:P.start_time,end_time:P.end_time},null,8,["selected-date","start_time","end_time"]))),128))]))),128)),i("div",wo,[s(e(N),{style:{width:"100%"},class:"ark-space_top-4",disabled:!O.value,onClick:R[5]||(R[5]=oe(g=>r.value=1,["stop","prevent"]))},{default:v(()=>[d(" Продолжить ")]),_:1},8,["disabled"])]),j.value?(a(),l("div",{key:0,class:b(q.$style.spinner)},[s(e(Be),{name:"spinner",size:16}),d(" Загружаем... ")],2)):L("",!0)])):(a(),l("p",So,[j.value?(a(),l(E,{key:0},[s(e(Be),{name:"spinner",size:16}),d(" Загружаем... ")],64)):(a(),l(E,{key:1},[d(" Мы не нашли свободных слотов ")],64))]))],64))}}),Ao="_date_1dz7i_1",Ro="_statuses_1dz7i_25",Mo="_statusesScroll_1dz7i_30",Po="_inline_1dz7i_45",Xo="_preview_1dz7i_51",Uo="_spinner_1dz7i_55",Fo="_buttons_1dz7i_71",Ho={date:Ao,statuses:Ro,statusesScroll:Mo,inline:Po,preview:Xo,spinner:Uo,buttons:Fo},qo={$style:Ho},jo=ne(Lo,[["__cssModules",qo]]),Zo={style:{flex:"1"}},Wo={class:"ark-text_h6 ark-space_bottom-4"},Jo=i("p",null,"Есть несохраненные изменения в бронировании.",-1),Ko=i("p",{class:"ark-space_bottom-6 ark-text_bold"},"Данные потеряются",-1),Go=se({__name:"BookingRoot",props:{id:{}},setup(M){const y=Ht.currentLocal().append({day:4}),_=ia(),{reservationToShow:p,newBookingOpened:k}=qt(_),z=Zt(),C=Wt(),A=Ge().computedSmallerThen("mobile"),V=c(null),$=c(!1),w=c(!1),x=ue(Ke),r=K(()=>C.currentRoute.value.path.endsWith("/booking")),D=()=>{w.value=!1},S=()=>{V.value=null,$.value?w.value=!0:C.push({query:{...z.query,type:void 0,bookingid:void 0}})},j=()=>{var O,f;$.value=!1,C.push({query:{...z.query,type:(O=V.value)!=null&&O.airesto?void 0:"resto",bookingid:(f=V.value)==null?void 0:f.full.id}}),V.value=null,w.value=!1};return(O,f)=>{const Y=Jt("RouterView");return a(),l(E,null,[i("div",{class:b(r.value&&O.$style.forstickytable)},[i("div",Zo,[s(Y)])],2),s(e(Ce),{modelValue:e(k),"onUpdate:modelValue":f[0]||(f[0]=u=>jt(k)?k.value=u:null),overscroll:"none",size:e(A)?"full":void 0},{default:v(({close:u})=>{var I,h;return[s(jo,{id:O.id,"airesto-booking":(I=e(x))==null?void 0:I.has_bookings,"max-booking-date":(h=e(x))!=null&&h.has_bookings?void 0:e(y),onAdd:e(_).onAddBooking,onClose:u},null,8,["id","airesto-booking","max-booking-date","onAdd","onClose"])]}),_:1},8,["modelValue","size"]),s(e(Sa),{"close-button":"",direction:"right","model-value":e(p)!==null,"root-class":O.$style.tablebarRoot,"content-class":O.$style.tableBarContent,"onUpdate:modelValue":S},{default:v(()=>[e(p)?(a(),l("div",{key:0,class:b(O.$style.tablebarContent)},[e(p).type==="resto"?(a(),H(Ql,{key:0,"item-id":e(p).id,onRefresh:f[1]||(f[1]=u=>e(_).onDeleteReservation(e(p).id)),onEditMode:f[2]||(f[2]=u=>$.value=u),onClose:D},null,8,["item-id"])):(a(),H(Ll,{key:1,"item-id":e(p).id,onRefresh:f[3]||(f[3]=u=>e(_).onHandleAiresto(e(p).id,u)),onEditMode:f[4]||(f[4]=u=>$.value=u),onClose:D,onChangeTable:e(_).onSwapTables},null,8,["item-id","onChangeTable"]))],2)):L("",!0)]),_:1},8,["model-value","root-class","content-class"]),s(e(Ce),{modelValue:w.value,"onUpdate:modelValue":f[5]||(f[5]=u=>w.value=u),size:"sm"},{default:v(({close:u})=>[i("h6",Wo," Точно хочешь "+U(V.value?"открыть другую бронь?":"закрыть бронь?"),1),Jo,Ko,i("div",{class:b(O.$style.buttons)},[s(e(N),{onClick:j},{default:v(()=>[d(" Да, "+U(V.value?"открыть":"закрыть"),1)]),_:1}),s(e(N),{appearance:"neutral",class:"ark-space_left-1",onClick:u},{default:v(()=>[d(" Нет, подожди ")]),_:2},1032,["onClick"])],2)]),_:1},8,["modelValue"])],64)}}}),Yo="_tablebarRoot_1x6gy_1",Qo="_tablebarContent_1x6gy_8",es="_forstickytable_1x6gy_16",ts={tablebarRoot:Yo,tablebarContent:Qo,forstickytable:es},as={$style:ts},ys=ne(Go,[["__cssModules",as]]);export{ys as default};
