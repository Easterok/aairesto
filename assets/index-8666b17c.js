import{T as v,b4 as w,v as D,u as A,m as E,y as p,aa as O,aL as _,r as l,w as L,b,a0 as N}from"./index-ed930d81.js";const R=Object.values(v),c=R.reduce((u,d)=>(u[d]=!0,u),{}),F=w("useBooking",()=>{const u=D(),d=A(),k=E(),y=p(O),i=p(_),r=l([]),f=l(!1),S=l(i.value.day),n=l([]),g=l(!1);L(y,e=>{e&&(S.value.daySame(i.value.day)||(S.value=i.value.day))});const T=b(()=>{const e=u.currentRoute.value.query.bookingid,s=u.currentRoute.value.query.type;return typeof e!="string"?null:{id:e,type:typeof s=="string"&&(s==="resto"||"queue")?s:null}});return{navItems:b(()=>{var s;const e=(s=y.value)==null?void 0:s.code;return[{text:"Таблица",to:`/restaurant/${e}/booking`,exact:!0},{text:"Списком по дням",to:`/restaurant/${e}/booking/list`}]}),todaysLoading:f,todaysBookings:r,onSafeLoadBookings:(e,s)=>{f.value=!0,d.loadBooking.execute({restaurant_id:e,start_date:s.toJSON(),end_date:s.toJSON()}).then(a=>{r.value=a??[]}).catch(()=>{k.show("Попробуй перезагрузить страницу",{type:"error",label:"Не удалось загрузить бронирования"})}).finally(()=>{f.value=!1})},toggleNewBooking:()=>{g.value=!g.value},newBookingOpened:g,reservationToShow:T,tableDate:S,tableSlots:n,setTableSlots:e=>{n.value=e},concatTableSlots:e=>{n.value=n.value.concat(e)},onAddBooking:e=>{const[s]=e.seating_time.split("T"),a=N.jsonParse(s);n.value=n.value.map(t=>{if(e.tables.includes(t.id)){const o=t.reservations.concat(e);return{...t,reservations:o}}return t}),a.daySame(i.value.day)&&(r.value=r.value.concat(e))},onDeleteReservation:e=>{n.value=n.value.map(s=>{const a=s.reservations.filter(t=>c[t.status]?!0:`${t.id}`!=`${e}`);return{...s,reservations:a}}),r.value=r.value.filter(s=>`${s.id}`!=`${e}`)},onHandleAiresto:(e,s)=>{n.value=n.value.map(a=>{let t=a.reservations;return s.status===v.CANCELLED||s.status===v.CANCELLED_NO_DEPOSIT||s.status===v.CLOSED?t=a.reservations.filter(o=>c[o.status]?`${o.id}`!=`${e}`:o):t=a.reservations.map(o=>c[o.status]&&`${o.id}`==`${e}`?s:o),{...a,reservations:t}}),r.value=r.value.map(a=>`${a.id}`==`${e}`?s:a)},onSwapTables:e=>{const s=e.prev.reduce((t,o)=>(t[o]=!0,t),{}),a=e.new.reduce((t,o)=>(t[o]=!0,t),{});n.value=n.value.map(t=>{let o=t.reservations;return s[t.id]&&!a[t.id]?o=o.filter(({id:B,status:$})=>c[$]&&B!==e.dto.id):a[t.id]&&!s[t.id]&&(o=o.concat(e.dto)),{...t,reservations:o}}),r.value=r.value.map(t=>t.id===e.dto.id?e.dto:t)}}});export{F as u};
