import{d as g,m as E,w as b,e as q,r as x,c as k,h as s,i as l,k as o,a as f,n as C,s as N,u as R,v as U,x as $,p as M,y as z,o as A,z as B,j as v,A as I,V as S,_ as j}from"./index-5702d411.js";import{c as F,r as y,e as L,_ as h}from"./index-7d630444.js";import{I as O}from"./index-0fb832de.js";import"./index-60702af0.js";const T=g({__name:"Login",setup(Y){const d=R(),_=E(),n=U(),V=$(),u=z(S),e=F({email:["",{required:y,email:L}],password:["",{required:y}]}),p={"Unable to log in with provided credentials.":"Неверная почта или пароль"};b([e.email.value,e.password.value],()=>{e.email.removeErrors(["_async"]),e.password.removeErrors(["_async"])}),q(()=>{V.query.t==="1"&&(d.authorized.value=!1,_.show("Токен авторизации просрочен",{type:"info",label:"Авторизуйтесь еще раз"}),n.replace({query:{...n.currentRoute.value.query,t:void 0}}))});const i=x(!1),w=()=>{if(e.validate(),e.invalid.value)return;i.value=!0;const c=e.getCurrentValue();d.login(c).then(()=>{u==null||u.verify(),n.push("/")}).catch(([r])=>{if(r.non_field_errors&&r.non_field_errors[0]){const a=r.non_field_errors[0];e.email.setErrors({_async:p[a]||a}),e.password.setErrors({_async:p[a]||a})}else _.show(JSON.stringify(r),{type:"error",label:"Ошибка авторизации"})}).finally(()=>{i.value=!1})};return(c,r)=>{const a=M("router-link");return A(),k("form",{class:C(c.$style.form),onSubmit:N(w,["prevent"])},[s(o(h),{control:o(e).email},{default:l(({model:t})=>[s(o(B),{modelValue:t.value,"onUpdate:modelValue":m=>t.value=m,placeholder:"Email",autocomplete:"email",name:"email",inputmode:"email"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s(o(h),{control:o(e).password},{default:l(({model:t})=>[s(o(O),{modelValue:t.value,"onUpdate:modelValue":m=>t.value=m,placeholder:"Пароль"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),f("p",null,[s(a,{to:"/sign-up"},{default:l(()=>[v("Регистрация")]),_:1})]),f("div",null,[s(o(I),{type:"submit",loading:i.value},{default:l(()=>[v("Продолжить")]),_:1},8,["loading"])])],34)}}}),J="_form_as36q_1",K={form:J},P={$style:K},W=j(T,[["__cssModules",P]]);export{W as default};
