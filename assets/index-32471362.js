import{d as te,a3 as se,y as Z,Q as le,r as re,b as _,w as ce,o as l,c as u,k as n,t as d,l as q,j as y,n as v,h as z,S as ie,F as w,a as r,a7 as ue,g as K,q as P,i as g,aF as J,aG as Q,A as V,s as U,Y as de,ai as _e,aO as D,aj as Y,_ as ae,a9 as i,aP as pe,$ as W,a0 as X,Z as H}from"./index-2ac84a6d.js";import{T as ee}from"./index-03765aec.js";const me=k=>{k.setAttribute("data-ark-data-list-item",""),k.setAttribute("role","option"),k.style.justifyContent="initial"},Ie={mounted:me},ve={key:0,class:"ark-space_bottom-2 ark-text_medium"},be={key:0,class:"ark-text_body-s"},fe=r("span",{class:"ark-text_body-xs"}," на ",-1),ye=r("span",{class:"ark-text_body-xs"},"чел",-1),ke=["href"],he={class:"ark-text_body-s ark-text_semibold ark-space_bottom-1"},$e={class:"ark-text_body-xs ark-space_bottom-1"},ze={style:{display:"flex","justify-content":"space-between",gap:"0.5rem","align-items":"center"}},ge={key:0},Te={key:1},Se=["data-small"],Ce=te({__name:"TableSelect",props:{item:{},loading:{type:Boolean},buttonSize:{},showClient:{type:Boolean,default:!0},buttonText:{},buttonReverse:{type:Boolean}},emits:["tableSelect","close"],setup(k,{emit:L}){const T=k,M=L,{item:c}=se(T),B=Z(de),S=Z(_e),b=le({}),f=re(null),F=["стол","стола","столов"],I=["Выбран","Выбрано","Выбрано"],o=_(()=>{const e=b;return Object.keys(e).filter(s=>!!e[s])}),C=e=>{const s=Array.isArray(e)?e:[e],t=o.value;return s.every(a=>!!t.find(m=>m===a))},N=(e,s)=>{(typeof s=="string"?[s]:s).forEach(a=>{b[a]=e})},A=_(()=>{const e=S.value;return c.value.tables.map(a=>{var G;const h=(Array.isArray(a)?a:[a]).map($=>e[$]).filter(Boolean),ne=h.map($=>$.number).join(`${D}+${D}`),oe=h.map($=>$.capacity).join("+");return{ids:h.map($=>$.id),number:ne,capacity:oe,zone:(G=h[0])==null?void 0:G.zone}})}),x=_(()=>{const e=o.value.length,s=Y(F,e);return`${Y(I,e)} ${e} ${s}`}),R=_(()=>{const e=o.value,s=S.value;let t=0;const a=[];return e.forEach(m=>{const h=s[m];t+=h.capacity,a.push(`#${h.number}`)}),`${a.join(", ")} (на ${t} чел)`}),j=_(()=>{const s=c.value.phone_number||"";return s.slice(s.length-5).replace("-","")}),E=_(()=>{const e=f.value,s=Object.values(S.value),t=e?s.filter(({zone:a})=>a===e):s;return t.sort((a,m)=>Number(a.number)-Number(m.number)),t}),p=()=>{const e=o.value;e.length!==0&&M("tableSelect",e)},O=()=>{Object.keys(b).forEach(e=>{delete b[e]})};return ce(B,e=>{const s=e.filter(Boolean);s.length>0&&!f.value&&(f.value=s[0])},{immediate:!0}),(e,s)=>(l(),u(w,null,[e.showClient?(l(),u("p",ve,["queue_number"in n(c)&&n(c).queue_number?(l(),u("span",be,"№"+d(n(c).queue_number)+" ",1)):q("",!0),y(d(n(c).name_for_reservation),1),fe,y(d(n(c).num_people),1),ye,n(c).phone_number?(l(),u("a",{key:1,class:v(["ark-space_left-1",e.$style.link]),href:`tel:${n(c).phone_number}`},[z(n(ie),{name:"phone",style:{"margin-right":"2px"},size:12}),y(d(j.value),1)],10,ke)):q("",!0)])):q("",!0),A.value.length>0?(l(),u(w,{key:1},[r("p",he,[ue(e.$slots,"expectedTitle",{},()=>[y(" Предлагаемые столы ")])]),r("div",{class:v(["ark-space_bottom-3",e.$style.tables])},[(l(!0),u(w,null,K(A.value,(t,a)=>(l(),P(n(Q),{key:a,class:v(["ark-text_body-s-2 ark-text_medium",e.$style.tables__item]),for:`expected_table_${a}`},{default:g(()=>[z(n(J),{id:`expected_table_${a}`,size:"s","model-value":C(t.ids),"onUpdate:modelValue":m=>N(m,t.ids)},null,8,["id","model-value","onUpdate:modelValue"]),r("div",null,[z(n(ee),{item:t},null,8,["item"])])]),_:2},1032,["class","for"]))),128))],2)],64)):q("",!0),r("div",{class:v(["ark-space_bottom-2",e.$style.zones])},[(l(!0),u(w,null,K(n(B),(t,a)=>(l(),P(n(V),{key:a,size:"xs",type:"button",appearance:f.value===t?"primary":"neutral",onClick:m=>f.value=t},{default:g(()=>[y(d(t??"Все"),1)]),_:2},1032,["appearance","onClick"]))),128))],2),r("div",{class:v(e.$style.tables)},[(l(!0),u(w,null,K(E.value,t=>(l(),P(n(Q),{key:t.id,class:v(["ark-text_body-s-2 ark-text_medium",e.$style.tables__item]),for:`table_${t.id}`},{default:g(()=>[z(n(J),{id:`table_${t.id}`,size:"s","model-value":!!b[t.id],"onUpdate:modelValue":a=>b[t.id]=a},null,8,["id","model-value","onUpdate:modelValue"]),r("div",null,[z(n(ee),{item:t,zone:!f.value},null,8,["item","zone"])])]),_:2},1032,["class","for"]))),128))],2),r("div",{class:v(e.$style.footer)},[r("div",$e,[r("div",ze,[o.value.length>0?(l(),u("p",ge,d(x.value),1)):(l(),u("p",Te,"Выберите стол")),z(n(V),{appearance:"flat",size:"xs",onClick:U(O,["stop","prevent"])},{default:g(()=>[y(" Сбросить ")]),_:1})]),r("p",null,d(o.value.length>0?R.value:"..."),1)]),r("div",{class:v(e.$style.buttons),"data-small":!!e.buttonText},[z(n(V),{size:e.buttonSize,disabled:o.value.length===0,loading:e.loading,onClick:U(p,["stop"])},{default:g(()=>[y(d(e.buttonText??"Подтвердить"),1)]),_:1},8,["size","disabled","loading"]),e.buttonReverse?(l(),P(n(V),{key:0,appearance:"neutral",size:e.buttonSize,onClick:s[0]||(s[0]=U(t=>M("close"),["stop"]))},{default:g(()=>[y(" Отменить ")]),_:1},8,["size"])):q("",!0)],10,Se)],2)],64))}}),Ae="_footer_p2z3f_1",xe="_buttons_p2z3f_10",Re="_smallzone_p2z3f_18",je="_link_p2z3f_25",Ee="_zones_p2z3f_33",Oe="_tables_p2z3f_39",qe="_tables__item_p2z3f_43",we={footer:Ae,buttons:xe,smallzone:Re,link:je,zones:Ee,tables:Oe,tables__item:qe},Me={$style:we},Ke=ae(Ce,[["__cssModules",Me]]),Be=["data-type","data-size"],Ne=te({__name:"ReservationStatus",props:{status:{},size:{default:"m"},inviteTime:{},created:{}},setup(k){const L=k,{status:T,inviteTime:M,created:c}=se(L),B=Z(pe),S=_(()=>B.value.native),b={[i.Joined]:"Пришел",[i.Called]:"Вызван",[i.Live]:"Ожидает"},f=_(()=>{const o=T.value;return b[o]??o}),F=_(()=>{switch(T.value){case i.Cancelled:return"cancelled";case i.Called:return"called";case i.Reserve:case i.Reserve_Hostme:return"reserve";case i.Sat:return"sat";case i.Joined:return"joined";default:return"live"}}),I=_(()=>{const o=T.value,C=S.value.valueOf(),N=c.value,A=M.value;if(o===i.Live&&N){const[x,R]=N.split("T"),j=new W(X.jsonParse(x),H.fromString(R)).valueOf(),E=C-j,p=H.fromAbsoluteMilliseconds(E),O=p.toString("HH:MM"),e=p.hours?O:`${p.minutes} мин.`;return`${D}(${e})`}if(o===i.Called&&A){const[x,R]=A.split("T"),j=new W(X.jsonParse(x),H.fromString(R)).valueOf(),E=C-j,p=H.fromAbsoluteMilliseconds(E),O=p.toString("HH:MM"),e=p.hours?O:`${p.minutes} мин.`;return`${D}(${e})`}return""});return(o,C)=>(l(),u("span",{"data-type":F.value,"data-size":o.size,class:v(o.$style.tag)},d(f.value)+d(I.value),11,Be))}}),Pe="_tag_1ivsp_1",Ve={tag:Pe},He={$style:Ve},Ue=ae(Ne,[["__cssModules",He]]);export{Ie as O,Ue as R,Ke as T};
