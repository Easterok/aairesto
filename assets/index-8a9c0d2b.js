import{d as Me,a3 as Je,y as xe,b as m,o,c as u,q as re,k as e,W as Xe,l as U,a as s,t as C,j as g,F as x,g as ne,n as i,h as r,S as Tt,aa as nt,$ as X,a0 as Ne,Z as pe,b5 as Wt,a2 as $e,aj as Dt,aO as Lt,b6 as Et,_ as Ie,aN as ot,r as A,w as de,a7 as at,aC as st,s as it,A as P,i as h,aP as Mt,al as lt,b7 as Zt,u as rt,m as ct,Q as et,E as Ue,b8 as ht,C as gt,U as Kt,z as $t,a1 as Fe,ai as Gt,ab as Yt,ac as Qt,aD as Xt,b9 as ea,T as Oe,aL as Vt,ba as ta,aF as St,aG as Pe,P as aa,aM as sa,bb as la,a9 as Ke,v as na,x as oa,bc as ia,aq as Ge,aK as wt,ah as zt,af as Ot,ad as Ye,Y as ra,bd as ca}from"./index-2ac84a6d.js";import{O as ua,I as Ct,M as da}from"./index-511f1bf9.js";import{T as Qe}from"./index-2dcd8634.js";import{T as It}from"./index-03765aec.js";import{c as At,p as qt,s as _a}from"./index-e103f8f3.js";import{c as Bt,r as tt,s as va,_ as Re,b as ma}from"./index-b51ad6a4.js";import{I as fa,_ as pa}from"./index-502044f9.js";import{F as ba}from"./index-d9c5e50f.js";import{v as ya,a as ka,S as ha}from"./index-d9444f9d.js";import{u as ga}from"./index-5f0aee30.js";import"./index-c24d0159.js";import"./index-cc80e411.js";import"./index-f75dc1b0.js";const $a=["data-conf"],Sa=s("p",{class:"ark-text_body-xs ark-text_semibold ark-space_bottom-1"}," Новое бронирование ",-1),wa={class:"ark-text_semibold"},za={class:"ark-text_body-xs ark-space_bottom-2"},Oa={class:"ark-text_body-xs ark-text_64"},Ca={class:"ark-text_body-xs"},xa=Me({__name:"SelectedPreview",props:{vertical:{},horizontal:{},tables:{},time:{},conf:{type:Boolean}},setup(ae){const oe=ae,{vertical:$,horizontal:N,tables:Z,time:K}=Je(oe),F=xe(nt),T=m(()=>{const f=$.value;return f?f.start.time.toJSON():null}),G=m(()=>{const f=$.value;if(!f)return null;const y=f.end.time.valueOf(),M=new Date(y+$e*15),Y=new X(Ne.fromLocalNativeDate(M),pe.fromLocalNativeDate(M));return`${f.start.time.time.toString("HH:MM")} ${Wt} ${Y.time.toString("HH:MM")}`}),ee=m(()=>{const f=N.value,y=Z.value,M=Object.keys(y);if(!f)return[];const{start:Y,end:se}=f,R=[];let te=!1;for(let ce=0;ce<M.length;ce++){const le=y[M[ce]];if(!te&&le.id===Y.column&&(te=!0),te&&(R.push({id:le.id,num:le.number,zone:le.zone,cap:le.capacity}),le.id===se.column))break}return R}),q=m(()=>ee.value.reduce((f,y)=>f+y.cap,0)),J=m(()=>{const f=$.value;if(!f)return null;const{start:y,end:M}=f,Y=y.time.valueOf();let se=M.time.valueOf()+$e*15;return se<Y&&(se+=Et),pe.fromAbsoluteMilliseconds(se-Y)}),L=["час","часа","часов"],W=m(()=>{const f=J.value;if(!f)return"";const y=[];return f.hours!==0&&y.push(`${f.hours} ${Dt(L,f.hours)}`),f.minutes!==0&&y.push(`${f.minutes} мин`),y.join(Lt)}),E=m(()=>{const f=ee.value;if(!f[0])return[];const y=f[0].zone,M=[];f.every(te=>te.zone===y)||M.push("Столы из разных зон");const Y=$.value,se=K.value;Y&&Y.start.time.valueOf()<se.valueOf()&&M.push("Время начала в прошлом");const R=F.value;return Y&&R&&Y.start.time.valueOf()<new X(Y.start.time.day,pe.fromString(R.opening_time)).valueOf()&&M.push("Время начала до открытия"),M});return(f,y)=>(o(),u("div",{class:i(f.$style.root),"data-conf":f.conf},[Sa,T.value?(o(),re(e(Xe),{key:0,today:"",mask:"[day:numeric] [month:long] [year:numeric]",class:"ark-text_body-xs",date:T.value},null,8,["date"])):U("",!0),s("p",wa,C(G.value),1),s("p",za,C(W.value),1),s("p",Oa,[g(" Столы "),(o(!0),u(x,null,ne(ee.value,M=>(o(),u("span",{key:M.id,class:i(f.$style.table)},C(M.num),3))),128))]),s("p",Ca,[g(" На "),s("b",null,C(q.value)+" чел",1)]),E.value.length>0?(o(),u("div",{key:1,class:i(["ark-space_top-2",f.$style.notification])},[(o(!0),u(x,null,ne(E.value,M=>(o(),u("p",{key:M,class:i(f.$style.notification__text)},[r(e(Tt),{name:"warning",style:{color:"var(--supra-attention-color)"},size:12}),g(" "+C(M),1)],2))),128))],2)):U("",!0)],10,$a))}}),Na="_root_a4i85_1",Ta="_table_a4i85_13",Da="_notification_a4i85_27",La="_notification__text_a4i85_38",Ea={root:Na,table:Ta,notification:Da,notification__text:La},Ma={$style:Ea},Ut=Ie(xa,[["__cssModules",Ma]]),Va=["data-show-hidden"],Ia={style:{position:"absolute","z-index":"-1",top:"40px",left:"-4px"}},Aa=["data-col","data-time"],qa=["data-col","data-time"],Ba=["data-id","data-high","data-type","data-selection","data-airesto","onClick"],Ua=s("p",null,"Жду следующую",-1),xt=32,Pa=Me({__name:"MobileTimesheet",props:{timeSegments:{},tables:{},data:{},highlight:{},count:{},addEnabled:{type:Boolean},freezLoading:{type:Boolean}},emits:["add","show","freez"],setup(ae,{emit:oe}){ot(l=>({"4b592133":be.value}));const $=ae,N=oe,{timeSegments:Z,data:K,tables:F,count:T,addEnabled:G}=Je($),ee=xe(Mt),q=A(128),J=A(null),L=A(null),W=A(!1),E=A(!1),f=A(null),y=m(()=>ee.value.native);let M=null;de([J,T],([l],b,p)=>{if(p(()=>{M&&clearTimeout(M),M=null}),l){const z=Array.isArray(l)?l[0]:l;M=setTimeout(()=>{q.value=z.clientWidth})}},{immediate:!0});const Y=m(()=>Z.value.reduce((b,p)=>{const z=new Date(p.valueOf()+$e*15),t=new X(Ne.fromLocalNativeDate(z),pe.fromLocalNativeDate(z)),d={a:p,b:t};return b.push(d),b},[])),se=m(()=>F.value.reduce((b,p,z)=>(b[p.id]=z,b),{})),R=m(()=>F.value.reduce((b,p)=>(b[p.id]=p,b),{})),te=m(()=>{const l=f.value;if(!l)return null;const{start:b,end:p}=l,z=b.time.valueOf(),t=p.time.valueOf(),d=Math.abs(z-t)/($e*15);return b.time.valueOf()>p.time.valueOf()?{start:p,end:b,diff:d}:{start:b,end:p,diff:d}}),ce=m(()=>{const l=f.value;if(!l)return null;const{start:b,end:p}=l,z=se.value,t=z[b.column],d=z[p.column],_=Math.abs(t-d);return t<d?{start:b,end:p,diff:_}:{start:p,end:b,diff:_}}),le=m(()=>{const l=ce.value;return l?`${(l.diff+1)*q.value}px`:"0px"}),ke=m(()=>{const l=te.value;return l?`${(l.diff+1)*(xt/2)}px`:"0px"}),Ce=m(()=>{const l=ce.value,b=se.value;return l?`${b[l.start.column]*q.value}px`:"0px"}),Ve=m(()=>{const l=Y.value[0],b=te.value;return!l||!b?"0px":`${(b.start.time.valueOf()-l.a.valueOf())/($e*15)*(xt/2)+42}px`}),he=m(()=>{const l=le.value,b=ke.value,p=Ce.value,z=Ve.value;return{left:p,width:l,height:b,top:z}}),Te=m(()=>G.value&&!!f.value),_e=m(()=>{const l=Z.value;if(l.length===0)return[-1/0,1/0];const b=l[0].toLocalNativeDate().valueOf(),p=l[l.length-1];let z=p.day;p.time.valueOf()>p.time.shift({minutes:30}).valueOf()&&(z=z.append({day:1}));const t=new X(z,p.time.shift({minutes:30})).toLocalNativeDate().valueOf();return[b,t]}),be=m(()=>{const l=y.value.valueOf(),[b,p]=_e.value;return`${At(l,b,p).toFixed(2)}%`}),c=m(()=>{const l=K.value,[b,p]=_e.value;return qt(l,b,p)}),k=()=>{E.value=!1,f.value=null,W.value=!1},I=()=>{const l=ce.value,b=te.value,p=R.value;if(!l||!b)return;const z=new Date(b.end.time.valueOf()+$e*15),t=new X(Ne.fromLocalNativeDate(z),pe.fromLocalNativeDate(z)),d={...b,end:{...b.end,time:t}};N("add",{horizontal:l,vertical:d,tables:p}),f.value=null,E.value=!1};let B=null;const Q=()=>{B&&clearTimeout(B),B=null},ue=l=>{if(Q(),!G.value)return;const b=l.target,p=b.getAttribute("data-col"),z=b.getAttribute("data-time");!p||!z||W.value||(B=setTimeout(()=>{const t={column:p,time:X.fromString(z)};f.value={start:t,end:t},E.value=!1,W.value=!0},500))},O=()=>{const l=f.value,b={};if(l){const p=R.value,z=Object.keys(p),{start:t,end:d}=l;let _=!1;for(let S=0;S<z.length;S++){const w=p[z[S]];if(!_&&w.id===t.column&&(_=!0),_&&(b[w.id]=!0,w.id===d.column))break}N("freez",{time:l.start.time,tables:Object.keys(b)})}};de(()=>$.freezLoading,(l,b)=>{!l&&b&&k()});const D=l=>{if(W.value){Q();const b=l.target,p=b.getAttribute("data-col"),z=b.getAttribute("data-time");if(!p||!z)return;l.preventDefault(),l.stopPropagation();const t={column:p,time:X.fromString(z)};f.value={...f.value,end:t},W.value=!1,E.value=!0}};return de(G,(l,b,p)=>{p(()=>{document.removeEventListener("pointerup",Q),document.removeEventListener("pointercancel",Q)}),l&&(document.addEventListener("pointerup",Q),document.addEventListener("pointercancel",Q))},{immediate:!0}),(l,b)=>(o(),u("div",{ref_key:"timesheetRef",ref:L,class:i(l.$style.timesheet),"data-show-hidden":W.value},[s("div",Ia,[(o(!0),u(x,null,ne(Y.value,(p,z)=>(o(),u("p",{key:z,class:i(l.$style.time)},C(p.a.time),3))),128))]),(o(!0),u(x,null,ne(e(F),(p,z)=>(o(),u("div",{key:p.id},[s("div",{class:i(l.$style.label)},[s("div",{class:i(l.$style.label__content)},[z===0?(o(),u("div",{key:0,ref_for:!0,ref_key:"columnRef",ref:J},null,512)):U("",!0),at(l.$slots,"xlabel",{item:p})],2)],2),s("div",{class:i(l.$style.content),onContextmenu:b[0]||(b[0]=it(()=>{},["prevent"])),onPointerdown:ue,onClick:D},[(o(!0),u(x,null,ne(Y.value,(t,d)=>(o(),u("div",{key:d,class:i(l.$style.cell)},[s("p",{"data-col":p.id,"data-time":t.a,class:i(l.$style.cell__book)},C(t.a.time),11,Aa),s("p",{"data-col":p.id,"data-time":t.b,class:i(l.$style.cell__book)},C(t.b.time),11,qa)],2))),128)),(o(!0),u(x,null,ne(c.value[z],(t,d)=>(o(),u("div",{key:`${z}_${d}`,class:i(l.$style.bubble),style:st(t.style),"data-id":t.original.full.id,"data-high":`${t.original.full.id}`===l.highlight,"data-type":t.original.type,"data-selection":Te.value,"data-airesto":t.original.airesto,onClick:_=>N("show",t.original)},[s("div",{class:i(l.$style.bubble__content)},[at(l.$slots,"default",{item:t.original})],2)],14,Ba))),128))],34)]))),128)),Te.value?(o(),u("div",{key:0,class:i(l.$style.selection),style:st(he.value)},[W.value?(o(),u("div",{key:1,class:i(["ark-text_body-xs",l.$style.dblclick])},[Ua,s("div",{class:i(l.$style.dblclick__btn)},[r(e(P),{"icon-button":"",size:"xs",appearance:"flat",icon:"close",onClick:k})],2),r(e(P),{size:"xs",class:"ark-space_top-1",style:{"pointer-events":"auto"},loading:l.freezLoading,onClick:O},{default:h(()=>[g(" Резерв 15мин ")]),_:1},8,["loading"])],2)):(o(),re(Ut,{key:0,vertical:te.value,horizontal:ce.value,tables:R.value,time:y.value,conf:!!E.value},null,8,["vertical","horizontal","tables","time","conf"])),E.value?(o(),u("div",{key:2,class:i(l.$style.selection__btn)},[r(e(P),{size:"xs",loading:l.freezLoading,onClick:O},{default:h(()=>[g(" Резерв 15мин ")]),_:1},8,["loading"]),r(e(P),{size:"xs",style:{background:"var(--supra-accent)"},onClick:I},{default:h(()=>[g(" Создать ")]),_:1}),r(e(P),{size:"xs",appearance:"neutral",onClick:k},{default:h(()=>[g(" Отменить ")]),_:1})],2)):U("",!0)],6)):U("",!0)],10,Va))}}),Ra="_timesheet_fq4yr_1",ja="_time_fq4yr_1",Ha="_label_fq4yr_23",Fa="_label__content_fq4yr_36",Ja="_cell_fq4yr_43",Wa="_cell__book_fq4yr_60",Za="_content_fq4yr_75",Ka="_bubble_fq4yr_80",Ga="_bubble__content_fq4yr_138",Ya="_slide_fq4yr_150",Qa="_selection_fq4yr_168",Xa="_selection__btn_fq4yr_181",es="_dblclick_fq4yr_195",ts="_dblclick__btn_fq4yr_203",as={timesheet:Ra,time:ja,label:Ha,label__content:Fa,cell:Ja,cell__book:Wa,content:Za,bubble:Ka,bubble__content:Ga,slide:Ya,selection:Qa,selection__btn:Xa,dblclick:es,dblclick__btn:ts},ss={$style:as},ls=Ie(Pa,[["__cssModules",ss]]),ns={style:{isolation:"isolate"}},os=["data-show-hidden"],is=["data-col","data-time","onPointerdown"],rs=["data-col","data-time","onPointerdown"],cs=["data-id","data-high","data-type","data-selection","data-airesto","onClick"],us=s("p",null,"Жду следующую",-1),ds=s("p",null,"Масштаб",-1),_s=Me({__name:"Timesheet",props:{timeSegments:{},tables:{},data:{},highlight:{},mode:{},addEnabled:{type:Boolean},size:{},freezLoading:{type:Boolean}},emits:["add","show","update:size","freez"],setup(ae,{emit:oe}){ot(t=>({"3fed33b5":E.value,"60d2716e":c.value,"3286fe10":k.value}));const $=ae,N=oe,{timeSegments:Z,data:K,tables:F,mode:T,addEnabled:G,size:ee}=Je($),q=xe(Mt),J=m(()=>ee.value*32),L=m(()=>J.value),W=m(()=>L.value/2),E=m(()=>`${J.value}px`),f=A(null),y=A(!1),M=m(()=>Z.value.reduce((d,_)=>{const S=new Date(_.valueOf()+$e*15),w=new X(Ne.fromLocalNativeDate(S),pe.fromLocalNativeDate(S)),j={a:_,b:w};return d.push(j),d},[])),Y=m(()=>F.value.reduce((d,_,S)=>(d[_.id]=S,d),{})),se=m(()=>F.value.reduce((d,_)=>(d[_.id]=_,d),{})),R=m(()=>{const t=f.value;if(!t)return null;const{start:d,end:_}=t,S=d.time.valueOf(),w=_.time.valueOf(),j=Math.abs(S-w)/($e*15);return d.time.valueOf()>_.time.valueOf()?{start:_,end:d,diff:j}:{start:d,end:_,diff:j}}),te=m(()=>{const t=f.value;if(!t)return null;const{start:d,end:_}=t,S=Y.value,w=S[d.column],j=S[_.column],ve=Math.abs(w-j);return w<j?{start:d,end:_,diff:ve}:{start:_,end:d,diff:ve}}),ce=m(()=>{const t=te.value;return t?`${(t.diff+1)*L.value}px`:"0px"}),le=m(()=>{const t=R.value;return t?`${(t.diff+1)*(W.value/2)}px`:"0px"}),ke=m(()=>{const t=te.value,d=Y.value;return t?`${d[t.start.column]*L.value}px`:"0px"}),Ce=m(()=>{const t=M.value[0],d=R.value;return!t||!d?"0px":`${(d.start.time.valueOf()-t.a.valueOf())/($e*15)*(W.value/2)}px`}),Ve=m(()=>{const t=ce.value,d=le.value,_=ke.value,S=Ce.value;return{left:_,width:t,height:d,top:S}}),he=m(()=>G.value&&!!f.value),Te=m(()=>T.value==="selection"&&!!f.value&&!y.value),_e=m(()=>{const t=Z.value;if(t.length===0)return[-1/0,1/0];const d=t[0].toLocalNativeDate().valueOf(),_=t[t.length-1];let S=_.day;_.time.valueOf()>_.time.shift({minutes:30}).valueOf()&&(S=S.append({day:1}));const w=new X(S,_.time.shift({minutes:30})).toLocalNativeDate().valueOf();return[d,w]}),be=m(()=>q.value.native),c=m(()=>{const t=be.value.valueOf(),[d,_]=_e.value;return`${At(t,d,_).toFixed(2)}%`}),k=m(()=>`${K.value.length*100}%`),I=m(()=>{const t=K.value,[d,_]=_e.value;return qt(t,d,_)}),B=t=>{N("update:size",lt($.size+t,1,6))},Q=()=>{const t=te.value,d=R.value,_=se.value;if(!t||!d)return;const S=new Date(d.end.time.valueOf()+$e*15),w=new X(Ne.fromLocalNativeDate(S),pe.fromLocalNativeDate(S)),j={...d,end:{...d.end,time:w}};N("add",{horizontal:t,vertical:j,tables:_}),f.value=null,y.value=!1},ue=t=>{t.animationName==="arkVibe"&&t.target&&t.target.classList.remove("ark-vibe")},O=A(!1),D=()=>{const t=f.value,d={};if(t){const _=se.value,S=Object.keys(_),{start:w,end:j}=t;let ve=!1;for(let De=0;De<S.length;De++){const Ae=_[S[De]];if(!ve&&Ae.id===w.column&&(ve=!0),ve&&(d[Ae.id]=!0,Ae.id===j.column))break}N("freez",{time:t.start.time,tables:Object.keys(d)})}},l=()=>{y.value=!1,f.value=null,O.value=!1};de(()=>$.freezLoading,(t,d)=>{!t&&d&&l()});const b=(t,{id:d},_)=>{if(T.value!=="selection"||!G.value)return;const S={column:d,time:_};y.value=!1,f.value={start:S,end:S}},p=t=>{const d=t.target,_=d.getAttribute("data-col"),S=d.getAttribute("data-time"),w=f.value;if(!_||!S||!w||w.end.time.toString()===S&&w.end.column===_)return;const j={column:_,time:X.fromString(S)};f.value={...w,end:j}},z=()=>{y.value=!0};return de(Te,(t,d,_)=>{_(()=>{document.removeEventListener("pointermove",p),document.removeEventListener("pointerup",z),document.removeEventListener("pointercancel",z)}),t&&(document.addEventListener("pointermove",p),document.addEventListener("pointerup",z),document.addEventListener("pointercancel",z))},{immediate:!0}),(t,d)=>(o(),u("div",ns,[s("div",{class:i([t.$style.root,t.$style.top])},[s("div",{class:i([t.$style.labelCell,t.$style.labelCell_hidden])},[(o(!0),u(x,null,ne(e(Z),(_,S)=>(o(),u("p",{key:S},C(_.time),1))),128))],2),(o(!0),u(x,null,ne(e(F),(_,S)=>(o(),u("div",{key:S,class:i([t.$style.col,t.$style.col_tobottom])},[s("div",{class:i(t.$style.colLabel)},[at(t.$slots,"xlabel",{item:_},()=>[g(C(_),1)])],2)],2))),128))],2),s("div",{class:i(t.$style.root),"data-show-hidden":O.value},[s("div",{class:i(t.$style.sticky)},[(o(!0),u(x,null,ne(e(Z),(_,S)=>(o(),u("div",{key:S,class:i(t.$style.labelCell)},C(_.time),3))),128))],2),(o(!0),u(x,null,ne(e(F),(_,S)=>(o(),u("div",{key:S,class:i([t.$style.col,S===0&&t.$style.col_first])},[(o(!0),u(x,null,ne(M.value,(w,j)=>(o(),u("div",{key:j,class:i(t.$style.cell)},[s("p",{"data-col":_.id,"data-time":w.a,class:i(t.$style.cell__book),onPointerdown:ve=>b(ve,_,w.a)},[s("span",{class:i(t.$style.cell__book__text)},C(w.a.time),3)],42,is),s("p",{"data-col":_.id,"data-time":w.b,class:i(t.$style.cell__book),onPointerdown:ve=>b(ve,_,w.b)},[s("span",{class:i(t.$style.cell__book__text)},C(w.b.time),3)],42,rs)],2))),128)),(o(!0),u(x,null,ne(I.value[S],(w,j)=>(o(),u("div",{key:`${S}_${j}`,class:i(t.$style.bubble),style:st(w.style),"data-id":w.original.full.id,"data-high":`${w.original.full.id}`===t.highlight,"data-type":w.original.type,"data-selection":he.value,"data-airesto":w.original.airesto,onClick:ve=>N("show",w.original),onAnimationend:ue},[s("div",{class:i(t.$style.bubble__content)},[at(t.$slots,"default",{item:w.original})],2)],46,cs))),128))],2))),128)),he.value?(o(),u("div",{key:0,class:i(t.$style.selection),style:st(Ve.value)},[O.value?(o(),u("div",{key:1,class:i(["ark-text_body-xs",t.$style.dblclick])},[us,s("div",{class:i(t.$style.dblclick__btn)},[r(e(P),{"icon-button":"",size:"xs",appearance:"flat",icon:"close",onClick:l})],2)],2)):(o(),re(Ut,{key:0,vertical:R.value,horizontal:te.value,tables:se.value,time:be.value,conf:y.value},null,8,["vertical","horizontal","tables","time","conf"])),y.value?(o(),u("div",{key:2,class:i(t.$style.selection__btn)},[r(e(P),{size:"xs",loading:t.freezLoading,onClick:D},{default:h(()=>[g(" Резерв 15мин ")]),_:1},8,["loading"]),r(e(P),{size:"xs",style:{background:"var(--supra-accent)"},onClick:Q},{default:h(()=>[g(" Создать ")]),_:1}),r(e(P),{size:"xs",appearance:"neutral",onClick:l},{default:h(()=>[g(" Отменить ")]),_:1})],2)):U("",!0)],6)):U("",!0)],10,os),s("div",{class:i(t.$style.fixed),onClick:l},[he.value?(o(),re(e(P),{key:0,appearance:"accent",size:"s"},{default:h(()=>[g(" Отменить создание ")]),_:1})):U("",!0),s("div",{class:i(["ark-space_left-auto",t.$style.size])},[ds,r(e(P),{"icon-button":"",appearance:"flat",size:"xs",icon:"minus",onClick:d[0]||(d[0]=_=>B(-.5))}),r(e(P),{"icon-button":"",appearance:"flat",size:"xs",icon:"plus",onClick:d[1]||(d[1]=_=>B(.5))})],2)],2)]))}}),vs="_root_1v97l_1",ms="_col_1v97l_14",fs="_col_first_1v97l_22",ps="_col_tobottom_1v97l_34",bs="_labelCell_1v97l_40",ys="_labelCell_hidden_1v97l_48",ks="_cell_1v97l_57",hs="_cell__book_1v97l_67",gs="_cell__book__text_1v97l_75",$s="_selection_1v97l_84",Ss="_selection__btn_1v97l_97",ws="_colLabel_1v97l_111",zs="_bubble_1v97l_117",Os="_bubble__content_1v97l_178",Cs="_top_1v97l_196",xs="_sticky_1v97l_203",Ns="_size_1v97l_209",Ts="_dblclick_1v97l_219",Ds="_dblclick__btn_1v97l_224",Ls="_fixed_1v97l_231",Es={root:vs,col:ms,col_first:fs,col_tobottom:ps,labelCell:bs,labelCell_hidden:ys,cell:ks,cell__book:hs,cell__book__text:gs,selection:$s,selection__btn:Ss,colLabel:ws,bubble:zs,bubble__content:Os,top:Cs,sticky:xs,size:Ns,dblclick:Ts,dblclick__btn:Ds,fixed:Ls},Ms={$style:Es},Vs=Ie(_s,[["__cssModules",Ms]]);function Is(ae){ae.dispatchEvent(new CustomEvent(Zt,{detail:ae,bubbles:!0}))}const As={mounted:Is},qs=s("h6",{class:"ark-text_h6 ark-space_bottom-3"},"Новое бронирование",-1),Bs=s("p",{class:"ark-text_body-s ark-text_64"},"Дата",-1),Us={class:"ark-space_bottom-4"},Ps=s("p",{class:"ark-text_body-s ark-text_64"},"Время начала",-1),Rs=["data-warning"],js=s("span",{class:"ark-space_top-4"},"—",-1),Hs=s("p",{class:"ark-text_body-s ark-text_64"},"Время конца брони",-1),Fs=["data-warning"],Js={class:"ark-text_body-xs ark-space_top-1 ark-space_bottom-1 ark-text_64"},Ws={class:"ark-text_semibold"},Zs=s("p",{class:"ark-space_top-2"},[g(" Столы "),s("span",{class:"ark-text_body-xs ark-text_64"}," (можешь добавить нужный или убрать все) ")],-1),Ks=["data-active","onClick"],Gs={class:"ark-text_body-xs ark-space_top-1 ark-space_bottom-4 ark-text_64"},Ys={class:"ark-text_semibold"},Qs=s("p",{class:"ark-text_body-l ark-text_semibold ark-space_bottom-2"}," Контактные данные ",-1),Xs=Me({__name:"BookingWithTables",props:{item:{},restaurant:{}},emits:["close","add"],setup(ae,{emit:oe}){const $=ae,N=oe,{item:Z,restaurant:K}=Je($),F=rt(),T=ct();class G{constructor(k,I){this.label=k,this.time_ms=I}toString(){return this.label}}const ee=[new G("До след брони",-1),new G("на 2ч",Fe*2),new G("на 2ч 30м",Fe*2+$e*30),new G("на 3ч",Fe*3),new G("на 4ч",Fe*4)],q=Bt({count:[2,{required:tt}],name:["",{required:tt}],phone:["",{required:tt,phone:va(!0)}],comment:[""]}),J=xe(nt),L=xe(Gt),W=q.count.value,E=et({}),f=A(!1),y=A($.item),M=m(()=>{var I;const c=(I=J.value)==null?void 0:I.timezone,k=new Date(new Date().toLocaleString("en",{timeZone:c})).toISOString();return X.jsonParse(k)}),Y=m(()=>{const c=y.value.horizontal;return c?c.start.column:null}),se=m(()=>Object.keys(E).filter(c=>E[c]).length>0),R=m(()=>{const c=y.value.tables;return Object.keys(E).reduce((k,I)=>k+(E[I]?c[I].capacity:0),0)}),te=m(()=>R.value<W.value&&se.value?{capacity:"Столы не вмещают всех"}:null),ce=m(()=>{const c=y.value.vertical;if(!c)return null;const{start:k,end:I}=c,B=k.time.valueOf();let Q=I.time.valueOf();return Q<B&&(Q+=Et),pe.fromAbsoluteMilliseconds(Q-B)}),le=m(()=>{const c=ce.value;return c&&c.hours===0&&c.minutes===15}),ke=["час","часа","часов"],Ce=m(()=>{const c=ce.value;if(!c)return"";const k=[];return c.hours!==0&&k.push(`${c.hours} ${Dt(ke,c.hours)}`),c.minutes!==0&&k.push(`${c.minutes} мин`),k.join(Lt)}),Ve=c=>{const k=y.value;if(c.time_ms===-1){const I=k.vertical.start.time.valueOf(),B=Object.keys(E).reduce((D,l)=>(E[l]&&k.tables[l]&&k.tables[l].reservations.forEach(p=>{const[z,t]=p.seating_time.split("T"),d=new X(Ne.jsonParse(z),pe.fromString(t)).valueOf();d>I&&D.push(d)}),D),[]);if(B.length===0)return;const Q=Math.min(...B),ue=new Date(Q),O=new X(Ne.fromLocalNativeDate(ue),pe.fromLocalNativeDate(ue));y.value={...k,vertical:{...k.vertical,end:{...k.vertical.end,time:O}}}}else{const I=new Date(k.vertical.start.time.valueOf()+c.time_ms),B=new X(Ne.fromLocalNativeDate(I),pe.fromLocalNativeDate(I));y.value={...k,vertical:{...k.vertical,end:{...k.vertical.end,time:B}}}}},he=c=>{const k=y.value;y.value={...k,vertical:{...k.vertical,start:{...k.vertical.start,time:c}}}},Te=c=>{const k=y.value;y.value={...k,vertical:{...k.vertical,end:{...k.vertical.end,time:c}}}},_e=({day:c,time:k})=>`${c.toJSON()} ${k.toString("HH:MM")}`,be=()=>{if(q.validate(),q.invalid.value)return;const{start:c,end:k}=y.value.vertical,{phone:I,name:B,count:Q,comment:ue}=q.getCurrentValue(),O=Object.keys(E).filter(D=>E[D]);f.value=!0,F.createBooking.execute({restaurant:Number(K.value),tables:O.length===0?void 0:O,num_people:Q,name_for_reservation:B,phone_number:`+${Yt(I)}`,comment:ue,seating_time:_e(c.time),end_time:_e(k.time)}).then(D=>{D&&(T.show(Qt(ha),{autoClose:15e3,data:{...D,allTables:L.value,__newbooking:!0}}),N("add",D),N("close"))}).catch(([D])=>{T.show(D.error??"Не удалось создать бронь",{type:"error",label:"Ошибка"})}).finally(()=>{f.value=!1})};return de(Z,c=>{const k=c.horizontal,I=c.tables,B=Object.keys(I);if(y.value=c,k){const{start:Q,end:ue}=k;let O=!1;for(let D=0;D<B.length;D++){const l=I[B[D]];if(!O&&l.id===Q.column&&(O=!0),O&&(E[l.id]=!0,l.id===ue.column))break}}q.count.setValue(R.value)},{immediate:!0}),(c,k)=>{var I,B,Q,ue;return o(),u(x,null,[qs,Bs,s("div",{class:i(["ark-space_bottom-2",c.$style.inline])},[r(e(Ue),{name:"calendar",size:16}),r(e(Xe),{today:"",mask:"[day:numeric] [month:long] [year:numeric], [weekday:long]",date:y.value.vertical.start.time.toJSON()},null,8,["date"])],2),s("div",Us,[s("div",{class:i(c.$style.time)},[s("div",{class:i(c.$style.time__item)},[Ps,s("button",{type:"button",class:i(c.$style.time__content),"data-warning":le.value},[s("div",{class:i(c.$style.inline)},[r(e(Ue),{name:"clock",size:16}),r(e(Xe),{mask:"с [hour:numeric]:[minute:numeric]",date:y.value.vertical.start.time.toJSON()},null,8,["date"]),s("span",null," ‐ "+C(y.value.vertical.start.time.time.shift({minutes:15})),1)],2),r(e(Ue),{name:"arrow-right",size:16}),r(e(ht),{"model-value":y.value.vertical.start.time,class:i(c.$style.selectTime),start:(I=e(J))==null?void 0:I.opening_time,end:(B=e(J))==null?void 0:B.closing_time,day:y.value.horizontal.start.time.day,min:M.value,"onUpdate:modelValue":he},null,8,["model-value","class","start","end","day","min"])],10,Rs)],2),js,s("div",{class:i(c.$style.time__item)},[Hs,s("button",{type:"button",class:i(c.$style.time__content),"data-warning":le.value},[s("div",{class:i(c.$style.inline)},[r(e(Ue),{name:"clock",size:16}),r(e(Xe),{mask:"до [hour:numeric]:[minute:numeric]",date:y.value.vertical.end.time.toJSON()},null,8,["date"])],2),r(e(Ue),{name:"arrow-right",size:16}),r(e(ht),{"model-value":y.value.vertical.end.time,class:i(c.$style.selectTime),start:(Q=e(J))==null?void 0:Q.opening_time,day:y.value.horizontal.start.time.day,end:(ue=e(J))==null?void 0:ue.closing_time,min:y.value.horizontal.start.time,"onUpdate:modelValue":Te},null,8,["model-value","class","start","day","end","min"])],10,Fs)],2)],2),le.value?(o(),u("span",{key:0,class:i(["ark-text_body-xs ark-text_semibold",c.$style.error])},[r(e(Ue),{name:"warning",size:16}),g(" Слишком мальнькая длительность ")],2)):U("",!0),s("p",Js,[g(" Длительность "),s("span",Ws,C(Ce.value),1)]),s("div",{class:i(c.$style.buttons)},[(o(),u(x,null,ne(ee,O=>r(e(P),{key:O.label,appearance:"neutral",size:"xs",onClick:D=>Ve(O)},{default:h(()=>[g(C(O),1)]),_:2},1032,["onClick"])),64))],2)]),Zs,r(e(Kt),null,{default:h(()=>[gt((o(),u("div",{class:i(["ark-space_bottom-1",c.$style.tables])},[(o(!0),u(x,null,ne(e(Z).tables,(O,D)=>gt((o(),u("button",{key:D,type:"button",class:i(c.$style.tables__item),"data-active":E[D],onClick:l=>E[D]=!E[D]},[r(e(It),{item:O},null,8,["item"])],10,Ks)),[[e(ka),Y.value===D]])),128))],2)),[[e(ba)],[e(As)],[e(ya)]])]),_:1}),s("p",Gs,[se.value?(o(),u(x,{key:0},[g(" Вместимость "),s("span",Ys,C(R.value)+" чел",1)],64)):(o(),u(x,{key:1},[g(" Столы определим сами ")],64))]),Qs,s("form",{onSubmit:it(be,["prevent"])},[r(e(Re),{class:"ark-space_bottom-3",control:e(q).name},{default:h(({model:O})=>[r(e($t),{modelValue:O.value,"onUpdate:modelValue":D=>O.value=D,required:"",label:"На чье имя","has-cleaner":!1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),r(e(Re),{class:"ark-space_bottom-3",control:e(q).count},{default:h(({model:O})=>[r(e(fa),{modelValue:O.value,"onUpdate:modelValue":D=>O.value=D,required:"",label:"Кол-во человек",min:1,"has-cleaner":!1},null,8,["modelValue","onUpdate:modelValue"]),r(e(ma),{error:te.value},null,8,["error"])]),_:1},8,["control"]),r(e(Re),{class:"ark-space_bottom-3",control:e(q).phone},{default:h(({model:O})=>[r(e(pa),{modelValue:O.value,"onUpdate:modelValue":D=>O.value=D,required:"",label:"Номер телефона","has-cleaner":!1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),r(e(Re),{class:"ark-space_bottom-6",control:e(q).comment},{default:h(({model:O})=>[r(e($t),{modelValue:O.value,"onUpdate:modelValue":D=>O.value=D,label:"Комментарий","has-cleaner":!1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),s("div",{class:i(c.$style.actions)},[r(e(P),{type:"submit",loading:f.value},{default:h(()=>[g("Создать")]),_:1},8,["loading"]),r(e(P),{appearance:"neutral",type:"button",onClick:k[0]||(k[0]=O=>N("close"))},{default:h(()=>[g(" Отменить ")]),_:1})],2)],32)],64)}}}),el="_actions_1yu47_1",tl="_time_1yu47_10",al="_time__item_1yu47_15",sl="_time__content_1yu47_18",ll="_inline_1yu47_55",nl="_buttons_1yu47_63",ol="_tables_1yu47_69",il="_tables__item_1yu47_83",rl="_selectTime_1yu47_115",cl="_error_1yu47_124",ul={actions:el,time:tl,time__item:al,time__content:sl,inline:ll,buttons:nl,tables:ol,tables__item:il,selectTime:rl,error:cl},dl={$style:ul},_l=Ie(Xs,[["__cssModules",dl]]),vl=["data-cancelled"],ml={style:{"white-space":"nowrap"}},fl={class:"ark-text_semibold"},pl=Me({__name:"BubblePreview",props:{item:{}},setup(ae){const oe=ae,{item:$}=Je(oe),N=m(()=>{const T=$.value;return`${T.start.time.toString("HH:MM")}-${T.end.time.toString("HH:MM")}`}),Z=m(()=>{const G=$.value.full.phone_number;return G?G.slice(G.length-4):""}),K=m(()=>{const T=$.value.full;switch(T.status){case Oe.APPLICATION:case Oe.CANCELLED:case Oe.CANCELLED_NO_DEPOSIT:case Oe.CLOSED:case Oe.NEW:case Oe.OPEN:case Oe.WAITING:return""}return T.status}),F=m(()=>{const T=$.value.full;return T.status===Oe.CANCELLED||T.status===Oe.CANCELLED_NO_DEPOSIT});return(T,G)=>(o(),u("div",{class:i(T.$style.preview),"data-cancelled":F.value},[e($).type==="reservation"?(o(),u(x,{key:0},[s("div",null,[s("p",{class:i(["ark-space_right-1",T.$style.id])},"№"+C(e($).full.id),3),s("span",{class:i(T.$style.bold)},C(e($).full.name_for_reservation),3),s("span",{class:i(T.$style.bold)},C(e($).full.num_people),3),s("p",ml,C(K.value),1)]),e($).airesto?(o(),re(e(Xt),{key:0,size:"xs",end_time:e($).full.end_time,seating_time:e($).full.seating_time,status:e($).full.status},null,8,["end_time","seating_time","status"])):U("",!0),e($).full.phone_number?(o(),u("p",{key:1,class:i(T.$style.phone)},[r(e(ea),{name:"phone",class:i(T.$style.phone)},null,8,["class"]),g(" "+C(Z.value),1)],2)):U("",!0),s("p",null,C(N.value),1)],64)):(o(),u(x,{key:1},[s("p",fl,[e($).full.status!=="Banquet"?(o(),u(x,{key:0},[g(" Заказ ")],64)):U("",!0),r(e(ua),{class:i(T.$style.status),status:e($).full.status},null,8,["class","status"])]),s("p",null,C(N.value),1)],64))],10,vl))}}),bl="_id_f0ecp_2",yl="_preview_f0ecp_7",kl="_phone_f0ecp_15",hl="_bold_f0ecp_19",gl="_status_f0ecp_32",$l={id:bl,preview:yl,phone:kl,bold:hl,status:gl},Sl={$style:$l},Nt=Ie(pl,[["__cssModules",Sl]]);function wl(ae,oe){const $=document.createElement("a");$.download=ae,$.href=oe,$.click()}const zl=s("h6",{class:"ark-text_h6 ark-space_bottom-6"},"Выгрузка бронирований",-1),Ol={key:0,class:"ark-text_body-xs ark-text_64"},Cl={key:0,class:"ark-text_body-s ark-space_bottom-4"},xl=["download","href"],Nl=Me({__name:"DownloadContacts",props:{id:{},defaultDay:{}},setup(ae){const oe=ae,$=Bt({start:[oe.defaultDay,{required:tt}],end:[null]}),N=rt(),Z=ct(),K=xe(Vt),F=A(!1),T=A(null),G=()=>{if($.validate(),$.invalid.value)return;const{start:ee,end:q}=$.getCurrentValue();F.value=!0,N.guestsContactsExport({restaurant_id:oe.id,start_date:ee.toJSON(),end_start:q==null?void 0:q.toJSON()}).then(J=>{var f;const L=window.URL.createObjectURL(J),E=ee.daySame(q||K.value.day)?`Брони_гостей_за_${ee.toString()}.xlsx`:`Брони_гостей_с_${ee.toString()}_до_${(f=q||K.value.day)==null?void 0:f.toString()}.xlsx`;T.value={name:E,url:L},wl(E,L)}).catch(()=>{Z.show("Не удалось скачать выгрузку",{type:"error"})}).finally(()=>{F.value=!1})};return(ee,q)=>(o(),u(x,null,[zl,s("form",{onSubmit:it(G,["prevent"])},[r(e(Re),{class:"ark-space_bottom-3",control:e($).start},{default:h(({model:J})=>[r(e(Ct),{modelValue:J.value,"onUpdate:modelValue":L=>J.value=L,required:"",size:"l",label:"Дата начала","has-cleaner":!1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),r(e(Re),{class:"ark-space_bottom-4",control:e($).end},{default:h(({model:J})=>{var L;return[r(e(Ct),{modelValue:J.value,"onUpdate:modelValue":W=>J.value=W,size:"l",label:"Дата окончания",class:"ark-space_bottom-1","has-cleaner":!1},null,8,["modelValue","onUpdate:modelValue"]),J.value?U("",!0):(o(),u("p",Ol," По умолчанию текущая дата - "+C((L=e(K))==null?void 0:L.day),1))]}),_:1},8,["control"]),T.value?(o(),u("div",Cl,[g(" Если загрузка не началась автоматически, нажмите сюда "),s("a",{download:T.value.name,href:T.value.url},C(T.value.name),9,xl)])):U("",!0),r(e(P),{type:"submit",size:"l",style:{width:"100%"},loading:F.value},{default:h(()=>[g(" Выгрузить ")]),_:1},8,["loading"])],32)],64))}}),Tl="/aairesto/img/selection.gif",Dl="/aairesto/img/2clicks.gif",Ll=s("h6",{class:"ark-text_h6 ark-space_bottom-3"}," Как выбирать столы для бронирования ",-1),El=s("div",null,[s("p",{class:"ark-text_semibold"},"Выделение"),s("p",{class:"ark-text_body-s"},"Только для компьютеров")],-1),Ml=s("div",null,[s("p",{class:"ark-text_semibold"},"Удержание"),s("p",{class:"ark-text_body-s"},"Для телефонов и планшетов")],-1),Vl=Me({__name:"SelectionModeExplan",props:{mode:{}},emits:["update:mode"],setup(ae,{emit:oe}){const $=oe,N=ta();return(Z,K)=>(o(),u(x,null,[Ll,e(N)?U("",!0):(o(),u(x,{key:0},[r(e(Pe),{style:{display:"inline-flex"}},{default:h(()=>[r(e(St),{class:"ark-space_right-2",style:{"align-self":"flex-start"},"model-value":Z.mode==="selection","onUpdate:modelValue":K[0]||(K[0]=F=>$("update:mode","selection"))},null,8,["model-value"]),El]),_:1}),s("img",{src:Tl,width:"200px",height:"177",class:i(["ark-space_bottom-4",Z.$style.gif])},null,2)],64)),r(e(Pe),{style:{display:"inline-flex"}},{default:h(()=>[r(e(St),{class:"ark-space_right-2",style:{"align-self":"flex-start"},"model-value":Z.mode==="click","onUpdate:modelValue":K[1]||(K[1]=F=>$("update:mode","click"))},null,8,["model-value"]),Ml]),_:1}),s("img",{src:Dl,class:i(Z.$style.gif)},null,2)],64))}}),Il="_gif_ncrcy_1",Al={gif:Il},ql={$style:Al},Bl=Ie(Vl,[["__cssModules",ql]]),Ul={key:0},Pl=s("p",{class:"ark-text_body-s ark-text_medium ark-text_64"},"Когда",-1),Rl=["data-active","onClick"],jl=["data-active"],Hl=s("p",null,"Как выбирать столы?",-1),Fl={class:"ark-text_semibold"},Jl=s("p",{class:"ark-text_body-xs ark-text_semibold ark-text_64"}," Shift + колесико мышки для скролла по горизонтали ",-1),Wl=s("p",{class:"ark-text_body-s ark-text_medium ark-text_64"},"Отображаемые зоны",-1),Zl=["data-active","onClick"],Kl=["data-tablebar"],Gl={key:1,class:"ark-text_body-xs"},Yl=s("h6",{class:"ark-text_h6"},"Настройки таблицы",-1),Ql=s("p",{class:"ark-text_body-xs ark-space_bottom-2 ark-text_64"}," Эти настройки только для вас ",-1),Xl={class:"ark-space_bottom-4"},en={class:"ark-space_bottom-4"},tn={class:"ark-space_bottom-4"},an=Me({__name:"Booking",props:{id:{}},setup(ae){ot(a=>({"5c99d1ba":O.value}));const oe={Banquet:"Банкеты",Bill:"Пречек",Closed:"Закрытые",Deleted:"Удаленные",New:"Новые"},$=Ke,N=ae,Z=aa(),K=rt(),F=ct(),T=na(),G=oa(),ee=ga(),{reservationToShow:q,navItems:J,tableDate:L,tableSlots:W}=sa(ee),E=A(!1),f=A(!1),y=A(!1),M=A(null),Y=A(!1),se=A(!1),R=A(!1),te=localStorage.getItem("__ark-supra-timesheet-size"),ce=Number.isNaN(te)?4:lt(Number(te),1,6),le=A(ce);de(le,a=>{localStorage.setItem("__ark-supra-timesheet-size",`${a}`)});const ke=A(null),Ce=xe(Vt),Ve=m(()=>{const a=L.value,n=Ce.value.daytime;return n.day.daySame(a)?"Сегодня":n.day.append({day:1}).daySame(a)?"Завтра":a}),he=localStorage.getItem("__ark-supra-selection-mode"),Te=la()==="web"?he==="selection"||he==="click"?he:"selection":"click",_e=A(Te),be=A(!1);de(_e,a=>{localStorage.setItem("__ark-supra-selection-mode",a)});const c=xe(nt),k=xe(ra),I=localStorage.getItem(`__ark-supra-empty-tables-state_${N.id}`),B=A(!I||I==="1");de(B,a=>{localStorage.setItem(`__ark-supra-empty-tables-state_${N.id}`,a?"1":"0")});function Q(a){return typeof a!="string"||!a||Number.isNaN(Number(a))?3:Number(a)}const ue=Q(localStorage.getItem(`__ark-supra-mobile-tables-count-state_${N.id}`)),O=A(ue),D=a=>{const n=O.value,V=lt(n+a,1,1/0);O.value=V};de(O,a=>{localStorage.setItem(`__ark-supra-mobile-tables-count-state_${N.id}`,`${a}`)});function l(a){if(typeof a!="string")return{};let n;try{n=JSON.parse(a)}catch{}return typeof n=="object"&&n!==null?n:{}}const b=l(localStorage.getItem(`__ark-supra-orders-state_${N.id}`)),p=et({Banquet:b.Banquet??!0,Bill:b.Bill??!0,Closed:b.Closed??!0,Deleted:b.Deleted??!0,New:b.New??!0});de(p,a=>{localStorage.setItem(`__ark-supra-orders-state_${N.id}`,JSON.stringify(a))});const z=l(localStorage.getItem(`__ark-supra-reservation-state_v2_${N.id}`)),t=Object.values(Oe),d=t.reduce((a,n)=>(a[n]=!0,a),{}),_=et(Object.values(Ke).concat(...t).reduce((a,n)=>(a[n]=z[n]??!0,a),{}));de(_,a=>{localStorage.setItem(`__ark-supra-reservation-state_v2_${N.id}`,JSON.stringify(a))});const S=l(localStorage.getItem(`__ark-supra-zones-state_${N.id}`)),w=et(S);de(w,a=>{localStorage.setItem(`__ark-supra-zones-state_${N.id}`,JSON.stringify(a))});const j=Z.computedSmallerThen("mobile"),ve=a=>{ke.value=a},De=(a,n)=>{const V=n[a];return V===void 0?!0:V},Ae=a=>{a.type==="reservation"&&(Y.value?(M.value=a,se.value=!0):T.push({query:{...G.query,type:a.airesto?void 0:"resto",bookingid:a.full.id}}))},ut=m(()=>k.value.filter(Boolean)),dt=m(()=>ut.value.every(n=>De(n,w))),_t=m(()=>Object.values(_).every(n=>n)),vt=m(()=>Object.values(p).every(n=>n)),Pt=()=>{const a=dt.value,n=ut.value,V=!a;n.forEach(H=>{w[H]=V})},Rt=()=>{const a=_t.value,n=_,V=!a;Object.keys(n).forEach(H=>{_[H]=V})},jt=a=>{W.value=W.value.map(n=>{if(a.tables.includes(n.id)){const V=n.reservations.concat(a);return{...n,reservations:V}}return n})},Ht=()=>{const a=vt.value,n=p,V=!a;Object.keys(n).forEach(H=>{p[H]=V})},mt=m(()=>{var me,we;const n=L.value,V=(me=c.value)==null?void 0:me.opening_time,H=(we=c.value)==null?void 0:we.closing_time;if(!V||!H)return[];const ge=pe.fromString(V),Se=pe.fromString(H);let ye=n;return ge.toAbsoluteMilliseconds()>Se.toAbsoluteMilliseconds()&&(ye=ye.append({day:1})),ca(new X(n,ge),new X(ye,Se),{minutes:30})}),qe=A(!1),ft=A(!1),pt=m(()=>{const n=Ce.value.day;return new Array(5).fill("").map((V,H)=>n.append({day:H}))}),Ft=m(()=>qe.value?_a:W.value.filter(a=>De(a.zone,w))),bt=m(()=>{if(qe.value)return[];const a=new Set;return W.value.forEach(n=>{a.add(n.zone)}),Array.from(a).sort()}),je=m(()=>{const a=L.value,n=Ft.value,V=new Array(n.length).fill("").map(()=>null),H=new Array(n.length).fill("").map(()=>[]);n.forEach((me,we)=>{V[we]=me;const We=me.orders.reduce((ze,ie)=>{var Le,v;if(p[ie.status]){const fe=ie.start_time.split("+")[0],Ee=X.jsonParse(fe);if(Ee.day.daySame(a)){const Jt={start:Ee,end:X.jsonParse(((Le=ie.end_time)==null?void 0:Le.split("+")[0])??((v=ie.prediction_time)==null?void 0:v.split("+")[0])??""),type:ie.status,airesto:!1,full:ie};ze.push(Jt)}}return ze},[]),Ze=me.reservations.reduce((ze,ie)=>{if(_[ie.status]&&(N.id!=="111113"||ie.status!==Ke.Reserve)){const Le=X.jsonParse(ie.seating_time.split("+")[0]);if(Le.day.daySame(a)){const v={start:Le,end:X.jsonParse(ie.end_time.split("+")[0]),type:"reservation",airesto:d[ie.status],full:ie};ze.push(v)}}return ze},[]),He=[].concat(We).concat(Ze);He.sort((ze,ie)=>ze.start.toLocalNativeDate().valueOf()-ie.start.toLocalNativeDate().valueOf()),H[we]=He});const ge=B.value,Se=ge?V:V.filter((me,we)=>H[we].length>0),ye=ge?H:H.filter(me=>me.length>0);return{tables:Se,data:ye}}),yt=m(()=>{const a=L.value;return!pt.value.find(n=>n.daySame(a))}),Be=A(null),kt=a=>{y.value=!0;const n=a.tables.length>1;K.reservationFreez.execute({restaurant:Number(N.id),seating_time:`${a.time.day.toJSON()} ${a.time.time.toString("HH:MM")}`,tables:a.tables}).then(V=>{if(V){F.show(`Добавили резерв стол${n?"ов":"а"} на 15 минут`);const H=new Date(a.time.valueOf()+Fe),ge=new X(Ne.fromLocalNativeDate(H),pe.fromLocalNativeDate(H)),Se={...V,comment:"",status:Ke.Sat,queue_number:null,restaurant:Number(N.id),end_time:`${ge.day.toJSON()}T${ge.time.toString("HH:MM")}+10:00`,num_people:1,name_for_reservation:"Новый гость",phone_number:"+79999999999",foreigner:!1,invite_time:null,created:""};W.value=W.value.map(ye=>{if(Se.tables.includes(ye.id)){const me=ye.reservations.concat(Se);return{...ye,reservations:me}}return ye})}}).catch(()=>{F.show(`Не удалось зарезервировать стол${n?"ы":""} на 15 мин`,{type:"error"})}).finally(()=>{y.value=!1})};return de([()=>N.id,L],([a,n])=>{if(!a)return;Be.value=null;const V=n.toJSON();qe.value=!0,ft.value=!1,K.loadAvailableTables.execute({restaurant_id:a,date:V}).then(H=>{H&&(ee.setTableSlots(H.results),H.next&&(Be.value={id:a,page:2,date:V}),qe.value=!1)}).catch(()=>{Be.value=null,qe.value=!1,ft.value=!0})},{immediate:!0}),de(Be,a=>{a&&K.loadAvailableTables.execute({restaurant_id:a.id,date:a.date,page:a.page}).then(n=>{n&&(ee.concatTableSlots(n.results),n.next&&(Be.value={id:a.id,date:a.date,page:a.page+1}))}).catch(()=>{Be.value=null,F.show("Не удалось загрузить следующую страницу бронирований",{type:"error"})})},{immediate:!0}),(a,n)=>{var V,H,ge,Se,ye,me,we,We,Ze,He,ze,ie,Le;return o(),u(x,null,[s("div",{class:i(a.$style.headerContainer)},[s("h6",{class:i(["ark-text_h6 ark-text_semibold ark-space_top-2 ark-space_bottom-1",a.$style.header])},[g(" Бронирования "),s("div",{class:i(a.$style.statuses)},[r(e(P),{appearance:"neutral",icon:"download",size:"xs",onClick:n[0]||(n[0]=v=>E.value=!E.value)},{default:h(()=>[g(" Контакты гостей ")]),_:1}),r(e(P),{appearance:"neutral",size:"xs",icon:"settings",onClick:n[1]||(n[1]=v=>f.value=!f.value)},{default:h(()=>[g(" Настройки ")]),_:1})],2)],2),s("div",{class:i(["ark-space_bottom-2",a.$style.statuses])},[(V=e(c))!=null&&V.has_bookings?(o(),re(e(ia),{key:0,size:"s",border:!1,class:i(a.$style.tabs),items:e(J)},{default:h(({item:v})=>[g(C(v.text),1)]),_:1},8,["class","items"])):U("",!0),!e(j)&&((H=e(c))!=null&&H.has_reservations||(ge=e(c))!=null&&ge.has_bookings)?(o(),re(e(P),{key:1,size:"xs",icon:"plus",class:"ark-space_top-2 ark-space_left-1",appearance:(Se=e(c))!=null&&Se.has_bookings?"accent":void 0,onClick:e(ee).toggleNewBooking},{default:h(()=>[g(" Добавить ")]),_:1},8,["appearance","onClick"])):U("",!0)],2),e(j)&&((ye=e(c))!=null&&ye.has_bookings)?(o(),u("div",Ul,[s("a",{class:"ark-text_body-s",style:{"text-decoration":"underline"},onClick:n[2]||(n[2]=v=>be.value=!be.value)}," Как выбирать столы для брони? ")])):U("",!0),e(j)?U("",!0):(o(),u(x,{key:1},[Pl,s("div",{class:i(["ark-space_bottom-2",a.$style.statuses])},[(o(!0),u(x,null,ne(pt.value,(v,fe)=>(o(),u("button",{key:v.toJSON(),class:i(a.$style.date),"data-active":v.daySame(e(L)),onClick:Ee=>L.value=v},[r(e(Ge),{class:"ark-text_semibold",mask:"[day:numeric] [month:long]",date:v.toLocalNativeDate()},null,8,["date"]),s("p",null,[fe<2?(o(),u(x,{key:0},[g(C(e(Ce).day.daySame(v)?"сегодня":"завтра"),1)],64)):(o(),re(e(Ge),{key:1,mask:"[weekday:long]",date:v.toLocalNativeDate()},null,8,["date"]))])],10,Rl))),128)),r(e(zt),{modelValue:R.value,"onUpdate:modelValue":n[4]||(n[4]=v=>R.value=v),align:"left","max-width":243,"min-width":243,"min-height":290},{dropdown:h(()=>[r(e(wt),{value:e(L),onDayClick:n[3]||(n[3]=v=>{L.value=v,R.value=!1})},null,8,["value"])]),default:h(()=>[s("button",{style:{height:"2.5rem"},class:i(a.$style.date),"data-active":yt.value},[yt.value?(o(),u(x,{key:0},[r(e(Ge),{class:"ark-text_semibold",mask:"[day:numeric] [month:long]",date:e(L).toLocalNativeDate()},null,8,["date"]),s("p",null,[r(e(Ge),{mask:"[weekday:long]",date:e(L).toLocalNativeDate()},null,8,["date"])])],64)):(o(),u(x,{key:1},[g(" Выбрать ")],64))],10,jl)]),_:1},8,["modelValue"]),(me=e(c))!=null&&me.has_bookings?(o(),u("button",{key:0,type:"button",class:i(["ark-space_left-auto",a.$style.date]),onClick:n[5]||(n[5]=v=>be.value=!be.value)},[Hl,s("p",Fl,C(_e.value==="selection"?"Выделение":"Удержание"),1)],2)):U("",!0)],2),Jl],64)),Wl,s("div",{class:i(a.$style.statuses)},[(o(!0),u(x,null,ne(bt.value,v=>(o(),re(e(da),{key:v,a:De(v,w)},{default:h(({a:fe})=>[s("button",{type:"button",class:i([a.$style.date,a.$style.date_center]),"data-active":fe,onClick:Ee=>w[v]=!fe},C(v),11,Zl)]),_:2},1032,["a"]))),128))],2)],2),s("div",{class:i(a.$style.container),"data-tablebar":e(q)!==null},[je.value.tables.length>0?(o(),u(x,{key:0},[qe.value?(o(),u(x,{key:1},[r(e(Tt),{name:"spinner",class:"ark-space_right-2",size:16}),g(" Загружаем... ")],64)):(o(),u(x,{key:0},[e(j)?(o(),re(e(ls),{key:1,"time-segments":mt.value,tables:je.value.tables,data:je.value.data,highlight:(Ze=e(q))==null?void 0:Ze.id,count:O.value,"add-enabled":(He=e(c))==null?void 0:He.has_bookings,"freez-loading":y.value,onShow:Ae,onAdd:ve,onFreez:kt},{default:h(({item:v})=>[r(Nt,{item:v},null,8,["item"])]),xlabel:h(({item:v})=>[r(e(Ot),{id:v.id},null,8,["id"])]),_:1},8,["time-segments","tables","data","highlight","count","add-enabled","freez-loading"])):(o(),re(e(Vs),{key:0,size:le.value,"onUpdate:size":n[6]||(n[6]=v=>le.value=v),"time-segments":mt.value,tables:je.value.tables,data:je.value.data,highlight:(we=e(q))==null?void 0:we.id,mode:e(j)?"click":_e.value,"add-enabled":(We=e(c))==null?void 0:We.has_bookings,"freez-loading":y.value,onShow:Ae,onAdd:ve,onFreez:kt},{default:h(({item:v})=>[r(Nt,{item:v},null,8,["item"])]),xlabel:h(({item:v})=>[le.value>2?(o(),re(e(It),{key:0,item:v},null,8,["item"])):(o(),u("div",Gl,[r(e(Ot),{id:v.id},null,8,["id"])]))]),_:1},8,["size","time-segments","tables","data","highlight","mode","add-enabled","freez-loading"]))],64))],64)):e(c)?(o(),u(x,{key:1},[g(' Нет данных. Возможно у вас скрытые "пустые" столы в настройках ')],64)):U("",!0)],10,Kl),e(j)?(o(),u("div",{key:0,class:i(a.$style.safe__content)},[r(e(zt),{modelValue:R.value,"onUpdate:modelValue":n[8]||(n[8]=v=>R.value=v),align:"right",class:"ark-space_left-auto","max-width":243,"min-width":243,"min-height":290},{dropdown:h(()=>[r(e(wt),{value:e(L),onDayClick:n[7]||(n[7]=v=>{L.value=v,R.value=!1})},null,8,["value"])]),default:h(()=>[r(e(P),{icon:"calendar",appearance:"elevation",size:"l",style:{"--ark-padding":"1rem"}},{default:h(()=>[g(C(Ve.value),1)]),_:1})]),_:1},8,["modelValue"]),(ze=e(c))!=null&&ze.has_reservations||(ie=e(c))!=null&&ie.has_bookings?(o(),re(e(P),{key:0,"icon-button":"",shape:"square",icon:"plus",size:"l",appearance:(Le=e(c))!=null&&Le.has_bookings?"accent":void 0,onClick:e(ee).toggleNewBooking},null,8,["appearance","onClick"])):U("",!0)],2)):U("",!0),r(e(Ye),{modelValue:f.value,"onUpdate:modelValue":n[12]||(n[12]=v=>f.value=v),order:4},{default:h(()=>[Yl,Ql,s("div",Xl,[s("div",{class:i(["ark-text_body-xs ark-text_64",a.$style.header])}," Столы ",2),r(e(Pe),{class:i(a.$style.label)},{default:h(()=>[g(" Показывать пустые столы "),r(e(Qe),{modelValue:B.value,"onUpdate:modelValue":n[9]||(n[9]=v=>B.value=v),size:"s"},null,8,["modelValue"])]),_:1},8,["class"]),e(j)?(o(),u("div",{key:0,class:i(a.$style.label)},[g(" Отображение кол-ва столов "),s("div",{class:i(a.$style.label__counter)},[r(e(P),{"icon-button":"",shape:"square",appearance:"neutral",size:"xs",icon:"minus",onClick:n[10]||(n[10]=v=>D(-1))}),g(" "+C(O.value)+" ",1),r(e(P),{"icon-button":"",shape:"square",appearance:"neutral",size:"xs",icon:"plus",onClick:n[11]||(n[11]=v=>D(1))})],2)],2)):U("",!0)]),s("div",en,[s("div",{class:i(["ark-text_body-xs ark-text_64",a.$style.header])},[g(" Бронирования "),r(e(P),{size:"xs",appearance:"flat",onClick:Rt},{default:h(()=>[g(C(_t.value?"Скрыть все":"Все"),1)]),_:1})],2),(o(!0),u(x,null,ne(e($),(v,fe)=>(o(),re(e(Pe),{key:fe,class:i(a.$style.label)},{default:h(()=>[g(C(v)+" ",1),r(e(Qe),{modelValue:_[v],"onUpdate:modelValue":Ee=>_[v]=Ee,size:"s"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["class"]))),128))]),s("div",tn,[s("div",{class:i(["ark-text_body-xs ark-text_64",a.$style.header])},[g(" Заказы "),r(e(P),{size:"xs",appearance:"flat",onClick:Ht},{default:h(()=>[g(C(vt.value?"Скрыть все":"Все"),1)]),_:1})],2),(o(),u(x,null,ne(oe,(v,fe)=>r(e(Pe),{key:fe,class:i(a.$style.label)},{default:h(()=>[g(C(v)+" ",1),r(e(Qe),{modelValue:p[fe],"onUpdate:modelValue":Ee=>p[fe]=Ee,size:"s"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["class"])),64))]),s("div",null,[s("div",{class:i(["ark-text_body-xs ark-text_64",a.$style.header])},[g(" Зоны "),r(e(P),{size:"xs",appearance:"flat",onClick:Pt},{default:h(()=>[g(C(dt.value?"Скрыть все":"Все"),1)]),_:1})],2),(o(!0),u(x,null,ne(bt.value,v=>(o(),re(e(Pe),{key:v,class:i(a.$style.label)},{default:h(()=>[g(C(v)+" ",1),r(e(Qe),{size:"s","model-value":De(v,w),"onUpdate:modelValue":fe=>w[v]=fe},null,8,["model-value","onUpdate:modelValue"])]),_:2},1032,["class"]))),128))])]),_:1},8,["modelValue"]),r(e(Ye),{overscroll:"none","model-value":ke.value!==null,"onUpdate:modelValue":n[13]||(n[13]=v=>ke.value=null)},{default:h(({close:v})=>[ke.value?(o(),re(_l,{key:0,item:ke.value,restaurant:a.id,onAdd:jt,onClose:v},null,8,["item","restaurant","onClose"])):U("",!0)]),_:1},8,["model-value"]),r(e(Ye),{modelValue:be.value,"onUpdate:modelValue":n[15]||(n[15]=v=>be.value=v)},{default:h(()=>[r(Bl,{mode:_e.value,"onUpdate:mode":n[14]||(n[14]=v=>_e.value=v)},null,8,["mode"])]),_:1},8,["modelValue"]),r(e(Ye),{modelValue:E.value,"onUpdate:modelValue":n[16]||(n[16]=v=>E.value=v),size:"sm"},{default:h(()=>[a.id?(o(),re(Nl,{key:0,id:a.id,"default-day":e(L)},null,8,["id","default-day"])):U("",!0)]),_:1},8,["modelValue"])],64)}}}),sn="_container_42k44_1",ln="_headerContainer_42k44_8",nn="_fixed_42k44_15",on="_tabs_42k44_39",rn="_header_42k44_8",cn="_statuses_42k44_50",un="_buttons_42k44_55",dn="_statusesScroll_42k44_65",_n="_date_42k44_80",vn="_date_center_42k44_98",mn="_cell_42k44_107",fn="_input_42k44_112",pn="_notification_42k44_147",bn="_label_42k44_153",yn="_label__counter_42k44_172",kn="_spinner_42k44_180",hn="_safe_42k44_196",gn="_safe__content_42k44_199",$n="_safe__buttons_42k44_210",Sn="_search_42k44_218",wn="_search_focused_42k44_224",zn={container:sn,headerContainer:ln,fixed:nn,tabs:on,header:rn,statuses:cn,buttons:un,statusesScroll:dn,date:_n,date_center:vn,cell:mn,input:fn,notification:pn,label:bn,label__counter:yn,spinner:kn,safe:hn,safe__content:gn,safe__buttons:$n,search:Sn,search_focused:wn},On={$style:zn},Un=Ie(an,[["__cssModules",On]]);export{Un as default};
