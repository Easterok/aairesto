import{d as oe,C as Ot,Q as Ve,b as Q,r as v,A as de,ba as Et,bb as Vt,w as Y,i as e,o as t,q as R,s as p,h as r,D as ce,bc as It,bd as Lt,b3 as at,c as l,a as d,a5 as Mt,n as g,ah as lt,G as At,b5 as Rt,k as w,at as Pt,be as Xt,bf as Ut,_ as ie,aC as Ht,S as ze,bg as Ft,m as jt,F as T,g as te,j as c,t as X,x as E,aG as Me,ak as st,ao as Ue,a6 as be,ad as ot,R as J,u as He,l as Fe,bh as qt,a0 as nt,bi as Oe,aK as Jt,aL as Zt,H as Gt,v as se,aU as Wt,aV as Kt,bj as rt,a1 as Qt,a3 as Yt,B as it,a4 as Ee,aa as he,ab as Ae,a9 as Re,ag as Ne,ae as le,W as ut,ap as ea,bk as et,b9 as Pe,Z as dt,av as Se,a8 as ta,bl as aa,af as la,b1 as sa,N as oa,z as na,y as ra,p as ia}from"./index-6367d8ff.js";import{_ as ke}from"./index-bbe23418.js";import{D as ua}from"./index-9535c0f6.js";import{O as da}from"./index-f9111cae.js";import{F as ct}from"./index-953ce25b.js";import{c as mt,r as Xe,s as ca}from"./index-9268c079.js";import{I as vt}from"./index-375c6776.js";import{T as ma,R as va}from"./index-181093b8.js";import{S as pt,B as _t,a as De,v as pa,b as _a}from"./index-44a8d1b8.js";import{T as xe}from"./index-cbb74742.js";import{v as fa,a as ba}from"./index-543c47ea.js";import{_ as ga}from"./index-57821b90.js";import{R as ya}from"./index-60afbd63.js";import{u as ka}from"./index-f484f4d0.js";import"./index-55204b2b.js";/* empty css              */import"./index-456889fa.js";import"./index-464983bd.js";import"./index-cebbb5bb.js";import"./index-cc030883.js";const ha={direction:"bottom"},Te=12,Be=72,xa=oe({name:"TableBar",__name:"TableBar",props:Ot({modelValue:{type:Boolean},direction:{},overlay:{type:Boolean},rootClass:{},contentClass:{},dataAutomationId:{},closeButton:{type:Boolean}},ha),emits:["update:modelValue"],setup(P,{emit:m}){const i=P,o=m,{modelValue:S,overlay:O,direction:A}=Ve(i),f=Q(()=>O.value?"all":"none"),b=v(null),B=v(!1),C=de(Et,v(null)),h=de(Vt,v(NaN)),x=Q(()=>C.value&&C.value.overlayClickEvents),u=()=>{o("update:modelValue",!1)},I=()=>{O.value&&u()},V=()=>{var j;const D=(j=b.value)==null?void 0:j.getBoundingClientRect();if(!D)return!1;const F=A.value,{left:y,right:M,top:z,bottom:ee}=D,_=window.innerWidth,a=window.innerHeight;switch(F){case"left":return _-M-Be-Te<0;case"right":return y-Be-Te<0;case"top":return a-ee-Be-Te<0;default:return z-Be-Te<0}};Y([S,O,C],([D,F,y])=>{D&&F&&y?y.showOverlay():y==null||y.hideOverlay()},{immediate:!0}),Y(x,()=>{S.value&&O.value&&u()});const L=Ut(()=>{if(!S.value)return;const D=V();B.value=D},300),N={onEvent:I};return i.closeButton&&Y(h,L,{immediate:!0}),(D,F)=>e(C)?(t(),R(e(Xt),{key:0,"append-to":e(O)?"#ark_table-bar-overlayable":"#ark_table-bars"},{default:p(()=>[r(Pt,{appear:"","enter-from-class":D.$style[`ark-table-bar_${e(A)}-enter-from`],"enter-active-class":D.$style[`ark-table-bar_${e(A)}-enter-active`],"leave-active-class":D.$style[`ark-table-bar_${e(A)}-leave-active`],"leave-to-class":D.$style[`ark-table-bar_${e(A)}-leave-to`]},{default:p(()=>[e(S)?ce((t(),l("section",{key:0,ref_key:"tableBarRef",ref:b,class:g([D.$style.tableBar,D.$style["tableBar_"+e(A)],D.rootClass])},[d("div",{class:g(D.$style.content)},[r(e(Mt),{class:g(D.$style.scrollbar)},{default:p(()=>[d("div",{class:g(D.contentClass)},[lt(D.$slots,"default",{close:u})],2)]),_:3},8,["class"]),D.closeButton&&e(S)?ce((t(),l("button",{key:0,class:g([D.$style.close,D.$style["close_"+e(A)],B.value&&D.$style.close_inside]),onClick:u},[r(e(At),{name:"close",size:"xl"})],2)),[[e(Rt)]]):w("",!0)],2)],2)),[[e(It),N],[e(Lt),{handle:e(O)}],[e(at),f.value]]):w("",!0)]),_:3},8,["enter-from-class","enter-active-class","leave-active-class","leave-to-class"])]),_:3},8,["append-to"])):w("",!0)}}),$a="_tableBar_1xo14_1",wa="_tableBar_bottom_1xo14_10",Ca="_tableBar_top_1xo14_14",Sa="_tableBar_left_1xo14_18",Ta="_tableBar_right_1xo14_23",Ba="_content_1xo14_29",Na="_scrollbar_1xo14_35",Da="_close_1xo14_39",za="_close_left_1xo14_88",Oa="_close_right_1xo14_94",Ea="_close_bottom_1xo14_100",Va="_close_top_1xo14_106",Ia="_close_inside_1xo14_112",La={tableBar:$a,tableBar_bottom:wa,tableBar_top:Ca,tableBar_left:Sa,tableBar_right:Ta,content:Ba,scrollbar:Na,close:Da,close_left:za,close_right:Oa,close_bottom:Ea,close_top:Va,close_inside:Ia,"ark-table-bar_bottom-enter-active":"_ark-table-bar_bottom-enter-active_1xo14_135","ark-table-bar_bottom-leave-active":"_ark-table-bar_bottom-leave-active_1xo14_135","ark-table-bar_bottom-enter-from":"_ark-table-bar_bottom-enter-from_1xo14_139","ark-table-bar_bottom-leave-to":"_ark-table-bar_bottom-leave-to_1xo14_139","ark-table-bar_left-enter-active":"_ark-table-bar_left-enter-active_1xo14_142","ark-table-bar_left-leave-active":"_ark-table-bar_left-leave-active_1xo14_142","ark-table-bar_left-enter-from":"_ark-table-bar_left-enter-from_1xo14_146","ark-table-bar_left-leave-to":"_ark-table-bar_left-leave-to_1xo14_146","ark-table-bar_right-enter-active":"_ark-table-bar_right-enter-active_1xo14_149","ark-table-bar_right-leave-active":"_ark-table-bar_right-leave-active_1xo14_149","ark-table-bar_right-enter-from":"_ark-table-bar_right-enter-from_1xo14_153","ark-table-bar_right-leave-to":"_ark-table-bar_right-leave-to_1xo14_153","ark-table-bar_top-enter-active":"_ark-table-bar_top-enter-active_1xo14_156","ark-table-bar_top-leave-active":"_ark-table-bar_top-leave-active_1xo14_156","ark-table-bar_top-enter-from":"_ark-table-bar_top-enter-from_1xo14_160","ark-table-bar_top-leave-to":"_ark-table-bar_top-leave-to_1xo14_160"},Ma={$style:La},Aa=ie(xa,[["__cssModules",Ma]]),Ra=["data-appearance","data-size"],Pa=oe({__name:"Badge",props:{appearance:{default:"outline"},icon:{},iconSize:{},size:{default:"m"},color:{default:"var(--ark-text-color)"},background:{default:"var(--ark-text-color-12)"}},setup(P){return Ht(m=>({"5b972115":m.color,"27b5a2bc":m.background})),(m,i)=>(t(),l("div",{"data-appearance":m.appearance,"data-size":m.size,class:"ark-badge"},[m.icon?(t(),R(e(ze),{key:0,name:m.icon,size:m.iconSize},null,8,["name","size"])):w("",!0),lt(m.$slots,"default")],8,Ra))}});const Xa=["type","inputMode","autocomplete","accept","min","max","step","pattern","size","maxlength"],Ua=(P,m)=>{Xa.forEach(i=>{const o=m.getAttribute(i);o!=null&&P.setAttribute(i,o)})},Ha=P=>{const m=document.createElement("input"),i=P.getBoundingClientRect();return Ua(m,P),m.setAttribute("autofocus","autofocus"),m.style.height=`${i.height}px`,m.style.width=`${i.width/2}px`,m.style.position="fixed",m.style.zIndex="-99999999",m.style.caretColor="transparent",m.style.border="none",m.style.outline="none",m.style.color="transparent",m.style.background="transparent",m.style.cursor="none",m.style.fontSize="16px",m.style.top=`${i.top}px`,m.style.left=`${i.left}px`,m},Fa=P=>P.closest("#ark_popups-host"),ja=P=>{var f;const m=Ha(P),i=100;let o=null,S=null;const O=()=>m.focus({preventScroll:!0}),A=()=>{o&&clearTimeout(o),o=setTimeout(()=>{S&&clearTimeout(S),m.removeEventListener("blur",O),m.removeEventListener("focus",A),S=setTimeout(()=>{P.focus({preventScroll:!1}),m.remove()},i)})};m.addEventListener("blur",O,{once:!0}),m.addEventListener("focus",A),Fa(P)?window.document.body.appendChild(m):(f=P.parentElement)==null||f.appendChild(m),m.focus({preventScroll:!0})},qa=P=>{Promise.resolve().then(()=>{const m=P.querySelector("input,textarea")??P;Ft()?ja(m):setTimeout(()=>m.focus())})},ft={mounted:qa},Ja=d("p",{class:"ark-text_body-xs ark-space_bottom-1"}," Зеленые столы не означают что они свободны!!! ",-1),Za=["data-selected","onClick"],Ga=["src"],Wa={class:"ark-text_body-xs ark-space_top-1 ark-space_bottom-1"},Ka=oe({__name:"FloorMap",props:{preselected:{},loading:{type:Boolean}},emits:["tableSelect","close"],setup(P,{emit:m}){const i=P,o=m,S=de(Ue),O=v(null),A=Q(()=>{const y=S.value;return Array.from(Object.values(y).reduce((M,z)=>(M.add(z.zone),M),new Set)).sort()}),f=Q(()=>A.value.filter(Boolean));Y(f,y=>{y.length>0&&(O.value=y[0])},{immediate:!0});const b=Q(()=>{const y=S.value;return Object.keys(y).reduce((M,z)=>(M[y[z].number]=z,M),{})}),B={"1 Этаж":[[{img:"/romani/sofa_2.png",text:"17",id:"17"},{img:"/romani/sofa_2.png",text:"18",id:"18",style:{transform:"translateX(16px)"}}],[{img:"/romani/round_2.png",text:"19",id:"19",sub:"неброн",style:{transform:"translateX(128px)"}},{img:"/romani/round_2.png",text:"191",id:"191",sub:"неброн",style:{transform:"translateX(144px)"}},{img:"/romani/4.png",text:"14",id:"14",style:{transform:"translate(288px, 8px)"},rotate:{transform:"rotate(90deg)"}}],[],[{img:"/romani/round_5.png",text:"16",id:"16",style:{transform:"translate(32px, -16px)"}},{img:"/romani/4.png",text:"154",id:"154",style:{transform:"translateX(64px)"}},{img:"/romani/4.png",text:"153",id:"153",style:{transform:"translateX(76px)"}},{img:"/romani/4.png",text:"152",id:"152",style:{transform:"translateX(88px)"}},{img:"/romani/6.png",text:"151",id:"151",style:{transform:"translateX(100px)"}},{img:"/romani/round_4.png",text:"15",id:"15",style:{transform:"translateX(128px)"}},{img:"/romani/2.png",text:"12",id:"12",style:{transform:"translate(160px, 8px)"}}],[{img:"/romani/arrow.svg",sub:"Вход",id:"lol?",custom:!0,style:{"margin-left":"-48px"},rotate:{width:"48px",height:"12px"}}],[{img:"/romani/round_5.png",text:"1",id:"1"},{img:"/romani/sofa_1.png",text:"2",id:"2",style:{transform:"translateX(24px)"},rotate:{transform:"rotate(-90deg)"}},{img:"/romani/sofa_2.png",text:"4",id:"4",style:{transform:"translateX(36px)"},rotate:{transform:"rotate(-180deg)"}},{img:"/romani/sofa_1.png",text:"5",id:"5",style:{transform:"translateX(64px)"},rotate:{transform:"rotate(-90deg)"}},{img:"/romani/sofa_2.png",text:"6",id:"6",style:{transform:"translateX(76px)"},rotate:{transform:"rotate(-180deg)"}},{img:"/romani/sofa_2.png",text:"8",id:"8",style:{transform:"translateX(104px)"},rotate:{transform:"rotate(-180deg)"}},{img:"/romani/sofa_1.png",text:"10",id:"10",style:{transform:"translateX(116px)"},rotate:{transform:"rotate(-90deg)"}},{img:"/romani/round_6.png",text:"11",id:"11",style:{transform:"translateX(150px)"},rotate:{transform:"rotate(-90deg)"}}]],"2 Этаж":[[{img:"/romani/2.png",text:"47",id:"47",rotate:{transform:"rotate(90deg)"}},{img:"/romani/2.png",text:"48",id:"48",style:{transform:"translateX(16px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/sofa_5.png",text:"40",id:"40",style:{transform:"translateX(44px)"},rotate:{width:"90px",height:"44px"}},{img:"/romani/2.png",text:"41",id:"41",style:{transform:"translateX(76px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/2.png",text:"42",id:"42",style:{transform:"translateX(88px)"},rotate:{transform:"rotate(90deg)"}}],[{img:"/romani/2.png",text:"46",id:"46",rotate:{transform:"rotate(90deg)"}},{img:"/romani/2.png",text:"45",id:"45",style:{transform:"translateX(16px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/2.png",text:"44",id:"44",style:{transform:"translateX(166px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/2.png",text:"43",id:"43",style:{transform:"translateX(178px)"},rotate:{transform:"rotate(90deg)"}}],[],[{img:"/romani/4.png",text:"37",id:"37",style:{transform:"translateX(52px)"}},{img:"/romani/2.png",text:"36",id:"36",style:{transform:"translateX(68px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/4.png",text:"34",id:"34",style:{transform:"translateX(84px)"}},{img:"/romani/2.png",text:"33",id:"33",style:{transform:"translateX(100px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/4.png",text:"31",id:"31",style:{transform:"translateX(116px)"}},{img:"/romani/2.png",text:"21",id:"21",style:{transform:"translateX(132px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/2.png",text:"30",id:"30",style:{transform:"translateX(148px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/round_6.png",text:"20",id:"20",style:{transform:"translateX(196px)"}}],[],[{img:"/romani/round_4.png",text:"29",id:"29",style:{transform:"translateX(36px)"}},{img:"/romani/round_4.png",text:"28",id:"28",style:{transform:"translateX(52px)"}},{img:"/romani/round_2.png",text:"27",id:"27",style:{transform:"translateX(68px)"},rotate:{transform:"rotate(-45deg)"}},{img:"/romani/round_2.png",text:"39",id:"39",style:{transform:"translateX(84px)"},rotate:{transform:"rotate(-45deg)"}},{img:"/romani/round_4.png",text:"26",id:"26",style:{transform:"translateX(100px)"}},{img:"/romani/round_4.png",text:"25",id:"25",style:{transform:"translateX(116px)"}},{img:"/romani/round_2.png",text:"24",id:"24",style:{transform:"translateX(132px)"},rotate:{transform:"rotate(-45deg)"}},{img:"/romani/round_4.png",text:"23",id:"23",style:{transform:"translateX(148px)"}},{img:"/romani/3.png",text:"22",id:"22",style:{transform:"translateX(164px)"}}]],"Банкетный зал":[[{img:"/romani/3.png",text:"61",id:"61",style:{},rotate:{transform:"rotate(90deg)"}},{img:"/romani/4.png",text:"62",id:"62",style:{transform:"translate(16px, 16px)"}},{img:"/romani/2.png",text:"64",id:"64",style:{transform:"translate(32px, 16px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/4.png",text:"65",id:"65",style:{transform:"translate(48px, 16px)"}},{img:"/romani/4.png",text:"67",id:"67",style:{transform:"translate(64px, 16px)"}},{img:"/romani/4.png",text:"69",id:"69",sub:"Не сдвигать",style:{transform:"translate(80px, 16px)"}}],[],[{img:"/romani/arrow.svg",sub:"Вход",id:"lol?",custom:!0,style:{"margin-right":"-48px",transform:"translateY(32px)"},rotate:{width:"48px",height:"12px",transform:"rotate(-90deg)"}},{img:"/romani/4.png",text:"57",id:"57",sub:"Не сдвигать",style:{transform:"translate(48px, 16px)"}},{img:"/romani/4.png",text:"55",id:"55",sub:"Не сдвигать",style:{transform:"translate(64px, 16px)"}},{img:"/romani/4.png",text:"53",id:"53",style:{transform:"translate(80px, 16px)"}},{img:"/romani/2.png",text:"52",id:"52",style:{transform:"translate(96px, 16px)"},rotate:{transform:"rotate(90deg)"}},{img:"/romani/4.png",text:"50",id:"50",sub:"Не сдвигать",style:{transform:"translate(112px, 16px)"}}]]},C=Q(()=>{const y=b.value;return Object.keys(B).reduce((M,z)=>(M[z]=B[z].map(ee=>ee.map(_=>({..._,id:y[_.text]}))),M),{})}),h=jt({}),x=Q(()=>Object.keys(h).filter(y=>h[y])),u=()=>{o("tableSelect",x.value)},I=y=>{y&&(h[y]=!h[y])};Y(()=>i.preselected,y=>{y.forEach(M=>{h[M]=!0})},{immediate:!0}),v({left:0,top:0,width:0,height:0,ratio:1});const V=v({scale:1,translate:{x:0,y:0},deg:0}),L=Q(()=>{const y=V.value;return{position:"relative",display:"inline-flex",transition:"",transformOrigin:"0 0",transform:`translate(${y.translate.x}px, ${y.translate.y}px) scale(${y.scale})`}}),N=([y,M])=>{const z=V.value.translate;V.value={...V.value,translate:{x:z.x+y,y:z.y+M}}},D={matrix:V,onEvent:(y,M,z)=>{const ee=V.value;V.value={...ee,scale:y,translate:{x:M,y:z}}},onRelease:()=>{}},F={onEvent:N,onPanning:()=>{}};return(y,M)=>(t(),l(T,null,[d("div",{class:g(["ark-space_bottom-2",y.$style.zones])},[(t(!0),l(T,null,te(f.value,(z,ee)=>(t(),R(e(E),{key:ee,size:"xs",type:"button",appearance:O.value===z?"primary":"neutral",onClick:_=>O.value=z},{default:p(()=>[c(X(z),1)]),_:2},1032,["appearance","onClick"]))),128))],2),Ja,ce((t(),l("div",{class:g(y.$style.floor)},[d("div",{class:g(y.$style.content),style:Me(L.value)},[(t(!0),l(T,null,te(C.value[O.value??"1 Этаж"],(z,ee)=>(t(),l("div",{key:ee,class:g(y.$style.line)},[(t(!0),l(T,null,te(z,_=>(t(),l("button",{key:_.id,type:"button",class:g(y.$style.table),style:Me(_.style),"data-selected":h[_.id],onClick:a=>I(_.custom?"":_.id)},[d("span",{class:g(y.$style.table__text)},X(_.text),3),d("img",{src:_.img,width:"32",height:"32",style:Me(_.rotate)},null,12,Ga),_.sub?(t(),l("p",{key:0,class:g(["ark-text_64",y.$style.sub])},X(_.sub),3)):w("",!0)],14,Za))),128))],2))),128))],6)],2)),[[e(at)],[e(fa),F],[e(ba),D]]),d("p",Wa,[c(" Выбраны столы: "),r(e(st),{tables:x.value},null,8,["tables"])]),r(e(E),{size:"xs",loading:y.loading,onClick:u},{default:p(()=>[c(" Пересадить ")]),_:1},8,["loading"]),r(e(E),{appearance:"neutral",size:"xs",class:"ark-space_left-2",onClick:M[0]||(M[0]=z=>o("close"))},{default:p(()=>[c(" Отменить ")]),_:1})],64))}}),Qa="_floor_1bx28_1",Ya="_content_1bx28_10",el="_line_1bx28_18",tl="_table_1bx28_24",al="_table__text_1bx28_47",ll="_sub_1bx28_58",sl="_zones_1bx28_67",ol={floor:Qa,content:Ya,line:el,table:tl,table__text:al,sub:ll,zones:sl},nl={$style:ol},rl=ie(Ka,[["__cssModules",nl]]),il={key:0},ul={style:{display:"flex","text-decoration":"line-through"}},dl={key:2,style:{display:"flex","flex-wrap":"wrap",gap:"0.125rem"}},cl=["title"],ml={style:{"text-decoration":"line-through"}},vl=oe({__name:"HistoryChanges",props:{changeToString:{},changes:{}},setup(P){return(m,i)=>(t(!0),l(T,null,te(m.changes,(o,S)=>(t(),l("div",{key:S,class:g(m.$style.change)},[c(X(m.changeToString[o.key]||o.key)+": ",1),o.key==="seating_time"||o.key==="end_time"?(t(),l("div",il,[o.new?(t(),R(e(be),{key:0,mask:"[hour:numeric]:[minute:numeric], [day:numeric].[month:numeric].[year:numeric]. ",date:o.new},null,8,["date"])):w("",!0),o.old?(t(),R(e(be),{key:1,mask:"[hour:numeric]:[minute:numeric], [day:numeric].[month:numeric].[year:numeric]",style:{"text-decoration":"line-through"},date:o.old},null,8,["date"])):w("",!0)])):o.key==="tables"?(t(),l(T,{key:1},[r(e(xe),{"show-capacity":!1,"show-zone":!1,ids:o.new},null,8,["ids"]),d("div",ul,[r(e(xe),{"show-capacity":!1,"show-zone":!1,ids:o.old},null,8,["ids"])])],64)):o.key==="tags"?(t(),l("div",dl,[!o.new||o.new.length===0?(t(),l(T,{key:0},[c(" Удалено ")],64)):(t(),l("div",{key:1,title:o.new.join("; "),class:g(m.$style.clamp)},X(o.new.join("; ")),11,cl))])):o.key==="num_people"?(t(),l(T,{key:3},[d("span",null,X(o.new),1),d("span",ml,X(o.old),1)],64)):(t(),l(T,{key:4},[o.new?(t(),l("p",{key:1,class:g(m.$style.clamp)},X(o.new),3)):(t(),l(T,{key:0},[c(" Удалено ")],64))],64))],2))),128))}}),pl="_change_152ju_1",_l="_clamp_152ju_8",fl={change:pl,clamp:_l},bl={$style:fl},tt=ie(vl,[["__cssModules",bl]]),gl={class:"ark-text_body-xs ark-space_bottom-1"},yl={class:"ark-text_64",style:{display:"flex","align-items":"center",gap:"0.25rem"}},kl={key:0,class:"ark-text_body-xs-2 ark-text_64"},hl={class:"ark-text_medium ark-space_bottom-1",style:{"font-style":"italic"}},xl=oe({__name:"HistoryPreview",props:{item:{}},setup(P){const m=P,{item:i}=Ve(m),o={comment:"Изм. комент",seating_time:"Начало",end_time:"Конец",tables:"Пересадили",status:"Изм. статус",num_people:"Кол-во",tags:"Изм. метки"},S={seating_time:"Начало",end_time:"Конец",tables:"Столы"},O=Q(()=>{const A=i.value,f="changes"in A?A.changes:[];if(f.length===0)return null;const b=f.reduce((u,I)=>(u[I.key]=I,u),{});return Object.keys(b).length===1&&!!b.seating_time?new Date(f[0].new).valueOf()-new Date(f[0].old).valueOf()===ot*15?{text:'Нажали "Опаздывают"',params:{type:"date",value:f[0].new}}:null:!!b.tables&&(b.seating_time||!!b.end_time)?{text:"Изменили время. Автоматически пересадили",params:{type:"array",value:f}}:!!b.tables&&b.num_people?{text:"Изменили кол-во гостей. Автоматически пересадили",params:{type:"array",value:f}}:null});return(A,f)=>(t(),l("div",gl,[d("div",yl,[d("span",null,X(e(i).user==="Anonymous"?"Гость":e(i).user)+".",1),r(e(be),{mask:"[day:numeric] [month:long] [year:numeric], [hour:numeric]:[minute:numeric]",date:e(i).date},null,8,["date"])]),"init"in e(i)&&e(i).init?(t(),l(T,{key:0},[e(i).user!=="Anonymous"?(t(),l("div",kl,[e(i).init.seating_time&&e(i).init.end_time&&e(i).init.tables?(t(),l(T,{key:0},[c(" Создано через таблицу ")],64)):e(i).init.seating_time&&!e(i).init.end_time&&!e(i).init.tables?(t(),l(T,{key:1},[c(' Создано через "Добавить" ')],64)):w("",!0)])):w("",!0),(t(!0),l(T,null,te(e(i).init,(b,B)=>(t(),l("div",{key:B,class:g(A.$style.change)},[c(X(S[B]??B)+": ",1),(B==="seating_time"||B==="end_time")&&b?(t(),R(e(be),{key:0,mask:"[day:numeric] [month:long] [year:numeric], [hour:numeric]:[minute:numeric]",date:b},null,8,["date"])):B==="tables"&&b?(t(),R(e(xe),{key:1,"show-capacity":!1,"show-zone":!1,ids:b},null,8,["ids"])):w("",!0)],2))),128))],64)):w("",!0),O.value?(t(),l(T,{key:1},[d("p",hl,X(O.value.text),1),O.value.params.type==="date"?(t(),R(e(be),{key:0,mask:"Новое время: [hour:numeric]:[minute:numeric]",date:O.value.params.value},null,8,["date"])):O.value.params.type==="array"?(t(),R(tt,{key:1,changes:O.value.params.value,"change-to-string":o},null,8,["changes"])):w("",!0)],64)):"changes"in e(i)?(t(),R(tt,{key:2,changes:e(i).changes,"change-to-string":o},null,8,["changes"])):w("",!0)]))}}),$l="_change_152ju_1",wl="_clamp_152ju_8",Cl={change:$l,clamp:wl},Sl={$style:Cl},Tl=ie(xl,[["__cssModules",Sl]]),Bl={class:"ark-text_h6 ark-space_bottom-1 ark-text_medium",style:{display:"flex","align-items":"center","justify-content":"space-between"}},Nl={key:0},Dl=d("a",{class:"ark-space_left-2 ark-text_body-s ark-text_semibold",style:{cursor:"pointer"}}," Изменить статус ",-1),zl={key:2},Ol={class:"ark-text_body-s"},El={key:0},Vl=d("p",{class:"ark-text_semibold"},"Столы могут поменяться",-1),Il=d("p",{class:"ark-text_body-s"},' Если нужны именно эти столы, нажмите на "Оставить ..." ',-1),Ll={key:0,style:{width:"100%"}},Ml={key:1},Al={key:0,class:"ark-text_semibold ark-text_body-xs-2",style:{color:"var(--ark-error-fill)","text-transform":"none"}},Rl={key:4,style:{"padding-left":"0.5rem","--ark-elevation":"var(--ark-background-color)"}},Pl={key:0,class:"ark-space_bottom-2"},Xl={key:2,class:"ark-space_bottom-8"},Ul={key:0,class:"ark-text_body-xs"},Hl=d("div",null,[d("p",{class:"ark-text_body-s-2 ark-text_semibold"},"Опаздывают"),d("p",{class:"ark-text_body-xs-2"},"(+15 мин.)")],-1),Fl={key:1},jl=d("p",{class:"ark-space_bottom-2 ark-text_h6"}," Не удалось загрузить информацию ",-1),ql={style:{"text-align":"center"}},Jl=d("h4",{class:"ark-text_h4 ark-space_bottom-6",style:{"text-align":"center"}}," Точно отменяем бронирование? ",-1),Zl=oe({__name:"AirestoBookingRes",props:{itemId:{}},emits:["close","changeTable","refresh","editMode"],setup(P,{emit:m}){const i=P,o=m,S={[J.NEW]:"Ожидает подтверждения",[J.APPLICATION]:"Ожидаем",[J.CANCELLED]:"Отменен",[J.CLOSED]:"Завершено",[J.OPEN]:"В зале"},O={"Не пересаживать":"lock","День рождения":"cake",Предзаказ:"order",Корпоратив:"party","Может опоздать":"slow","Пробковый сбор":"beer",Сертификат:"ticket","У окна":"window",Свидание:"heart","Деловая встреча":"business","Хочу напиться":"wine","Хочу поесть":"food"},A=[J.NEW,J.APPLICATION,J.OPEN,J.CANCELLED,J.CLOSED],f=He(),b=Fe(),B=v(!1),C=v(!1),h=v(!1),x=v(!1),u=v(""),I=v(""),V=mt({name:["",{required:Xe}],count:[1]}),L=v(!1),N=v(!1),D=v(!1),F=v(!1),y=v(!1),M=v(!1),z=v(null),ee=v(NaN),_=v(!1),a=v(null),j=v(!1),U=v(!1),k=v(!1),q=v(!1),K=v(""),G=v([]),ne=v(!1),pe=v(!1),me=v(!1),ve=v(!1),Ie=localStorage.getItem("__ark-supra-table-mode-booking-rest"),_e=v(Ie==="list"||Ie==="scheme"?Ie:"list"),$e=v(!1),we=v(!1),ue=v(!1),ge=v(null);Y(_e,n=>{localStorage.setItem("__ark-supra-table-mode-booking-rest",n)});const ae=v(Date.now()),Le=de(Ue),bt=Q(()=>{var s;return[...((s=a.value)==null?void 0:s.tags)??[]].sort()}),gt=n=>{const s=document.querySelector(`[data-id="${n}"]`);s&&(s.scrollIntoView({block:"center",inline:"center"}),s.classList.add("ark-vibe"))},je=()=>{if(!a.value)return;ve.value=!0;const n=new he(Ae.jsonParse(a.value.seating_time),Re.fromString(a.value.seating_time.split("T")[1])),s=new he(Ae.jsonParse(a.value.end_time),Re.fromString(a.value.end_time.split("T")[1])),H=a.value;f.updateBooking.execute({id:Number(i.itemId),seating_time:`${n.day.toJSON()} ${n.time.toString("HH:MM")}`,end_time:`${s.day.toJSON()} ${s.time.toString("HH:MM")}`}).then(W=>{W&&(a.value=W,W.tables.sort().toString()!==H.tables.sort().toString()?(b.show(Ne(De),{autoClose:15e3,data:{...W,allTables:Le.value,__frontUpdate:!0,__newbooking:!0}}),o("changeTable",{prev:H.tables,new:W.tables,dto:W})):(b.show("Не смогли найти подходящий стол",{type:"error"}),o("refresh",W)))}).catch(()=>{b.show("Ошибка смены стола",{type:"error"})}).finally(()=>{ve.value=!1})},yt=Q(()=>h.value||L.value||C.value&&u.value!==K.value||B.value&&x.value),kt=Q(()=>{const n=a.value;return!!n&&(n.status===J.CANCELLED||n.status===J.CANCELLED_NO_DEPOSIT)}),ye=Q(()=>!kt.value),ht=()=>{var W;if(V.validate(),V.invalid.value)return;N.value=!0;const n=a.value,s=$e.value?(W=a.value)==null?void 0:W.tables:void 0,{count:H}=V.getCurrentValue();f.updateBooking.execute({id:Number(i.itemId),num_people:H,tables:s}).then(Z=>{Z&&(a.value=Z,Z.tables.sort().toString()!==n.tables.sort().toString()?(b.show(Ne(De),{autoClose:15e3,data:{...Z,allTables:Le.value,__frontUpdate:!0,__newbooking:!0}}),o("changeTable",{prev:n.tables,new:Z.tables,dto:Z})):(b.show("Изменили количество человек"),o("refresh",Z)),ae.value=Date.now(),L.value=!1)}).catch(([Z])=>{b.show("Попробуйте еще раз",{label:Z.error?Z.error:"Не удалось изменить кол-во человек",type:"error"})}).finally(()=>{N.value=!1})},xt=n=>{z.value=n,f.updateBooking.execute({id:Number(i.itemId),status:n}).then(s=>{s&&(b.show(`Изменили статус брони. "${S[n]}"`),a.value=s,o("refresh",s),o("close"),me.value=!1,ae.value=Date.now())}).catch(()=>{b.show("Попробуйте еще раз",{label:"Не удалось обновить",type:"error"})}).finally(()=>{z.value=null})},$t=()=>{M.value=!0,f.updateBooking.execute({id:Number(i.itemId),status:J.APPLICATION}).then(n=>{n&&(b.show("Вернули бронь"),a.value=n,o("refresh",n),o("close"),j.value=!1,me.value=!1,ae.value=Date.now())}).catch(()=>{b.show("Попробуйте еще раз",{label:"Не удалось обновить",type:"error"})}).finally(()=>{M.value=!1})},wt=()=>{pe.value=!0,f.updateBooking.execute({id:Number(i.itemId),status:J.OPEN}).then(n=>{n&&(b.show("За столом"),a.value=n,o("refresh",n),o("close"),j.value=!1,ae.value=Date.now())}).catch(()=>{b.show("Попробуйте еще раз",{label:"Не удалось обновить",type:"error"})}).finally(()=>{pe.value=!1})},Ct=()=>{U.value=!0,f.updateBooking.execute({id:Number(i.itemId),status:J.CANCELLED,comment:I.value||void 0}).then(n=>{n&&(b.show("Бронирование отменено"),a.value=n,I.value="",o("refresh",n),o("close"),j.value=!1,ae.value=Date.now())}).catch(()=>{b.show("Попробуйте еще раз",{label:"Не удалось отменить бронирование",type:"error"})}).finally(()=>{U.value=!1})},St=()=>{const n=K.value,s=a.value,H=G.value,W=n===(s==null?void 0:s.comment)?void 0:n,Z=JSON.stringify(((s==null?void 0:s.tags)??[]).sort())===JSON.stringify(H.sort())?void 0:H;q.value=!0,f.updateBooking.execute({id:Number(i.itemId),comment:W,tags:Z}).then(fe=>{if(fe){const Ce=W&&Z?"комментарий и метки":W?"комментарий":"метки";b.show(`Изменили ${Ce}`),a.value=fe,C.value=!1,o("refresh",fe),ae.value=Date.now()}}).catch(()=>{b.show("Попробуйте еще раз",{label:"Не удалось изменить комментарий",type:"error"})}).finally(()=>{q.value=!1})},Tt=()=>{D.value=!0,f.updateBooking.execute({id:Number(i.itemId),status:J.CLOSED}).then(n=>{n&&(b.show("Завершили бронирование"),a.value=n,o("refresh",n),o("close"),ae.value=Date.now())}).catch(()=>{b.show("Попробуйте еще раз",{label:"Не удалось завершить бронирование",type:"error"})}).finally(()=>{D.value=!1})},Bt=()=>{y.value=!0,f.updateBooking.execute({id:Number(i.itemId),status:J.APPLICATION}).then(n=>{n&&(b.show("Подтвердили бронь"),a.value=n,o("refresh",n),o("close"),ae.value=Date.now())}).catch(()=>{b.show("Попробуйте еще раз",{label:"Не удалось завершить бронирование",type:"error"})}).finally(()=>{y.value=!1})},Nt=()=>{k.value=!0,f.updateBooking.execute({id:Number(i.itemId),clients_are_late:!0}).then(n=>{n&&(b.show("Перенесли на 15 минут"),a.value=n,ae.value=Date.now(),o("refresh",n))}).catch(()=>{b.show("Попробуйте еще раз",{label:"Не удалось перенести бронь",type:"error"})}).finally(()=>{k.value=!1})},Dt=n=>{var W;F.value=!0;const s=we.value?(W=a.value)==null?void 0:W.tables:void 0,H=a.value;f.updateBooking.execute({id:Number(i.itemId),seating_time:n.start,end_time:n.end,tables:s}).then(Z=>{Z&&(a.value=Z,we.value=!1,B.value=!1,Z.tables.sort().toString()!==H.tables.sort().toString()?(b.show(Ne(De),{autoClose:15e3,data:{...Z,allTables:Le.value,__frontUpdate:!0,__newbooking:!0}}),o("changeTable",{prev:H.tables,new:Z.tables,dto:Z})):(b.show("Изменили дату и время"),o("refresh",Z)),ae.value=Date.now())}).catch(()=>{b.show("Попробуйте еще раз",{label:"Не удалось изменить дату и время",type:"error"})}).finally(()=>{F.value=!1})},qe=()=>{ue.value=!0,f.loadBookingHistory.execute({id:Number(i.itemId)}).then(n=>{n&&Array.isArray(n)?(ge.value=n.sort((s,H)=>new Date(H.date).valueOf()-new Date(s.date).valueOf()).map(s=>({...s,changes:"changes"in s?s.changes.filter(H=>H.key==="tables"?H.new.sort().toString()!==H.old.sort().toString():H.new.toString()!==H.old.toString()&&H.key!=="tags"):[],init:"init"in s?s.init:null})).filter(s=>s.changes.length>0||s.init),ue.value=!1):ue.value=null}).catch(()=>{ue.value=null})},Je=n=>{ne.value=!0;const s=a.value;f.updateBooking.execute({id:Number(i.itemId),tables:n}).then(H=>{H&&(b.show("Изменили столы"),a.value=H,h.value=!1,ae.value=Date.now(),o("changeTable",{prev:s.tables,new:H.tables,dto:H}))}).catch(()=>{b.show("Попробуйте еще раз",{label:"Не удалось изменить столы",type:"error"})}).finally(()=>{ne.value=!1})};return Y(C,n=>{var s,H;n&&(K.value=((s=a.value)==null?void 0:s.comment)||"",G.value=((H=a.value)==null?void 0:H.tags)??[],u.value=K.value)}),Y(L,n=>{n&&($e.value=!1)}),Y([L,a],([n,s])=>{n&&s&&(V.count.setValue(s.num_people),V.name.setValue(s.name_for_reservation))}),Y(yt,n=>{o("editMode",n)}),Y([()=>i.itemId,ee],([n])=>{_.value=!0,ge.value=null,ue.value=!1,h.value=!1,C.value=!1,B.value=!1,f.loadBookingById.execute({id:n}).then(s=>{a.value=s,ae.value=Date.now()}).finally(()=>{_.value=!1})},{immediate:!0}),Y(ye,(n,s)=>{s&&!n&&(C.value=!1,B.value=!1,h.value=!1)}),Y(ae,()=>{qe()},{immediate:!0}),(n,s)=>{var H,W,Z,fe,Ce,Ze,Ge,We,Ke;return t(),l(T,null,[_.value||a.value?(t(),l(T,{key:0},[d("h6",Bl,[c(" Бронирование "),r(e(Pa),{appearance:"filled",size:"s",color:"var(--ark-white)",background:"var(--supra-accent)"},{default:p(()=>[c(" Airesto ")]),_:1})]),a.value?(t(),l("div",Nl,[r(e(qt),{class:g(_.value&&"ark-skeleton"),end_time:a.value.end_time,seating_time:a.value.seating_time,status:a.value.status},null,8,["class","end_time","seating_time","status"]),r(e(nt),{modelValue:me.value,"onUpdate:modelValue":s[0]||(s[0]=$=>me.value=$),"min-width":240},{dropdown:p(()=>[r(e(ua),null,{default:p(()=>[(t(),l(T,null,te(A,$=>ce(r(e(E),{key:$,size:"s",appearance:"flat",disabled:z.value!==null,loading:z.value===$,onClick:re=>xt($)},{default:p(()=>[c(X(S[$]),1)]),_:2},1032,["disabled","loading","onClick"]),[[e(da)]])),64))]),_:1})]),default:p(()=>[Dl]),_:1},8,["modelValue"])])):w("",!0),d("p",{class:g(n.$style.label)},[c(" Гость "),a.value&&ye.value?(t(),R(e(E),{key:0,size:"xs",appearance:"neutral",type:"button",disabled:_.value,onClick:s[1]||(s[1]=$=>L.value=!L.value)},{default:p(()=>[c(X(L.value?"Отменить":"Изменить"),1)]),_:1},8,["disabled"])):w("",!0)],2),L.value?(t(),l("div",zl,[r(e(ke),{control:e(V).count},{default:p(({model:$})=>[r(e(vt),{modelValue:$.value,"onUpdate:modelValue":re=>$.value=re,label:"Количество человек",min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),d("div",{class:g(["ark-space_bottom-2 ark-space_top-2",n.$style.buttons]),style:{"align-items":"center","flex-wrap":"nowrap"}},[r(e(Zt),null,{default:p(()=>{var $;return[r(e(Jt),{modelValue:$e.value,"onUpdate:modelValue":s[2]||(s[2]=re=>$e.value=re),size:"s",class:"ark-space_right-1"},null,8,["modelValue"]),d("div",Ol,[c(" Оставить стол"),a.value&&a.value.tables.length>1?(t(),l("span",El,"ы")):w("",!0),c("  "),r(e(st),{tables:(($=a.value)==null?void 0:$.tables)||[]},null,8,["tables"])])]}),_:1}),r(e(Kt),null,{default:p(({on:$,attrs:re})=>[r(e(ze),Gt(re,{name:"question",class:"ark-text_48",size:12},Wt($),{onClick:s[3]||(s[3]=se(()=>{},["stop"]))}),null,16)]),hint:p(()=>[Vl,Il]),_:1})],2),d("div",{class:g(["ark-space_top-2",n.$style.buttons])},[r(e(E),{type:"button",size:"xs",loading:N.value,onClick:se(ht,["stop","prevent"])},{default:p(()=>[c(" Сохранить ")]),_:1},8,["loading"]),r(e(E),{type:"button",size:"xs",appearance:"flat",onClick:s[4]||(s[4]=se($=>L.value=!1,["stop","prevent"]))},{default:p(()=>[c(" Отменить ")]),_:1})],2)])):(t(),R(Oe,{key:1,name:(H=a.value)==null?void 0:H.name_for_reservation,num:(W=a.value)==null?void 0:W.num_people,phone:(Z=a.value)==null?void 0:Z.phone_number,loading:_.value},null,8,["name","num","phone","loading"])),d("p",{class:g(n.$style.label)},[c(X(B.value?"Изменение даты и времени":"Дата и время")+" ",1),a.value&&ye.value?(t(),R(e(E),{key:0,size:"xs",appearance:"neutral",type:"button",disabled:_.value,onClick:s[5]||(s[5]=$=>B.value=!B.value)},{default:p(()=>[c(X(B.value?"Отменить":"Изменить"),1)]),_:1},8,["disabled"])):w("",!0)],2),r(rt,{edit:B.value,loading:_.value||F.value,count:((fe=a.value)==null?void 0:fe.num_people)??0,start:a.value?a.value.seating_time:"1970-01-01T01:01:01+10:00",end:a.value?a.value.end_time:"1970-01-01T01:01:01+10:00",tables:(Ce=a.value)==null?void 0:Ce.tables,onConfirm:Dt,onClose:s[6]||(s[6]=$=>{B.value=!1,we.value=!1}),onEdited:s[7]||(s[7]=$=>x.value=$),onNewTables:s[8]||(s[8]=$=>we.value=$)},null,8,["edit","loading","count","start","end","tables"]),d("p",{class:g(n.$style.label)},[c(X(C.value?"Изменение комментария":"Комментарий")+" ",1),ye.value?(t(),R(e(E),{key:0,size:"xs",appearance:"neutral",type:"button",disabled:_.value,onClick:s[9]||(s[9]=se($=>C.value=!C.value,["stop","prevent"]))},{default:p(()=>[c(X(C.value?"Отменить":"Изменить"),1)]),_:1},8,["disabled"])):w("",!0)],2),d("div",{class:g(n.$style.commentContainer)},[C.value?(t(),l("div",Ll,[ce(r(e(pt),{modelValue:K.value,"onUpdate:modelValue":s[10]||(s[10]=$=>K.value=$),placeholder:"Комментарий...",rows:2},null,8,["modelValue"]),[[e(ft)]]),r(e(_t),{tags:G.value,"onUpdate:tags":s[11]||(s[11]=$=>G.value=$),theme:"neutral"},null,8,["tags"]),d("div",{class:g(["ark-space_top-2",n.$style.buttons])},[r(e(E),{type:"button",size:"xs",loading:q.value,onClick:se(St,["stop","prevent"])},{default:p(()=>[c(" Сохранить ")]),_:1},8,["loading"]),r(e(E),{type:"button",size:"xs",appearance:"flat",onClick:s[12]||(s[12]=se($=>C.value=!1,["stop","prevent"]))},{default:p(()=>[c(" Отменить ")]),_:1})],2)])):(t(),l("div",Ml,[a.value&&(a.value.tags&&((Ze=a.value.tags)==null?void 0:Ze.length)>0||a.value.comment)?(t(),l(T,{key:0},[!_.value&&((Ge=a.value)!=null&&Ge.tags)&&a.value.tags.length>0?(t(),l("div",{key:0,class:g(n.$style.tags)},[(t(!0),l(T,null,te(bt.value,$=>(t(),l("p",{key:$,class:g(n.$style.tags__item)},[O[$]?(t(),R(e(Qt),{key:0,size:"0.75rem",name:O[$]},null,8,["name"])):w("",!0),c(" "+X($),1)],2))),128))],2)):w("",!0),a.value&&a.value.comment?(t(),l("p",{key:1,class:g(["ark-text_body-s-2 ark-space_top-2",_.value&&"ark-skeleton"])},X(a.value.comment),3)):w("",!0)],64)):(t(),l("p",{key:1,class:g(["ark-text_body-s-2",_.value&&"ark-skeleton"])}," — ",2))]))],2),d("div",{class:g(n.$style.label)},[d("div",null,[d("p",null,X(h.value?"Изменение столов":"Столы"),1),(Ke=(We=a.value)==null?void 0:We.tags)!=null&&Ke.find($=>$==="Не пересаживать")?(t(),l("p",Al," Не пересаживать ")):w("",!0)]),a.value&&ye.value?(t(),R(e(E),{key:0,size:"xs",appearance:"neutral",type:"button",disabled:_.value,onClick:s[13]||(s[13]=$=>h.value=!h.value)},{default:p(()=>[c(X(h.value?"Отменить":"Изменить"),1)]),_:1},8,["disabled"])):w("",!0)],2),h.value?a.value?(t(),l("div",Rl,[r(e(E),{size:"xs",class:"ark-space_bottom-2",appearance:"neutral",loading:ve.value,onClick:je},{default:p(()=>[c(" Перенести на любой другой стол ")]),_:1},8,["loading"]),a.value.restaurant===111113?(t(),l("div",Pl,[r(e(E),{size:"xs",class:"ark-space_right-1",appearance:_e.value==="scheme"?"neutral":"flat",onClick:s[14]||(s[14]=$=>_e.value="scheme")},{default:p(()=>[c(" Схема ")]),_:1},8,["appearance"]),r(e(E),{size:"xs",appearance:_e.value==="list"?"neutral":"flat",onClick:s[15]||(s[15]=$=>_e.value="list")},{default:p(()=>[c(" Список ")]),_:1},8,["appearance"])])):w("",!0),a.value.restaurant===111113&&_e.value==="scheme"?(t(),R(rl,{key:1,preselected:a.value.tables,loading:ne.value,onClose:s[16]||(s[16]=$=>h.value=!1),onTableSelect:Je},null,8,["preselected","loading"])):(t(),l("div",Xl,[r(ma,{"button-reverse":"","button-size":"xs","button-text":"Пересадить",item:a.value,"show-client":!1,loading:ne.value,onClose:s[17]||(s[17]=$=>h.value=!1),onTableSelect:Je},{subtitle:p(()=>[c(" За какой стол пересаживаем? ")]),expectedTitle:p(()=>[c(" Текущие столы ")]),_:1},8,["item","loading"])]))])):w("",!0):(t(),l("div",{key:3,class:g(["ark-space_bottom-4",[n.$style.tables,_.value&&"ark-skeleton"]])},[r(e(E),{size:"xs",class:"ark-space_bottom-2",appearance:"neutral",loading:ve.value,onClick:je},{default:p(()=>[c(" Перенести на любой другой стол ")]),_:1},8,["loading"]),a.value?(t(),R(e(xe),{key:0,"show-capacity":!1,"res-id":a.value.id,ids:a.value.tables},null,8,["res-id","ids"])):w("",!0)],2)),d("p",{class:g(n.$style.label)},"История изменений",2),ce((t(),l("div",{class:g(["ark-space_bottom-4",n.$style.history])},[ue.value===null?(t(),l("p",Ul,"Нет истории")):w("",!0),a.value&&!ge.value&&ue.value!==null?(t(),R(e(E),{key:1,size:"xs",appearance:"neutral",type:"button",loading:ue.value===null?!1:ue.value,onClick:qe},{default:p(()=>[c(" Загрузить ")]),_:1},8,["loading"])):w("",!0),ge.value?(t(!0),l(T,{key:2},te(ge.value,($,re)=>(t(),R(Tl,{key:re,item:$},null,8,["item"]))),128)):w("",!0)],2)),[[e(ct),"vertical"]]),a.value?(t(),l("div",{key:5,class:g(["ark-space_top-auto",n.$style.actions])},[a.value.status===e(J).NEW?(t(),R(e(E),{key:0,loading:y.value,onClick:Bt},{default:p(()=>[c(" Подтвердить ")]),_:1},8,["loading"])):w("",!0),a.value.status===e(J).CANCELLED||a.value.status===e(J).CANCELLED_NO_DEPOSIT||a.value.status===e(J).CLOSED?(t(),R(e(E),{key:1,appearance:"s-danger",loading:M.value,onClick:$t},{default:p(()=>[c(' Вернуть в "ожидаем" ')]),_:1},8,["loading"])):w("",!0),a.value.status===e(J).APPLICATION?(t(),l("div",{key:2,class:g([n.$style.buttons,n.$style.buttons_wide])},[r(e(E),{align:"vertical",appearance:"success",loading:pe.value,onClick:wt},{default:p(()=>[c(" За столом ")]),_:1},8,["loading"]),r(e(E),{appearance:"neutral-b",align:"vertical",loading:k.value,onClick:Nt},{default:p(()=>[Hl]),_:1},8,["loading"])],2)):w("",!0),a.value.status===e(J).APPLICATION||a.value.status===e(J).NEW?(t(),R(e(E),{key:3,appearance:"s-danger",onClick:s[18]||(s[18]=$=>j.value=!0)},{default:p(()=>[c(" Отменить бронь ")]),_:1})):w("",!0),a.value.status===e(J).OPEN||a.value.status===e(J).WAITING?(t(),R(e(E),{key:4,appearance:"success",loading:D.value,onClick:Tt},{default:p(()=>[c(" Завершить бронь ")]),_:1},8,["loading"])):w("",!0),r(e(E),{appearance:"flat",onClick:s[19]||(s[19]=$=>gt(a.value.id))},{default:p(()=>[c(" Найти на странице ")]),_:1})],2)):w("",!0)],64)):(t(),l("div",Fl,[jl,r(e(E),{appearance:"neutral",size:"s",onClick:s[20]||(s[20]=$=>ee.value=Date.now())},{default:p(()=>[c(" Попробуйте еще раз ")]),_:1})])),r(e(Ee),{modelValue:j.value,"onUpdate:modelValue":s[22]||(s[22]=$=>j.value=$),size:"sm",order:3.1},{default:p(({close:$})=>{var re,Qe,Ye;return[d("div",ql,[r(e(Yt),{class:"ark-space_bottom-6",type:"warning"}),Jl,r(Oe,{name:(re=a.value)==null?void 0:re.name_for_reservation,num:(Qe=a.value)==null?void 0:Qe.num_people,phone:(Ye=a.value)==null?void 0:Ye.phone_number,loading:_.value},null,8,["name","num","phone","loading"]),r(e(it),{modelValue:I.value,"onUpdate:modelValue":s[21]||(s[21]=zt=>I.value=zt),class:"ark-space_top-3",label:"Причина отмены (опционально)",size:"l"},null,8,["modelValue"]),d("div",{class:g(["ark-space_top-4",n.$style.actions])},[r(e(E),{size:"l",loading:U.value,onClick:Ct},{default:p(()=>[c(" Да, отменяем ")]),_:1},8,["loading"]),r(e(E),{appearance:"neutral",size:"l",onClick:$},{default:p(()=>[c(" Нет, оставляем ")]),_:2},1032,["onClick"])],2)])]}),_:1},8,["modelValue"])],64)}}}),Gl="_tables_175ln_1",Wl="_commentContainer_175ln_18",Kl="_actions_175ln_26",Ql="_buttons_175ln_27",Yl="_buttons_wide_175ln_33",es="_comment_175ln_18",ts="_history_175ln_57",as="_label_175ln_69",ls="_tags_175ln_85",ss="_tags__item_175ln_90",os={tables:Gl,commentContainer:Wl,actions:Kl,buttons:Ql,buttons_wide:Yl,comment:es,history:ts,label:as,tags:ls,tags__item:ss},ns={$style:os},rs=ie(Zl,[["__cssModules",ns]]),is=["value"],us=oe({__name:"SimpleTextarea",props:{modelValue:{}},emits:["update:modelValue"],setup(P,{emit:m}){const i=m,o=S=>{const O=S.target.value;i("update:modelValue",O)};return(S,O)=>(t(),l("textarea",{value:S.modelValue,class:g(S.$style.textarea),onInput:o},null,42,is))}}),ds="_textarea_18ru7_1",cs={textarea:ds},ms={$style:cs},vs=ie(us,[["__cssModules",ms]]),ps={class:"ark-text_h6 ark-space_bottom-1 ark-text_medium"},_s={key:1},fs={key:0,style:{width:"100%"}},bs={key:1},gs=d("p",{class:"ark-space_bottom-2 ark-text_h6"}," Не удалось загрузить информацию ",-1),ys=d("h6",{class:"ark-text_h6 ark-space_bottom-4"},"Точно отменяем бронирование?",-1),ks=oe({__name:"BookingRes",props:{itemId:{}},emits:["close","refresh","editMode"],setup(P,{emit:m}){const i=P,o=m,S=He(),O=Fe(),A=v(!1),f=v(!1),b=v(!1),B=v(!1),C=v(""),h=v(NaN),x=v(!1),u=v(null),I=v(!1),V=v(!1),L=v(!1),N=v(""),D=de(ut),F=_=>{const a=document.querySelector(`[data-id="${_}"]`);a&&(a.scrollIntoView({block:"center",inline:"center"}),a.classList.add("ark-vibe"))},y=Q(()=>b.value||f.value&&C.value!==N.value||A.value&&B.value),M=Q(()=>{const _=u.value;if(!_)return"";switch(_.status){case le.Sat:case le.Called:case le.Cancelled:case le.Joined:case le.Live:return _.queue_number===null?"Быстрый резерв":`Живая очередь #${_.queue_number}`;case le.Reserve:case le.Reserve_Hostme:return"Бронирование"}return""}),z=()=>{V.value=!0,S.cancelBookingReservation.execute({id:Number(i.itemId)}).then(()=>{O.show("Бронирование отменено"),o("refresh"),o("close"),I.value=!1}).catch(()=>{O.show("Попробуйте еще раз",{label:"Не удалось отменить бронирование",type:"error"})}).finally(()=>{V.value=!1})},ee=()=>{const _=N.value;L.value=!0,S.updateBookingReservation.execute({id:Number(i.itemId),comment:_}).then(()=>{O.show("Комментарий изменен"),u.value&&(u.value={...u.value,comment:_}),f.value=!1}).catch(()=>{O.show("Попробуйте еще раз",{label:"Не удалось изменить комментарий",type:"error"})}).finally(()=>{L.value=!1})};return Y(f,_=>{var a;_&&(N.value=((a=u.value)==null?void 0:a.comment)||"",C.value=N.value)}),Y(y,_=>{o("editMode",_)}),Y([()=>i.itemId,h],([_])=>{x.value=!0,b.value=!1,f.value=!1,A.value=!1,S.loadReservationItem.execute({id:Number(_)}).then(a=>{u.value=a}).finally(()=>{x.value=!1})},{immediate:!0}),(_,a)=>{var j,U,k,q,K;return t(),l(T,null,[x.value||u.value?(t(),l(T,{key:0},[d("h6",ps,X(M.value),1),M.value==="Быстрый резерв"?(t(),l("p",{key:0,class:g(["ark-text_body-xs",_.$style.notification])}," Закроем автоматом через 15 минут, если не будет заказа за столом ",2)):w("",!0),u.value&&u.value.status!==e(le).Reserve&&u.value.status!==e(le).Reserve_Hostme?(t(),l("div",_s,[r(e(va),{class:"ark-text_body-m",size:"s",status:u.value.status,"invite-time":u.value.invite_time,created:u.value.created},null,8,["status","invite-time","created"])])):w("",!0),d("p",{class:g(_.$style.label)},"Гость",2),r(Oe,{name:(j=u.value)==null?void 0:j.name_for_reservation,num:(U=u.value)==null?void 0:U.num_people,foreigner:(k=u.value)==null?void 0:k.foreigner,phone:(q=u.value)==null?void 0:q.phone_number,loading:x.value},null,8,["name","num","foreigner","phone","loading"]),d("p",{class:g(_.$style.label)},"Дата и время",2),r(rt,{edit:A.value,loading:x.value,count:((K=u.value)==null?void 0:K.num_people)??0,start:u.value?u.value.status!==e(le).Reserve&&u.value.status!==e(le).Reserve_Hostme?u.value.seating_time??u.value.created:u.value.seating_time:"1970-01-01T01:01:01+10:00",end:u.value&&u.value.end_time||"1970-01-01T01:01:01+10:00",onClose:a[0]||(a[0]=G=>A.value=!1),onEdited:a[1]||(a[1]=G=>B.value=G)},null,8,["edit","loading","count","start","end"]),d("p",{class:g(_.$style.label)},[c(X(f.value?"Изменение комментария":"Комментарий")+" ",1),e(D)&&e(D).code!==111113&&u.value&&u.value.status!==e(le).Reserve_Hostme?(t(),R(e(E),{key:0,size:"xs",appearance:"neutral",type:"button",disabled:x.value,onClick:a[2]||(a[2]=se(G=>f.value=!f.value,["stop","prevent"]))},{default:p(()=>[c(X(f.value?"Отменить":"Изменить"),1)]),_:1},8,["disabled"])):w("",!0)],2),d("div",{class:g(_.$style.commentContainer)},[f.value?(t(),l("div",fs,[ce(r(e(vs),{modelValue:N.value,"onUpdate:modelValue":a[3]||(a[3]=G=>N.value=G),placeholder:"Комментарий..."},null,8,["modelValue"]),[[e(ft)]]),d("div",{class:g(["ark-space_top-2",_.$style.buttons])},[r(e(E),{type:"button",size:"xs",loading:L.value,onClick:se(ee,["stop","prevent"])},{default:p(()=>[c(" Сохранить ")]),_:1},8,["loading"]),r(e(E),{type:"button",size:"xs",appearance:"flat",onClick:a[4]||(a[4]=se(G=>f.value=!1,["stop","prevent"]))},{default:p(()=>[c(" Отменить ")]),_:1})],2)])):(t(),l("p",{key:1,class:g(["ark-text_body-s-2",x.value&&"ark-skeleton"])},[u.value&&u.value.comment?(t(),l(T,{key:0},[c(X(u.value.comment),1)],64)):(t(),l(T,{key:1},[c("—")],64))],2))],2),d("p",{class:g(_.$style.label)},"Столы",2),u.value?(t(),l("div",{key:2,class:g(["ark-space_bottom-4",[_.$style.tables,x.value&&"ark-skeleton"]])},[r(e(xe),{"show-capacity":!1,"res-id":u.value.id,ids:u.value.tables},null,8,["res-id","ids"])],2)):w("",!0),u.value?(t(),l("div",{key:3,class:g(["ark-space_top-auto",_.$style.actions])},[u.value.status===e(le).Reserve?(t(),R(e(E),{key:0,appearance:"s-danger",onClick:a[5]||(a[5]=G=>I.value=!0)},{default:p(()=>[c(" Отменить бронь ")]),_:1})):w("",!0),r(e(E),{appearance:"flat",onClick:a[6]||(a[6]=G=>F(u.value.id))},{default:p(()=>[c(" Найти на странице ")]),_:1})],2)):w("",!0)],64)):(t(),l("div",bs,[gs,r(e(E),{appearance:"neutral",size:"s",onClick:a[7]||(a[7]=G=>h.value=Date.now())},{default:p(()=>[c(" Попробуйте еще раз ")]),_:1})])),r(e(Ee),{modelValue:I.value,"onUpdate:modelValue":a[8]||(a[8]=G=>I.value=G),size:"sm",order:3.1},{default:p(({close:G})=>{var ne,pe,me,ve;return[ys,r(Oe,{name:(ne=u.value)==null?void 0:ne.name_for_reservation,num:(pe=u.value)==null?void 0:pe.num_people,foreigner:(me=u.value)==null?void 0:me.foreigner,phone:(ve=u.value)==null?void 0:ve.phone_number,loading:x.value},null,8,["name","num","foreigner","phone","loading"]),d("div",{class:g(["ark-space_top-6",_.$style.actions])},[r(e(E),{loading:V.value,onClick:z},{default:p(()=>[c(" Да, отменяем ")]),_:1},8,["loading"]),r(e(E),{appearance:"neutral",onClick:G},{default:p(()=>[c(" Нет, оставляем ")]),_:2},1032,["onClick"])],2)]}),_:1},8,["modelValue"])],64)}}}),hs="_tables_17vaf_1",xs="_commentContainer_17vaf_18",$s="_actions_17vaf_26",ws="_buttons_17vaf_27",Cs="_comment_17vaf_18",Ss="_label_17vaf_43",Ts="_notification_17vaf_59",Bs={tables:hs,commentContainer:xs,actions:$s,buttons:ws,comment:Cs,label:Ss,notification:Ts},Ns={$style:Bs},Ds=ie(ks,[["__cssModules",Ns]]),zs={class:"ark-space_bottom-1"},Os=["disabled","data-active","onClick"],Es=oe({__name:"SepSlots",props:{selectedDate:{},start_time:{},end_time:{}},emits:["update:selectedDate"],setup(P,{emit:m}){const i=P,o=m,{start_time:S,end_time:O}=Ve(i),A=ot*15,f=Q(()=>{const C=new Date(S.value),h=new Date(O.value);if(h.valueOf()-C.valueOf()<A)return[he.jsonParse(C.toJSON())];let x=C;const u=[x],I=x.getMinutes()%15;for(I!==0&&x.setMinutes(x.getMinutes()+(15-I));x.valueOf()<h.valueOf();)x=new Date(ea(x.valueOf()+A,x.valueOf(),h.valueOf())),u.push(x);return u.map(V=>he.jsonParse(V.toJSON()))}),b=C=>{if(C.length===4)return C.map(I=>({dt:I,key:I.valueOf(),disabled:!1}));const h=C.reduce((I,V)=>(I[V.valueOf()]=!0,I),{}),{hours:x}=C[0].time;return new Array(4).fill("").map((I,V)=>{const L=new he(C[0].day,new Re(x,V*15));return{dt:L,key:L.valueOf(),disabled:!h[L.valueOf()]}})},B=Q(()=>f.value.reduce((h,x)=>{const u=x.time.hours;return h[u]=(h[u]||[]).concat(x),h},[]).filter(h=>h.length>0).map(h=>b(h)));return(C,h)=>(t(),l("div",zs,[(t(!0),l(T,null,te(B.value,(x,u)=>(t(),l("div",{key:u,class:g(C.$style.slots)},[(t(!0),l(T,null,te(x,I=>{var V;return t(),l("button",{key:I.key,class:g(C.$style.slots__item),disabled:I.disabled,"data-active":I.key===((V=C.selectedDate)==null?void 0:V.valueOf()),onClick:L=>o("update:selectedDate",I.dt)},X(I.dt.time),11,Os)}),128))],2))),128))]))}}),Vs="_slots_9sxcp_1",Is="_slots__item_9sxcp_9",Ls={slots:Vs,slots__item:Is},Ms={$style:Ls},As=ie(Es,[["__cssModules",Ms]]),Rs=oe({__name:"DoubleCalendar",props:{date:{},max:{},min:{}},emits:["update:date"],setup(P,{emit:m}){const i=m,o=v(et.currentLocal()),S=v(et.currentLocal().append({month:1})),O=f=>{o.value=f,S.value=f.append({month:1})},A=f=>{o.value=f.append({month:-1}),S.value=f};return(f,b)=>(t(),l("div",{class:g(f.$style.root)},[r(e(Pe),{"flex-width":"",bordered:!1,value:f.date,month:o.value,min:f.min,"max-viewed-month":o.value,"show-adjacent-days":!1,max:f.max,onDayClick:b[0]||(b[0]=B=>i("update:date",B)),"onUpdate:month":O},null,8,["value","month","min","max-viewed-month","max"]),r(e(Pe),{"flex-width":"",bordered:!1,value:f.date,month:S.value,"min-viewed-month":S.value,"show-adjacent-days":!1,max:f.max,onDayClick:b[1]||(b[1]=B=>i("update:date",B)),"onUpdate:month":A},null,8,["value","month","min-viewed-month","max"])],2))}}),Ps="_root_dw5ia_1",Xs={root:Ps},Us={$style:Xs},Hs=ie(Rs,[["__cssModules",Us]]),Fs=d("h6",{class:"ark-text_h6 ark-space_bottom-4"},"Новое бронирование",-1),js=d("p",{class:"ark-text_body-s ark-text_medium ark-space_top-3 ark-space_bottom-1 ark-text_64"}," Когда? ",-1),qs=["data-active","onClick"],Js={class:"ark-text_medium ark-text_body-xs",style:{"white-space":"nowrap",opacity:"0.64"}},Zs=["data-active"],Gs={class:"ark-text_medium ark-text_body-xs",style:{"white-space":"nowrap",opacity:"0.64"}},Ws=d("p",{class:"ark-text_body-s ark-text_medium ark-space_top-3 ark-space_bottom-1 ark-text_64"}," Зона (если просят определенную) ",-1),Ks=d("p",{class:"ark-text_body-s ark-text_medium ark-space_top-3 ark-text_64"}," Свободные слоты ",-1),Qs={key:2,style:{position:"relative"}},Ys={key:1},eo=d("span",{class:"ark-text_body-xs"},"(подберем автоматически)",-1),to={style:{position:"sticky",bottom:"0.5rem",left:"0"}},ao={key:3},lo=d("h6",{class:"ark-text_h6 ark-space_bottom-4"},"Подтверди бронирование",-1),so=d("p",{class:"ark-text_body-s ark-text_medium ark-text_64"},"Время",-1),oo={class:"ark-text_semibold ark-space_bottom-2"},no=d("p",{class:"ark-text_body-s ark-text_medium ark-text_64"},"Количество гостей",-1),ro={class:"ark-text_semibold ark-space_bottom-2"},io=d("p",{class:"ark-text_body-s ark-text_medium ark-text_64"},"Зона",-1),uo={class:"ark-text_semibold ark-space_bottom-6"},co=d("span",{class:"ark-text_body-xs"},"(подберем автоматически)",-1),mo=d("h6",{class:"ark-text_h6 ark-space_bottom-3"},"Контактные данные",-1),vo=oe({__name:"NewBookingContent",props:{id:{},maxBookingDate:{},airestoBooking:{type:Boolean}},emits:["add","close"],setup(P,{emit:m}){const i=P,o=m,{maxBookingDate:S}=Ve(i),A=dt().computedSmallerThen("mobile"),f=He(),b=Fe(),B=de(ta),C=de(Ue),h=de(aa),x=mt({name:["",{required:Xe}],phone:["+7",{required:Xe,softPhone:ca(!0)}],comment:[""],tags:[[]]}),u=v(0),I=v(!1),V=v(2),L=v(!1),N=v(null),D=v(null),F=v(!1),y=v(!1),M=v(null),z=v(h.value.day),ee=Q(()=>{const j=h.value.day,U=S.value,k=new Array(10).fill("").map((q,K)=>j.append({day:K}));return U?k.filter(q=>q.daySameOrBefore(U)):k}),_=Q(()=>{const j=z.value;return ee.value.find(U=>U.daySame(j))?"Выбрать":null});Y(z,()=>{N.value=null}),Y([z,V,D,()=>i.id],([j,U,k,q])=>{q&&U&&(L.value=!0,f.loadAvailableSlots.execute({restaurant_id:q,date:j.toJSON(),group_size:U,zone:k??void 0}).then(K=>{K&&(M.value=K,L.value=!1)}).catch(()=>{M.value=null,b.show("Ошибка загрузки слотов для бронирования",{type:"error"}),L.value=!1}))},{immediate:!0});const a=()=>{if(x.validate(),x.invalid.value||!V.value||!N.value)return;const{comment:j,name:U,phone:k,tags:q}=x.getCurrentValue();I.value=!0;const K=D.value;(i.airestoBooking?f.createBooking:f.createBookingReservation).execute({restaurant:Number(i.id),num_people:V.value,name_for_reservation:U,phone_number:`+${la(k)}`,foreigner:!1,comment:j,required_zone:K??void 0,seating_time:`${N.value.day.toJSON()} ${N.value.time.toString("HH:MM")}`,tags:q}).then(ne=>{ne&&(b.show(Ne(De),{autoClose:15e3,data:{...ne,allTables:C.value,__newbooking:i.airestoBooking}}),i.airestoBooking&&o("add",ne),x.comment.reset(),x.name.reset(),x.phone.setValue("+7"),N.value=null,D.value=null,F.value=!1,V.value=2,o("close"))}).catch(()=>{b.show("Попробуйте еще раз",{type:"error",label:"Ошибка добавления бронирования"})}).finally(()=>{I.value=!1})};return(j,U)=>u.value?u.value===1?(t(),l(T,{key:1},[lo,so,d("p",oo,[N.value?(t(),R(e(be),{key:0,today:"",mask:"[day:numeric] [month:long] [year:numeric], [hour:numeric]:[minute:numeric]",date:N.value.toJSON()},null,8,["date"])):w("",!0)]),no,d("p",ro,X(V.value),1),io,d("p",uo,[D.value?(t(),l(T,{key:0},[c(X(D.value),1)],64)):(t(),l(T,{key:1},[c(" Не важно "),co],64))]),mo,d("form",{onSubmit:se(a,["prevent"])},[r(e(ke),{class:"ark-space_bottom-2",control:e(x).name},{default:p(({model:k})=>[r(e(it),{modelValue:k.value,"onUpdate:modelValue":q=>k.value=q,modelModifiers:{capitalize:!0},required:"",label:"Имя",placeholder:"Иван",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),r(e(ke),{class:"ark-space_bottom-2",control:e(x).phone},{default:p(({model:k})=>[r(e(ga),{modelValue:k.value,"onUpdate:modelValue":q=>k.value=q,required:"",label:"Телефон",size:"l"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),r(e(ke),{control:e(x).comment},{default:p(({model:k})=>[r(e(pt),{modelValue:k.value,"onUpdate:modelValue":q=>k.value=q,placeholder:"Комментарий",rows:4},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["control"]),j.airestoBooking?(t(),R(e(ke),{key:0,class:"ark-space_bottom-6",control:e(x).tags},{default:p(({model:k})=>[r(e(_t),{tags:k.value,"onUpdate:tags":q=>k.value=q},null,8,["tags","onUpdate:tags"])]),_:1},8,["control"])):w("",!0),d("div",{class:g(["ark-space_top-6",j.$style.buttons])},[r(e(E),{type:"submit",size:"l",loading:I.value},{default:p(()=>[c(" Подтвердить ")]),_:1},8,["loading"]),r(e(E),{appearance:"neutral",type:"button",size:"l",onClick:U[6]||(U[6]=se(k=>u.value=0,["stop","prevent"]))},{default:p(()=>[c(" Назад ")]),_:1})],2)],32)],64)):w("",!0):(t(),l(T,{key:0},[Fs,r(e(vt),{modelValue:V.value,"onUpdate:modelValue":U[0]||(U[0]=k=>V.value=k),label:"Количество гостей",size:"l",min:1},null,8,["modelValue"]),js,e(A)?(t(),l("div",{key:0,class:g(j.$style.statuses)},[ce((t(),l("div",{class:g(j.$style.statusesScroll)},[(t(!0),l(T,null,te(ee.value,k=>ce((t(),l("button",{key:k.toJSON(),type:"button",class:g(j.$style.date),"data-active":k.daySame(z.value),onClick:q=>z.value=k},[r(e(Se),{mask:"[day:numeric] [month:short]",date:k.toLocalNativeDate()},null,8,["date"]),d("p",Js,[k.daySame(e(h).day)?(t(),l(T,{key:0},[c(" сегодня ")],64)):k.daySame(e(h).day.append({day:1}))?(t(),l(T,{key:1},[c(" завтра ")],64)):(t(),R(e(Se),{key:2,mask:"[weekday:long]",date:k.toLocalNativeDate()},null,8,["date"]))])],10,qs)),[[e(_a),k.daySame(z.value),void 0,{updated:!0}]])),128))],2)),[[e(ct)],[e(pa)]]),r(e(nt),{modelValue:y.value,"onUpdate:modelValue":U[2]||(U[2]=k=>y.value=k),"max-width":243,"min-width":243,"min-height":290},{dropdown:p(()=>[r(e(Pe),{value:z.value,max:e(S),min:e(h).day,onDayClick:U[1]||(U[1]=k=>{z.value=k,y.value=!1})},null,8,["value","max","min"])]),default:p(()=>[d("button",{class:g(j.$style.date),"data-active":!_.value},[_.value?(t(),l(T,{key:0},[c(X(_.value),1)],64)):(t(),l(T,{key:1},[r(e(Se),{mask:"[day:numeric] [month:short]",date:z.value.toLocalNativeDate()},null,8,["date"]),d("p",Gs,[r(e(Se),{mask:"[weekday:long]",date:z.value.toLocalNativeDate()},null,8,["date"])])],64))],10,Zs)]),_:1},8,["modelValue"])],2)):(t(),R(Hs,{key:1,date:z.value,"onUpdate:date":U[3]||(U[3]=k=>z.value=k),max:e(S),min:e(h).day},null,8,["date","max","min"])),Ws,d("div",{class:g(j.$style.statusesScroll)},[(t(!0),l(T,null,te(e(B),(k,q)=>(t(),R(e(ya),{key:q,"hide-radio":"",size:"s",style:{"--ark-background-color":"var(--ark-text-color-08)","white-space":"nowrap"},name:"PreferZone","model-value":D.value,item:k,"onUpdate:modelValue":K=>D.value=k},{default:p(()=>[c(X(k??"Не важно"),1)]),_:2},1032,["model-value","item","onUpdate:modelValue"]))),128))],2),Ks,M.value&&M.value.length>0?(t(),l("div",Qs,[(t(!0),l(T,null,te(M.value,k=>(t(),l("div",{key:k.zone,class:"ark-space_bottom-2"},[k.zone!=="default"?(t(),l(T,{key:0},[c(X(k.zone),1)],64)):(t(),l("p",Ys,[c(" Зона: Не важно "),eo])),(t(!0),l(T,null,te(k.slots,(q,K)=>(t(),R(As,{"selected-date":N.value,"onUpdate:selectedDate":U[4]||(U[4]=G=>N.value=G),key:K,start_time:q.start_time,end_time:q.end_time},null,8,["selected-date","start_time","end_time"]))),128))]))),128)),d("div",to,[r(e(E),{style:{width:"100%"},class:"ark-space_top-4",disabled:!N.value,onClick:U[5]||(U[5]=se(k=>u.value=1,["stop","prevent"]))},{default:p(()=>[c(" Продолжить ")]),_:1},8,["disabled"])]),L.value?(t(),l("div",{key:0,class:g(j.$style.spinner)},[r(e(ze),{name:"spinner",size:16}),c(" Загружаем... ")],2)):w("",!0)])):(t(),l("p",ao,[L.value?(t(),l(T,{key:0},[r(e(ze),{name:"spinner",size:16}),c(" Загружаем... ")],64)):(t(),l(T,{key:1},[c(" Мы не нашли свободных слотов ")],64))]))],64))}}),po="_date_1dz7i_1",_o="_statuses_1dz7i_25",fo="_statusesScroll_1dz7i_30",bo="_inline_1dz7i_45",go="_preview_1dz7i_51",yo="_spinner_1dz7i_55",ko="_buttons_1dz7i_71",ho={date:po,statuses:_o,statusesScroll:fo,inline:bo,preview:go,spinner:yo,buttons:ko},xo={$style:ho},$o=ie(vo,[["__cssModules",xo]]),wo={class:"ark-text_h6 ark-space_bottom-4"},Co=d("p",null,"Есть несохраненные изменения в бронировании.",-1),So=d("p",{class:"ark-space_bottom-6 ark-text_bold"},"Данные потеряются",-1),To=oe({__name:"BookingRoot",props:{id:{}},setup(P){const m=Ae.currentLocal().append({day:4}),i=ka(),{reservationToShow:o,newBookingOpened:S}=sa(i),O=na(),A=ra(),b=dt().computedSmallerThen("mobile"),B=v(null),C=v(!1),h=v(!1),x=de(ut),u=()=>{h.value=!1},I=()=>{B.value=null,C.value?h.value=!0:A.push({query:{...O.query,type:void 0,bookingid:void 0}})},V=()=>{var L,N;C.value=!1,A.push({query:{...O.query,type:(L=B.value)!=null&&L.airesto?void 0:"resto",bookingid:(N=B.value)==null?void 0:N.full.id}}),B.value=null,h.value=!1};return(L,N)=>{const D=ia("RouterView");return t(),l(T,null,[r(D),r(e(Ee),{modelValue:e(S),"onUpdate:modelValue":N[0]||(N[0]=F=>oa(S)?S.value=F:null),overscroll:"none",size:e(b)?"full":void 0},{default:p(({close:F})=>{var y,M;return[r($o,{id:L.id,"airesto-booking":(y=e(x))==null?void 0:y.has_bookings,"max-booking-date":(M=e(x))!=null&&M.has_bookings?void 0:e(m),onAdd:e(i).onAddBooking,onClose:F},null,8,["id","airesto-booking","max-booking-date","onAdd","onClose"])]}),_:1},8,["modelValue","size"]),r(e(Aa),{"close-button":"",direction:"right","model-value":e(o)!==null,"root-class":L.$style.tablebarRoot,"content-class":L.$style.tableBarContent,"onUpdate:modelValue":I},{default:p(()=>[e(o)?(t(),l("div",{key:0,class:g(L.$style.tablebarContent)},[e(o).type==="resto"?(t(),R(Ds,{key:0,"item-id":e(o).id,onRefresh:N[1]||(N[1]=F=>e(i).onDeleteReservation(e(o).id)),onEditMode:N[2]||(N[2]=F=>C.value=F),onClose:u},null,8,["item-id"])):(t(),R(rs,{key:1,"item-id":e(o).id,onRefresh:N[3]||(N[3]=F=>e(i).onHandleAiresto(e(o).id,F)),onEditMode:N[4]||(N[4]=F=>C.value=F),onClose:u,onChangeTable:e(i).onSwapTables},null,8,["item-id","onChangeTable"]))],2)):w("",!0)]),_:1},8,["model-value","root-class","content-class"]),r(e(Ee),{modelValue:h.value,"onUpdate:modelValue":N[5]||(N[5]=F=>h.value=F),size:"sm"},{default:p(({close:F})=>[d("h6",wo," Точно хочешь "+X(B.value?"открыть другую бронь?":"закрыть бронь?"),1),Co,So,d("div",{class:g(L.$style.buttons)},[r(e(E),{onClick:V},{default:p(()=>[c(" Да, "+X(B.value?"открыть":"закрыть"),1)]),_:1}),r(e(E),{appearance:"neutral",class:"ark-space_left-1",onClick:F},{default:p(()=>[c(" Нет, подожди ")]),_:2},1032,["onClick"])],2)]),_:1},8,["modelValue"])],64)}}}),Bo="_tablebarRoot_1x6gy_1",No="_tablebarContent_1x6gy_8",Do="_forstickytable_1x6gy_16",zo={tablebarRoot:Bo,tablebarContent:No,forstickytable:Do},Oo={$style:zo},Yo=ie(To,[["__cssModules",Oo]]);export{Yo as default};
