import{_ as Te}from"./index-127a01d9.js";import{d as Ie,a3 as Be,m as ze,u as je,r as I,b as D,o,c,a as u,n as _,t as h,k as e,F as L,g as te,q as J,af as Me,l as b,h as r,aD as Re,S as ve,W as re,i as g,j as f,A as w,T as l,ak as qe,ac as ye,_ as Ee,aM as He,w as ue,aC as be,al as Ce,aN as Ge,y as we,p as Ue,ad as Je,aP as Fe,aL as Ve,a1 as $e,$ as ee,Z as W,a0 as oe,a2 as Le,bd as Ke,P as Qe,Q as Ze,e as Xe,f as Ye,C as et,bc as tt,z as De,aq as le,aK as xe,ah as Ae,ai as at,aj as st}from"./index-ed930d81.js";import{E as nt}from"./index-f92f87fc.js";import{F as ot}from"./index-d9c5e50f.js";import{U as ge}from"./index-316df51b.js";import{c as Ne,b as lt}from"./index-4237dd58.js";import{u as We}from"./index-8666b17c.js";import"./index-5396820b.js";const ut=["data-id","data-high"],it={style:{"text-align":"right"}},rt=["href"],ct=u("p",{class:"ark-text_body-xs ark-text_64"},"Комментарий",-1),dt={class:"ark-text_body-s-2 ark-text_medium"},_t=u("span",{class:"ark-space_left-1 ark-space_right-1"},"‐",-1),mt=Ie({__name:"BookingItem",props:{item:{},loading:{type:Boolean},highlight:{type:Boolean}},emits:["refresh"],setup(fe,{emit:ce}){const C=fe,z=ce,{item:p}=Be(C),O=ze(),A=je(),S=I(!1),ae=I(!1),de=I(!1),P=I(!1),N=I(!1),R=I(!1),ie=I(!1),F=D(()=>{const d=p.value;return d.phone_number?qe(d.phone_number):""}),j=()=>{R.value=!0;const d=C.item.status,$={id:C.item.id,status:d};A.updateBooking.execute({id:C.item.id,status:l.APPLICATION}).then(y=>{y&&(O.show(ye(ge),{autoClose:!1,type:"undo",data:{title:"Подтвердили бронь",callback:()=>A.updateBooking.execute($).then(x=>{x&&z("refresh",x)})}}),z("refresh",y))}).catch(()=>{O.show("Попробуй еще раз",{label:"Не удалось подтвердить",type:"error"})}).finally(()=>{R.value=!1})},K=()=>{ie.value=!0;const d=C.item.status,$={id:C.item.id,status:d};A.updateBooking.execute({id:C.item.id,status:l.APPLICATION}).then(y=>{y&&(O.show(ye(ge),{autoClose:!1,type:"undo",data:{title:"Вернули бронь",callback:()=>A.updateBooking.execute($).then(x=>{x&&z("refresh",x)})}}),z("refresh",y))}).catch(()=>{O.show("Попробуй еще раз",{label:"Не удалось вернуть бронь",type:"error"})}).finally(()=>{ie.value=!1})},q=()=>{P.value=!0;const d=C.item.status,$={id:C.item.id,status:d};A.updateBooking.execute({id:C.item.id,status:l.OPEN}).then(y=>{y&&(O.show(ye(ge),{autoClose:!1,type:"undo",data:{title:"За столом",callback:()=>A.updateBooking.execute($).then(x=>{x&&z("refresh",x)})}}),z("refresh",y))}).catch(()=>{O.show("Попробуй еще раз",{label:"Не удалось обновить",type:"error"})}).finally(()=>{P.value=!1})},se=()=>{N.value=!0;const d=C.item.status,$={id:C.item.id,status:d};A.updateBooking.execute({id:C.item.id,status:l.CLOSED}).then(y=>{y&&(O.show(ye(ge),{autoClose:!1,type:"undo",data:{title:"Завершили бронь",callback:()=>A.updateBooking.execute($).then(x=>{x&&z("refresh",x)})}}),z("refresh",y))}).catch(()=>{O.show("Попробуй еще раз",{label:"Не удалось обновить",type:"error"})}).finally(()=>{N.value=!1})},Z=()=>{ae.value=!0;const d=C.item.status,T=C.item.id,$=C.item.comment,y={id:T,status:d,comment:$};A.updateBooking.execute({id:C.item.id,status:l.CANCELLED}).then(x=>{x&&(O.show(ye(ge),{autoClose:!1,type:"undo",data:{title:"Отменили бронь",callback:()=>A.updateBooking.execute(y).then(me=>{me&&z("refresh",me)})}}),z("refresh",x))}).catch(()=>{O.show("Попробуй еще раз",{label:"Не удалось отменить бронирование",type:"error"})}).finally(()=>{ae.value=!1})},X=()=>{de.value=!0,A.updateBooking.execute({id:C.item.id,clients_are_late:!0}).then(d=>{d&&(O.show("Перенесли на 15 минут"),z("refresh",d))}).catch(()=>{O.show("Попробуй еще раз",{label:"Не удалось перенести бронь",type:"error"})}).finally(()=>{de.value=!1})},_e=d=>{d.animationName==="arkVibe"&&d.target&&d.target.classList.remove("ark-vibe")};return(d,T)=>(o(),c("div",{"data-id":e(p).id,class:_(d.$style.item),"data-high":d.highlight,onAnimationend:_e},[u("div",{class:_(["ark-text_h6 ark-space_bottom-1",[d.$style.item__header,d.loading&&"ark-skeleton"]])},[u("span",{class:_([d.$style.name,S.value&&d.$style.name_full]),onClick:T[0]||(T[0]=$=>S.value=!S.value)},h(e(p).name_for_reservation),3),u("div",it,[(o(!0),c(L,null,te(e(p).tables,$=>(o(),J(e(Me),{id:$,key:$},null,8,["id"]))),128))])],2),u("div",{class:_([d.$style.content,d.loading&&"ark-skeleton"])},[e(p).phone_number?(o(),c("a",{key:0,href:`tel:${e(p).phone_number}`,class:_(d.$style.phone)},h(F.value),11,rt)):b("",!0),r(e(Re),{seating_time:e(p).seating_time,end_time:e(p).end_time,status:e(p).status},null,8,["seating_time","end_time","status"])],2),e(p).comment?(o(),c("div",{key:0,class:_([d.$style.comment,d.loading&&"ark-skeleton"])},[ct,u("p",dt,h(e(p).comment),1)],2)):b("",!0),u("hr",{class:_(d.$style.hr)},null,2),u("div",{class:_(["ark-text_body-l-2 ark-text_semibold",[d.$style.inline,d.loading&&"ark-skeleton"]])},[r(e(ve),{class:"ark-text_48 ark-space_right-1",name:"clock",size:16}),r(e(re),{mask:"[hour:numeric]:[minute:numeric]",date:e(p).seating_time},null,8,["date"]),_t,r(e(re),{mask:"[hour:numeric]:[minute:numeric]",date:e(p).end_time},null,8,["date"]),r(e(ve),{class:"ark-text_48 ark-space_left-3 ark-space_right-1",name:"users",size:16}),u("span",null,h(e(p).num_people),1)],2),u("hr",{class:_(d.$style.hr)},null,2),u("div",{class:_([d.$style.buttons,d.loading&&"ark-skeleton"])},[r(e(w),{appearance:"neutral-b",size:"xs",to:{query:{...d.$route.query,bookingid:e(p).id}}},{default:g(()=>[f(" Изменить ")]),_:1},8,["to"]),e(p).status===e(l).CLOSED||e(p).status===e(l).CANCELLED||e(p).status===e(l).CANCELLED_NO_DEPOSIT?(o(),J(e(w),{key:0,size:"xs",appearance:"s-danger",loading:ie.value,onClick:K},{default:g(()=>[f(' Вернуть в "ожидаем" ')]),_:1},8,["loading"])):b("",!0),e(p).status===e(l).NEW?(o(),J(e(w),{key:1,size:"xs",loading:R.value,onClick:j},{default:g(()=>[f(" Подтвердить ")]),_:1},8,["loading"])):b("",!0),e(p).status===e(l).APPLICATION||e(p).status===e(l).WAITING?(o(),J(e(w),{key:2,appearance:"success",size:"xs",loading:P.value,onClick:q},{default:g(()=>[f(" За столом ")]),_:1},8,["loading"])):b("",!0),e(p).status===e(l).APPLICATION?(o(),J(e(w),{key:3,appearance:"attention",size:"xs",loading:de.value,onClick:X},{default:g(()=>[f(" Опаздывают ")]),_:1},8,["loading"])):b("",!0),e(p).status===e(l).OPEN?(o(),J(e(w),{key:4,appearance:"success",size:"xs",loading:N.value,onClick:se},{default:g(()=>[f(" Завершен ")]),_:1},8,["loading"])):b("",!0),e(p).status===e(l).APPLICATION||e(p).status===e(l).NEW?(o(),J(e(w),{key:5,appearance:"s-danger",size:"xs",loading:ae.value,onClick:Z},{default:g(()=>[f(" Отменить ")]),_:1},8,["loading"])):b("",!0)],2)],42,ut))}}),vt="_item_s84ft_1",ft="_item__header_s84ft_14",kt="_name_s84ft_21",pt="_name_full_s84ft_36",yt="_phone_s84ft_40",gt="_inline_s84ft_45",ht="_content_s84ft_50",bt="_comment_s84ft_56",Ct="_bottom_s84ft_66",$t="_actions_s84ft_74",Nt="_buttons_s84ft_83",Lt="_hr_s84ft_101",wt={item:vt,item__header:ft,name:kt,name_full:pt,phone:yt,inline:gt,content:ht,comment:bt,bottom:Ct,actions:$t,buttons:Nt,hr:Lt},Ot={$style:wt},St=Ee(mt,[["__cssModules",Ot]]),It={class:"ark-space_bottom-1"},Et={class:"ark-text_semibold"},Dt={class:"ark-text_body-s"},xt={key:0,class:"ark-text_body-xs"},At=u("h6",{class:"ark-text_h6 ark-space_bottom-6"},"Легенда для таблицы",-1),Pt={class:"ark-text_h6"},Tt={class:"ark-text_body-s"},Bt=["data-status"],zt=u("span",null,"Константин",-1),jt={class:"ark-text_semibold"},Mt=u("p",{class:"ark-text_semibold"}," Отмененные и завершенные бронирования не показываются ",-1),Pe="2024-02-14T13:00:00",Ht=Ie({__name:"BookingLine",props:{bookings:{}},setup(fe){Ge(s=>({"0da9dcd1":Se.value,"4585c4f8":x.value,"4da59064":pe.value}));const ce=fe,{bookings:C}=Be(ce),z=We(),{reservationToShow:p}=He(z),O=we(Fe),A=we(Ve),S=[{title:"1. На подтверждение",subtitle:"Бронирование необходимо подтвердить",status:l.NEW},{title:"2. Ожидаем",subtitle:"Бронь подтверждена, ожидаем гостей",status:l.APPLICATION},{title:"3. В ресторане",subtitle:"Гости в ресторане, но еще не за столом",status:l.WAITING},{title:"4. За столом",subtitle:"Гости сидят за столом",status:l.OPEN}],ae=localStorage.getItem("__ark-supra-booking-line-mode"),P=I(ae==="all"||ae==="now"?ae:"all");ue(P,s=>{localStorage.setItem("__ark-supra-booking-line-mode",s)});const N=s=>{const[a,k]=s.split("T");return new ee(oe.jsonParse(a),W.fromString(k))},R=localStorage.getItem("__ark-supra-booking-line-left"),ie=Number.isNaN(R)?1:Ce(Number(R),1,10),F=localStorage.getItem("__ark-supra-booking-line-right"),j=Number.isNaN(F)?2:Ce(Number(F),1,10),K=I(ie),q=I(j),se=I(!1),Z=I(localStorage.getItem("__ark-supra-booking-line-full")==="1");ue(Z,s=>{s?localStorage.setItem("__ark-supra-booking-line-full","1"):localStorage.removeItem("__ark-supra-booking-line-full")}),ue(K,s=>{localStorage.setItem("__ark-supra-booking-line-left",`${s}`)}),ue(q,s=>{localStorage.setItem("__ark-supra-booking-line-right",`${s}`)});const X=(s,a)=>{a==="left"?K.value=Ce(K.value+s,1,10):q.value=Ce(q.value+s,1,10)},_e=D(()=>C.value.filter(a=>a.status!==l.CANCELLED&&a.status!==l.CANCELLED_NO_DEPOSIT&&a.status!==l.CLOSED).sort((a,k)=>N(a.seating_time).valueOf()-N(k.seating_time).valueOf())),d=D(()=>{const s=_e.value;if(P.value==="all")return s;const a=A.value.daytime.valueOf(),k=K.value,G=q.value;return s.filter(B=>{const m=N(B.seating_time);return N(B.end_time).valueOf()<a-$e*k||a+$e*G>m.valueOf()})}),T=D(()=>{if(P.value==="now"){const m=K.value,E=q.value,{day:M,time:H}=A.value.daytime,n=new ee(M,new W(H.hours,0,0)).valueOf(),i=new Date(n-$e*m),t=new Date(n+$e*E);return{min:new ee(oe.fromLocalNativeDate(i),W.fromLocalNativeDate(i)),max:new ee(oe.fromLocalNativeDate(t),W.fromLocalNativeDate(t))}}const s=d.value;if(s.length===0)return{min:new ee(oe.currentLocal(),W.currentLocal()),max:new ee(oe.currentLocal(),W.currentLocal())};let a=N(s[0].seating_time),k=N(s[0].end_time);s.forEach(m=>{const E=N(m.seating_time),M=N(m.end_time);a=E.valueOf()<a.valueOf()?E:a,k=M.valueOf()<k.valueOf()?k:M});const G=new Date(a.valueOf()-Le*15);a=new ee(oe.fromLocalNativeDate(G),W.fromLocalNativeDate(G));const B=new Date(k.valueOf()+Le*15);return k=new ee(oe.fromLocalNativeDate(B),W.fromLocalNativeDate(B)),{min:a,max:k}}),$=D(()=>{const{min:s,max:a}=T.value;return Ke(s,a,{minutes:15}).map(k=>({style:{left:`${Ne(k.valueOf(),s.valueOf(),a.valueOf())}%`},nice:k.time.minutes===0,item:k}))}),y=D(()=>{const s=T.value,a=Math.ceil((s.max.valueOf()-s.min.valueOf())/Le);return{a:{"min-width":`${a+48}px`},b:{"min-width":`${a}px`}}}),x=D(()=>{const s=O.value.daytime.valueOf(),{min:a,max:k}=T.value;return`${Ne(s,a.valueOf(),k.valueOf())}%`});function me(s,a,k){const G=N(s.seating_time),B=N(s.end_time),m=Ne(G.valueOf(),a.valueOf(),k.valueOf()),E=Ne(B.valueOf(),a.valueOf(),k.valueOf());return{left:`${m}%`,width:`${E-m}%`}}const Oe=D(()=>{const s=d.value,{min:a,max:k}=T.value;return s.reduce((B,m)=>{if(m.status!==l.CANCELLED&&m.status!==l.CANCELLED_NO_DEPOSIT&&m.status!==l.CLOSED){const E=me(m,a,k);m.tables.forEach(M=>{B[M]=(B[M]||[]).concat({...m,style:E})})}return B},{})}),ke={a:[],b:[],c:[]},Y=D(()=>{const s=Oe.value,k=Object.keys(s).length===0;return{empty:k,items:k?ke:s}}),pe=D(()=>`${Object.keys(Y.value.items).length*1.5}rem`),Se=D(()=>{const s=Z.value,a=Object.keys(Y.value.items);return`${Math.min(s?1/0:6,a.length)*1.5}rem`});return(s,a)=>{var G,B;const k=Ue("RouterLink");return o(),c("div",It,[u("div",{class:_(s.$style.buttons)},[P.value==="now"?(o(),c(L,{key:0},[r(e(w),{"icon-button":"",appearance:"neutral",size:"xs",icon:"minus",onClick:a[0]||(a[0]=m=>X(-1,"left"))}),r(e(w),{"icon-button":"",appearance:"neutral",size:"xs",icon:"plus",onClick:a[1]||(a[1]=m=>X(1,"left"))})],64)):b("",!0),r(e(w),{size:"xs",class:"ark-space_left-auto",appearance:P.value==="all"?"primary":"neutral",onClick:a[2]||(a[2]=m=>P.value="all")},{default:g(()=>[f(" Весь день ")]),_:1},8,["appearance"]),r(e(w),{class:"ark-space_right-auto",size:"xs",appearance:P.value==="all"?"neutral":"primary",onClick:a[3]||(a[3]=m=>P.value="now")},{default:g(()=>[f(" Сейчас ")]),_:1},8,["appearance"]),P.value==="now"?(o(),c(L,{key:1},[r(e(w),{"icon-button":"",appearance:"neutral",size:"xs",icon:"minus",onClick:a[4]||(a[4]=m=>X(-1,"right"))}),r(e(w),{"icon-button":"",appearance:"neutral",size:"xs",icon:"plus",onClick:a[5]||(a[5]=m=>X(1,"right"))})],64)):b("",!0)],2),u("div",{class:_(s.$style.root)},[u("div",{class:_(s.$style.carousel),style:be(y.value.a)},[(o(!0),c(L,null,te(Y.value.items,(m,E,M)=>(o(),c("div",{key:E,class:_([s.$style.table,M%2===0&&s.$style.table_even])},[u("div",{class:_(s.$style.table__name)},[Y.value.empty?b("",!0):(o(),J(e(Me),{key:0,id:E},null,8,["id"]))],2),u("div",{class:_(s.$style.line)},[(o(!0),c(L,null,te(m,H=>{var n;return o(),J(k,{key:H.id,class:_(s.$style.bubble),style:be(H.style),"data-selected":((n=e(p))==null?void 0:n.id)===`${H.id}`,"data-status":H.status,to:{query:{...s.$route.query,bookingid:H.id}}},{default:g(()=>[u("span",null,h(H.name_for_reservation),1),u("span",Et,[r(e(ve),{name:"users",size:8}),f(h(H.num_people),1)]),u("div",{class:_(s.$style.inline)},[r(re,{mask:"[hour:numeric]:[minute:numeric]",date:H.seating_time},null,8,["date"]),f(" ‐ "),r(re,{mask:"[hour:numeric]:[minute:numeric]",date:H.end_time},null,8,["date"])],2)]),_:2},1032,["class","style","data-selected","data-status","to"])}),128))],2)],2))),128))],6),Y.value.empty?(o(),c("div",{key:0,class:_(s.$style.empty)},[u("p",Dt,[f(" Нету броней "),P.value==="now"?(o(),c(L,{key:0},[f(" с "+h((G=T.value.min.time)==null?void 0:G.toString("HH:MM:SS"))+" до "+h((B=T.value.max.time)==null?void 0:B.toString("HH:MM:SS")),1)],64)):b("",!0)]),P.value==="now"?(o(),c("p",xt," Попробуй увеличить промежуток ")):b("",!0)],2)):b("",!0),u("div",{class:_(s.$style.times),style:be(y.value.b)},[(o(!0),c(L,null,te($.value,m=>(o(),c("div",{key:m.item.toJSON(),class:_([s.$style.times__item,m.nice&&s.$style.times__item_nice]),style:be(m.style)},h(m.item.time),7))),128))],6)],2),u("div",{class:_(s.$style.between)},[u("a",{class:"ark-text_body-xs ark-text_semibold",onClick:a[6]||(a[6]=m=>se.value=!se.value)}," Легенда (что означает каждый цвет) "),u("a",{class:"ark-text_body-xs ark-text_semibold",onClick:a[7]||(a[7]=m=>Z.value=!Z.value)},h(Z.value?"Свернуть":"На всю высоту"),1)],2),r(e(Je),{modelValue:se.value,"onUpdate:modelValue":a[8]||(a[8]=m=>se.value=m)},{default:g(({close:m})=>[At,(o(),c(L,null,te(S,(E,M)=>(o(),c(L,{key:M},[u("h6",Pt,h(E.title),1),u("p",Tt,h(E.subtitle),1),u("div",{class:_(["ark-space_bottom-4",[s.$style.bubble,s.$style.bubble_static]]),"data-status":E.status},[zt,u("span",jt,[r(e(ve),{name:"users",size:8}),f("2 ")]),u("div",{class:_(s.$style.inline)},[r(re,{mask:"[hour:numeric]:[minute:numeric]",date:Pe}),f(" ‐ "),r(re,{mask:"[hour:numeric]:[minute:numeric]",date:Pe})],2)],10,Bt)],64))),64)),Mt,r(e(w),{appearance:"neutral",class:"ark-space_top-4",style:{width:"100%"},onClick:m},{default:g(()=>[f(" Все понятно ")]),_:2},1032,["onClick"])]),_:1},8,["modelValue"])])}}}),Vt="_root_1juyi_2",Wt="_carousel_1juyi_15",Rt="_table_1juyi_24",qt="_table__name_1juyi_29",Gt="_table_even_1juyi_41",Ut="_line_1juyi_50",Jt="_bubble_1juyi_57",Ft="_bubble_static_1juyi_86",Kt="_inline_1juyi_116",Qt="_between_1juyi_123",Zt="_times_1juyi_129",Xt="_times__item_1juyi_153",Yt="_times__item_nice_1juyi_166",ea="_empty_1juyi_173",ta="_buttons_1juyi_186",aa="_showMobile_1juyi_193",sa={root:Vt,carousel:Wt,table:Rt,table__name:qt,table_even:Gt,line:Ut,bubble:Jt,bubble_static:Ft,inline:Kt,between:Qt,times:Zt,times__item:Xt,times__item_nice:Yt,empty:ea,buttons:ta,showMobile:aa},na={$style:sa},oa=Ee(Ht,[["__cssModules",na]]),la=["data-list"],ua={class:"ark-text_h6 ark-text_semibold ark-space_top-2 ark-space_bottom-1"},ia={class:"ark-space_bottom-2",style:{display:"flex",gap:"0.5rem"}},ra=["data-active","onClick"],ca=["data-active"],da=u("p",{class:"ark-text_body-xs ark-text_semibold ark-text_64"}," Shift + колесико мышки для скролла по горизонтали ",-1),_a=["data-active","onClick"],ma=["data-active"],va={class:"ark-text_body-xs"},fa={key:2},ka={class:"ark-text_body-s",style:{display:"flex","flex-wrap":"wrap","flex-direction":"column"}},pa=u("span",{class:"ark-text_body-xs"},"С",-1),ya={class:"ark-text_semibold"},ga={key:2,class:"ark-space_top-1"},ha=["data-list"],ba={key:4,style:{"text-align":"center",width:"100%"}},Ca=u("img",{src:Te,width:"128",height:"128",alt:"No users",class:"ark-space_bottom-4"},null,-1),$a=u("h3",{class:"ark-space_bottom-6 ark-text_h5"}," Нет бронирований на сегодня ",-1),Na=[Ca,$a],La={key:5,style:{"text-align":"center",width:"100%"}},wa=u("img",{src:Te,width:"128",height:"128",alt:"No users",class:"ark-space_bottom-4"},null,-1),Oa=u("h3",{class:"ark-space_bottom-6 ark-text_h5"}," Нет бронирований с таким фильтром ",-1),Sa=Ie({__name:"BookingList",props:{id:{}},setup(fe){const ce=fe,C=We(),{navItems:z,todaysLoading:p,todaysBookings:O,reservationToShow:A,tableDate:S}=He(C),ae=je(),de=ze(),N=Qe().computedSmallerThen("mobile"),R=I(!1),ie=we(at),F=we(Ve),j=I(localStorage.getItem("__ark-supra-booking-list-design")==="1");ue(j,n=>{n?localStorage.setItem("__ark-supra-booking-list-design","1"):localStorage.removeItem("__ark-supra-booking-list-design")});const K=I(Date.now()),q=I(""),se=I(!1),Z=I(Date.now()),X=I(!1),_e=I(NaN),d=I(null),$=(()=>{let n={};try{const i=localStorage.getItem("__ark-supra-booking-list-filter");i&&(n=JSON.parse(i))}catch{}return n})(),y=Ze({Все:$.Все??!1,Пересиживают:$.Пересиживают??!1,[l.APPLICATION]:$[l.APPLICATION]??!0,[l.NEW]:$[l.NEW]??!1,[l.OPEN]:$[l.OPEN]??!1,[l.CANCELLED]:$[l.CANCELLED]??!1,[l.CANCELLED_NO_DEPOSIT]:$[l.CANCELLED_NO_DEPOSIT]??!1,[l.CLOSED]:$[l.CLOSED]??!1,[l.WAITING]:$[l.WAITING]??!1});ue(y,n=>{localStorage.setItem("__ark-supra-booking-list-filter",JSON.stringify(n))});const x={[l.NEW]:"Подтвердить",[l.APPLICATION]:"Ожидаем",[l.WAITING]:"Ожидает",[l.OPEN]:"В зале",[l.CANCELLED]:"Отменен",[l.CANCELLED_NO_DEPOSIT]:"Отменен, не внес депозит",[l.CLOSED]:"Завершен"},me=["Все",l.NEW,l.APPLICATION,l.OPEN,"Пересиживают",l.CLOSED,l.CANCELLED],Oe=D(()=>{const i=F.value.day;return new Array(5).fill("").map((t,v)=>i.append({day:v}))}),ke=D(()=>{const n=Oe.value;return N?n.slice(0,4):n}),Y=D(()=>{const n=S.value;return!ke.value.find(i=>i.daySame(n))}),pe=D(()=>{if(p.value)return O.value.length>0?O.value:lt;const n=ie.value,t=O.value.sort((U,V)=>new Date(U.seating_time).valueOf()-new Date(V.seating_time).valueOf()),v=(q.value||"").trim().toLowerCase();if(v)return t.filter(U=>U.phone_number.includes(v)||U.name_for_reservation.toLowerCase().includes(v)||U.tables.some(V=>{const Q=n[V];return Q?Q.number.includes(v)||Q.zone.toLowerCase().includes(v):!1}));if(y.Все)return t;const ne=F.value.native.valueOf();return t.filter(U=>{if(y.Пересиживают&&U.status===l.OPEN){const[V,Q]=U.end_time.split("T");return new ee(oe.jsonParse(V),W.fromString(Q)).valueOf()<ne}return y[U.status]})});function Se(n,i){const t=i,v=i+1,ne=Object.keys(n).map(Number).sort((V,Q)=>V-Q);function he(V){for(const Q of ne)if(Q>=V)return{hour:Q,count:n[Q]};return null}function U(V){return{hour:V,count:n[V]!==void 0?n[V]:null,closest:he(V)}}return{in1Hour:U(t),in2Hours:U(v)}}const s=D(()=>{const n=F.value.daytime.time,i=d.value||{};return Object.keys(i).reduce((t,v)=>{const ne=Number(v);return n.hours<=ne&&(t[v]=i[v]),t},{})}),a=D(()=>{const n=W.fromLocalNativeDate(F.value.native);return Se(s.value||{},n.hours)}),k=D(()=>{const n=F.value.native.valueOf();return O.value.reduce((t,v)=>{if(v.status===l.APPLICATION||v.status===l.NEW||v.status===l.OPEN||v.status===l.WAITING){t[v.status]=(t[v.status]||0)+v.num_people;const[ne,he]=v.end_time.split("T");new ee(oe.jsonParse(ne),W.fromString(he)).valueOf()<n&&v.status===l.OPEN&&(t.Пересиживают=(t.Пересиживают||0)+v.num_people),t.Все=(t.Все||0)+v.num_people}return t},{})}),G=["минуту","минуты","минут"],B=D(()=>{Z.value;const n=K.value,i=W.currentLocal().valueOf()-W.fromLocalNativeDate(new Date(n)).valueOf(),t=W.fromAbsoluteMilliseconds(i);return t.hours?"больше часа":t.minutes?`${t.minutes} ${st(G,t.minutes)}`:"меньше минуты"}),m=n=>{_e.value=Date.now(),O.value=O.value.map(i=>i.id===n.id?n:i)},E=n=>{n==="Все"?(Object.keys(y).forEach(i=>{y[i]=!1}),y.Все=!0):(y.Все=!1,y[n]=!y[n])};let M=null;Xe(()=>{M=setInterval(()=>{Z.value=Date.now()},Le)}),Ye(()=>{M&&clearInterval(M)});const H=()=>{K.value=Date.now()};return ue([()=>ce.id,S,_e],([n,i])=>{se.value=!0,ae.bookingGuestCount.execute({id:n,date:i.toJSON()}).then(t=>{d.value=t}).catch(()=>{de.show("Попробуй перезагрузить страницу",{type:"error",label:"Не удалось загрузить кол-во гостей"})}).finally(()=>{se.value=!1})},{immediate:!0}),ue([()=>ce.id,S,K],([n,i])=>{C.onSafeLoadBookings(n,i)},{immediate:!0}),(n,i)=>(o(),c("div",{class:_(n.$style.container),"data-list":!e(N)&&j.value},[u("div",ua,[f(" Бронирования по дням "),r(re,{class:"ark-text_body-s ark-text_64",mask:", [day:numeric] [month:long]",style:{display:"inline"},date:e(S).toJSON()},null,8,["date"])]),u("div",ia,[r(e(tt),{size:"s",border:!1,class:_(n.$style.tabs),items:e(z)},{default:g(({item:t})=>[f(h(t.text),1)]),_:1},8,["class","items"]),e(N)?b("",!0):(o(),J(e(w),{key:0,appearance:"accent",size:"xs",icon:"plus",class:"ark-space_top-2 ark-space_left-1",onClick:e(C).toggleNewBooking},{default:g(()=>[f(" Добавить ")]),_:1},8,["onClick"])),r(e(w),{appearance:"flat",size:"xs",icon:"refresh",class:"ark-space_top-2",onClick:H},{default:g(()=>[e(N)?b("",!0):(o(),c(L,{key:0},[f("Обновлено")],64)),f(" "+h(B.value)+" назад ",1)]),_:1})]),e(N)?b("",!0):(o(),c(L,{key:0},[u("div",{class:_(n.$style.inline)},[r(e(De),{modelValue:q.value,"onUpdate:modelValue":i[0]||(i[0]=t=>q.value=t),class:"ark-space_bottom-1",placeholder:"Телефон, имя, стол",style:{"max-width":"288px",width:"100%"}},{left:g(()=>[r(e(ve),{name:"search"})]),_:1},8,["modelValue"]),(o(!0),c(L,null,te(ke.value,(t,v)=>(o(),c("button",{key:t.toJSON(),class:_(n.$style.date),"data-active":t.daySame(e(S)),onClick:ne=>S.value=t},[r(e(le),{class:"ark-text_semibold",mask:"[day:numeric] [month:long]",date:t.toLocalNativeDate()},null,8,["date"]),u("p",null,[v<2?(o(),c(L,{key:0},[f(h(e(F).day.daySame(t)?"сегодня":"завтра"),1)],64)):(o(),J(e(le),{key:1,mask:"[weekday:long]",date:t.toLocalNativeDate()},null,8,["date"]))])],10,ra))),128)),r(e(Ae),{modelValue:R.value,"onUpdate:modelValue":i[2]||(i[2]=t=>R.value=t),align:"right","max-width":243,"min-width":243,"min-height":290},{dropdown:g(()=>[r(e(xe),{value:e(S),onDayClick:i[1]||(i[1]=t=>{S.value=t,R.value=!1})},null,8,["value"])]),default:g(()=>[u("button",{style:{height:"2.5rem"},class:_(n.$style.date),"data-active":Y.value},[Y.value?(o(),c(L,{key:0},[r(e(le),{class:"ark-text_semibold",mask:"[day:numeric] [month:long]",date:e(S).toLocalNativeDate()},null,8,["date"]),u("p",null,[r(e(le),{mask:"[weekday:long]",date:e(S).toLocalNativeDate()},null,8,["date"])])],64)):(o(),c(L,{key:1},[f(" Выбрать ")],64))],10,ca)]),_:1},8,["modelValue"])],2),da],64)),r(oa,{bookings:e(O)},null,8,["bookings"]),e(N)?(o(),c(L,{key:1},[r(e(De),{modelValue:q.value,"onUpdate:modelValue":i[3]||(i[3]=t=>q.value=t),placeholder:"Телефон, имя, стол",size:"s",class:_(n.$style.search)},{left:g(()=>[r(e(ve),{name:"search"})]),_:1},8,["modelValue","class"]),u("div",{class:_(["ark-space_top-1",n.$style.inline])},[(o(!0),c(L,null,te(ke.value,(t,v)=>(o(),c("button",{key:t.toJSON(),class:_(n.$style.date),"data-active":t.daySame(e(S)),onClick:ne=>S.value=t},[r(e(le),{class:"ark-text_semibold",mask:"[day:numeric] [month:long]",date:t.toLocalNativeDate()},null,8,["date"]),u("p",null,[v<2?(o(),c(L,{key:0},[f(h(e(F).day.daySame(t)?"сегодня":"завтра"),1)],64)):(o(),J(e(le),{key:1,mask:"[weekday:long]",date:t.toLocalNativeDate()},null,8,["date"]))])],10,_a))),128)),r(e(Ae),{modelValue:R.value,"onUpdate:modelValue":i[5]||(i[5]=t=>R.value=t),align:"right","max-width":243,"min-width":243,"min-height":290},{dropdown:g(()=>[r(e(xe),{value:e(S),onDayClick:i[4]||(i[4]=t=>{S.value=t,R.value=!1})},null,8,["value"])]),default:g(()=>[u("button",{style:{height:"2.5rem"},class:_(n.$style.date),"data-active":Y.value},[Y.value?(o(),c(L,{key:0},[r(e(le),{class:"ark-text_semibold",mask:"[day:numeric] [month:long]",date:e(S).toLocalNativeDate()},null,8,["date"]),u("p",null,[r(e(le),{mask:"[weekday:long]",date:e(S).toLocalNativeDate()},null,8,["date"])])],64)):(o(),c(L,{key:1},[f(" Выбрать ")],64))],10,ma)]),_:1},8,["modelValue"])],2)],64)):b("",!0),et((o(),c("div",{class:_(["ark-space_bottom-1 ark-space_top-1",n.$style.statuses])},[(o(),c(L,null,te(me,t=>r(e(w),{key:t,size:"xs",appearance:y.Все?t==="Все"?"primary":"neutral":y[t]?"primary":"neutral",onClick:v=>E(t)},{default:g(()=>[f(h(x[t]??t)+" ",1),k.value[t]?(o(),c("span",{key:0,class:_(n.$style.count)},h(k.value[t])+"чел ",3)):b("",!0)]),_:2},1032,["appearance","onClick"])),64)),e(N)?b("",!0):(o(),c(L,{key:0},[r(e(w),{size:"xs",icon:"list",class:"ark-space_left-auto",appearance:j.value?"neutral":"flat",onClick:i[6]||(i[6]=t=>j.value=!0)},{default:g(()=>[f(" Списком ")]),_:1},8,["appearance"]),r(e(w),{size:"xs",icon:"grid",appearance:j.value?"flat":"neutral",onClick:i[7]||(i[7]=t=>j.value=!1)},{default:g(()=>[f(" Сеткой ")]),_:1},8,["appearance"])],64))],2)),[[e(ot)]]),u("p",va,[a.value.in1Hour.count!==null?(o(),c("span",{key:0,class:_(n.$style.wait)},[f(" с "+h(a.value.in1Hour.hour)+":00 ‐ ",1),u("b",null,h(a.value.in1Hour.count)+" чел",1)],2)):b("",!0),a.value.in2Hours.count!==null?(o(),c("span",{key:1,class:_(n.$style.wait)},[f(" с "+h(a.value.in2Hours.hour)+":00 ‐ ",1),u("b",null,h(a.value.in2Hours.count)+" чел",1)],2)):b("",!0),a.value.in1Hour.count===null&&a.value.in2Hours.count===null&&a.value.in1Hour.closest?(o(),c("span",fa,[f(" Ближайщее в "+h(a.value.in1Hour.closest.hour)+":00 ожидаем ",1),u("b",null,h(a.value.in1Hour.closest.count)+" чел",1)])):b("",!0),u("a",{class:"ark-space_left-1 ark-text_semibold",onClick:i[8]||(i[8]=t=>X.value=!X.value)}," Вся разбивка по часам ")]),r(e(nt),{opened:X.value},{default:g(()=>[u("div",ka,[(o(!0),c(L,null,te(s.value,(t,v)=>(o(),c("p",{key:v},[pa,f(" "+h(v)+":00 ‐ ",1),u("span",ya,h(t)+"чел",1)]))),128))])]),_:1},8,["opened"]),e(N)?(o(),c("div",ga,[r(e(w),{size:"xs",icon:"list",appearance:j.value?"neutral":"flat",onClick:i[9]||(i[9]=t=>j.value=!0)},{default:g(()=>[f(" Списком ")]),_:1},8,["appearance"]),r(e(w),{size:"xs",icon:"grid",appearance:j.value?"flat":"neutral",onClick:i[10]||(i[10]=t=>j.value=!1)},{default:g(()=>[f(" Сеткой ")]),_:1},8,["appearance"])])):b("",!0),pe.value.length>0?(o(),c("div",{key:3,class:_(["ark-space_top-1",n.$style.bookings]),"data-list":j.value},[(o(!0),c(L,null,te(pe.value,t=>{var v;return o(),J(St,{key:t.id,item:t,loading:e(p),highlight:((v=e(A))==null?void 0:v.id)===`${t.id}`,onRefresh:m},null,8,["item","loading","highlight"])}),128))],10,ha)):e(O).length===0?(o(),c("div",ba,Na)):pe.value.length===0?(o(),c("div",La,[wa,Oa,r(e(w),{onClick:i[11]||(i[11]=t=>E("Все"))},{default:g(()=>[f("Показать все брони")]),_:1})])):b("",!0),e(N)?(o(),c("div",{key:6,class:_(n.$style.safe__content)},[r(e(w),{"icon-button":"",icon:"refresh",appearance:"elevation",size:"l",shape:"square",class:"ark-space_left-auto",onClick:H}),r(e(w),{"icon-button":"",shape:"square",icon:"plus",size:"l",appearance:"accent",onClick:e(C).toggleNewBooking},null,8,["onClick"])],2)):b("",!0)],10,la))}}),Ia="_container_gs8ud_2",Ea="_bookings_gs8ud_8",Da="_statuses_gs8ud_20",xa="_count_gs8ud_36",Aa="_wait_gs8ud_44",Pa="_safe_gs8ud_51",Ta="_safe__content_gs8ud_54",Ba="_search_gs8ud_70",za="_search_focused_gs8ud_73",ja="_tabs_gs8ud_77",Ma="_inline_gs8ud_82",Ha="_date_gs8ud_97",Va={container:Ia,bookings:Ea,statuses:Da,count:xa,wait:Aa,safe:Pa,safe__content:Ta,search:Ba,search_focused:za,tabs:ja,inline:Ma,date:Ha},Wa={$style:Va},Xa=Ee(Sa,[["__cssModules",Wa]]);export{Xa as default};
